function logout(){delCookie("Environmental.inspection.session"),window.location=httphead+"//"+window.location.host+basic_address+"login.html"}function video_windows(e){window.open(httphead+"//"+window.location.host+basic_address+"/video/video.html?id="+e,"监控录像","height=284, width=340, top=0, left=400,toolbar=no, menubar=no, scrollbars=no, resizable=no, location=no, status=no")}function screen_windows(){window.open(httphead+"//"+window.location.host+screen_saver_address+"?id="+usr.id+"&StatCode="+monitor_selected.StatCode,"屏幕保护","height=auto, width=auto")}function write_title(e,t){$("#page_title").empty(),$("#page_title").append("<h3>"+e+" <small>"+t+"</small></h3>")}function active_menu(e){$SIDEBAR_MENU.find("li.active").addClass("active-sm").removeClass("active"),$SIDEBAR_MENU.find("li").each(function(){$(this).removeClass("current-page")}),$SIDEBAR_MENU.find('a[id="'+e+'"]').parent("li").addClass("current-page")}function nav_check(){"true"==usr.admin?$("#Admin_menu").css("display","block"):$("#Admin_menu").css("display","none"),$("#Hello_label").text("您好："+usr.name);$(NaN);$("#Hello_label").append("<span class=' fa fa-angle-down'></span>")}function modal_middle(e){$BODY.hasClass("nav-md")||$MENU_TOGGLE.click(),setTimeout(function(){var t=$(e).find(".modal-dialog");parseInt(($(window).height()-t.height())/2)>0&&t.animate({"margin-top":parseInt(($(window).height()-t.height())/2)},300)},wait_time_short)}function on_collapse(e){touchcookie()}function PageInitialize(){get_user_information()}function hide_menu(){for(var e in usr.userauth.webauth)"false"==usr.userauth.webauth[e]&&$("#"+e).css("display","none")}function get_user_information(){var e=getQueryString("session"),t={session:e},a={action:"UserInfo",type:"query",body:t,user:"null"},o=function(e){var t=e.status;"false"==t?show_alarm_module(!0,"获取用户失败，请联系管理员",null):(usr=e.ret,get_alarm_type_list(),get_user_message(),get_user_image(),nav_check(),get_sensor_list(),get_camera_unit(),get_project_list(),hide_menu(),setTimeout(mp_monitor,wait_time_middle),getshowaction())};JQ_get(request_head,a,o)}function show_expiredModule(){modal_middle($("#ExpiredAlarm")),$("#ExpiredAlarm").modal("show")}function show_searchbar(){global_key_word="",$("#CommonQueryInput").val(""),$("#QueryBar").css("display","block")}function hide_searchbar(){$("#QueryBar").css("display","none")}function calculate_row(){var e=($(window).height(),parseInt(($(window).height()-650)/100));e<=0?table_row=5:e>=5?table_row=10:table_row+=e}function show_table_tags(){$("#Warning_"+alarm_type_list[0].id+"_day").css("display","block")}function show_table_tags2(){alarm_interval_tab="#Warning_"+alarm_type_list[0].id+"_month2",$("#Warning_"+alarm_type_list[0].id+"_month2").css("display","block")}function show_table_tags3(){null===alarm_interval_tab?($("#Warning_"+alarm_type_list[0].id+"_minute2").css("display","block"),alarm_interval_tab="#Warning_"+alarm_type_list[0].id+"_minute2"):($tail=alarm_interval_tab.split("_"),"day2"===$tail[2]||"week2"===$tail[2]||"month2"===$tail[2]?($("#Alarm_chart_view2").css("display","block"),$("#Alarm_chart_realtime_view2").css("display","none")):($("#Alarm_chart_view2").css("display","none"),$("#Alarm_chart_realtime_view2").css("display","block")),$(alarm_interval_tab).css("display","block"))}function user_manager(){clear_window(),write_title("用户管理","根据您的权限对用户进行添加/删除/修改等操作"),$("#UserManageView").css("display","block"),show_searchbar(),user_initial||user_intialize(0)}function pg_manage(){clear_window(),write_title("项目组管理","根据您的权限对项目组进行添加/删除/修改等操作"),$("#PGManageView").css("display","block"),show_searchbar(),pg_initial||pg_intialize(0)}function key_manage(){clear_window(),write_title("钥匙管理","根据您的权限对项目组进行添加/删除/修改等操作"),$("#KeyManageView").css("display","block"),show_searchbar(),key_initial||key_intialize(0)}function proj_manage(){clear_window(),write_title("项目管理","根据您的权限对项目进行添加/删除/修改等操作"),$("#ProjManageView").css("display","block"),show_searchbar(),proj_intialize(0)}function para_manage(){clear_window(),write_title("参数管理","您可以在这里升级您的设备版本"),$("#ParaManageView").css("display","block"),hide_searchbar(),parameter_initial||parameter_initialize()}function mp_manage(){clear_window(),write_title("站点管理","根据您的权限对站点进行配置"),$("#MPManageView").css("display","block"),show_searchbar(),point_initial||point_intialize(0)}function dev_manage(){clear_window(),write_title("设备管理","根据您的权限对设备进行配置"),$("#DevManageView").css("display","block"),show_searchbar(),device_initial||dev_intialize(0)}function mp_monitor(){clear_window(),write_title("地图监控","在地图上对站点进行监控"),CURRENT_URL="MPMonitor",$("#MPMonitorView").css("display","block"),console.log("into map:"+map_initialized),hide_searchbar(),initializeMap()}function mp_monitor_table(){clear_window(),write_title("站点聚合","实时刷新"),$("#MPMonitorTableView").css("display","block"),hide_searchbar(),Monitor_table_initialized||initialize_warning_table()}function mp_monitor_card(){clear_window(),write_title("站点列块","点选设备卡片以获得详细信息"),hide_searchbar(),$("#MPMonitorCardView").css("display","block")}function mp_static_monitor_table(){clear_window(),write_title("站点聚合","请手工刷新"),$("#MPMonitorStaticTableView").css("display","block"),hide_searchbar(),query_static_warning()}function warning_check(){clear_window(),write_title("告警查看","可以导出报表"),$("#WarningCheckView").css("display","block"),hide_searchbar(),alarm_map_initialized||initializeAlarmMap()}function warning_handle(){clear_window(),$("#WarningHandleView").css("display","block"),write_title("告警处理","请查看报表"),hide_searchbar(),warning_handle_initialize()}function desktop(){clear_window(),hide_searchbar(),write_title("欢迎","请选择您需要的功能"),$("#Desktop").css("display","block")}function Inst_Conf(){clear_window(),write_title("施工中",""),hide_searchbar(),$("#Undefined").css("display","block")}function Inst_Read(){clear_window(),write_title("施工中",""),hide_searchbar(),$("#Undefined").css("display","block")}function Inst_Design(){clear_window(),write_title("施工中",""),hide_searchbar(),$("#Undefined").css("display","block")}function Inst_Control(){clear_window(),write_title("施工中",""),hide_searchbar(),$("#Undefined").css("display","block")}function Inst_Snapshot(){clear_window(),write_title("施工中",""),hide_searchbar(),$("#Undefined").css("display","block")}function Inst_Video(){clear_window(),write_title("施工中",""),hide_searchbar(),$("#Undefined").css("display","block")}function Audit_Target(){clear_window(),write_title("施工中",""),hide_searchbar(),$("#Undefined").css("display","block")}function Audit_Stability(){clear_window(),write_title("稳定性统计","请手工刷新"),hide_searchbar(),$("#AuditStabilityView").css("display","block"),query_audit_stability()}function Audit_Availability(){clear_window(),write_title("施工中",""),hide_searchbar(),$("#Undefined").css("display","block")}function Audit_Error(){clear_window(),write_title("施工中",""),hide_searchbar(),$("#Undefined").css("display","block")}function Audit_Quality(){clear_window(),write_title("施工中",""),hide_searchbar(),$("#Undefined").css("display","block")}function Geo_InfoQuery(){clear_window(),CURRENT_URL="Undefined",write_title("施工中",""),hide_searchbar(),$("#Undefined").css("display","block")}function Geo_TrendAnalysis(){clear_window(),CURRENT_URL="Undefined",write_title("施工中",""),hide_searchbar(),$("#Undefined").css("display","block")}function Geo_DisaterForecast(){clear_window(),CURRENT_URL="Undefined",write_title("施工中",""),hide_searchbar(),$("#Undefined").css("display","block")}function Geo_EmergencyDirect(){clear_window(),write_title("施工中",""),hide_searchbar(),$("#Undefined").css("display","block")}function Geo_DiffusionAnalysis(){clear_window(),write_title("施工中",""),hide_searchbar(),$("#Undefined").css("display","block")}function Work_flowDesign(){clear_window(),write_title("施工中",""),hide_searchbar(),$("#Undefined").css("display","block")}function Order_Management(){clear_window(),write_title("施工中",""),hide_searchbar(),$("#Undefined").css("display","block")}function Unloading_Management(){clear_window(),write_title("施工中",""),hide_searchbar(),$("#Undefined").css("display","block")}function Order_Audit(){clear_window(),write_title("施工中",""),hide_searchbar(),$("#Undefined").css("display","block")}function AD_Conf(){clear_window(),write_title("施工中",""),hide_searchbar(),$("#Undefined").css("display","block")}function WEB_Conf(){clear_window(),write_title("施工中",""),hide_searchbar(),$("#Undefined").css("display","block")}function key_auth(){clear_window(),write_title("钥匙授权",""),$("#KeyAuthView").css("display","block"),key_auth_initialize()}function key_history(){clear_window(),write_title("开锁历史查询","请输入查询条件"),$("#KeyHistoryView").css("display","block"),key_history_initialize()}function clear_window(){$("#UserManageView").css("display","none"),$("#PGManageView").css("display","none"),$("#ProjManageView").css("display","none"),$("#ParaManageView").css("display","none"),$("#MPManageView").css("display","none"),$("#DevManageView").css("display","none"),$("#MPMonitorView").css("display","none"),$("#MPMonitorTableView").css("display","none"),$("#MPMonitorCardView").css("display","none"),$("#MPMonitorStaticTableView").css("display","none"),$("#WarningCheckView").css("display","none"),$("#WarningHandleView").css("display","none"),$("#Desktop").css("display","none"),$("#Undefined").css("display","none"),$("#KeyManageView").css("display","none"),$("#KeyHistoryView").css("display","none"),$("#KeyAuthView").css("display","none"),$("#AuditStabilityView").css("display","none")}function get_project_pg_list(){var e={action:"ProjectPGList",type:"query",user:usr.id},t=function(e){return"false"==e.status?void show_expiredModule():void(project_pg_list=e.ret)};JQ_get(request_head,e,t)}function get_user_table(e,t){var a={startseq:e,length:t,keyword:global_key_word},o={action:"UserTable",type:"query",body:a,user:usr.id},n=function(e){return"false"==e.status?void show_expiredModule():(user_table=e.ret.usertable,user_start=parseInt(e.ret.start),user_total=parseInt(e.ret.total),void draw_user_table_head())};JQ_get(request_head,o,n)}function del_user(e){var t={userid:e},a={action:"UserDel",type:"mod",body:t,user:usr.id},o=function(e){var t=e.status;"true"==t?(del_user_flash=function(){clear_user_detail_panel(),user_intialize(0)},setTimeout(function(){show_alarm_module(!1,"删除成功！",del_user_flash)},500)):setTimeout(function(){show_alarm_module(!0,"删除失败！"+e.msg,null)},500)};JQ_get(request_head,a,o),$("#UserDelAlarm").modal("hide")}function new_user(e,t){var a={name:e.name,nickname:e.nickname,password:e.password,mobile:e.mobile,mail:e.mail,type:e.type,memo:e.memo,auth:t},o={action:"UserNew",type:"mod",body:a,user:usr.id},n=function(e){var t=e.status;"true"==t?($("#newUserModal").modal("hide"),create_user_flash=function(){clear_user_detail_panel(),user_intialize(0)},setTimeout(function(){show_alarm_module(!1,"创建成功！",create_user_flash)},500)):setTimeout(function(){show_alarm_module(!0,"创建失败！"+e.msg,null)},500)};JQ_get(request_head,o,n)}function modify_user(e,t){var a={userid:e.id,name:e.name,nickname:e.nickname,password:e.password,mobile:e.mobile,mail:e.mail,type:e.type,memo:e.memo,auth:t},o={action:"UserMod",type:"mod",body:a,user:usr.id},n=function(e){var t=e.status;"true"==t?($("#newUserModal").modal("hide"),mod_user_flash=function(){clear_user_detail_panel(),user_intialize(0)},setTimeout(function(){show_alarm_module(!1,"修改成功！",mod_user_flash)},500)):setTimeout(function(){show_alarm_module(!0,"修改失败！"+e.msg,null)},500)};JQ_get(request_head,o,n)}function get_user_proj(e){var t={userid:e},a={action:"UserProj",body:t,type:"query",user:usr.id},o=function(e){return"false"==e.status?void show_expiredModule():(user_selected_auth=e.ret,void draw_user_detail_proj_table())};JQ_get(request_head,a,o)}function get_user_key(e){var t={userid:e},a={action:"UserKey",body:t,type:"query",user:usr.id},o=function(e){return"false"==e.status?void show_expiredModule():(user_selected_key=e.ret,void draw_user_detail_key_table())};JQ_get(request_head,a,o)}function user_intialize(e){user_initial=!0,user_table=null,get_user_table(e,5*table_row),get_project_pg_list()}function draw_user_table_head(){if(null!==user_table){var e=Math.ceil(user_table.length/table_row);$("#User_Page_control").empty();var t,a="<li><a href='#' id='user_page_prev'>Prev</a></li>",o=Math.ceil(user_start/table_row);for(t=0;t<e;t++)a=a+"<li><a href='#' id='user_page_"+t+"'>"+(t+o+1)+"</a></li>";for(a+="<li><a href='#' id='user_page_next'>Next</a></li>",$("#User_Page_control").append(a),table_head="<thead><tr><th>序号</th><th>用户名</th><th>昵称</th><th>电话</th><th>属性</th><th>更新日期</th>",table_head+="</tr></thread>",click_draw_user_table=function(){draw_user_table($(this))},t=0;t<e;t++)$("#user_page_"+t).on("click",click_draw_user_table);user_start<=0?$("#user_page_prev").css("display","none"):($("#user_page_prev").css("display","block"),$("#user_page_prev").on("click",function(){var e=user_start-5*table_row;e<0&&(e=0),user_intialize(e)})),user_start+5*table_row>=user_total?$("#user_page_next").css("display","none"):($("#user_page_next").css("display","block"),$("#user_page_next").on("click",function(){user_intialize(user_start+5*table_row)})),draw_user_table($("#user_page_0"))}}function get_user_level(e){return"0"==e?"管理员":"1"==e?"高级用户":"2"==e?"一级用户":"3"==e?"二级用户":"4"==e?"三级用户":"未知级别"}function draw_user_table(e){if($("#Table_user").empty(),null!==user_table){var t=(parseInt(e.html())-1)*table_row-user_start,a=table_head;a+="<tbody>";var o;for(o=0;o<table_row;o++)t+o<user_table.length?(a=0!==o%2?a+"<tr class='success li_menu' id='table_cell"+o+"' userid='"+user_table[t+o].id+"'>":a+"<tr class='li_menu' id='table_cell"+o+"' userid='"+user_table[t+o].id+"'>",a=a+"<td>"+user_table[t+o].id+"</td><td>"+user_table[t+o].name+"</td><td>"+user_table[t+o].nickname+"</td><td>"+user_table[t+o].mobile+"</td>",a=a+"<td>"+get_user_level(user_table[t+o].type)+"</td>",a=a+"<td>"+user_table[t+o].date+"</td>",a+="</tr>"):(a=0!==o%2?a+"<tr class='success' id='table_cell"+o+"' userid='null'>":a+"<tr  id='table_cell"+o+"' userid='null'>",a+="<td>--</td><td>--</td><td>--</td><td>--</td><td>--</td><td>--</td>",a+="</tr>");for(a+="</tbody>",$("#Table_user").append(a),table_cell_click=function(){if("null"!=$(this).attr("userid")){for(var e=0;e<user_table.length;e++)if($(this).attr("userid")==user_table[e].id){user_selected=user_table[e];break}Initialize_user_detail(),touchcookie()}},o=0;o<table_row;o++)$("#table_cell"+o).on("click",table_cell_click)}}function Initialize_user_detail(){draw_user_detail_panel(),get_user_proj(user_selected.id)}function clear_user_detail_panel(){user_selected=null;var e="<p></p><p></p><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt >用户名：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt >用户类型：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt >联系方式：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd></dl></div><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt>用户昵称：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt>修改日期：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt>邮箱：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd></dl></div><div class='col-md-12 col-sm-12 col-xs-12 column'><dl ><dt>备注：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd></dl></div>";$("#Label_user_detail").empty(),$("#Label_user_detail").append(e),$("#Table_user_authed").empty()}function draw_user_detail_panel(){if($("#Label_user_detail").empty(),null!==user_selected_auth){var e=get_user_level(user_selected.type),t="<p></p><p></p><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt >用户名：</dt><dd>"+user_selected.name+"</dd><dt >用户类型：</dt><dd>"+e+"</dd><dt >联系方式：</dt><dd>"+user_selected.mobile+"</dd></dl></div><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt>用户昵称：</dt><dd>"+user_selected.nickname+"</dd><dt>修改日期：</dt><dd>"+user_selected.date+"</dd><dt>邮箱：</dt><dd>"+user_selected.mail+"</dd></dl></div><div class='col-md-12 col-sm-12 col-xs-12 column'><dl ><dt>备注：</dt><dd>"+user_selected.memo+"</dd></dl></div>";$("#Label_user_detail").append(t)}}function draw_user_detail_proj_table(){$("#Table_user_authed").empty(),txt="<thead> <tr> <th>已关联项目 </th> </tr> </thead> <tbody >";for(var e=0;e<user_selected_auth.length;e++)txt=txt+"<tr> <td>"+user_selected_auth[e].name+"</td> </tr>";txt+="</tbody>",$("#Table_user_authed").append(txt)}function draw_user_detail_key_table(){$("#Table_user_key").empty(),txt="<thead> <tr> <th>钥匙名称 </th> <th>归属项目 </th></tr> </thead> <tbody >",null===user_selected_key&&(user_selected_key=[]);for(var e=0;e<user_selected_key.length;e++)txt=txt+"<tr id='"+user_selected_key[e].id+"' class='keyrow'> <td>"+user_selected_key[e].name+"</td> <td>"+user_selected_key[e].domain+"</td></tr>";txt+="</tbody>",$("#Table_user_key").append(txt),$(".keyrow").on("click",function(){var e=$(this).attr("id");void 0!==e&&""!==e&&get_key_auth_list(e)})}function show_new_user_module(){$("#newModalLabel").text("创建新用户"),user_module_status=!0,$("#NewUsername_Input").val(""),$("#NewUserNick_Input").val(""),$("#NewPassword_Input").val(""),$("#NewRePassword_Input").val(""),$("#NewUserMobile_Input").val(""),$("#NewUserMail_Input").val(""),$("#NewUserMemo_Input").val(""),$("#NewUserType_choice").val("false"),$("#NewUsername_Input").attr("placeholder","用户名"),$("#NewPassword_Input").attr("placeholder","密码"),$("#NewRePassword_Input").attr("placeholder","重复密码"),$("#NewUserMobile_Input").attr("placeholder","电话号码"),$("#NewUserMail_Input").attr("placeholder","邮箱"),$("#duallistboxUserAuth_new").empty();var e="";null===project_pg_list&&(project_pg_list=[]);for(var t=0;t<project_pg_list.length;t++)e="<option value='"+project_pg_list[t].id+"'>"+project_pg_list[t].name+"</option>",$("#duallistboxUserAuth_new").append(e);$(".NewUserAuthDual").bootstrapDualListbox("refresh",!0),modal_middle($("#newUserModal")),$("#newUserModal").modal("show")}function submit_new_user_module(){var e=$("#NewUsername_Input").val(),t=$("#NewUserNick_Input").val(),a=$("#NewPassword_Input").val(),o=$("#NewRePassword_Input").val(),n=$("#NewUserMobile_Input").val(),i=$("#NewUserMail_Input").val(),l=$("#NewUserMemo_Input").val();if(null===e||""===e)return $("#NewUsername_Input").attr("placeholder","用户名不能为空"),void $("#NewUsername_Input").focus();if(null===a||""===a)return $("#NewPassword_Input").attr("placeholder","密码不能为空"),$("#NewRePassword_Input").attr("placeholder","密码不能为空"),void $("#NewPassword_Input").focus();if(a!=o)return $("#NewPassword_Input").val(""),$("#NewRePassword_Input").val(""),$("#NewPassword_Input").attr("placeholder","密码不正确，请重新输入"),$("#NewRePassword_Input").attr("placeholder","密码不正确，请重新输入"),void $("#NewPassword_Input").focus();if(null===n||""===n)return $("#NewUserMobile_Input").attr("placeholder","电话号码不能为空"),void $("#NewUserMobile_Input").focus();if(null===i||""===i)return $("#NewUserMail_Input").attr("placeholder","邮箱不能为空"),void $("#NewUserMail_Input").focus();var r={name:e,nickname:t,password:b64_sha1(o),mobile:n,mail:i,type:$("#NewUserType_choice").val(),memo:l},d=[];$("#duallistboxUserAuth_new :selected").each(function(e,t){var a={id:$(t).val(),name:$(t).text()};d.push(a)}),console.log(d),new_user(r,d)}function show_mod_user_module(e,t){$("#newModalLabel").text("用户信息修改：密码栏不输入表示不修改密码"),user_module_status=!1,$("#NewUsername_Input").val(e.name),$("#NewUserNick_Input").val(e.nickname),$("#NewPassword_Input").val(""),$("#NewRePassword_Input").val(""),$("#NewUserMobile_Input").val(e.mobile),$("#NewUserMail_Input").val(e.mail),$("#NewUserMemo_Input").val(e.memo),$("#NewUsername_Input").attr("placeholder","用户名"),$("#NewPassword_Input").attr("placeholder","密码"),$("#NewRePassword_Input").attr("placeholder","重复密码"),$("#NewUserMobile_Input").attr("placeholder","电话号码"),$("#NewUserMail_Input").attr("placeholder","邮箱"),$("#NewUserType_choice").val(e.type),$("#duallistboxUserAuth_new").empty();var a="";null===project_pg_list&&(project_pg_list=[]);for(var o=0;o<project_pg_list.length;o++){a="<option value='"+project_pg_list[o].id+"'";for(var n=0;n<t.length;n++)if(t[n].id==project_pg_list[o].id){a+="selected='selected'";break}a=a+">"+project_pg_list[o].name+"</option>",$("#duallistboxUserAuth_new").append(a)}$(".NewUserAuthDual").bootstrapDualListbox("refresh",!0),modal_middle($("#newUserModal")),$("#newUserModal").modal("show")}function submit_mod_user_module(){var e=$("#NewUsername_Input").val(),t=$("#NewUserNick_Input").val(),a=$("#NewPassword_Input").val(),o=$("#NewRePassword_Input").val(),n=$("#NewUserMobile_Input").val(),i=$("#NewUserMail_Input").val(),l=$("#NewUserMemo_Input").val();if(""!==a&&""!==o&&a!=o)return $("#NewPassword_Input").val(""),$("#NewRePassword_Input").val(""),$("#NewPassword_Input").attr("placeholder","密码不正确，请重新输入"),$("#NewRePassword_Input").attr("placeholder","密码不正确，请重新输入"),void $("#NewPassword_Input").focus();""!==o&&(o=b64_sha1(o));var r={id:user_selected.id,name:e,nickname:t,password:o,mobile:n,mail:i,type:$("#NewUserType_choice").val(),memo:l},d=[];$("#duallistboxUserAuth_new :selected").each(function(e,t){var a={id:$(t).val(),name:$(t).text()};d.push(a)}),modify_user(r,d)}function get_project_list(){var e={action:"ProjectList",type:"query",user:usr.id},t=function(e){return"false"==e.status?void show_expiredModule():void(project_list=e.ret)};JQ_get(request_head,e,t)}function get_pg_table(e,t){var a={startseq:e,length:t,keyword:global_key_word},o={action:"PGTable",body:a,type:"query",user:usr.id},n=function(e){return"false"==e.status?void show_expiredModule():(pg_table=e.ret.pgtable,pg_start=parseInt(e.ret.start),pg_total=parseInt(e.ret.total),void draw_pg_table_head())};JQ_get(request_head,o,n)}function del_pg(e){var t={PGCode:e},a={action:"PGDel",type:"mod",body:t,user:usr.id},o=function(e){var t=e.status;"true"==t?(del_pg_flash=function(){clear_pg_detail_panel(),pg_intialize(0)},setTimeout(function(){show_alarm_module(!1,"删除成功！",del_pg_flash)},500)):setTimeout(function(){show_alarm_module(!0,"删除失败！"+e.msg,null)},500)};JQ_get(request_head,a,o),$("#PGDelAlarm").modal("hide")}function new_pg(e,t){var a={PGCode:e.PGCode,PGName:e.PGName,ChargeMan:e.ChargeMan,Telephone:e.Telephone,Department:e.Department,Address:e.Address,Stage:e.Stage,Projlist:t},o={action:"PGNew",type:"mod",body:a,user:usr.id},n=function(e){var t=e.status;"true"==t?($("#newPGModal").modal("hide"),new_pg_flash=function(){clear_pg_detail_panel(),pg_intialize(0)},setTimeout(function(){show_alarm_module(!1,"创建成功！",new_pg_flash)},500)):setTimeout(function(){show_alarm_module(!0,"创建失败！"+e.msg,null)},500)};JQ_get(request_head,o,n)}function modify_pg(e,t){var a={PGCode:e.PGCode,PGName:e.PGName,ChargeMan:e.ChargeMan,Telephone:e.Telephone,Department:e.Department,Address:e.Address,Stage:e.Stage,Projlist:t},o={action:"PGMod",type:"mod",body:a,user:usr.id},n=function(e){var t=e.status;"true"==t?($("#newPGModal").modal("hide"),mod_pg_flash=function(){clear_pg_detail_panel(),pg_intialize(0)},setTimeout(function(){show_alarm_module(!1,"修改成功！",mod_pg_flash)},500)):setTimeout(function(){show_alarm_module(!0,"修改失败！"+e.msg,null)},500)};JQ_get(request_head,o,n)}function get_pg_proj(e){var t={PGCode:e},a={action:"PGProj",type:"query",body:t,user:usr.id},o=function(e){return"false"==e.status?void show_expiredModule():(pg_selected_proj=e.ret,void draw_pg_detail_panel())};JQ_get(request_head,a,o)}function pg_intialize(e){null===project_list&&get_project_list(),pg_initial=!0,pg_table=null,get_pg_table(e,5*table_row),clear_pg_detail_panel(),get_project_list()}function draw_pg_table_head(){if(null!==pg_table){var e=Math.ceil(pg_table.length/table_row);$("#PG_Page_control").empty();var t,a="<li><a href='#' id='pg_page_prev'>Prev</a></li>",o=Math.ceil(pg_start/table_row);for(t=0;t<e;t++)a=a+"<li><a href='#' id='pg_page_"+t+"'>"+(t+o+1)+"</a></li>";for(a+="<li><a href='#' id='pg_page_next'>Next</a></li>",$("#PG_Page_control").append(a),table_head="<thead><tr><th>编号</th> <th>名称 </th> <th>责任人 </th> <th>电话 </th> <th>单位 </th>",table_head+="</tr></thread>",pg_page_click=function(){draw_pg_table($(this))},t=0;t<e;t++)$("#pg_page_"+t).on("click",pg_page_click);pg_start<=0?$("#pg_page_prev").css("display","none"):($("#pg_page_prev").css("display","block"),$("#pg_page_prev").on("click",function(){var e=pg_start-5*table_row;e<0&&(e=0),pg_intialize(e)})),pg_start+5*table_row>=pg_total?$("#pg_page_next").css("display","none"):($("#pg_page_next").css("display","block"),$("#pg_page_next").on("click",function(){pg_intialize(pg_start+5*table_row)})),draw_pg_table($("#pg_page_0"))}}function draw_pg_table(e){if($("#Table_pg").empty(),null!==pg_table){var t=(parseInt(e.html())-1)*table_row-pg_start,a=table_head;a+="<tbody>";var o;for(o=0;o<table_row;o++)t+o<pg_table.length?(a=0!==o%2?a+"<tr class='success  li_menu' id='pg_table_cell"+o+"' PGCode='"+pg_table[t+o].PGCode+"'>":a+"<tr class=' li_menu' id='pg_table_cell"+o+"' PGCode='"+pg_table[t+o].PGCode+"'>",a=a+"<td>"+pg_table[t+o].PGCode+"</td><td>"+pg_table[t+o].PGName+"</td><td>"+pg_table[t+o].ChargeMan+"</td><td>"+pg_table[t+o].Telephone+"</td>",a=a+"<td>"+pg_table[t+o].Department+"</td>",a+="</tr>"):(a=0!==o%2?a+"<tr class='success' id='pg_table_cell"+o+"' PGCode='null'>":a+"<tr  id='pg_table_cell"+o+"' PGCode='null'>",a+="<td>--</td><td>--</td><td>--</td><td>--</td><td>--</td><td>--</td>",a+="</tr>");for(a+="</tbody>",$("#Table_pg").append(a),pg_table_cell_click=function(){if("null"!=$(this).attr("PGCode")){for(var e=0;e<pg_table.length;e++)if($(this).attr("PGCode")==pg_table[e].PGCode){pg_selected=pg_table[e];break}Initialize_pg_detail(),touchcookie()}},o=0;o<table_row;o++)$("#pg_table_cell"+o).on("click",pg_table_cell_click);touchcookie()}}function Initialize_pg_detail(){get_pg_proj(pg_selected.PGCode)}function clear_pg_detail_panel(){pg_selected=null;var e="<p></p><p></p><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt >项目组编号：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt >负责人：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd></dl></div><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt>项目组名称：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt>电话：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd></dl></div><div class='col-md-12 col-sm-12 col-xs-12 column'><dl ><dt>单位：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt>地址：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt>备注：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd></dl></div>";$("#Label_pg_detail").empty(),$("#Label_pg_detail").append(e),$("#Table_pg_proj").empty()}function draw_pg_detail_panel(){if($("#Label_pg_detail").empty(),null!==pg_selected_proj){var e="<p></p><p></p><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt >项目组编号：</dt><dd>"+pg_selected.PGCode+"</dd><dt >负责人：</dt><dd>"+pg_selected.ChargeMan+"</dd></dl></div><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt>项目组名称：</dt><dd>"+pg_selected.PGName+"</dd><dt>电话：</dt><dd>"+pg_selected.Telephone+"</dd></dl></div><div class='col-md-12 col-sm-12 col-xs-12 column'><dl ><dt>单位：</dt><dd>"+pg_selected.Department+"</dd><dt>地址：</dt><dd>"+pg_selected.Address+"</dd><dt>备注：</dt><dd>"+pg_selected.Stage+"</dd></dl></div>";$("#Label_pg_detail").append(e),$("#Table_pg_proj").empty(),e="<thead> <tr> <th>下辖项目清单 </th> </tr> </thead> <tbody >",null===pg_selected_proj&&(pg_selected_proj=[]);for(var t=0;t<pg_selected_proj.length;t++)e=e+"<tr> <td>"+pg_selected_proj[t].name+"</td> </tr>";e+="</tbody>",$("#Table_pg_proj").append(e)}}function show_new_pg_module(){$("#newPGModalLabel").text("创建新项目组"),pg_module_status=!0,$("#PGPGCode_Input").val(""),$("#PGPGCode_Input").attr("disabled",!0),$("#PGPGName_Input").val(""),$("#PGChargeMan_Input").val(""),$("#PGTelephone_Input").val(""),$("#PGDepartment_Input").val(""),$("#PGAddress_Input").val(""),$("#PGStage_Input").val(""),$("#PGPGCode_Input").attr("placeholder","项目组编号"),$("#PGPGName_Input").attr("placeholder","项目组名称"),$("#PGChargeMan_Input").attr("placeholder","负责人姓名"),$("#PGTelephone_Input").attr("placeholder","联系电话"),$("#PGDepartment_Input").attr("placeholder","单位名称"),$("#PGAddress_Input").attr("placeholder","地址"),$("#duallistboxPGProj_new").empty();var e="";null===project_list&&(project_list=[]);for(var t=0;t<project_list.length;t++)e="<option value='"+project_list[t].id+"'>"+project_list[t].name+"</option>",$("#duallistboxPGProj_new").append(e);$(".NewPGProjDual").bootstrapDualListbox("refresh",!0),modal_middle($("#newPGModal")),$("#newPGModal").modal("show")}function submit_new_pg_module(){var e=$("#PGPGCode_Input").val(),t=$("#PGPGName_Input").val(),a=$("#PGChargeMan_Input").val(),o=$("#PGTelephone_Input").val(),n=$("#PGDepartment_Input").val(),i=$("#PGAddress_Input").val(),l=$("#PGStage_Input").val();if(null===t||""===t)return $("#PGPGName_Input").attr("placeholder","项目组名称不能为空"),void $("#PGPGName_Input").focus();if(null===a||""===a)return $("#PGChargeMan_Input").attr("placeholder","负责人姓名不能为空"),void $("#PGChargeMan_Input").focus();if(null===o||""===o)return $("#PGTelephone_Input").attr("placeholder","联系电话不能为空"),void $("#PGTelephone_Input").focus();if(null===n||""===n)return $("#PGDepartment_Input").attr("placeholder","单位名称不能为空"),void $("#PGDepartment_Input").focus();if(null===i||""===i)return $("#PGAddress_Input").attr("placeholder","地址不能为空"),void $("#PGAddress_Input").focus();var r={PGCode:e,PGName:t,ChargeMan:a,Telephone:o,Department:n,Address:i,Stage:l},d=[];$("#duallistboxPGProj_new :selected").each(function(e,t){var a={id:$(t).val(),name:$(t).text()};d.push(a)}),new_pg(r,d)}function show_mod_pg_module(e,t){$("#newPGModalLabel").text("项目组修改"),pg_module_status=!1,$("#PGPGCode_Input").val(e.PGCode),$("#PGPGCode_Input").attr("disabled",!0),$("#PGPGName_Input").val(e.PGName),$("#PGChargeMan_Input").val(e.ChargeMan),$("#PGTelephone_Input").val(e.Telephone),$("#PGDepartment_Input").val(e.Department),$("#PGAddress_Input").val(e.Address),$("#PGStage_Input").val(e.Stage),$("#PGPGCode_Input").attr("placeholder","项目号"),$("#PGPGName_Input").attr("placeholder","项目名称"),$("#PGChargeMan_Input").attr("placeholder","负责人姓名"),$("#PGTelephone_Input").attr("placeholder","联系电话"),$("#PGDepartment_Input").attr("placeholder","单位名称"),$("#PGAddress_Input").attr("placeholder","地址"),$("#duallistboxPGProj_new").empty();var a="";null===project_list&&(project_list=[]);for(var o=0;o<project_list.length;o++){a="<option value='"+project_list[o].id+"'";for(var n=0;n<t.length;n++)if(t[n].id==project_list[o].id){a+="selected='selected'";break}a=a+">"+project_list[o].name+"</option>",$("#duallistboxPGProj_new").append(a)}$(".NewPGProjDual").bootstrapDualListbox("refresh",!0),modal_middle($("#newPGModal")),$("#newPGModal").modal("show")}function submit_mod_pg_module(){var e=$("#PGPGCode_Input").val(),t=$("#PGPGName_Input").val(),a=$("#PGChargeMan_Input").val(),o=$("#PGTelephone_Input").val(),n=$("#PGDepartment_Input").val(),i=$("#PGAddress_Input").val(),l=$("#PGStage_Input").val(),r={PGCode:e,PGName:t,ChargeMan:a,Telephone:o,Department:n,Address:i,Stage:l},d=[];$("#duallistboxPGProj_new :selected").each(function(e,t){var a={id:$(t).val(),name:$(t).text()};d.push(a)}),modify_pg(r,d)}function get_proj_table(e,t){var a={startseq:e,length:t,keyword:global_key_word},o={action:"ProjTable",type:"query",body:a,user:usr.id},n=function(e){return"false"==e.status?void show_expiredModule():(project_table=e.ret.projtable,project_start=parseInt(e.ret.start),project_total=parseInt(e.ret.total),void draw_proj_table_head())};JQ_get(request_head,o,n)}function del_proj(e){var t={ProjCode:e},a={action:"ProjDel",type:"mod",body:t,user:usr.id},o=function(e){var t=e.status;"true"==t?(del_proj_flash=function(){clear_proj_detail_panel(),proj_intialize(0)},setTimeout(function(){show_alarm_module(!1,"删除成功！",del_proj_flash)},500)):setTimeout(function(){show_alarm_module(!0,"删除失败！"+e.msg,null)},500)};JQ_get(request_head,a,o),$("#ProjDelAlarm").modal("hide")}function new_proj(e){var t={ProjCode:e.ProjCode,ProjName:e.ProjName,ChargeMan:e.ChargeMan,Telephone:e.Telephone,Department:e.Department,Address:e.Address,ProStartTime:e.ProStartTime,Stage:e.Stage},a={action:"ProjNew",type:"mod",body:t,user:usr.id},o=function(e){var t=e.status;"true"==t?($("#newProjModal").modal("hide"),new_proj_flash=function(){clear_proj_detail_panel(),proj_intialize(0)},setTimeout(function(){show_alarm_module(!1,"创建成功！",new_proj_flash)},500)):setTimeout(function(){show_alarm_module(!0,"创建失败！"+e.msg,null)},500)};JQ_get(request_head,a,o)}function modify_proj(e){
var t={ProjCode:e.ProjCode,ProjName:e.ProjName,ChargeMan:e.ChargeMan,Telephone:e.Telephone,Department:e.Department,Address:e.Address,ProStartTime:e.ProStartTime,Stage:e.Stage},a={action:"ProjMod",type:"mod",body:t,user:usr.id},o=function(e){var t=e.status;"true"==t?($("#newProjModal").modal("hide"),mod_proj_flash=function(){clear_proj_detail_panel(),proj_intialize(0)},setTimeout(function(){show_alarm_module(!1,"修改成功！",mod_proj_flash)},500)):setTimeout(function(){show_alarm_module(!0,"修改失败！"+e.msg,null)},500)};JQ_get(request_head,a,o)}function get_proj_point(e){var t={ProjCode:e},a={action:"PointProj",type:"query",body:t,user:usr.id},o=function(e){return"false"==e.status?void show_expiredModule():(project_selected_point=e.ret,void draw_proj_detail_point_table())};JQ_get(request_head,a,o)}function get_proj_key(e){var t={ProjCode:e},a={action:"ProjKey",type:"query",body:t,user:usr.id},o=function(e){return"false"==e.status?void show_expiredModule():(project_selected_key=e.ret,void draw_proj_detail_key_table())};JQ_get(request_head,a,o)}function proj_intialize(e){project_initial=!0,project_table=null,get_proj_table(e,5*table_row)}function draw_proj_table_head(){if(null!==project_table){var e=Math.ceil(project_table.length/table_row);$("#Proj_Page_control").empty();var t,a="<li><a href='#' id='proj_page_prev'>Prev</a></li>",o=Math.ceil(project_start/table_row);for(t=0;t<e;t++)a=a+"<li><a href='#' id='proj_page_"+t+"'>"+(t+o+1)+"</a></li>";for(a+="<li><a href='#' id='proj_page_next'>Next</a></li>",$("#Proj_Page_control").append(a),table_head="<thead><tr><th>编号</th> <th>名称 </th> <th>责任人 </th> <th>电话 </th> <th>单位 </th>",table_head+="</tr></thread>",proj_page_click=function(){draw_proj_table($(this))},t=0;t<e;t++)$("#proj_page_"+t).on("click",proj_page_click);project_start<=0?$("#proj_page_prev").css("display","none"):($("#proj_page_prev").css("display","block"),$("#proj_page_prev").on("click",function(){var e=project_start-5*table_row;e<0&&(e=0),proj_intialize(e)})),project_start+5*table_row>=project_total?$("#proj_page_next").css("display","none"):($("#proj_page_next").css("display","block"),$("#proj_page_next").on("click",function(){proj_intialize(project_start+5*table_row)})),draw_proj_table($("#proj_page_0"))}}function draw_proj_table(e){if($("#Table_proj").empty(),null!==project_table){var t=(parseInt(e.html())-1)*table_row-project_start,a=table_head;a+="<tbody>";var o;for(o=0;o<table_row;o++)t+o<project_table.length?(a=0!==o%2?a+"<tr class='success li_menu' id='proj_table_cell"+o+"' ProjCode='"+project_table[t+o].ProjCode+"'>":a+"<tr class=' li_menu' id='proj_table_cell"+o+"' ProjCode='"+project_table[t+o].ProjCode+"'>",a=a+"<td>"+project_table[t+o].ProjCode+"</td><td>"+project_table[t+o].ProjName+"</td><td>"+project_table[t+o].ChargeMan+"</td><td>"+project_table[t+o].Telephone+"</td><td>"+project_table[t+o].Department+"</td>",a+="</tr>"):(a=0!==o%2?a+"<tr class='success' id='proj_table_cell"+o+"' ProjCode='null'>":a+"<tr  id='proj_table_cell"+o+"' ProjCode='null'>",a+="<td>--</td><td>--</td><td>--</td><td>--</td><td>--</td>",a+="</tr>");for(a+="</tbody>",$("#Table_proj").append(a),proj_table_cell_click=function(){if("null"!=$(this).attr("ProjCode")){for(var e=0;e<project_table.length;e++)if($(this).attr("ProjCode")==project_table[e].ProjCode){project_selected=project_table[e];break}Initialize_proj_detail(),touchcookie()}},o=0;o<table_row;o++)$("#proj_table_cell"+o).on("click",proj_table_cell_click);touchcookie()}}function Initialize_proj_detail(){draw_proj_detail_panel(),get_proj_point(project_selected.ProjCode)}function clear_proj_detail_panel(){project_selected=null;var e="<p></p><p></p><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt >项目编号：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt >负责人：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd></dl></div><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt>项目名称：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt>电话：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd></dl></div><div class='col-md-12 col-sm-12 col-xs-12 column'><dl ><dt>单位：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt>地址：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt>开工日期：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt>备注：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd></dl></div>";$("#Label_proj_detail").empty(),$("#Label_proj_detail").append(e),$("#Table_proj_point").empty()}function draw_proj_detail_panel(){if($("#Label_proj_detail").empty(),null!==project_selected_point){var e="<p></p><p></p><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt >项目编号：</dt><dd>"+project_selected.ProjCode+"</dd><dt >负责人：</dt><dd>"+project_selected.ChargeMan+"</dd></dl></div><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt>项目名称：</dt><dd>"+project_selected.ProjName+"</dd><dt>电话：</dt><dd>"+project_selected.Telephone+"</dd></dl></div><div class='col-md-12 col-sm-12 col-xs-12 column'><dl ><dt>单位：</dt><dd>"+project_selected.Department+"</dd><dt>地址：</dt><dd>"+project_selected.Address+"</dd><dt>开工日期：</dt><dd>"+project_selected.ProStartTime+"</dd><dt>备注：</dt><dd>"+project_selected.Stage+"</dd></dl></div>";$("#Label_proj_detail").append(e)}}function draw_proj_detail_point_table(){$("#Table_proj_point").empty(),txt="<thead> <tr> <th>站点清单 </th> </tr> </thead> <tbody >",null===project_selected_point&&(project_selected_point=[]);for(var e=0;e<project_selected_point.length;e++)txt=txt+"<tr> <td>"+project_selected_point[e].name+"</td> </tr>";txt+="</tbody>",$("#Table_proj_point").append(txt)}function draw_proj_detail_key_table(){$("#Table_proj_key").empty(),txt="<thead> <tr> <th>钥匙名称 </th> <th>所有人 </th></tr> </thead> <tbody >",null===project_selected_key&&(project_selected_key=[]);for(var e=0;e<project_selected_key.length;e++)txt=txt+"<tr id='"+project_selected_key[e].id+"' class='keyrow'> <td>"+project_selected_key[e].name+"</td> <td>"+project_selected_key[e].username+"</td></tr>";txt+="</tbody>",$("#Table_proj_key").append(txt),$(".keyrow").on("click",function(){var e=$(this).attr("id");void 0!==e&&""!==e&&get_key_auth_list(e)})}function show_new_proj_module(){$("#newProjModalLabel").text("创建新项目"),project_module_status=!0,$("#ProjProjCode_Input").val(""),$("#ProjProjCode_Input").attr("disabled",!0),$("#ProjProjName_Input").val(""),$("#ProjChargeMan_Input").val(""),$("#ProjTelephone_Input").val(""),$("#ProjDepartment_Input").val(""),$("#ProjAddress_Input").val(""),$("#ProjProStartTime_Input").val(""),$("#ProjStage_Input").val(""),$("#ProjProjCode_Input").attr("placeholder","项目号"),$("#ProjProjName_Input").attr("placeholder","项目名称"),$("#ProjChargeMan_Input").attr("placeholder","负责人姓名"),$("#ProjTelephone_Input").attr("placeholder","联系电话"),$("#ProjDepartment_Input").attr("placeholder","单位名称"),$("#ProjAddress_Input").attr("placeholder","地址"),$("#ProjProStartTime_Input").attr("placeholder","创建时间"),modal_middle($("#newProjModal")),$("#newProjModal").modal("show")}function submit_new_proj_module(){var e=$("#ProjProjCode_Input").val(),t=$("#ProjProjName_Input").val(),a=$("#ProjChargeMan_Input").val(),o=$("#ProjTelephone_Input").val(),n=$("#ProjDepartment_Input").val(),i=$("#ProjAddress_Input").val(),l=$("#ProjProStartTime_Input").val(),r=$("#ProjStage_Input").val();if(null===t||""===t)return $("#ProjProjName_Input").attr("placeholder","项目名称不能为空"),void $("#ProjProjName_Input").focus();if(null===a||""===a)return $("#ProjChargeMan_Input").attr("placeholder","负责人姓名不能为空"),void $("#ProjChargeMan_Input").focus();if(null===o||""===o)return $("#ProjTelephone_Input").attr("placeholder","联系电话不能为空"),void $("#ProjTelephone_Input").focus();if(null===n||""===n)return $("#ProjDepartment_Input").attr("placeholder","单位名称不能为空"),void $("#ProjDepartment_Input").focus();if(null===i||""===i)return $("#ProjAddress_Input").attr("placeholder","地址不能为空"),void $("#ProjAddress_Input").focus();if(null===l||""===l)return $("#ProjProStartTime_Input").attr("placeholder","创建时间不能为空"),void $("#ProjProStartTime_Input").focus();var d={ProjCode:e,ProjName:t,ChargeMan:a,Telephone:o,Department:n,Address:i,ProStartTime:l,Stage:r};new_proj(d)}function show_mod_proj_module(e){$("#newProjModalLabel").text("项目修改"),project_module_status=!1,$("#ProjProjCode_Input").val(e.ProjCode),$("#ProjProjCode_Input").attr("disabled",!0),$("#ProjProjName_Input").val(e.ProjName),$("#ProjChargeMan_Input").val(e.ChargeMan),$("#ProjTelephone_Input").val(e.Telephone),$("#ProjDepartment_Input").val(e.Department),$("#ProjAddress_Input").val(e.Address),$("#ProjProStartTime_Input").val(e.ProStartTime),$("#ProjStage_Input").val(e.Stage),$("#ProjProjCode_Input").attr("placeholder","项目号"),$("#ProjProjName_Input").attr("placeholder","项目名称"),$("#ProjChargeMan_Input").attr("placeholder","负责人姓名"),$("#ProjTelephone_Input").attr("placeholder","联系电话"),$("#ProjDepartment_Input").attr("placeholder","单位名称"),$("#ProjAddress_Input").attr("placeholder","地址"),$("#ProjProStartTime_Input").attr("placeholder","创建时间"),modal_middle($("#newProjModal")),$("#newProjModal").modal("show")}function submit_mod_proj_module(){var e=$("#ProjProjCode_Input").val(),t=$("#ProjProjName_Input").val(),a=$("#ProjChargeMan_Input").val(),o=$("#ProjTelephone_Input").val(),n=$("#ProjDepartment_Input").val(),i=$("#ProjAddress_Input").val(),l=$("#ProjProStartTime_Input").val(),r=$("#ProjStage_Input").val(),d={ProjCode:e,ProjName:t,ChargeMan:a,Telephone:o,Department:n,Address:i,ProStartTime:l,Stage:r};modify_proj(d)}function get_point_table(e,t){var a={startseq:e,length:t,keyword:global_key_word},o={action:"PointTable",type:"query",body:a,user:usr.id},n=function(e){return"false"==e.status?void show_expiredModule():(point_table=e.ret.pointtable,point_start=parseInt(e.ret.start),point_total=parseInt(e.ret.total),void draw_point_table_head())};JQ_get(request_head,o,n)}function del_point(e){var t={StatCode:e},a={action:"PointDel",type:"mod",body:t,user:usr.id},o=function(e){var t=e.status;"true"==t?(del_point_flash=function(){clear_point_detail_panel(),point_intialize(0)},setTimeout(function(){show_alarm_module(!1,"删除成功！",del_point_flash)},500)):setTimeout(function(){show_alarm_module(!0,"删除失败！"+e.msg,null)},500)};JQ_get(request_head,a,o),$("#PointDelAlarm").modal("hide")}function new_point(e){var t={StatCode:e.StatCode,StatName:e.StatName,ProjCode:e.ProjCode,ChargeMan:e.ChargeMan,Telephone:e.Telephone,Longitude:e.Longitude,Latitude:e.Latitude,Department:e.Department,Address:e.Address,Country:e.Country,Street:e.Street,Square:e.Square,ProStartTime:e.ProStartTime,Stage:e.Stage},a={action:"PointNew",type:"mod",body:t,user:usr.id},o=function(e){var t=e.status;"true"==t?($("#newPointModal").modal("hide"),new_point_flash=function(){clear_point_detail_panel(),point_intialize(0)},setTimeout(function(){show_alarm_module(!1,"创建成功！",new_point_flash)},500)):setTimeout(function(){show_alarm_module(!0,"创建失败！"+e.msg,null)},500)};JQ_get(request_head,a,o)}function modify_point(e){var t={StatCode:e.StatCode,StatName:e.StatName,ProjCode:e.ProjCode,ChargeMan:e.ChargeMan,Telephone:e.Telephone,Longitude:e.Longitude,Latitude:e.Latitude,Department:e.Department,Address:e.Address,Country:e.Country,Street:e.Street,Square:e.Square,ProStartTime:e.ProStartTime,Stage:e.Stage},a={action:"PointMod",type:"mod",body:t,user:usr.id},o=function(e){var t=e.status;"true"==t?($("#newPointModal").modal("hide"),mod_point_flash=function(){clear_point_detail_panel(),point_intialize(0)},setTimeout(function(){show_alarm_module(!1,"修改成功！",mod_point_flash)},500)):setTimeout(function(){show_alarm_module(!0,"修改失败！"+e.msg,null)},500)};JQ_get(request_head,a,o)}function get_point_device(e){var t={StatCode:e},a={action:"PointDev",type:"query",body:t,user:usr.id},o=function(e){return"false"==e.status?void show_expiredModule():(point_selected_device=e.ret,void draw_point_detail_panel())};JQ_get(request_head,a,o)}function get_point_picture(e){var t={StatCode:e},a={action:"PointPicture",type:"query",body:t,user:usr.id},o=function(e){return"false"==e.status?void show_expiredModule():(point_selected_picture=e.ret,void draw_point_picture_panel())};JQ_get(request_head,a,o)}function point_intialize(e){point_initial=!0,point_table=null,get_project_list(),get_point_table(e,5*table_row),clear_point_detail_panel()}function draw_point_table_head(){if(null!==point_table){var e=Math.ceil(point_table.length/table_row);$("#Point_Page_control").empty();var t,a="<li><a href='#' id='point_page_prev'>Prev</a></li>",o=Math.ceil(point_start/table_row);for(t=0;t<e;t++)a=a+"<li><a href='#' id='point_page_"+t+"'>"+(t+o+1)+"</a></li>";for(a+="<li><a href='#' id='point_page_next'>Next</a></li>",$("#Point_Page_control").append(a),table_head="<thead><tr><th>编号</th> <th>名称 </th> <th>项目</th> <th>责任人 </th> <th>电话 </th> ",table_head+="</tr></thread>",point_page_click=function(){draw_point_table($(this))},t=0;t<e;t++)$("#point_page_"+t).on("click",point_page_click);point_start<=0?$("#point_page_prev").css("display","none"):($("#point_page_prev").css("display","block"),$("#point_page_prev").on("click",function(){var e=point_start-5*table_row;e<0&&(e=0),point_intialize(e)})),point_start+5*table_row>=point_total?$("#point_page_next").css("display","none"):($("#point_page_next").css("display","block"),$("#point_page_next").on("click",function(){point_intialize(point_start+5*table_row)})),draw_point_table($("#point_page_0"))}}function draw_point_table(e){if($("#Table_point").empty(),null!==point_table){var t=(parseInt(e.html())-1)*table_row-point_start,a=table_head;a+="<tbody>";var o;for(o=0;o<table_row;o++)if(t+o<point_table.length){for(var n="",i=0;i<project_list.length;i++)if(point_table[t+o].ProjCode==project_list[i].id){n=project_list[i].name;break}a=0!==o%2?a+"<tr class='success li_menu' id='point_table_cell"+o+"' StatCode='"+point_table[t+o].StatCode+"'>":a+"<tr class=' li_menu' id='point_table_cell"+o+"' StatCode='"+point_table[t+o].StatCode+"'>",a=a+"<td>"+point_table[t+o].StatCode+"</td><td>"+point_table[t+o].StatName+"</td><td>"+n+"</td><td>"+point_table[t+o].ChargeMan+"</td><td>"+point_table[t+o].Telephone+"</td>",a+="</tr>"}else a=0!==o%2?a+"<tr class='success' id='point_table_cell"+o+"' StatCode='null'>":a+"<tr  id='point_table_cell"+o+"' StatCode='null'>",a+="<td>--</td><td>--</td><td>--</td><td>--</td><td>--</td><td>--</td>",a+="</tr>";for(a+="</tbody>",$("#Table_point").append(a),point_table_cell_click=function(){if("null"!=$(this).attr("StatCode")){for(var e=0;e<point_table.length;e++)if($(this).attr("StatCode")==point_table[e].StatCode){point_selected=point_table[e];break}Initialize_point_detail(),touchcookie()}},o=0;o<table_row;o++)$("#point_table_cell"+o).on("click",point_table_cell_click);touchcookie()}}function Initialize_point_detail(){get_point_device(point_selected.StatCode),get_point_picture(point_selected.StatCode)}function clear_point_detail_panel(){point_selected=null;var e="<p></p><p></p><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt >站点编号：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt >负责人：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt >开工日期：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd></dl></div><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt>站点名称：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt>电话：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt >面积：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd></dl></div><div class='col-md-12 col-sm-12 col-xs-12 column'><dl ><dt>关联项目：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt>单位：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd></dl></div><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt >经度：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt >区县：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd></dl></div><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt>纬度：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt>街镇：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd></dl></div><div class='col-md-12 col-sm-12 col-xs-12 column'><dl ><dt>地址：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt>备注：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd></dl></div>";$("#Label_point_detail").empty(),$("#Label_point_detail").append(e),$("#Table_point_device").empty(),$("#Table_point_picture").empty()}function draw_point_detail_panel(){if($("#Label_point_detail").empty(),null!==point_selected_device){var e="";null===project_list&&(project_list=[]);for(var t=0;t<project_list.length;t++)if(point_selected.ProjCode==project_list[t].id){e=project_list[t].name;break}var a="<p></p><p></p><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt >站点编号：</dt><dd>"+point_selected.StatCode+"</dd><dt >负责人：</dt><dd>"+point_selected.ChargeMan+"</dd><dt >开工日期：</dt><dd>"+point_selected.ProStartTime+"</dd></dl></div><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt>站点名称：</dt><dd>"+point_selected.StatName+"</dd><dt>电话：</dt><dd>"+point_selected.Telephone+"</dd><dt >面积：</dt><dd>"+point_selected.Square+"</dd></dl></div><div class='col-md-12 col-sm-12 col-xs-12 column'><dl ><dt>关联项目：</dt><dd>"+e+"</dd><dt>单位：</dt><dd>"+point_selected.Department+"</dd></dl></div><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt >经度：</dt><dd>"+point_selected.Longitude+"</dd><dt >区县：</dt><dd>"+point_selected.Country+"</dd></dl></div><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt>纬度：</dt><dd>"+point_selected.Latitude+"</dd><dt>街镇：</dt><dd>"+point_selected.Street+"</dd></dl></div><div class='col-md-12 col-sm-12 col-xs-12 column'><dl ><dt>地址：</dt><dd>"+point_selected.Address+"</dd><dt>备注：</dt><dd>"+point_selected.Stage+"</dd></dl></div>";$("#Label_point_detail").append(a),$("#Table_point_device").empty(),a="<thead> <tr> <th>监控设备清单 </th> </tr> </thead> <tbody >",null===point_selected_device&&(point_selected_device=[]);for(var o=0;o<point_selected_device.length;o++)a=a+"<tr> <td>"+point_selected_device[o].name+"</td> </tr>";a+="</tbody>",$("#Table_point_device").append(a)}}function draw_point_picture_panel(){$("#Table_point_picture").empty(),txt="<thead> <tr> <th>安装照片 </th> </tr> </thead> <tbody >",null===point_selected_picture&&(point_selected_picture=[]);for(var e=0;e<point_selected_picture.length;e++)txt=txt+"<tr> <td class='pictd' picurl='"+point_selected_picture[e].url+"' >"+point_selected_picture[e].name+"</td> </tr>";txt+="</tbody>",$("#Table_point_picture").append(txt),$(".pictd").on("click",function(){console.log(httphead+"//"+window.location.host+$(this).attr("picurl")),window.open(httphead+"//"+window.location.host+$(this).attr("picurl"),"监控照片","height=480, width=640, top=0, left=400,toolbar=no, menubar=no, scrollbars=no, resizable=no, location=no, status=no")})}function show_new_point_module(){$("#newPointModalLabel").text("创建站点"),point_module_status=!0,$("#PointStatCode_Input").val(""),$("#PointStatCode_Input").attr("disabled",!0),$("#PointStatName_Input").val(""),$("#PointChargeMan_Input").val(""),$("#PointTelephone_Input").val(""),$("#PointLongitude_Input").val(""),$("#PointLatitude_Input").val(""),$("#PointLongitude_Input").attr("disabled",!0),$("#PointLatitude_Input").attr("disabled",!0),$("#PointDepartment_Input").val(""),$("#PointAddress_Input").val(""),$("#PointCountry_Input").val(""),$("#PointStreet_Input").val(""),$("#PointSquare_Input").val(""),$("#PointProStartTime_Input").val(""),$("#PointStage_Input").val(""),$("#PointProjCode_choice").empty(),$("#PointProjCode_choice").append(get_proj_option()),$("#PointStatCode_Input").attr("placeholder","站点号"),$("#PointStatName_Input").attr("placeholder","站点名称"),$("#PointChargeMan_Input").attr("placeholder","负责人姓名"),$("#PointTelephone_Input").attr("placeholder","联系电话"),$("#PointLongitude_Input").attr("placeholder","经度"),$("#PointLatitude_Input").attr("placeholder","纬度"),$("#PointDepartment_Input").attr("placeholder","单位名称"),$("#PointAddress_Input").attr("placeholder","地址"),$("#PointCountry_Input").attr("placeholder","区县"),$("#PointStreet_Input").attr("placeholder","街镇"),$("#PointSquare_Input").attr("placeholder","施工面积(平方米)"),$("#PointProStartTime_Input").attr("placeholder","开工时间"),modal_middle($("#newPointModal")),$("#newPointModal").modal("show")}function submit_new_point_module(){var e=$("#PointStatCode_Input").val(),t=$("#PointStatName_Input").val(),a=$("#PointProjCode_choice").val(),o=$("#PointChargeMan_Input").val(),n=$("#PointTelephone_Input").val(),i=$("#PointLongitude_Input").val(),l=$("#PointLatitude_Input").val(),r=$("#PointDepartment_Input").val(),d=$("#PointAddress_Input").val(),_=$("#PointCountry_Input").val(),s=$("#PointStreet_Input").val(),c=$("#PointSquare_Input").val(),u=$("#PointProStartTime_Input").val(),p=$("#PointStage_Input").val();if(null===t||""===t)return $("#PointStatName_Input").attr("placeholder","站点名称不能为空"),void $("#PointStatName_Input").focus();if(null===o||""===o)return $("#PointChargeMan_Input").attr("placeholder","负责人姓名不能为空"),void $("#PointChargeMan_Input").focus();if(null===a||""===a)return $("#PointProjCode_choice").attr("placeholder","项目不能为空"),void $("#PointProjCode_choice").focus();if(null===n||""===n)return $("#PointTelephone_Input").attr("placeholder","联系电话不能为空"),void $("#PointTelephone_Input").focus();if(null===r||""===r)return $("#PointDepartment_Input").attr("placeholder","单位名称不能为空"),void $("#PointDepartment_Input").focus();if(null===d||""===d)return $("#PointAddress_Input").attr("placeholder","地址不能为空"),void $("#PointAddress_Input").focus();if(null===_||""===_)return $("#PointCountry_Input").attr("placeholder","区县不能为空"),void $("#PointCountry_Input").focus();if(null===s||""===s)return $("#PointStreet_Input").attr("placeholder","街镇不能为空"),void $("#PointStreet_Input").focus();if(null===c||""===c)return $("#PointSquare_Input").attr("placeholder","施工面积不能为空"),void $("#PointSquare_Input").focus();if(null===u||""===u)return $("#PointProStartTime_Input").attr("placeholder","开工时间不能为空"),void $("#PointProStartTime_Input").focus();var m={StatCode:e,StatName:t,ProjCode:a,ChargeMan:o,Telephone:n,Longitude:i,Latitude:l,Department:r,Address:d,Country:_,Street:s,Square:c,ProStartTime:u,Stage:p};new_point(m)}function show_mod_point_module(e){$("#newPointModalLabel").text("站点修改"),point_module_status=!1,$("#PointStatCode_Input").val(e.StatCode),$("#PointStatCode_Input").attr("disabled",!0),$("#PointStatName_Input").val(e.StatName),$("#PointChargeMan_Input").val(e.ChargeMan),$("#PointTelephone_Input").val(e.Telephone),$("#PointLongitude_Input").val(e.Longitude),$("#PointLatitude_Input").val(e.Latitude),$("#PointDepartment_Input").val(e.Department),$("#PointAddress_Input").val(e.Address),$("#PointCountry_Input").val(e.Country),$("#PointStreet_Input").val(e.Street),$("#PointSquare_Input").val(e.Square),$("#PointProStartTime_Input").val(e.ProStartTime),$("#PointStage_Input").val(e.Stage),$("#PointProjCode_choice").empty(),$("#PointProjCode_choice").append(get_proj_option()),$("#PointProjCode_choice").val(e.ProjCode),$("#PointStatCode_Input").attr("placeholder","站点号"),$("#PointStatName_Input").attr("placeholder","站点名称"),$("#PointChargeMan_Input").attr("placeholder","负责人姓名"),$("#PointTelephone_Input").attr("placeholder","联系电话"),$("#PointLongitude_Input").attr("placeholder","经度"),$("#PointLatitude_Input").attr("placeholder","纬度"),$("#PointDepartment_Input").attr("placeholder","单位名称"),$("#PointAddress_Input").attr("placeholder","地址"),$("#PointCountry_Input").attr("placeholder","区县"),$("#PointStreet_Input").attr("placeholder","街镇"),$("#PointSquare_Input").attr("placeholder","施工面积(平方米)"),$("#PointProStartTime_Input").attr("placeholder","开工时间"),modal_middle($("#newPointModal")),$("#newPointModal").modal("show")}function submit_mod_point_module(){var e=$("#PointStatCode_Input").val(),t=$("#PointStatName_Input").val(),a=$("#PointProjCode_choice").val(),o=$("#PointChargeMan_Input").val(),n=$("#PointTelephone_Input").val(),i=$("#PointLongitude_Input").val(),l=$("#PointLatitude_Input").val(),r=$("#PointDepartment_Input").val(),d=$("#PointAddress_Input").val(),_=$("#PointCountry_Input").val(),s=$("#PointStreet_Input").val(),c=$("#PointSquare_Input").val(),u=$("#PointProStartTime_Input").val(),p=$("#PointStage_Input").val(),m={StatCode:e,StatName:t,ProjCode:a,ChargeMan:o,Telephone:n,Longitude:i,Latitude:l,Department:r,Address:d,Country:_,Street:s,Square:c,ProStartTime:u,Stage:p};modify_point(m)}function get_proj_point_list(){var e={action:"ProjPoint",type:"query",user:usr.id},t=function(e){return"false"==e.status?void show_expiredModule():void(point_list=e.ret)};JQ_get(request_head,e,t)}function get_dev_table(e,t){var a={startseq:e,length:t,keyword:global_key_word},o={action:"DevTable",body:a,type:"query",user:usr.id},n=function(e){return"false"==e.status?void show_expiredModule():(device_table=e.ret.devtable,device_start=parseInt(e.ret.start),device_total=parseInt(e.ret.total),void window.setTimeout(draw_dev_table_head,wait_time_middle))};JQ_get(request_head,o,n)}function del_dev(e){var t={DevCode:e},a={action:"DevDel",type:"mod",body:t,user:usr.id},o=function(e){var t=e.status;"true"==t?(del_dev_flash=function(){clear_dev_detail_panel(),dev_intialize(0)},setTimeout(function(){show_alarm_module(!1,"删除成功！",del_dev_flash)},500)):setTimeout(function(){show_alarm_module(!0,"删除失败！"+e.msg,null)},500)};JQ_get(request_head,a,o),$("#DevDelAlarm").modal("hide")}function new_dev(e){var t={DevCode:e.DevCode,StatCode:e.StatCode,StartTime:e.StartTime,PreEndTime:e.PreEndTime,EndTime:e.EndTime,DevStatus:e.DevStatus,VideoURL:e.VideoURL},a={action:"DevNew",type:"mod",body:t,user:usr.id},o=function(e){var t=e.status;"true"==t?($("#newDevModal").modal("hide"),new_dev_flash=function(){clear_dev_detail_panel(),dev_intialize(0)},setTimeout(function(){show_alarm_module(!1,"创建成功！",new_dev_flash)},500)):setTimeout(function(){show_alarm_module(!0,"创建失败！"+e.msg,null)},500)};JQ_get(request_head,a,o)}function modify_dev(e){var t={DevCode:e.DevCode,StatCode:e.StatCode,StartTime:e.StartTime,PreEndTime:e.PreEndTime,EndTime:e.EndTime,DevStatus:e.DevStatus,VideoURL:e.VideoURL},a={action:"DevMod",type:"mod",body:t,user:usr.id},o=function(e){var t=e.status;"true"==t?($("#newDevModal").modal("hide"),mod_dev_flash=function(){clear_dev_detail_panel(),dev_intialize(0)},setTimeout(function(){show_alarm_module(!1,"修改成功！",mod_dev_flash)},500)):setTimeout(function(){show_alarm_module(!0,"修改失败！"+e.msg,null)},500)};JQ_get(request_head,a,o)}function dev_intialize(e){device_initial=!0,device_table=null,get_dev_table(e,5*table_row),get_project_list(),get_proj_point_list(),clear_dev_detail_panel()}function draw_dev_table_head(){if(null!==device_table){var e=Math.ceil(device_table.length/table_row);$("#Dev_Page_control").empty();var t,a="<li><a href='#' id='dev_page_prev'>Prev</a></li>",o=Math.ceil(device_start/table_row);for(t=0;t<e;t++)a=a+"<li><a href='#' id='dev_page_"+t+"'>"+(t+o+1)+"</a></li>";for(a+="<li><a href='#' id='dev_page_next'>Next</a></li>",$("#Dev_Page_control").append(a),table_head="<thead><tr><th>编号 </th> <th>项目名称 </th> <th>站点名称 </th><th>安装时间 </th> <th>是否启动 </th>",table_head+="</tr></thread>",dev_page_click=function(){draw_dev_table($(this))},t=0;t<e;t++)$("#dev_page_"+t).on("click",dev_page_click);device_start<=0?$("#dev_page_prev").css("display","none"):($("#dev_page_prev").css("display","block"),$("#dev_page_prev").on("click",function(){var e=device_start-5*table_row;e<0&&(e=0),dev_intialize(e)})),device_start+5*table_row>=device_total?$("#dev_page_next").css("display","none"):($("#dev_page_next").css("display","block"),$("#dev_page_next").on("click",function(){dev_intialize(device_start+5*table_row)})),draw_dev_table($("#dev_page_0"))}}function draw_dev_table(e){if($("#Table_dev").empty(),null!==device_table){var t=(parseInt(e.html())-1)*table_row-device_start,a=table_head;a+="<tbody>";var o;for(o=0;o<table_row;o++)if(t+o<device_table.length){a=0!==o%2?a+"<tr class='success li_menu' id='dev_table_cell"+o+"' DevCode='"+device_table[t+o].DevCode+"'>":a+"<tr class=' li_menu' id='dev_table_cell"+o+"' DevCode='"+device_table[t+o].DevCode+"'>";var n="开启";"false"===device_table[t+o].DevStatus&&(n="关闭"),a=a+"<td>"+device_table[t+o].DevCode+"</td><td>"+get_proj_name(device_table[t+o].ProjCode)+"</td><td>"+get_point_name(device_table[t+o].StatCode)+"</td><td>"+device_table[t+o].StartTime+"</td><td>"+n+"</td>",a+="</tr>"}else a=0!==o%2?a+"<tr class='success' id='dev_table_cell"+o+"' DevCode='null'>":a+"<tr  id='dev_table_cell"+o+"' DevCode='null'>",a+="<td>--</td><td>--</td><td>--</td><td>--</td><td>--</td>",a+="</tr>";for(a+="</tbody>",$("#Table_dev").append(a),dev_table_cell_click=function(){if("null"!=$(this).attr("DevCode")){for(var e=0;e<device_table.length;e++)if($(this).attr("DevCode")==device_table[e].DevCode){device_selected=device_table[e];break}Initialize_dev_detail(),touchcookie()}},o=0;o<table_row;o++)$("#dev_table_cell"+o).on("click",dev_table_cell_click);touchcookie()}}function Initialize_dev_detail(){get_device_sensor(device_selected.DevCode)}function clear_dev_detail_panel(){project_selected=null;var e="<p></p><p></p><div class='col-md-12 col-sm-12 col-xs-12 column'><dl ><dt>设备编号：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd></dl></div><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt >项目：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt >安装时间：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt >MAC地址：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt >实际结束时间：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd></dl></div><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt>站点：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt>预计结束时间：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt >IP地址：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt >设备是否启动：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd></dl></div><div class='col-md-12 col-sm-12 col-xs-12 column'><dl ><dt>视频地址：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd></dl></div>";$("#Label_dev_detail").empty(),$("#Label_dev_detail").append(e),$("#Table_device_sensor").empty()}function draw_dev_detail_panel(){if($("#Label_dev_detail").empty(),null!==device_selected_sensor){var e="开启";"false"===device_selected.DevStatus&&(e="关闭");var t="<p></p><p></p><div class='col-md-12 col-sm-12 col-xs-12 column'><dl ><dt>设备编号：</dt><dd>"+device_selected.DevCode+"</dd></dl></div><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt >项目：</dt><dd>"+get_proj_name(device_selected.ProjCode)+"</dd><dt >安装时间：</dt><dd>"+device_selected.StartTime+"</dd><dt >MAC地址：</dt><dd>"+device_selected.MAC+"</dd><dt >实际结束时间：</dt><dd>"+device_selected.EndTime+"</dd></dl></div><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt>站点：</dt><dd>"+get_point_name(device_selected.StatCode)+"</dd><dt>预计结束时间：</dt><dd>"+device_selected.PreEndTime+"</dd><dt >IP地址：</dt><dd>"+device_selected.IP+"</dd><dt >设备是否启动：</dt><dd>"+e+"</dd></dl></div><div class='col-md-12 col-sm-12 col-xs-12 column'><dl ><dt>视频地址：</dt><dd>"+device_selected.VideoURL+"</dd></dl></div>";$("#Label_dev_detail").append(t),$("#Table_device_sensor").empty(),t="<thead> <tr> <th>传感器 </th><th>状态 </th> </tr> </thead> <tbody >";var a;for(null===device_selected_sensor&&(device_selected_sensor=[]),a=0;a<device_selected_sensor.length;a++){var o="开启";"false"==device_selected_sensor[a].status&&(o="关闭"),t=t+"<tr class=' li_menu' id='sensor_table_cell"+a+"' sequence='"+a+"'> <td>"+get_sensor_name(device_selected_sensor[a].id)+"</td><td>"+o+"</td> </tr>"}for($("#Table_device_sensor").append(t),sensor_table_cell_click=function(){"null"!=$(this).attr("sequence")&&(select_sensor=device_selected_sensor[parseInt($(this).attr("sequence"))],show_sensor_module())},a=0;a<device_selected_sensor.length;a++)$("#sensor_table_cell"+a).on("click",sensor_table_cell_click)}}function show_new_dev_module(){$("#newDevModalLabel").text("创建新设备"),device_module_status=!0,$("#DevDevCode_Input").attr("disabled",!1),$("#DevDevCode_Input").val(""),$("#DevStatCode_choice").empty(),$("#DevProjCode_choice").empty(),$("#DevProjCode_choice").append(get_proj_option()),get_proj_point_option($("#DevProjCode_choice").val(),$("#DevStatCode_choice"),""),$("#DevStartTime_Input").val(""),$("#DevPreEndTime_Input").val(""),$("#DevEndTime_Input").val(""),$("#DevDevStatus_choice").val("true"),$("#DevVideoURL_Input").val(""),$("#DevDevCode_Input").attr("placeholder","设备编号"),$("#DevStartTime_Input").attr("placeholder","安装时间"),$("#DevPreEndTime_Input").attr("placeholder","预计结束时间"),$("#DevEndTime_Input").attr("placeholder","实际结束时间"),modal_middle($("#newDevModal")),$("#newDevModal").modal("show")}function submit_new_dev_module(){var e=$("#DevDevCode_Input").val(),t=$("#DevStatCode_choice").val(),a=$("#DevStartTime_Input").val(),o=$("#DevPreEndTime_Input").val(),n=$("#DevEndTime_Input").val(),i=$("#DevDevStatus_choice").val(),l=$("#DevVideoURL_Input").val();
if(null===e||""===e)return $("#DevDevCode_Input").attr("placeholder","设备号不能为空"),void $("#DevDevCode_Input").focus();if(null===t||""===t)return $("#DevStatCode_choice").attr("placeholder","项目不能为空"),void $("#DevStatCode_choice").focus();if(null===a||""===a)return $("#DevStartTime_Input").attr("placeholder","负责人姓名不能为空"),void $("#DevStartTime_Input").focus();var r={DevCode:e,StatCode:t,StartTime:a,PreEndTime:o,EndTime:n,DevStatus:i,VideoURL:l};new_dev(r)}function show_mod_dev_module(e){$("#newDevModalLabel").text("设备修改"),device_module_status=!1,$("#DevDevCode_Input").attr("disabled",!0),$("#DevDevCode_Input").val(e.DevCode),$("#DevStatCode_choice").empty(),$("#DevProjCode_choice").empty(),$("#DevProjCode_choice").append(get_proj_option(e.ProjCode)),get_proj_point_option($("#DevProjCode_choice").val(),$("#DevStatCode_choice"),e.StatCode),$("#DevStatCode_choice").val(e.StatCode),$("#DevStartTime_Input").val(e.StartTime),$("#DevPreEndTime_Input").val(e.PreEndTime),$("#DevEndTime_Input").val(e.EndTime),e.DevStatus?$("#DevDevStatus_choice").val("true"):$("#DevDevStatus_choice").val("false"),$("#DevVideoURL_Input").val(e.VideoURL),$("#DevDevCode_Input").attr("placeholder","设备编号"),$("#DevStartTime_Input").attr("placeholder","安装时间"),$("#DevPreEndTime_Input").attr("placeholder","预计结束时间"),$("#DevEndTime_Input").attr("placeholder","实际结束时间"),modal_middle($("#newDevModal")),$("#newDevModal").modal("show")}function submit_mod_dev_module(){var e=$("#DevDevCode_Input").val(),t=$("#DevStatCode_choice").val(),a=$("#DevStartTime_Input").val(),o=$("#DevPreEndTime_Input").val(),n=$("#DevEndTime_Input").val(),i=$("#DevDevStatus_choice").val(),l=$("#DevVideoURL_Input").val(),r={DevCode:e,StatCode:t,StartTime:a,PreEndTime:o,EndTime:n,DevStatus:i,VideoURL:l};modify_dev(r)}function get_proj_name(e){var t=null;null===project_list&&(project_list=[]);for(var a=0;a<project_list.length;a++)if(project_list[a].id==e){t=project_list[a].name;break}return t}function get_point_name(e){var t=null;null===point_list&&(point_list=[]);for(var a=0;a<point_list.length;a++)if(point_list[a].id==e){t=point_list[a].name;break}return t}function get_proj_option(e){txt="",null===project_list&&(project_list=[]);for(var t=0;t<project_list.length;t++)project_list[t].id==e?txt=txt+"<option value="+project_list[t].id+" selected='selected'>"+project_list[t].name+"</option>":txt=txt+"<option value="+project_list[t].id+">"+project_list[t].name+"</option>";return txt}function get_proj_point_option(e,t,a){if(t.empty(),""!==e&&null!==e){var o="";null===point_list&&(point_list=[]);for(var n=0;n<point_list.length;n++)point_list[n].ProjCode==e&&(o=point_list[n].id==a?o+"<option value="+point_list[n].id+" selected='selected' >"+point_list[n].name+"</option>":o+"<option value="+point_list[n].id+">"+point_list[n].name+"</option>");t.empty(),t.append(o)}}function get_monitor_list(){var e={action:"MonitorList",type:"query",user:usr.id},t=function(e){return"false"==e.status?void show_expiredModule():(monitor_map_list=e.ret,void addMarker())};JQ_get(request_head,e,t)}function get_monitor_alarm_list(){var e={action:"MonitorAlarmList",type:"query",user:usr.id},t=function(e){return"false"==e.status?void show_expiredModule():void(alarm_map_list=e.ret)};JQ_get(request_head,e,t)}function get_monitor_warning_on_map(){if(null!==monitor_selected&&null!==monitor_map_handle){var e={StatCode:monitor_selected.StatCode},t={action:"DevAlarm",body:e,type:"query",user:usr.id},a=function(e){if("false"==e.status)return void show_expiredModule();var t=e.ret.alarmlist,a="";if("false"==t)a="<Strong>获取告警失败</Strong>";else{a="<div id ='Element_card_floating' align='center' ><p style='font-size:14px;font-weight: bold' >站点名称："+monitor_selected.StatName+"</p><HR style='FILTER: alpha(opacity=100,finishopacity=0,style=3)' width='80%' color=#987cb9 SIZE=3/><div style='font-size:10px; min-height: 350px; min-width:420px' >",a+=" <div class='col-md-6 column'>";for(var o=0;o<t.length;o++){t[o].AlarmEName;a=a+"<img src='./svg/icon/"+t[o].AlarmEName+".svg' style='width:36px;hight:36px'></img><label style='max-width: 150px;min-width: 150px'>&nbsp&nbsp&nbsp&nbsp"+t[o].AlarmName+":";var n=t[o].AlarmValue,i=t[o].WarningTarget;a="true"==i?a+"<Strong style='color:red'>"+n+"</Strong>"+t[o].AlarmUnit+"</label>":a+"<Strong>"+n+"</Strong>"+t[o].AlarmUnit+"</label>",a+="<HR style='FILTER: alpha(opacity=100,finishopacity=0,style=3)' width='80%' color=#987cb9 SIZE=3/>",o==t.length/2-1&&(a+="</div><div class='col-md-6 column'>")}a+="</div></div>"}null!==monitor_map_handle&&monitor_map_handle.setContent(a),$("#VideoStatCode_Input").val(monitor_selected.StatName),video_selection_change()};JQ_get(request_head,t,a)}}function monitor_lock(){var e=monitor_selected.StatCode;void 0!==e&&show_openlockmodule(e)}function initializeMap(){var e=new Date;$("#Alarm_query_Input2").val(e.Format("yyyy-MM-dd"));var t=parseInt($("#MPMonitorViewMap").css("min-height").replace(/[^0-9]/gi,""));window.screen.availHeight-275>t&&(t=window.screen.availHeight-275),$("#MPMonitorViewMap").css("min-height",t+"px"),map_MPMonitor=new BMap.Map("MPMonitorViewMap"),map_MPMonitor.addControl(new BMap.NavigationControl),map_MPMonitor.enableScrollWheelZoom(),"GPS"===usr.city?null===Longitude?map_MPMonitor.centerAndZoom("beijing",12):map_MPMonitor.centerAndZoom(new BMap.Point(Longitude,Latitude),12):map_MPMonitor.centerAndZoom(usr.city,12),get_project_list(),get_proj_point_list(),get_monitor_alarm_list(),get_alarm_type_list(),get_monitor_list(),getfavoritelist(),map_initialized=!0}function build_alarm_tabs2(){if(null!==alarm_type_list){$("#Alarm_chart_view_nav2").empty(),$("#Alarm_Chart_content2").empty();var e,t="",a="",o="",n="";for(e=0;e<alarm_type_list.length;e++)o="",n="",0===e&&(o="class='active'",n=" in active"),t=t+"<li class=''><a href='#' data-toggle='tab' aria-expanded='false' id='Warning_"+alarm_type_list[e].id+"_tab_month2' alarmid='"+alarm_type_list[e].id+"'>"+alarm_type_list[e].name+"</a></li>",a=a+"<div class='Alarm_Canvas' id='Warning_"+alarm_type_list[e].id+"_month2' ><div id='"+alarm_type_list[e].id+"_canvas_month2' class='Alarm_Canvas' ></div></div>";for($("#Alarm_chart_view_nav2").append(t),$("#Alarm_Chart_content2").append(a),Warning_tab_month_click2=function(){hide_all_chart2(),alarm_interval_tab="#Warning_"+$(this).attr("alarmid")+"_month2",$("#Warning_"+$(this).attr("alarmid")+"_month2").css("display","block")},e=0;e<alarm_type_list.length;e++)$("#Warning_"+alarm_type_list[e].id+"_tab_month2").on("click",Warning_tab_month_click2);for($("#Alarm_chart_realtime_view_nav2").empty(),$("#Alarm_Chart_realtime_content2").empty(),t="",a="",e=0;e<alarm_type_list.length;e++)o="",n="",0===e&&(o="class='active'",n=" in active"),t=t+"<li class='dropdown'><a href='#' id='Warning_"+alarm_type_list[e].id+"_tab2' class='dropdown-toggle' data-toggle='dropdown'>"+alarm_type_list[e].name+" <b class='caret'></b></a><ul class='dropdown-menu' role='menu' aria-labelledby='Warning_"+alarm_type_list[e].id+"_tab2''><li><a href='#Warning_"+alarm_type_list[e].id+"_minute2' "+o+" tabindex='-1' data-toggle='tab' id='Warning_"+alarm_type_list[e].id+"_tab_minute2' alarmid='"+alarm_type_list[e].id+"'>实时分钟（60）</a> </li><li><a href='#Warning_"+alarm_type_list[e].id+"_hour2' tabindex='-1' data-toggle='tab'  id='Warning_"+alarm_type_list[e].id+"_tab_hour2' alarmid='"+alarm_type_list[e].id+"'>实时小时（24）</a> </li></ul> </li>",a=a+"<div class='Alarm_Canvas' id='Warning_"+alarm_type_list[e].id+"_minute2' ><div id='"+alarm_type_list[e].id+"_canvas_minute2' class='Alarm_Canvas'></div></div><div class='Alarm_Canvas' id='Warning_"+alarm_type_list[e].id+"_hour2' ><div id='"+alarm_type_list[e].id+"_canvas_hour2' class='Alarm_Canvas' ></div></div>";for($("#Alarm_chart_realtime_view_nav2").append(t),$("#Alarm_Chart_realtime_content2").append(a),Warning_tab_minute_click2=function(){hide_all_chart2(),$("#Warning_"+$(this).attr("alarmid")+"_minute2").css("display","block"),alarm_interval_tab="#Warning_"+$(this).attr("alarmid")+"_minute2"},Warning_tab_hour_click2=function(){hide_all_chart2(),$("#Warning_"+$(this).attr("alarmid")+"_hour2").css("display","block"),alarm_interval_tab="#Warning_"+$(this).attr("alarmid")+"_hour2"},e=0;e<alarm_type_list.length;e++)$("#Warning_"+alarm_type_list[e].id+"_tab_minute2").on("click",Warning_tab_minute_click2),$("#Warning_"+alarm_type_list[e].id+"_tab_hour2").on("click",Warning_tab_hour_click2);$("#Alarm_chart_view2").css("display","none"),$("#Alarm_chart_realtime_view2").css("display","block"),hide_all_chart2(),$(window).resize()}}function hide_all_chart2(){for(var e=0;e<alarm_type_list.length;e++)$("#Warning_"+alarm_type_list[e].id+"_month2").css("display","none"),$("#Warning_"+alarm_type_list[e].id+"_minute2").css("display","none"),$("#Warning_"+alarm_type_list[e].id+"_hour2").css("display","none")}function unhide_all_chart2(){for(var e=0;e<alarm_type_list.length;e++)$("#Warning_"+alarm_type_list[e].id+"_month2").css("display","block"),$("#Warning_"+alarm_type_list[e].id+"_minute2").css("display","block"),$("#Warning_"+alarm_type_list[e].id+"_hour2").css("display","block")}function get_select_alarm2(e){var t=e.split(":");null===monitor_map_list&&(monitor_map_list=[]);for(var a=0;a<monitor_map_list.length;a++)if(monitor_map_list[a].StatCode==t[0])return void(alarm_selected=monitor_map_list[a]);alarm_selected=null}function get_monitorpointinfo_on_map(){null!==alarm_selected&&$("#WCStatCode_Input2").val(alarm_selected.StatName)}function query_alarm2(e,t,a){var o={StatCode:alarm_selected.StatCode,date:e,type:t},n={action:"AlarmQuery",body:o,type:"query",user:usr.id},i=function(e){if("false"==e.status)return void show_expiredModule();var o=(e.ret.StatCode,e.ret.date),n=(e.ret.AlarmName,e.ret.AlarmUnit),i=(e.ret.WarningTarget,e.ret.minute_alarm,e.ret.hour_alarm,e.ret.day_alarm),l=(e.ret.minute_head,e.ret.hour_head,e.ret.day_head),r=parseInt(e.ret.Alarm_min),d=parseInt(e.ret.Alarm_max),_=0;$("#Warning_"+t+"_month2").css("display","block"),max=l.length-1,max>30&&(max=30);var s=[];for(_=0;_<i.length;_++)s.push({name:i[_].name,data:i[_].items,turboThreshold:1500});$("#"+t+"_canvas_month2").highcharts({chart:{type:"spline",zoomType:"x"},title:{text:a+" 日平均值日志，周期： "+o+" 为截至的30天 "},legend:{layout:"vertical",align:"left",verticalAlign:"top",x:150,y:100,floating:!0,borderWidth:1,backgroundColor:Highcharts.theme&&Highcharts.theme.legendBackgroundColor||"#FFFFFF"},xAxis:{categories:l,max:max},scrollbar:{enabled:!0},yAxis:{title:{text:a},max:d,min:r},tooltip:{shared:!0,valueSuffix:n},credits:{enabled:!1},plotOptions:{areaspline:{fillOpacity:.5}},series:s}),$("#Warning_"+t+"_month2").css("display","none"),show_table_tags2()};JQ_get(request_head,n,i)}function query_alarm3(e,t){if("MPMonitor"===CURRENT_URL){var a={StatCode:alarm_selected.StatCode,type:e},o={action:"AlarmQueryRealtime",body:a,type:"query",user:usr.id},n=function(a){if("false"==a.status)return void show_expiredModule();var o=(a.ret.StatCode,a.ret.date,a.ret.AlarmName,a.ret.AlarmUnit),n=(a.ret.WarningTarget,a.ret.minute_alarm),i=a.ret.hour_alarm,l=a.ret.minute_head,r=a.ret.hour_head,d=parseInt(a.ret.Alarm_min),_=parseInt(a.ret.Alarm_max),s=0;$("#Warning_"+e+"_minute2").css("display","block");var c=l.length-1;c>120&&(c=120);var u=[];for(s=0;s<n.length;s++)u.push({name:n[s].name,data:n[s].items,turboThreshold:1500});$("#"+e+"_canvas_minute2").highcharts({chart:{type:"spline",zoomType:"x"},title:{text:t+" 实时分钟值日志，周期：60分钟"},legend:{layout:"vertical",align:"left",verticalAlign:"top",x:150,y:100,floating:!0,borderWidth:1,backgroundColor:Highcharts.theme&&Highcharts.theme.legendBackgroundColor||"#FFFFFF"},xAxis:{categories:l,max:c},scrollbar:{enabled:!0},yAxis:{title:{text:t},max:_,min:d},tooltip:{shared:!0,valueSuffix:o},credits:{enabled:!1},plotOptions:{areaspline:{fillOpacity:.5}},series:u}),$("#Warning_"+e+"_minute2").css("display","none"),$("#Warning_"+e+"_hour2").css("display","block"),c=r.length-1,c>120&&(c=120);var p=[];for(s=0;s<i.length;s++)p.push({name:i[s].name,data:i[s].items,turboThreshold:1500});$("#"+e+"_canvas_hour2").highcharts({chart:{type:"spline",zoomType:"x"},title:{text:t+" 实时小时平均值日志，周期：24小时 "},legend:{layout:"vertical",align:"left",verticalAlign:"top",x:150,y:100,floating:!0,borderWidth:1,backgroundColor:Highcharts.theme&&Highcharts.theme.legendBackgroundColor||"#FFFFFF"},xAxis:{categories:r,max:c},scrollbar:{enabled:!0},yAxis:{title:{text:t},max:_,min:d},tooltip:{shared:!0,valueSuffix:o},credits:{enabled:!1},plotOptions:{areaspline:{fillOpacity:.5}},series:p}),$("#Warning_"+e+"_hour2").css("display","none"),show_table_tags3()};JQ_get(request_head,o,n)}}function get_select_monitor(e){var t=e.split(":");null===monitor_map_list&&(monitor_map_list=[]);for(var a=0;a<monitor_map_list.length;a++)if(monitor_map_list[a].StatCode==t[0])return monitor_selected=monitor_map_list[a],void favorateCount(monitor_selected.StatCode);monitor_selected=null}function addMarker(e){if(null!==monitor_map_list){monitor_mark_click=function(){get_select_monitor(this.getTitle()),get_select_alarm2(this.getTitle());var e=this.getTitle(),t=new BMap.InfoWindow(e,{offset:new BMap.Size(0,(-23)),width:600,height:300});monitor_map_handle=t,get_monitor_warning_on_map(),get_monitorpointinfo_on_map(),this.openInfoWindow(t),t.addEventListener("close",function(){monitor_map_handle==this&&(monitor_map_handle=null)})},null===monitor_map_list&&(monitor_map_list=[]);for(var t=0;t<monitor_map_list.length;t++){var a=new BMap.Point(parseFloat(monitor_map_list[t].Longitude),parseFloat(monitor_map_list[t].Latitude)),o="";switch(monitor_map_list[t].Status){case"normal":o="./image/map-marker-ball-green-small.png";break;case"warning":o="./image/map-marker-ball-orange-small.png";break;case"alarm":o="./image/map-marker-ball-pink-small.png";break;default:o="./image/map-marker-ball-gray-small.png"}var n=new BMap.Icon(o,new BMap.Size(32,32),{anchor:new BMap.Size(16,30)}),i=new BMap.Marker(a,{icon:n});i.setTitle(monitor_map_list[t].StatCode+":"+monitor_map_list[t].StatName),map_MPMonitor.addOverlay(i),i.addEventListener("click",monitor_mark_click),mark_MPMonitor_List.push(i)}}}function video_selection_change(){null!==monitor_selected&&""!==$("#Video_query_Input").val()}function get_video(e,t,a){var o={StatCode:e,date:t,hour:a},n={action:"GetVideoList",body:o,type:"query",user:usr.id},i=function(e){if("false"==e.status)return void show_expiredModule();var t=e.ret;$("#VCRStatus_choice").empty();for(var a="",o=0;o<t.length;o++)a=a+"<option value='"+t[o].id+"'>"+t[o].attr+"</option>";$("#VCRStatus_choice").append(a)};JQ_get(request_head,n,i)}function video_Module_selection_change(){""!==$("#VideoModuleStatCode_Input").val()&&""!==$("#VideoModule_query_Input").val()}function get_Module_video(e,t,a){var o={StatCode:e,date:t,hour:a},n={action:"GetVideoList",body:o,type:"query",user:usr.id},i=function(e){if("false"==e.status)return void show_expiredModule();var t=e.ret;$("#ModuleVCRStatus_choice").empty();for(var a="",o=0;o<t.length;o++)a=a+"<option value='"+t[o].id+"'>"+t[o].attr+"</option>";$("#ModuleVCRStatus_choice").append(a)};JQ_get(request_head,n,i)}function initialize_warning_table(){$("#Monitor_Page_control").empty(),$("#Table_Monitor").empty();var e,t="<li><a href='#' id='monitor_page_prev'>Prev</a></li>",a=Math.ceil(monitor_map_list.length/(2*table_row));for(e=0;e<a;e++)t=t+"<li><a href='#' id='monitor_page_"+e+"' number='"+e+"'>"+(e+1)+"</a></li>";for(t+="<li><a href='#' id='monitor_page_next'>Next</a></li>",$("#Monitor_Page_control").append(t),Monitor_table_start=0,Monitor_table_total=a,0===Monitor_table_start?$("#monitor_page_prev").css("display","none"):$("#monitor_page_prev").css("display","block"),Monitor_table_start+5>=Monitor_table_total?$("#monitor_page_next").css("display","none"):$("#monitor_page_next").css("display","block"),e=0;e<a;e++)e<5?$("#monitor_page_"+e).css("display","block"):$("#monitor_page_"+e).css("display","none");for($("#monitor_page_next").on("click",function(){if(!(Monitor_table_start+5>=Monitor_table_total)){Monitor_table_start+=5;for(var e=0;e<Monitor_table_total;e++)$("#monitor_page_"+e).css("display","none"),e>=Monitor_table_start&&e<Monitor_table_start+5&&$("#monitor_page_"+e).css("display","block");0===Monitor_table_start?$("#monitor_page_prev").css("display","none"):$("#monitor_page_prev").css("display","block"),Monitor_table_start+5>=Monitor_table_total?$("#monitor_page_next").css("display","none"):$("#monitor_page_next").css("display","block"),show_monitor_page(Monitor_table_start)}}),$("#monitor_page_prev").on("click",function(){if(0!==Monitor_table_start){Monitor_table_start-=5,Monitor_table_start<0&&(Monitor_table_start=0);for(var e=0;e<Monitor_table_total;e++)$("#monitor_page_"+e).css("display","none"),e>=Monitor_table_start&&e<Monitor_table_start+5&&$("#monitor_page_"+e).css("display","block");0===Monitor_table_start?$("#monitor_page_prev").css("display","none"):$("#monitor_page_prev").css("display","block"),Monitor_table_start+5>=Monitor_table_total?$("#monitor_page_next").css("display","none"):$("#monitor_page_next").css("display","block"),show_monitor_page(Monitor_table_start)}}),monitor_page_click=function(){show_monitor_page(parseInt($(this).attr("number")))},e=0;e<a;e++)$("#monitor_page_"+e).on("click",monitor_page_click);Monitor_table_initialized=!0,show_monitor_page(0)}function show_monitor_page(e){$("#Table_Monitor").empty(),table_head="<thead><tr><th>站点名称 </th> <th>监控信息 </th></tr></thread>";var t=table_head;t+="<tbody>",sequence=e*table_row*2,null===monitor_map_list&&(monitor_map_list=[]);for(var a=0;a<2*table_row;a++)sequence+a<monitor_map_list.length?(t+=0!==a%2?"<tr class='success' >":"<tr >",t=t+"<td>"+monitor_map_list[sequence+a].StatName+"</td><td id='Monitor_table_cell"+a+"' StatCode='"+monitor_map_list[sequence+a].StatCode+"'></td>",t+="</tr>"):(t+=0!==a%2?"<tr class='success'>":"<tr  >",t=t+"<td>--</td><td id='Monitor_table_cell"+a+"' DevCode='null'>--</td>",t+="</tr>");t+="</tbody>",$("#Table_Monitor").append(t),query_warning()}function build_monitor_message(e){var t="";if(null===e||void 0===e)return t;for(var a=0;a<e.length;a++)t=t+e[a].AlarmName+":","true"==e[a].WarningTarget&&(t+="<Strong style='color:red'>"),t=t+e[a].AlarmValue+" ","true"==e[a].WarningTarget&&(t+="</Strong>"),t=t+e[a].AlarmUnit+";";return t}function query_warning(){if(Monitor_table_initialized===!0){ajax_process=function(e){var t={StatCode:$("#Monitor_table_cell"+e).attr("StatCode")},a={action:"DevAlarm",body:t,type:"query",user:usr.id},o=function(e){var t="",a=e.ret.StatCode;t="false"==e.status?"<Strong style='color:red'>未找到对应监控信息</Strong>":build_monitor_message(e.ret.alarmlist);for(var o=0;o<2*table_row;o++)if($("#Monitor_table_cell"+o).attr("StatCode")==a){$("#Monitor_table_cell"+o).empty(),$("#Monitor_table_cell"+o).append(t);break}};JQ_get(request_head,a,o)};for(var e=0;e<2*table_row&&null!==$("#Monitor_table_cell"+e).attr("StatCode");e++)ajax_process(e)}}function query_static_warning(){if(Monitor_Static_table_initialized===!0){var e={action:"GetStaticMonitorTable",type:"query",user:usr.id},t=function(e){if("false"==e.status)return void show_expiredModule();var t=(new Date).Format("yyyy-MM-dd_hhmmss");$("#MonitorFlashTime").empty(),$("#MonitorFlashTime").append("最后刷新时间："+t);var a,o=e.ret.ColumnName,n=e.ret.TableData,i="<thead> <tr><th></th><th></th><th></th>";for(a=0;a<o.length;a++)i=i+"<th>"+o[a]+"</th>";for(i+="</tr></thead>",i+="<tbody>",a=0;a<n.length;a++){i+="<tr>",i=i+"<td><button type='button' class='btn btn-default camera_btn' StateCode='"+n[a][0]+"' StateName='"+n[a][1]+"' ><em class='glyphicon glyphicon-camera ' aria-hidden='true' ></em></button></td><td><button type='button' class='btn btn-default video_btn' StateCode='"+n[a][0]+"' ><em class='glyphicon glyphicon-play ' aria-hidden='true' ></em></button></td><td><button type='button' class='btn btn-default map_btn' StateCode='"+n[a][0]+"' StateName='"+n[a][1]+"' ><em class='glyphicon glyphicon-globe ' aria-hidden='true' ></em></button></td>";for(var l=0;l<n[a].length;l++)i=i+"<td>"+n[a][l]+"</td>";i+="</tr>"}i+="</tbody>",$("#MonitorQueryTable").empty(),$("#MonitorQueryTable").append(i),if_static_table_initialize&&$("#MonitorQueryTable").DataTable().destroy();$("#MonitorQueryTable").DataTable({scrollY:!1,scrollCollapse:!0,scrollX:!0,searching:!1,autoWidth:!0,lengthChange:!1,dom:"Bfrtip",buttons:[{extend:"excel",text:"导出到excel",filename:"MonitorData"+t}]});if_static_table_initialize=!0,video_btn_click=function(){var e=$(this).attr("StateCode");void 0!==e&&get_camera_and_video_web(e,!1,!0)},camera_btn_click=function(){var e=$(this).attr("StateCode"),t=$(this).attr("StateName");void 0!==e&&show_cameraModule(e,t)},map_btn_click=function(){mp_monitor();var e=$(this).attr("StateCode"),t=$(this).attr("StateName"),a=function(e,t){if(void 0!==e&&void 0!==t){var a=e+":"+t,o=find_marker(a);if(null!==o){get_select_monitor(a),get_select_alarm2(a),console.log("Selected:"+monitor_selected.StatName),console.log("Selected:"+monitor_selected.Longitude),console.log("Selected:"+monitor_selected.Latitude);var n=monitor_selected.Longitude,i=monitor_selected.Latitude;map_MPMonitor.centerAndZoom(new BMap.Point(n,i),15);var l=e+":"+t,r=new BMap.InfoWindow(l,{offset:new BMap.Size(0,(-23)),width:600,height:300});monitor_map_handle=r,get_monitor_warning_on_map(),get_monitorpointinfo_on_map(),o.openInfoWindow(r),r.addEventListener("close",function(){monitor_map_handle==this&&(monitor_map_handle=null)})}}};setTimeout(function(){a(e,t)},500)},$(".video_btn").on("click",video_btn_click),$(".camera_btn").on("click",camera_btn_click),$(".map_btn").on("click",map_btn_click),$("#MonitorQueryTable").on("draw.dt",function(){$(".video_btn").unbind(),$(".camera_btn").unbind(),$(".map_btn").unbind(),$(".video_btn").on("click",video_btn_click),$(".camera_btn").on("click",camera_btn_click),$(".map_btn").on("click",map_btn_click)})};JQ_get(request_head,e,t)}}function query_audit_stability(){var e={action:"GetAuditStabilityTable",type:"query",user:usr.id},t=function(e){if("false"==e.status)return void show_expiredModule();var t=(new Date).Format("yyyy-MM-dd_hhmmss");$("#AuditStabilityFlashTime").empty(),$("#AuditStabilityFlashTime").append("最后刷新时间："+t);var a,o=e.ret.ColumnName,n=e.ret.TableData,i="<thead> <tr>";for(a=0;a<o.length;a++)i=i+"<th>"+o[a]+"</th>";for(i+="</tr></thead>",i+="<tbody>",a=0;a<n.length;a++){i+="<tr>";for(var l=0;l<n[a].length;l++)i=i+"<td>"+n[a][l]+"</td>";i+="</tr>"}i+="</tbody>",$("#AuditStabilityTable").empty(),$("#AuditStabilityTable").append(i),if_audit_stability_table_initialized&&$("#AuditStabilityTable").DataTable().destroy();$("#AuditStabilityTable").DataTable({scrollY:!1,scrollCollapse:!0,scrollX:!0,searching:!1,autoWidth:!0,lengthChange:!1,dom:"Bfrtip",buttons:[{extend:"excel",text:"导出到excel",filename:"MonitorData"+t}]});if_audit_stability_table_initialized=!0};JQ_get(request_head,e,t)}function build_key_history_proj_choice(){if(null!==project_list){var e="";for(null===project_list&&(project_list=[]),i=0;i<project_list.length;i++)e=e+"<option value="+project_list[i].id+">"+project_list[i].name+"</option>";$("#KeyHistoryProj_choice").append(e)}}function key_history_initialize(){Key_History_table_initialized===!1&&(null===project_list?(get_project_list(),window.setTimeout(build_key_history_proj_choice,wait_time_long)):build_key_history_proj_choice(),Key_History_table_initialized=!0)}function query_open_lock_history(){if(Key_History_table_initialized===!0){var e=$("#KeyHistoryProj_choice").val(),t=$("#KeyHistoryTime_choice").val(),a=$("#KeyHistoryWord_Input").val(),o={ProjCode:e,Time:t,KeyWord:a},n={action:"KeyHistory",body:o,user:usr.id},i=function(e){if("false"==e.status)return void show_expiredModule();var t=(new Date).Format("yyyy-MM-dd_hhmmss");$("#KeyHistoryLastFlash").empty(),$("#KeyHistoryLastFlash").append("最后刷新时间："+t);var a,o=e.ret.ColumnName,n=e.ret.TableData,i="<thead> <tr>";for(a=0;a<o.length;a++)i=i+"<th>"+o[a]+"</th>";for(i+="</tr></thead>",i+="<tbody>",a=0;a<n.length;a++){i+="<tr>";for(var l=0;l<n[a].length;l++)i=i+"<td>"+n[a][l]+"</td>";i+="</tr>"}i+="</tbody>",$("#KeyHistoryQueryTable").empty(),$("#KeyHistoryQueryTable").append(i),if_key_history_table_initialize&&$("#KeyHistoryQueryTable").DataTable().destroy();$("#KeyHistoryQueryTable").DataTable({scrollY:!1,scrollCollapse:!0,scrollX:!0,searching:!1,autoWidth:!0,lengthChange:!1,dom:"Bfrtip",buttons:[{extend:"excel",text:"导出到excel",filename:"HistoryData"+t}]});if_key_history_table_initialize=!0};JQ_get(request_head,n,i)}}function get_alarm_type_list(){var e={action:"AlarmType",type:"query",user:usr.id},t=function(e){return"false"==e.status?void show_expiredModule():(alarm_type_list=e.ret,void build_alarm_tabs2())};JQ_get(request_head,e,t)}function query_alarm(e,t,a){var o={StatCode:alarm_selected.StatCode,date:e,type:t},n={action:"AlarmQuery",body:o,type:"query",user:usr.id},i=function(e){if("false"==e.status)return void show_expiredModule();var o=(e.ret.StatCode,e.ret.date),n=(e.ret.AlarmName,e.ret.AlarmUnit),i=(e.ret.WarningTarget,e.ret.minute_alarm),l=e.ret.hour_alarm,r=e.ret.day_alarm,d=e.ret.minute_head,_=e.ret.hour_head,s=e.ret.day_head,c=parseInt(e.ret.Alarm_min),u=parseInt(e.ret.Alarm_max),p=0;$("#Warning_"+t+"_day").css("display","block");var m=d.length-1;m>120&&(m=120);var h=[];for(p=0;p<i.length;p++)h.push({name:i[p].name,data:i[p].items,turboThreshold:1500});$("#"+t+"_canvas_day").highcharts({chart:{type:"spline",zoomType:"x"},title:{text:a+" 分钟值日志，日期："+o},legend:{layout:"vertical",align:"left",verticalAlign:"top",x:150,y:100,floating:!0,borderWidth:1,backgroundColor:Highcharts.theme&&Highcharts.theme.legendBackgroundColor||"#FFFFFF"},xAxis:{categories:d,max:m},scrollbar:{enabled:!0},yAxis:{title:{text:a},max:u,min:c},tooltip:{shared:!0,valueSuffix:n},credits:{enabled:!1},plotOptions:{areaspline:{fillOpacity:.5}},series:h}),$("#Warning_"+t+"_day").css("display","none"),$("#Warning_"+t+"_week").css("display","block"),m=_.length-1,m>120&&(m=120);var v=[];for(p=0;p<l.length;p++)v.push({name:l[p].name,data:l[p].items,turboThreshold:1500});$("#"+t+"_canvas_week").highcharts({chart:{type:"spline",zoomType:"x"},title:{text:a+" 小时平均值日志，周期： "+o+" 为截至的7天 "},legend:{layout:"vertical",align:"left",verticalAlign:"top",x:150,y:100,floating:!0,borderWidth:1,backgroundColor:Highcharts.theme&&Highcharts.theme.legendBackgroundColor||"#FFFFFF"},xAxis:{categories:_,max:m},scrollbar:{enabled:!0},yAxis:{title:{text:a},max:u,min:c},tooltip:{shared:!0,valueSuffix:n},credits:{enabled:!1},plotOptions:{areaspline:{fillOpacity:.5}},series:v}),$("#Warning_"+t+"_week").css("display","none"),$("#Warning_"+t+"_month").css("display","block"),m=s.length-1,m>30&&(m=30);var g=[];for(p=0;p<r.length;p++)g.push({name:r[p].name,data:r[p].items,turboThreshold:1500});$("#"+t+"_canvas_month").highcharts({chart:{type:"spline",zoomType:"x"},title:{text:a+" 日平均值日志，周期： "+o+" 为截至的30天 "},legend:{layout:"vertical",align:"left",verticalAlign:"top",x:150,y:100,floating:!0,borderWidth:1,backgroundColor:Highcharts.theme&&Highcharts.theme.legendBackgroundColor||"#FFFFFF"},xAxis:{categories:s,max:m},scrollbar:{enabled:!0},yAxis:{title:{text:a},max:u,min:c},tooltip:{shared:!0,valueSuffix:n},credits:{enabled:!1},plotOptions:{areaspline:{fillOpacity:.5}},series:g}),$("#Warning_"+t+"_month").css("display","none"),show_table_tags()};JQ_get(request_head,n,i)}function initializeAlarmMap(){get_project_list(),get_proj_point_list(),get_monitor_alarm_list(),get_alarm_type_list();var e=new Date;$("#Alarm_query_Input").val(e.Format("yyyy-MM-dd"));var t=parseInt($("#WCMonitorViewMap").css("min-height").replace(/[^0-9]/gi,""));window.screen.availHeight/2>t&&(t=window.screen.availHeight/2),$("#WCMonitorViewMap").css("min-height",t+"px"),map_AlarmMonitor=new BMap.Map("WCMonitorViewMap"),map_AlarmMonitor.addControl(new BMap.NavigationControl),map_AlarmMonitor.enableScrollWheelZoom(),"GPS"===usr.city?null===Longitude?map_AlarmMonitor.centerAndZoom("beijing",12):map_AlarmMonitor.centerAndZoom(new BMap.Point(Longitude,Latitude),12):map_AlarmMonitor.centerAndZoom(usr.city,12),window.setTimeout(alarm_addMarker,wait_time_long),window.setTimeout(build_alarm_tabs,wait_time_long),alarm_map_initialized=!0}function alarm_cycle(){alarm_map_initialized!==!1&&(get_monitor_alarm_list(),window.setTimeout(alarm_addMarker,wait_time_long))}function monitor_cycle(){map_initialized!==!1&&(get_monitor_list(),window.setTimeout(addMarker,wait_time_long))}function build_alarm_tabs(){if(null!==alarm_type_list){$("#Alarm_chart_view_nav").empty(),$("#Alarm_Chart_content").empty();var e,t="",a="";for(e=0;e<alarm_type_list.length;e++){var o="",n="";0===e&&(o="class='active'",n=" in active"),t=t+"<li class='dropdown'><a href='#' id='Warning_"+alarm_type_list[e].id+"_tab' class='dropdown-toggle' data-toggle='dropdown'>"+alarm_type_list[e].name+" <b class='caret'></b></a><ul class='dropdown-menu' role='menu' aria-labelledby='Warning_"+alarm_type_list[e].id+"_tab''><li><a href='#Warning_"+alarm_type_list[e].id+"_day' "+o+" tabindex='-1' data-toggle='tab' id='Warning_"+alarm_type_list[e].id+"_tab_day' alarmid='"+alarm_type_list[e].id+"'>分钟报表（日）</a> </li><li><a href='#Warning_"+alarm_type_list[e].id+"_week' tabindex='-1' data-toggle='tab'  id='Warning_"+alarm_type_list[e].id+"_tab_week' alarmid='"+alarm_type_list[e].id+"'>小时报表（周）</a> </li><li><a href='#Warning_"+alarm_type_list[e].id+"_month' tabindex='-1' data-toggle='tab'  id='Warning_"+alarm_type_list[e].id+"_tab_month' alarmid='"+alarm_type_list[e].id+"'> 日报表（30天）</a> </li> </ul> </li>",a=a+"<div class='Alarm_Canvas' id='Warning_"+alarm_type_list[e].id+"_day' ><div id='"+alarm_type_list[e].id+"_canvas_day' class='Alarm_Canvas'></div></div><div class='Alarm_Canvas' id='Warning_"+alarm_type_list[e].id+"_week' ><div id='"+alarm_type_list[e].id+"_canvas_week' class='Alarm_Canvas' ></div></div><div class='Alarm_Canvas' id='Warning_"+alarm_type_list[e].id+"_month' ><div id='"+alarm_type_list[e].id+"_canvas_month' class='Alarm_Canvas' ></div></div>"}for($("#Alarm_chart_view_nav").append(t),$("#Alarm_Chart_content").append(a),Warning_tab_day_click=function(){hide_all_chart(),$("#Warning_"+$(this).attr("alarmid")+"_day").css("display","block")},Warning_tab_week_click=function(){hide_all_chart(),$("#Warning_"+$(this).attr("alarmid")+"_week").css("display","block")},Warning_tab_month_click=function(){hide_all_chart(),$("#Warning_"+$(this).attr("alarmid")+"_month").css("display","block")},e=0;e<alarm_type_list.length;e++)$("#Warning_"+alarm_type_list[e].id+"_tab_day").on("click",Warning_tab_day_click),$("#Warning_"+alarm_type_list[e].id+"_tab_week").on("click",Warning_tab_week_click),$("#Warning_"+alarm_type_list[e].id+"_tab_month").on("click",Warning_tab_month_click);hide_all_chart(),$(window).resize()}}function hide_all_chart(){for(var e=0;e<alarm_type_list.length;e++)$("#Warning_"+alarm_type_list[e].id+"_day").css("display","none"),$("#Warning_"+alarm_type_list[e].id+"_week").css("display","none"),$("#Warning_"+alarm_type_list[e].id+"_month").css("display","none")}function unhide_all_chart(){for(var e=0;e<alarm_type_list.length;e++)$("#Warning_"+alarm_type_list[e].id+"_day").css("display","block"),$("#Warning_"+alarm_type_list[e].id+"_week").css("display","block"),$("#Warning_"+alarm_type_list[e].id+"_month").css("display","block")}function get_select_alarm(e){var t=e.split(":");null===monitor_map_list&&(monitor_map_list=[]);for(var a=0;a<monitor_map_list.length;a++)if(monitor_map_list[a].StatCode==t[0])return void(alarm_selected=monitor_map_list[a]);alarm_selected=null}function get_alarmpointinfo_on_map(){null!==alarm_selected&&null!==alarm_map_handle&&(txt="<div id ='Element_card_floating'><p style='font-size:14px;' >站点名称："+alarm_selected.StatName+"</p><HR style='FILTER: alpha(opacity=100,finishopacity=0,style=3)' width='80%' color=#987cb9 SIZE=3/><div style='font-size:10px;' >站点地址："+alarm_selected.Address+"</div></div>",null!==alarm_map_handle&&alarm_map_handle.setContent(txt),$("#WCStatCode_Input").val(alarm_selected.StatName))}
function alarm_addMarker(e){if("WarningCheck"==CURRENT_URL&&null!==alarm_map_list){var t=new BMap.Icon("./image/map-marker-ball-pink-small.png",new BMap.Size(32,32),{anchor:new BMap.Size(16,30)});alarm_mark_click=function(){get_select_alarm(this.getTitle());var e=this.getTitle(),t=new BMap.InfoWindow(e,{offset:new BMap.Size(0,(-23))});t.setWidth(400),alarm_map_handle=t,get_alarmpointinfo_on_map(),this.openInfoWindow(t),t.addEventListener("close",function(){alarm_map_handle==this&&(alarm_map_handle=null)})},null===alarm_map_list&&(alarm_map_list=[]);for(var a=0;a<alarm_map_list.length;a++){var o=new BMap.Point(parseFloat(alarm_map_list[a].Longitude),parseFloat(alarm_map_list[a].Latitude)),n=new BMap.Marker(o,{icon:t});n.setTitle(alarm_map_list[a].StatCode+":"+alarm_map_list[a].StatName),map_AlarmMonitor.addOverlay(n),n.addEventListener("click",alarm_mark_click)}}}function Data_export_Normal(e,t,a,o){$("#TableQueryCondition").css("display","none"),$("#ExportTable").empty(),$("#TableExportTitle").text(e);var n={TableName:t,Condition:a,Filter:o},i={action:"TableQuery",body:n,type:"query",user:usr.id},l=function(t){if("false"==t.status)return void show_expiredModule();ColumnName=t.ret.ColumnName,TableData=t.ret.TableData;var a,o="<thead> <tr>";for(a=0;a<ColumnName.length;a++)o=o+"<th>"+ColumnName[a]+"</th>";for(o+="</tr></thead>",o+="<tbody>",a=0;a<TableData.length;a++){o+="<tr>";for(var n=0;n<TableData[a].length;n++)o=o+"<td>"+TableData[a][n]+"</td>";o+="</tr>"}o+="</tbody>",$("#ExportTable").append(o),if_table_initialize&&$("#ExportTable").DataTable().destroy();$("#ExportTable").DataTable({scrollY:200,scrollCollapse:!0,scrollX:!0,searching:!1,autoWidth:!0,lengthChange:!1,dom:"Bfrtip",buttons:[{extend:"excel",text:"导出到excel",filename:e+(new Date).Format("yyyy-MM-dd_hhmmss")}]});if_table_initialize=!0,modal_middle($("#TableExportModule")),$("#TableExportModule").modal("show")};JQ_get(request_head,i,l)}function Data_export_alarm(){if_table_initialize&&($("#ExportTable").DataTable().destroy(),if_table_initialize=!1),$("#ExportTable").empty(),$("#TableQueryCondition").css("display","block"),$("#TableExportTitle").text("告警日志导出"),$("#QueryProjCode_choice").empty(),$("#QueryStatCode_choice").empty(),null!==alarm_selected?($("#QueryProjCode_choice").append(get_proj_option(alarm_selected.ProjCode)),get_proj_point_option($("#QueryProjCode_choice").val(),$("#QueryStatCode_choice"),alarm_selected.StatCode),$("#QueryStatCode_choice").val(alarm_selected.StatCode)):($("#QueryProjCode_choice").append(get_proj_option()),get_proj_point_option($("#QueryProjCode_choice").val(),$("#QueryStatCode_choice"),"")),$("#QueryStartTime_Input").val(get_yesterday()),$("#QueryEndTime_Input").val(get_yesterday()),modal_middle($("#TableExportModule")),$("#TableExportModule").modal("show")}function Data_export_alarm2(){if_table_initialize&&($("#ExportTable").DataTable().destroy(),if_table_initialize=!1),$("#ExportTable").empty(),$("#TableQueryCondition").css("display","block"),$("#TableExportTitle").text("告警日志导出"),$("#QueryProjCode_choice").empty(),$("#QueryStatCode_choice").empty(),null!==alarm_selected?($("#QueryProjCode_choice").append(get_proj_option(alarm_selected.ProjCode)),get_proj_point_option($("#QueryProjCode_choice").val(),$("#QueryStatCode_choice"),alarm_selected.StatCode),$("#QueryStatCode_choice").val(alarm_selected.StatCode)):($("#QueryProjCode_choice").append(get_proj_option()),get_proj_point_option($("#QueryProjCode_choice").val(),$("#QueryStatCode_choice"),"")),$("#QueryStartTime_Input").val(get_yesterday()),$("#QueryEndTime_Input").val(get_yesterday()),modal_middle($("#TableExportModule")),$("#TableExportModule").modal("show")}function submit_alarm_query(){var e=$("#QueryStatCode_choice").val(),t=$("#QueryAlarm_choice").val(),a=$("#QueryStartTime_Input").val(),o=$("#QueryEndTime_Input").val();if(""===e)return void $("#QueryStatCode_choice").focus();var n=[],i={ConditonName:"UserId",Equal:usr.id,GEQ:"",LEQ:""};n.push(i),i={ConditonName:"StatCode",Equal:e,GEQ:"",LEQ:""},n.push(i),i={ConditonName:"AlarmType",Equal:t,GEQ:"",LEQ:""},n.push(i),i={ConditonName:"AlarmDate",Equal:"",GEQ:o,LEQ:a},n.push(i);var l={TableName:"Alarmtable",Condition:n,Filter:[]},r={action:"TableQuery",body:l,type:"query",user:usr.id},d=function(e){if("false"==e.status)return void show_expiredModule();ColumnName=e.ret.ColumnName,TableData=e.ret.TableData,$("#ExportTable").empty();var t,a="<thead> <tr>";for(t=0;t<ColumnName.length;t++)a=a+"<th>"+ColumnName[t]+"</th>";for(a+="</tr></thead>",a+="<tbody>",t=0;t<TableData.length;t++){a+="<tr>";for(var o=0;o<TableData[t].length;o++)a=a+"<td>"+TableData[t][o]+"</td>";a+="</tr>"}a+="</tbody>",$("#ExportTable").append(a),if_table_initialize&&$("#ExportTable").DataTable().destroy();$("#ExportTable").DataTable({scrollY:200,scrollCollapse:!0,scrollX:!0,searching:!1,autoWidth:!0,lengthChange:!1,dom:"Bfrtip",buttons:[{extend:"excel",text:"导出到excel",filename:"日志数据导出"+$("#QueryStatCode_choice").text()+(new Date).Format("yyyy-MM-dd_hhmmss")}]});if_table_initialize=!0,modal_middle($("#TableExportModule")),$("#TableExportModule").modal("show")};JQ_get(request_head,r,d)}function get_sensor_list(){var e={action:"SensorList",type:"query",user:usr.id},t=function(e){return"false"==e.status?void show_expiredModule():void(sensor_list=e.ret)};JQ_get(request_head,e,t)}function get_device_sensor(e){var t={DevCode:e},a={action:"DevSensor",body:t,type:"query",user:usr.id},o=function(e){return"false"==e.status?void show_expiredModule():(device_selected_sensor=e.ret,void draw_dev_detail_panel())};JQ_get(request_head,a,o)}function get_sensor_name(e){var t="未知传感器";null===sensor_list&&(sensor_list=[]);for(var a=0;a<sensor_list.length;a++)e==sensor_list[a].id&&(t=sensor_list[a].nickname);return t}function show_sensor_module(){if(null!==select_sensor){if($("#SensorExtraInfo").empty(),$("#SensorDevCode_Input").val(device_selected.DevCode),$("#SensorName_Input").val(get_sensor_name(select_sensor.id)),$("#SensorStatus_choice").val(select_sensor.status),null===select_sensor.para&&(select_sensor.para=[]),0!==select_sensor.para.length){var e,t="";for(e=0;e<select_sensor.para.length;e++)t=t+"<div class='input-group '><span class='input-group-addon' style='min-width: 100px'>"+select_sensor.para[e].name+"</span><input type='text' class='form-control' placeholder='"+select_sensor.para[e].memo+"' aria-describedby='basic-addon1' id='SensorPara_"+select_sensor.para[e].name+"'/></div><p></p>";for($("#SensorExtraInfo").append(t),e=0;e<select_sensor.para.length;e++)$("#SensorPara_"+select_sensor.para[e].name).val(select_sensor.para[e].value)}modal_middle($("#SensorModal")),$("#SensorModal").modal("show")}}function submit_sensor_module(){if(null!==select_sensor){var e=[];null===select_sensor.para&&(select_sensor.para=[]);for(var t=0;t<select_sensor.para.length;t++){var a={name:select_sensor.para[t].name,value:$("#SensorPara_"+select_sensor.para[t].name).val()};e.push(a)}var o={DevCode:device_selected.DevCode,SensorCode:select_sensor.id,status:$("#SensorStatus_choice").val(),ParaList:e},n={action:"SensorUpdate",body:o,type:"mod",user:usr.id},i=function(e){var t=e.status;"true"==t?($("#SensorModal").modal("hide"),Initialize_dev_detail(),setTimeout(function(){show_alarm_module(!1,"传感器修改成功！",null)},500)):setTimeout(function(){show_alarm_module(!0,"传感器修改失败！"+e.msg,null)},500)};JQ_get(request_head,n,i)}}function get_key_auth_list(e){var t={KeyCode:e},a={action:"KeyAuthlist",body:t,type:"query",user:usr.id},o=function(e){return"false"==e.status?void show_expiredModule():(select_key_auth=e.ret,void show_key_auth_module())};JQ_get(request_head,a,o)}function show_key_auth_module(){if(null!==select_key_auth){if($("#KeyAuthList").empty(),$("#KeyAuthNumber_Input").val(""+select_key_auth.length),0!==select_key_auth.length){var e,t="";for(t="<table data-toggle='table' class='table table-hover table-bordered' ' data-click-to-select='false' ><thead> <tr> <th>授权设备 </th> <th>授权方式 </th></tr> </thead> <tbody >",e=0;e<select_key_auth.length;e++)t=t+"<tr> <td>"+select_key_auth[e].DomainName+"</td> <td>"+select_key_auth[e].AuthWay+"</td></tr>";t+="</tbody></table>",$("#KeyAuthList").append(t)}modal_middle($("#KeyModal")),$("#KeyModal").modal("show")}}function get_user_message(){var e={id:usr.id},t={action:"GetUserMsg",body:e,type:"query",user:usr.id},a=function(e){var t=e.status;"true"==t?(usr_msg=e.ret.msg,usr_ifdev=e.ret.ifdev):show_alarm_module(!0,"获取用户信息失败，请重新登录！"+e.msg,null)};JQ_get(request_head,t,a)}function get_user_image(){var e={id:usr.id},t={action:"GetUserImg",body:e,type:"query",user:usr.id},a=function(e){var t=e.status;"true"==t?(usr_img=e.ret,reflash_usr_img_table()):show_alarm_module(!0,"获取用户信息失败，请重新登录！"+e.msg,null)};JQ_get(request_head,t,a)}function clear_user_image(){var e={id:usr.id},t={action:"ClearUserImg",body:e,type:"query",user:usr.id},a=function(e){var t=e.status;"true"==t?(usr_img=[],reflash_usr_img_table()):show_alarm_module(!0,"获取用户信息失败，请重新登录！"+e.msg,null)};JQ_get(request_head,t,a)}function set_user_message(e,t){var a={id:usr.id,msg:e,ifdev:t},o={action:"SetUserMsg",body:a,type:"query",user:usr.id},n=function(e){var t=e.status;"true"==t?show_alarm_module(!0,"屏保欢迎语设置成功！"+e.msg,null):show_alarm_module(!0,"获取用户信息失败，请重新登录！"+e.msg,null)};JQ_get(request_head,o,n)}function show_usr_msg_module(){$("#UsrMsg_Input").val(usr_msg),$("#UsrDev_choice").val(usr_ifdev),reflash_usr_img_table(),$("#file-zh").fileinput({language:"zh",uploadUrl:upload_url+"?id="+usr.id,allowedFileExtensions:["jpg","png","gif"],showPreview:!0}),modal_middle($("#UsrMsgModal")),$("#UsrMsgModal").modal("show")}function reflash_usr_img_table(){$("#UsrImgTable").empty();var e="<thead> <tr> <th> 已上传文件</th> </tr> </thead> <tbody >";null===usr_img&&(usr_img=[]);for(var t=0;t<usr_img.length;t++)e=e+"<tr> <td>"+usr_img[t].name+"</td></tr>";$("#UsrImgTable").append(e)}function user_message_update(){var e={id:usr.id,msg:$("#UsrMsg_Input").val(),ifdev:$("#UsrDev_choice").val()},t={action:"SetUserMsg",body:e,type:"query",user:usr.id},a=function(e){var t=e.status;"true"==t?($("#UsrMsgModal").modal("hide"),show_alarm_module(!0,"屏保欢迎语设置成功！"+e.msg,null)):show_alarm_module(!0,"获取用户信息失败，请重新登录！"+e.msg,null)};JQ_get(request_head,t,a)}function change_camera_status(e,t,a,o){$("#video_img").attr("src",a),$("#camera_zoom").data("ionRangeSlider").update({from:o})}function get_camera_unit(){var e={action:"GetCameraUnit",type:"query",user:usr.id},t=function(e){var t=e.status;"true"==t?(camera_unit_h=e.ret.h,camera_unit_v=e.ret.v):show_alarm_module(!0,"获取摄像头基本单位失败，请重新登录！"+e.msg,null)};JQ_get(request_head,e,t)}function get_camera_status(e){var t={StatCode:e},a={action:"GetCameraStatus",body:t,type:"query",user:usr.id},o=function(e){var t=e.status;"true"==t?change_camera_status(e.ret.h,e.ret.v,e.ret.url,e.ret.zoom):show_alarm_module(!0,"获取摄像头基本单位失败，请重新登录！"+e.msg,null)};JQ_get(request_head,a,o)}function move_camera(e,t,a){var o,n={StatCode:e,adj:a};o="v"==t?{action:"CameraVAdj",body:n,type:"mod",user:usr.id}:"h"==t?{action:"CameraHAdj",body:n,type:"mod",user:usr.id}:{action:"CameraZAdj",body:n,type:"mod",user:usr.id};var i=function(e){var t=e.status;"true"==t?change_camera_status(e.ret.h,e.ret.v,e.ret.url,e.ret.z):show_alarm_module(!0,"改变摄像头参数失败，请重新登录！"+e.msg,null)};JQ_get(request_head,o,i)}function reset_camera(e){var t={StatCode:e},a={action:"CameraReset",body:t,type:"mod",user:usr.id},o=function(e){var t=e.status;"true"==t?change_camera_status(e.ret.h,e.ret.v,e.ret.url,e.ret.z):show_alarm_module(!0,"改变摄像头参数失败，请重新登录！"+e.msg,null)};JQ_get(request_head,a,o)}function show_cameraModule(e,t){modal_middle($("#VideoSelectionModule")),$("#VideoModuleStatCode_Input").val(e),$("#VideoModuleStatName_Input").val(t),get_camera_status(e),$("#VideoSelectionModule").modal("show")}function JQ_get(e,t,a){return"null"!=t.user&&"false"==usr.userauth[t.type]?void show_alarm_module(!0,"您没有进行此操作的权限",null):void jQuery.get(e,t,function(e){log(e);var t=JSON.parse(e);return"false"==t.status?void show_expiredModule():"false"==t.auth?void show_alarm_module(!0,"您没有进行此操作的权限："+t.msg,null):void a(t)})}function JQ_get_with_para(e,t,a,o){return"null"!=t.user&&"false"==usr.userauth[t.type]?void show_alarm_module(!0,"您没有进行此操作的权限",null):void jQuery.get(e,t,function(e){log(e);var t=JSON.parse(e);return"false"==t.status?void show_expiredModule():"false"==t.auth?void show_alarm_module(!0,"您没有进行此操作的权限："+t.msg,null):void a(t,o)})}function thread_sync(e,t,a){var o=0,n=function(t,a){e==threadnumber&&(e=0,clearInterval(t),a())};o=setInterval(function(){n(o,a)},500)}function show_alarm_module(e,t,a){if(e?($("#UserAlertModalLabel").text("警告"),$("#UserAlertModalContent").empty(),$("#UserAlertModalContent").append("<strong>警告！</strong>"+t)):($("#UserAlertModalLabel").text("通知"),$("#UserAlertModalContent").empty(),$("#UserAlertModalContent").append("<strong>通知：</strong>"+t)),modal_middle($("#UserAlarm")),$("#UserAlarm").modal("show"),null===a)emptyfunction=function(){},$("#UserAlarm").on("hide.bs.modal",emptyfunction);else{var o=0;$("#UserAlarm").on("hide.bs.modal",function(){1==++o&&setTimeout(a,500)})}}function getLocation(){console.log("正在获取位置！"),navigator.geolocation?navigator.geolocation.getCurrentPosition(showPosition):console.log("无法获得当前位置！")}function showPosition(e){console.log("Latitude: "+e.coords.latitude+"Longitude: "+e.coords.longitude),Latitude=e.coords.latitude,Longitude=e.coords.longitude}function parameter_initialize(){parameter_initial=!0,null===project_list&&get_project_list(),get_VersionInformation(),draw_parameter_page()}function draw_parameter_page(){$("#UpdateProj_choice").empty();var e,t="";for(null===project_list&&(project_list=[]),e=0;e<project_list.length;e++)t=t+"<option value="+project_list[e].id+">"+project_list[e].name+"</option>";$("#UpdateProj_choice").append(t),get_ProjUpdateStrategy($("#UpdateProj_choice").val()),$("#UpdateProj_choice").change(function(){get_ProjUpdateStrategy($(this).val())}),$("#UpdateLineChange_button").on("click",function(){click_ProjVersionStrategyChange_commit($("#UpdateProj_choice").val(),$("#UpdateLine_choice").val())}),$("#FlashProjUpdatedetail_button").on("click",function(){query_ProjUpdateStrategyList($("#UpdateProj_choice").val())}),$("#ProjAutoUpdate_button").on("click",function(){click_ProjUpdateStrategyChange_commit($("#UpdateProj_choice").val(),"true")}),$("#ProjNotUpdate_button").on("click",function(){click_ProjUpdateStrategyChange_commit($("#UpdateProj_choice").val(),"false")}),$("#UpdateProj_choice").change(function(){query_ProjUpdateStrategyList($("#UpdateProj_choice").val())}),query_ProjUpdateStrategyList($("#UpdateProj_choice").val())}function get_VersionInformation(){var e={action:"VersionInformation",type:"query",user:usr.id},t=function(e){var t=e.status;if("true"==t){for(var a=e.ret,o="<dl ><dt>版本升级详细信息：</dt><p></p>",n=0;n<a.length;n++)o=o+"<dd>"+a[n]+"</dd><p></p>";o+="</dl>",$("#Version_detail").empty(),$("#Version_detail").append(o)}else setTimeout(function(){show_alarm_module(!0,"无法获取版本详细说明！"+e.msg,null)},500)};JQ_get(request_head,e,t)}function get_ProjUpdateStrategy(e){var t={ProjCode:e},a={action:"GetProjUpdateStrategy",body:t,type:"query",user:usr.id},o=function(e){var t=e.status;if("true"==t){var a=e.ret.VersionLine;$("#UpdateLine_choice").val(a)}else setTimeout(function(){show_alarm_module(!0,"无法获取项目处于版本线"+e.msg,null)},500)};JQ_get(request_head,a,o)}function click_ProjVersionStrategyChange_commit(e,t){var a={ProjCode:e,UpdateLine:t},o={action:"ProjVersionStrategyChange",body:a,type:"query",user:usr.id},n=function(e){var t=e.status;"true"==t?setTimeout(function(){show_alarm_module(!1,"版本线更新成功！",null)},500):setTimeout(function(){show_alarm_module(!0,"版本线更新失败"+e.msg,null)},500)};JQ_get(request_head,o,n)}function click_PointUpdateStrategyChange_commit(e,t,a){var o={StatCode:e,AutoUpdate:t},n={action:"PointUpdateStrategyChange",body:o,type:"query",user:usr.id},i=function(e,a){var o=e.status;"true"==o?(a.empty(),"true"===t?(a.append("<em class='glyphicon glyphicon-ok' aria-hidden='true' ></em>"),a.attr("AutoUpdate","Y")):(a.append("<em class='glyphicon glyphicon-remove' aria-hidden='true' ></em>"),a.attr("AutoUpdate","N"))):setTimeout(function(){show_alarm_module(!0,"监测点自动更新设置失败"+e.msg,null)},500)};JQ_get_with_para(request_head,n,i,a)}function click_ProjUpdateStrategyChange_commit(e,t){var a={ProjCode:e,AutoUpdate:t},o={action:"ProjUpdateStrategyChange",body:a,type:"query",user:usr.id},n=function(e){var t=e.status;"true"==t?setTimeout(function(){show_alarm_module(!1,"批量自动更新设置成功！请手动刷新",null)},500):setTimeout(function(){show_alarm_module(!0,"批量自动更新设置失败"+e.msg,null)},500)};JQ_get(request_head,o,n)}function query_ProjUpdateStrategyList(e){var t={ProjCode:e},a={action:"ProjUpdateStrategyList",body:t,type:"query",user:usr.id},o=function(e){if("false"==e.status)return void show_expiredModule();var t=(new Date).Format("yyyy-MM-dd_hhmmss");$("#UpdateFlashTime").empty(),$("#UpdateFlashTime").append("最后刷新时间："+t);var a,o=e.ret.ColumnName,n=e.ret.TableData,i="<thead> <tr>";for(a=0;a<o.length;a++)i=i+"<th>"+o[a]+"</th>";for(i+="</tr></thead>",i+="<tbody>",a=0;a<n.length;a++){i+="<tr>";for(var l=0;l<n[a].length;l++)if(1!=l)i=i+"<td>"+n[a][l]+"</td>";else{var r="glyphicon glyphicon-remove";"Y"===n[a][1]&&(r="glyphicon glyphicon-ok"),i=i+"<td><button type='button' class='btn btn-default update_change_btn' StateCode='"+n[a][0]+"' AutoUpdate= '"+n[a][1]+"'><em class='"+r+"' aria-hidden='true' ></em></button></td>"}i+="</tr>"}i+="</tbody>",$("#ProjUpdateDetailTable").empty(),$("#ProjUpdateDetailTable").append(i),if_update_table_initialize&&$("#ProjUpdateDetailTable").DataTable().destroy();$("#ProjUpdateDetailTable").DataTable({scrollY:!1,scrollCollapse:!0,scrollX:!0,searching:!1,autoWidth:!0,lengthChange:!1,dom:"Bfrtip",buttons:[{text:"自动升级",action:function(e,t,a,o){click_ProjUpdateStrategyChange_commit($("#UpdateProj_choice").val(),"true")}},{text:"手动升级",action:function(e,t,a,o){click_ProjUpdateStrategyChange_commit($("#UpdateProj_choice").val(),"false")}},{extend:"excel",text:"导出到excel",filename:"MonitorData"+t}]});if_update_table_initialize=!0,update_change_btn_click=function(){var e=$(this).attr("StateCode");if(void 0!==e&&null!==e){var t=$(this).attr("AutoUpdate"),a="true";"Y"===t&&(a="false"),click_PointUpdateStrategyChange_commit(e,a,$(this))}},$(".update_change_btn").on("click",update_change_btn_click),$("#ProjUpdateDetailTable").on("draw.dt",function(){$(".update_change_btn").unbind(),$(".update_change_btn").on("click",update_change_btn_click)})};JQ_get(request_head,a,o)}function build_warning_handle_proj_choice(){if(null!==project_list){var e="";for(null===project_list&&(project_list=[]),i=0;i<project_list.length;i++)e=e+"<option value="+project_list[i].id+">"+project_list[i].name+"</option>";$("#WarningHandleProj_choice").append(e)}}function warning_handle_initialize(){Warning_Handle_table_initialized===!1&&(null===project_list?(get_project_list(),window.setTimeout(build_warning_handle_proj_choice,wait_time_long)):build_warning_handle_proj_choice(),Warning_Handle_table_initialized=!0)}function query_warning_handle_list(){if(Warning_Handle_table_initialized===!0){var e=$("#WarningHandleProj_choice").val(),t=$("#WarningHandleTime_choice").val(),a=$("#WarningHandleWord_Input").val(),o={ProjCode:e,Time:t,KeyWord:a},n={action:"GetWarningHandleListTable",body:o,type:"query",user:usr.id},i=function(e){if("false"==e.status)return void show_expiredModule();var t=(new Date).Format("yyyy-MM-dd_hhmmss");$("#WarningHandleFlashTime").empty(),$("#WarningHandleFlashTime").append("最后刷新时间："+t);var a,o=e.ret.ColumnName,n=e.ret.TableData,i="<thead> <tr><th></th><th></th><th></th>";for(a=0;a<o.length;a++)i=i+"<th>"+o[a]+"</th>";for(i+="</tr></thead>",i+="<tbody>",a=0;a<n.length;a++){i+="<tr>",i=i+"<td><button type='button' class='btn btn-default rtsp_play_btn' OpenCode='"+n[a][0]+"' ><em class='glyphicon glyphicon-play ' aria-hidden='true' ></em></button></td>",i=i+"<td><button type='button' class='btn btn-default open_btn' OpenCode='"+n[a][0]+"' ><em class='glyphicon glyphicon-picture ' aria-hidden='true' ></em></button></td>",i="N"==n[a][1]?i+"<td><ul class='pagination'> <li><a href='#' class = 'alarm_action_btn' StatCode='"+n[a][2]+"'>处理</a> </li></ul></td>":i+"<td><ul class='pagination'> <li><a href='#' class = 'alarm_close_btn' StatCode='"+n[a][2]+"'>关闭</a> </li></ul></td>";for(var l=0;l<n[a].length;l++)i=i+"<td>"+n[a][l]+"</td>";i+="</tr>"}i+="</tbody>",$("#WarningHandleQueryTable").empty(),$("#WarningHandleQueryTable").append(i),if_Warning_Handle_table_initialize&&$("#WarningHandleQueryTable").DataTable().destroy();$("#WarningHandleQueryTable").DataTable({scrollY:!1,scrollCollapse:!0,scrollX:!0,searching:!1,autoWidth:!0,lengthChange:!1,dom:"Bfrtip",select:!0,buttons:{buttons:[{extend:"excel",text:"导出到excel",filename:"AlarmData"+t}]}});if_Warning_Handle_table_initialize=!0,alarm_action_btn_click=function(){var e=$(this).attr("StatCode");$("#AlarmHandleUpdateCommit").attr("StatCode",e);var t=get_point_name(e);$("#AlarmStatName_Input").val(t),modal_middle($("#AlarmHandleProcess")),$("#AlarmHandleProcess").modal("show")},$(".alarm_action_btn").on("click",alarm_action_btn_click),alarm_close_btn_click=function(){var e=$(this).attr("StatCode");handle_Alarm_close(e)},$(".alarm_close_btn").on("click",alarm_close_btn_click),$("#WarningHandleQueryTable").on("draw.dt",function(){$(".alarm_action_btn").unbind(),$(".alarm_close_btn").unbind(),$(".alarm_action_btn").on("click",alarm_action_btn_click),$(".alarm_close_btn").on("click",alarm_close_btn_click)}),Openpicture_btn_click=function(){var e=$(this).attr("OpenCode");getwarningpicture(e)},Rtsp_play_btn_click=function(){var e=$(this).attr("OpenCode");getrtsphistorylist(e)},$(".open_btn").on("click",Openpicture_btn_click),$(".rtsp_play_btn").on("click",Rtsp_play_btn_click),$("#WarningHandleQueryTable").on("draw.dt",function(){$(".open_btn").unbind(),$(".open_btn").on("click",Openpicture_btn_click),$(".rtsp_play_btn").unbind(),$(".rtsp_play_btn").on("click",Rtsp_play_btn_click)})};JQ_get(request_head,n,i)}}function getwarningpicture(e){var t={warningid:e},a={action:"GetWarningImg",body:t,type:"query",user:usr.id},o=function(e){var t=e.status;if("true"==t)if("true"==e.ret.ifpicture){var a=e.ret.picture;window.open("http://"+window.location.host+"/"+show_image_url+"?image="+a+"#","监控照片","height=620, width=640, top=0, left=400,toolbar=no, menubar=no, scrollbars=no, resizable=no, location=no, status=no")}else show_alarm_module(!1,"本次告警未能捕捉到照片",null);else show_alarm_module(!0,"请重新登录！"+e.msg,null)};JQ_get(request_head,a,o)}function handle_Alarm_process(e,t,a){var o={StatCode:e,Mobile:t,Action:a},n={action:"AlarmHandle",body:o,type:"mod",user:usr.id},i=function(e){var t=e.status;"true"==t?setTimeout(function(){show_alarm_module(!1,"工单下发成功",null),query_warning_handle_list()},500):setTimeout(function(){show_alarm_module(!0,"工单下发失败"+e.msg,null)},500)};JQ_get(request_head,n,i)}function handle_Alarm_close(e){var t={StatCode:e},a={action:"AlarmClose",body:t,type:"mod",user:usr.id},o=function(e){var t=e.status;"true"==t?setTimeout(function(){show_alarm_module(!1,"告警关闭成功",null),query_warning_handle_list()},500):setTimeout(function(){show_alarm_module(!0,"告警关闭失败"+e.msg,null)},500)};JQ_get(request_head,a,o)}function AlarmHandleUpdateCommit_button_commit(){var e=$("#AlarmHandleUpdateCommit").attr("StatCode"),t=$("#AlarmHandleMobile_Input").val(),a=$("#AlarmHandleAction_Input").val();""!==t&&""!==a&&(handle_Alarm_process(e,t,a),$("#AlarmHandleProcess").modal("hide"))}function get_camera_and_video_web(e,t,a){var o={StatCode:e},n={action:"GetVideoCameraWeb",body:o,type:"mod",user:usr.id},i=function(e){var o=e.status;"true"==o?(t&&window.open(e.ret.camera,"监控录像","height=768, width=1024, top=0, left=0,toolbar=no, menubar=no, scrollbars=no, resizable=no, location=no, status=no"),a&&(window.location.href=e.ret.video)):show_alarm_module(!0,"请重新登录！"+e.msg,null)};JQ_get(request_head,n,i)}function get_pm(e){var t=e,a=httphead+"//api.map.baidu.com/telematics/v3/weather?location="+t+"&output=json&ak=2Pcn24FAWGTcyW4jsC8O38IyPd0pDZYX";$.ajax({url:a,scriptCharset:"gbk",dataType:"jsonp",crossDomain:!0,success:function(e){weather_info=t+"今日天气："+e.results[0].weather_data[0].weather+" 气温："+e.results[0].weather_data[0].temperature+" 颗粒物："+e.results[0].pm25,$("#weather_label").text(weather_info+"    ")}})}function getfavoritelist(){var e={action:"Favourite_list",type:"query",user:usr.id},t=function(e){var t=e.status;"true"==t?(usr_faverate_list=e.ret,build_fast_guild(),usr_faverate_list.length>0&&get_city(usr_faverate_list[0].Latitude,usr_faverate_list[0].Longitude)):show_alarm_module(!0,"请重新登录！"+e.msg,null)};JQ_get(request_head,e,t)}function favorateCount(e){var t={StatCode:e},a={action:"Favourite_count",body:t,type:"query",user:usr.id},o=function(e){var t=e.status;"true"==t||show_alarm_module(!0,"请重新登录！"+e.msg,null)};JQ_get(request_head,a,o)}function build_fast_guild(){$("#fast_guild").empty(),txt="<thead> <tr> <th>常用站点 </th> </tr> </thead> <tbody >";for(var e=0;e<usr_faverate_list.length;e++)txt=txt+"<tr> <td class='favouratelist' Latitude="+usr_faverate_list[e].Latitude+" Longitude="+usr_faverate_list[e].Longitude+" StatCode="+usr_faverate_list[e].StatCode+" StatName="+usr_faverate_list[e].StatName+">"+usr_faverate_list[e].StatName+"</td> </tr>";txt+="</tbody>",$("#fast_guild").append(txt),$(".favouratelist").on("click",function(){var e=$(this).attr("Longitude"),t=$(this).attr("Latitude");map_MPMonitor.centerAndZoom(new BMap.Point(e,t),15);var a=$(this).attr("StatCode")+":"+$(this).attr("StatName"),o=find_marker(a);if(null!==o){get_select_monitor(a),get_select_alarm2(a);var n=$(this).attr("StatCode")+":"+$(this).attr("StatName"),i=new BMap.InfoWindow(n,{offset:new BMap.Size(0,(-23)),width:600,height:300});monitor_map_handle=i,get_monitor_warning_on_map(),get_monitorpointinfo_on_map(),o.openInfoWindow(i),i.addEventListener("close",function(){monitor_map_handle==this&&(monitor_map_handle=null)})}})}function find_marker(e){for(var t=0;t<mark_MPMonitor_List.length;t++)if(mark_MPMonitor_List[t].getTitle()===e)return mark_MPMonitor_List[t];return null}function get_city(e,t){var a=(new BMap.Map("allmap"),new BMap.Point(t,e)),o=new BMap.Geocoder;o.getLocation(a,function(e){var t=e.addressComponents;usr_favorate_city=t.city,get_pm(usr_favorate_city)})}function getrtsphistorylist(e){var t={alarmcode:e},a={action:"GetHistoryRTSP",body:t,type:"query",user:usr.id},o=function(e){var t=e.status;"true"==t?($("#RTSPHistoryStatName_Input").val(e.ret.StatName),$("#RTSPHistoryAlarmTime_Input").val(e.ret.AlarmDate),$("#RTSPHistoryAlarmReason_Input").val(e.ret.AlarmReason),$("#RTSPHistoryshow").attr("data-url",e.ret.rtspurl),modal_middle($("#RTSPVideoModule")),$("#RTSPVideoModule").modal("show")):show_alarm_module(!0,"请重新登录！"+e.msg,null)};JQ_get(request_head,a,o)}function getshowaction(){var e={action:"GetShowAction",type:"query",user:usr.id},t=function(e){var t=e.status;"true"==t?"true"===e.ret&&(ifPPTshow=!0):show_alarm_module(!0,"请重新登录！"+e.msg,null)};JQ_get(request_head,e,t)}function PPTshow(){if(ifPPTshow!==!1&&0!==mark_MPMonitor_List.length){var e=mark_MPMonitor_List[randomNum(0,mark_MPMonitor_List.length-1)];get_select_monitor(e.getTitle()),get_select_alarm2(e.getTitle());var t=e.getTitle(),a=new BMap.InfoWindow(t,{offset:new BMap.Size(0,(-23)),width:600,height:300});monitor_map_handle=a,get_monitor_warning_on_map(),get_monitorpointinfo_on_map(),e.openInfoWindow(a),a.addEventListener("close",function(){monitor_map_handle==e&&(monitor_map_handle=null)})}}var httphead=gethttphead(),basic_address=getRelativeURL()+"/";console.log(basic_address);var wait_time_long=3e3,wait_time_middle=1e3,wait_time_short=500,cycle_time=6e4,show_time=15e3,request_head=basic_address+"request.php",jump_url=basic_address+"jump.php",upload_url=basic_address+"upload.php",screen_saver_address=basic_address+"screensaver/screen.html",show_image_url=basic_address+"imageshow/ImageShow.html",weather_info="",alarm_interval=null,alarm_interval_tab=null,ifPPTshow=!1,usr;usr="";var admin="",keystr="",table_row=5,usr_msg="",usr_ifdev="true",usr_img=[],usr_favorate_city="",current_table,table_head,map_MPMonitor,map_AlarmMonitor,mark_MPMonitor_List=[],map_initialized=!1,usr_faverate_list=[],user_initial=!1,user_start=0,user_total=0,project_pg_list=null,user_table=null,user_selected,user_selected_auth,user_selected_key,NewUserAuthDual2,user_module_status,pg_initial=!1,pg_start=0,pg_total=0,pg_table=null,pg_selected,pg_selected_proj,NewPGProjDual2,pg_module_status,project_list=null,project_initial=!1,project_start=0,project_total=0,project_table=null,project_selected,project_selected_device,project_module_status,parameter_initial=!1,software_version_list=null,if_update_table_initialize=!1,point_initial=!1,point_start=0,point_total=0,point_table=null,point_selected,point_selected_device,point_selected_picture,project_selected_point,project_selected_key,point_module_status,point_list=null,device_initial=!1,device_start=0,device_total=0,device_table=null,device_selected,device_selected_sensor,device_module_status,key_list=null,proj_user_list=null,key_initial=!1,key_start=0,key_total=0,key_table=null,key_selected,key_selected_auth,key_module_status,monitor_map_list=null,monitor_handle,monitor_selected=null,monitor_list=null,monitor_string="",monitor_map_handle=null,Monitor_table_initialized=!1,Monitor_table_start=0,Monitor_table_total=0,Monitor_Static_table_initialized=!0,if_static_table_initialize=!1,Key_History_table_initialized=!1,if_key_history_table_initialize=!1,Key_auth_initialized=!1,alarm_map_list=null,alarm_type_list=null,alarm_map_initialized=!1,alarm_selected=null,alarm_map_handle=null,alarm_array=null,Warning_Handle_table_initialized=!1,if_Warning_Handle_table_initialize=!1,export_table_name=null,if_table_initialize=!1,Audit_Stability_table_initialized=!1,if_audit_stability_table_initialized=!1,sensor_list=null,select_sensor_devcode=null,select_sensor=null,select_key_auth=null,camera_unit_h,camera_unit_v,Longitude=null,Latitude=null,global_key_word="";getLocation();var CURRENT_URL="desktop",$BODY=$("body"),$MENU_TOGGLE=$("#menu_toggle"),$SIDEBAR_MENU=$("#sidebar-menu"),$SIDEBAR_FOOTER=$(".sidebar-footer"),$LEFT_COL=$(".left_col"),$RIGHT_COL=$(".right_col"),$NAV_MENU=$(".nav_menu"),$FOOTER=$("footer");$(document).ready(function(){var e=document.querySelectorAll(".cycle-menuItem");console.log("items="+e.length);for(var t=0,a=e.length;t<a;t++)e[t].style.left=(50-35*Math.cos(-.5*Math.PI-2*(1/a)*t*Math.PI)).toFixed(4)+"%",e[t].style.top=(50+35*Math.sin(-.5*Math.PI-2*(1/a)*t*Math.PI)).toFixed(4)-15*(t+1)+"%";document.querySelector(".cycle-circle").classList.toggle("open");var o=function(){$RIGHT_COL.css("min-height",$(window).height());var e=$BODY.outerHeight(),t=$FOOTER.outerHeight(),a=$LEFT_COL.eq(1).height()+$SIDEBAR_FOOTER.height(),o=e<a?a:e;o-=$NAV_MENU.outerHeight()+t,$RIGHT_COL.css("min-height",o)};$SIDEBAR_MENU.find("a").on("click",function(e){var t=$(this).parent();t.is(".active")?(t.removeClass("active active-sm"),$("ul:first",t).slideUp(function(){o()})):(t.parent().is(".child_menu")||($SIDEBAR_MENU.find("li").removeClass("active active-sm"),$SIDEBAR_MENU.find("li ul").slideUp()),t.addClass("active"),$("ul:first",t).slideDown(function(){o()}))}),$MENU_TOGGLE.on("click",function(){$BODY.hasClass("nav-md")?($SIDEBAR_MENU.find("li.active ul").hide(),$SIDEBAR_MENU.find("li.active").addClass("active-sm").removeClass("active")):($SIDEBAR_MENU.find("li.active-sm ul").show(),$SIDEBAR_MENU.find("li.active-sm").addClass("active").removeClass("active-sm")),$BODY.toggleClass("nav-md nav-sm"),o()}),$SIDEBAR_MENU.find('a[href="#"]').on("click",function(){$BODY.hasClass("nav-md")||$(this).parent().parent().slideUp()}),$(window).smartresize(function(){o()}),o(),$.fn.mCustomScrollbar&&$(".menu_fixed").mCustomScrollbar({autoHideScrollbar:!0,theme:"minimal",mouseWheel:{preventDefault:!0}}),$(".camerazoom").ionRangeSlider({min:-180,max:180,grid:!0,force_edges:!0,
onFinish:function(e){var t=$("#VideoModuleStatCode_Input").val(),a="z",o=e.from;move_camera(t,a,o)}}),$(".rtspzoom").ionRangeSlider({min:-10,max:10,from:0,grid:!0,force_edges:!0})}),function(e,t){var a=function(e,t,a){var o;return function(){function n(){a||e.apply(i,l),o=null}var i=this,l=arguments;o?clearTimeout(o):a&&e.apply(i,l),o=setTimeout(n,t||100)}};jQuery.fn[t]=function(e){return e?this.bind("resize",a(e)):this.trigger(t)}}(jQuery,"smartresize"),window.onload=function(){},$(document).ready(function(){$("[data-toggle='modal']").click(function(){var e=$(this).attr("data-target");t=setTimeout(function(){var t=$(e).find(".modal-dialog");t.animate({"margin-top":parseInt(($(window).height()-t.height())/2)},300)},wait_time_short)}),$(".form_date").datetimepicker({language:"zh-CN",weekStart:1,todayBtn:1,autoclose:1,todayHighlight:1,startView:2,minView:2,forceParse:0}),NewUserAuthDual2=$(".NewUserAuthDual").bootstrapDualListbox({nonSelectedListLabel:"全部项目（组）",selectedListLabel:"用户权限",preserveSelectionOnMove:"moved",moveOnSelect:!0,nonSelectedFilter:"",showFilterInputs:!1,infoText:""}),$("#showValue").click(function(){alert($('[name="duallistbox_demo1"]').val())}),NewPGProjDual2=$(".NewPGProjDual").bootstrapDualListbox({nonSelectedListLabel:"全部项目",selectedListLabel:"本组包含",preserveSelectionOnMove:"moved",moveOnSelect:!0,nonSelectedFilter:"",showFilterInputs:!1,infoText:""}),DevUpdateDual2=$(".DevUpdateAuthDual").bootstrapDualListbox({nonSelectedListLabel:"当前设备",selectedListLabel:"需要升级",preserveSelectionOnMove:"moved",moveOnSelect:!0,nonSelectedFilter:"",showFilterInputs:!1,infoText:""}),$("#Desktop").css("min-height",window.screen.availHeight-300),$("#Undefined").css("min-height",window.screen.availHeight-300);setInterval(get_monitor_warning_on_map,cycle_time),setInterval(query_warning,cycle_time),setInterval(alarm_cycle,cycle_time),setInterval(monitor_cycle,cycle_time);PageInitialize(),$("#menu_logout").on("click",function(){logout()}),$("#UserManage").on("click",function(){CURRENT_URL="UserManage",active_menu("UserManage"),touchcookie(),user_manager()}),$("#KeyManage").on("click",function(){CURRENT_URL="KeyManage",active_menu("KeyManage"),touchcookie(),key_manage()}),$("#PGManage").on("click",function(){CURRENT_URL="PGManage",active_menu("PGManage"),touchcookie(),pg_manage()}),$("#ProjManage").on("click",function(){CURRENT_URL="ProjManage",active_menu("ProjManage"),touchcookie(),proj_manage()}),$("#ParaManage").on("click",function(){CURRENT_URL="ParaManage",active_menu("ParaManage"),touchcookie(),para_manage()}),$("#MPManage").on("click",function(){CURRENT_URL="MPManage",active_menu("MPManage"),touchcookie(),mp_manage()}),$("#DevManage").on("click",function(){CURRENT_URL="DevManage",active_menu("DevManage"),touchcookie(),dev_manage()}),$("#MPMonitor").on("click",function(){CURRENT_URL="MPMonitor",active_menu("MPMonitor"),touchcookie(),mp_monitor()}),$("#MPMonitorTable").on("click",function(){CURRENT_URL="MPMonitorTable",active_menu("MPMonitorTable"),touchcookie(),mp_monitor_table()}),$("#MPMonitorCard").on("click",function(){CURRENT_URL="MPMonitorCard",active_menu("MPMonitorCard"),touchcookie(),mp_monitor_card()}),$("#MPStaticMonitorTable").on("click",function(){CURRENT_URL="MPStaticMonitorTable",active_menu("MPStaticMonitorTable"),touchcookie(),mp_static_monitor_table()}),$("#WarningCheck").on("click",function(){CURRENT_URL="WarningCheck",active_menu("WarningCheck"),touchcookie(),warning_check()}),$("#WarningHandle").on("click",function(){CURRENT_URL="WarningHandle",active_menu("WarningHandle"),touchcookie(),warning_handle()}),$("#InstConf").on("click",function(){CURRENT_URL="InstConf",active_menu("InstConf"),touchcookie(),Inst_Conf()}),$("#InstRead").on("click",function(){CURRENT_URL="InstRead",active_menu("InstRead"),touchcookie(),Inst_Read()}),$("#InstDesign").on("click",function(){CURRENT_URL="InstDesign",active_menu("InstDesign"),touchcookie(),Inst_Design()}),$("#InstControl").on("click",function(){CURRENT_URL="InstControl",active_menu("InstControl"),touchcookie(),Inst_Control()}),$("#InstSnapshot").on("click",function(){CURRENT_URL="InstSnapshot",active_menu("InstSnapshot"),touchcookie(),Inst_Snapshot()}),$("#InstVideo").on("click",function(){CURRENT_URL="InstVideo",active_menu("InstVideo"),touchcookie(),Inst_Video()}),$("#AuditTarget").on("click",function(){CURRENT_URL="AuditTarget",active_menu("AuditTarget"),touchcookie(),Audit_Target()}),$("#AuditStability").on("click",function(){CURRENT_URL="AuditStability",active_menu("AuditStability"),touchcookie(),Audit_Stability()}),$("#AuditAvailability").on("click",function(){CURRENT_URL="AuditAvailability",active_menu("AuditAvailability"),touchcookie(),Audit_Availability()}),$("#AuditError").on("click",function(){CURRENT_URL="AuditError",active_menu("AuditError"),touchcookie(),Audit_Error()}),$("#AuditQuality").on("click",function(){CURRENT_URL="AuditQuality",active_menu("AuditQuality"),touchcookie(),Audit_Quality()}),$("#GeoInfoQuery").on("click",function(){CURRENT_URL="GeoInfoQuery",active_menu("GeoInfoQuery"),touchcookie(),Geo_InfoQuery()}),$("#GeoTrendAnalysis").on("click",function(){CURRENT_URL="GeoTrendAnalysis",active_menu("GeoTrendAnalysis"),touchcookie(),Geo_TrendAnalysis()}),$("#GeoDisaterForecast").on("click",function(){CURRENT_URL="GeoDisaterForecast",active_menu("GeoDisaterForecast"),touchcookie(),Geo_DisaterForecast()}),$("#GeoEmergencyDirect").on("click",function(){CURRENT_URL="GeoEmergencyDirect",active_menu("GeoEmergencyDirect"),touchcookie(),Geo_EmergencyDirect()}),$("#GeoDiffusionAnalysis").on("click",function(){CURRENT_URL="GeoDiffusionAnalysis",active_menu("GeoDiffusionAnalysis"),touchcookie(),Geo_DiffusionAnalysis()}),$("#WorkflowDesign").on("click",function(){CURRENT_URL="WorkflowDesign",active_menu("WorkflowDesign"),touchcookie(),Work_flowDesign()}),$("#OrderManagement").on("click",function(){CURRENT_URL="OrderManagement",active_menu("OrderManagement"),touchcookie(),Order_Management()}),$("#UnloadingManagement").on("click",function(){CURRENT_URL="UnloadingManagement",active_menu("UnloadingManagement"),touchcookie(),Unloading_Management()}),$("#OrderAudit").on("click",function(){CURRENT_URL="OrderAudit",active_menu("OrderAudit"),touchcookie(),Order_Audit()}),$("#ADConf").on("click",function(){CURRENT_URL="ADConf",active_menu("ADConf"),touchcookie(),AD_Conf()}),$("#WEBConf").on("click",function(){CURRENT_URL="WEBConf",active_menu("WEBConf"),touchcookie(),WEB_Conf()}),$("#KeyManage").on("click",function(){CURRENT_URL="KeyManage",active_menu("KeyManage"),touchcookie(),key_manage()}),$("#KeyAuth").on("click",function(){CURRENT_URL="KeyAuth",active_menu("KeyAuth"),touchcookie(),key_auth()}),$("#KeyHistory").on("click",function(){CURRENT_URL="KeyHistory",active_menu("KeyHistory"),touchcookie(),key_history()}),$("#UserfreshButton").on("click",function(){touchcookie(),clear_user_detail_panel(),user_intialize(0)}),$("#UserExportButton").on("click",function(){touchcookie();var e=[],t={ConditonName:"UserId",Equal:usr.id,GEQ:"",LEQ:""};e.push(t),Data_export_Normal("用户表导出","usertable",e,[])}),$("#UserNewButton").on("click",function(){touchcookie(),show_new_user_module()}),$("#UserDelButton").on("click",function(){touchcookie(),null===user_selected?show_alarm_module(!0,"请选择一个用户",null):(modal_middle($("#UserDelAlarm")),$("#UserDelAlarm").modal("show"))}),$("#UserModifyButton").on("click",function(){touchcookie(),null===user_selected?show_alarm_module(!0,"请选择一个用户",null):show_mod_user_module(user_selected,user_selected_auth)}),$("#delUserCommit").on("click",function(){del_user(user_selected.id),touchcookie()}),$("#newUserCommit").on("click",function(){user_module_status?(submit_new_user_module(),touchcookie()):(submit_mod_user_module(),touchcookie())}),$("#PGfreshButton").on("click",function(){touchcookie(),clear_pg_detail_panel(),pg_intialize(0)}),$("#PGExportButton").on("click",function(){touchcookie();var e=[],t={ConditonName:"UserId",Equal:usr.id,GEQ:"",LEQ:""};e.push(t),Data_export_Normal("项目组表导出","PGtable",e,[])}),$("#PGNewButton").on("click",function(){touchcookie(),show_new_pg_module()}),$("#PGDelButton").on("click",function(){touchcookie(),null===pg_selected?show_alarm_module(!0,"请选择一个项目组",null):(modal_middle($("#PGDelAlarm")),$("#PGDelAlarm").modal("show"))}),$("#PGModifyButton").on("click",function(){touchcookie(),null===pg_selected?show_alarm_module(!0,"请选择一个项目组",null):show_mod_pg_module(pg_selected,pg_selected_proj)}),$("#delPGCommit").on("click",function(){del_pg(pg_selected.PGCode),touchcookie()}),$("#newPGCommit").on("click",function(){pg_module_status?(submit_new_pg_module(),touchcookie()):(submit_mod_pg_module(),touchcookie())}),$("#ProjfreshButton").on("click",function(){touchcookie(),clear_proj_detail_panel(),proj_intialize(0)}),$("#ProjExportButton").on("click",function(){touchcookie();var e=[],t={ConditonName:"UserId",Equal:usr.id,GEQ:"",LEQ:""};e.push(t),Data_export_Normal("项目表导出","Projtable",e,[])}),$("#ProjNewButton").on("click",function(){touchcookie(),show_new_proj_module()}),$("#ProjDelButton").on("click",function(){touchcookie(),null===project_selected?show_alarm_module(!0,"请选择一个项目",null):(modal_middle($("#ProjDelAlarm")),$("#ProjDelAlarm").modal("show"))}),$("#ProjModifyButton").on("click",function(){touchcookie(),null===project_selected?show_alarm_module(!0,"请选择一个项目",null):show_mod_proj_module(project_selected)}),$("#delProjCommit").on("click",function(){del_proj(project_selected.ProjCode),touchcookie()}),$("#newProjCommit").on("click",function(){project_module_status?(submit_new_proj_module(),touchcookie()):(submit_mod_proj_module(),touchcookie())}),$("#PointfreshButton").on("click",function(){touchcookie(),clear_point_detail_panel(),point_intialize(0)}),$("#PointExportButton").on("click",function(){touchcookie();var e=[],t={ConditonName:"UserId",Equal:usr.id,GEQ:"",LEQ:""};e.push(t),Data_export_Normal("站点导出","Pointtable",e,[])}),$("#PointNewButton").on("click",function(){touchcookie(),show_new_point_module()}),$("#PointDelButton").on("click",function(){touchcookie(),null===point_selected?show_alarm_module(!0,"请选择一个站点",null):(modal_middle($("#PointDelAlarm")),$("#PointDelAlarm").modal("show"))}),$("#PointModifyButton").on("click",function(){touchcookie(),null===point_selected?show_alarm_module(!0,"请选择一个站点",null):show_mod_point_module(point_selected)}),$("#delPointCommit").on("click",function(){del_point(point_selected.StatCode),touchcookie()}),$("#newPointCommit").on("click",function(){point_module_status?(submit_new_point_module(),touchcookie()):(submit_mod_point_module(),touchcookie())}),$("#DevfreshButton").on("click",function(){touchcookie(),clear_dev_detail_panel(),dev_intialize(0)}),$("#DevExportButton").on("click",function(){touchcookie();var e=[],t={ConditonName:"UserId",Equal:usr.id,GEQ:"",LEQ:""};e.push(t),Data_export_Normal("设备表导出","Devtable",e,[])}),$("#DevNewButton").on("click",function(){touchcookie(),show_new_dev_module()}),$("#DevDelButton").on("click",function(){touchcookie(),null===device_selected?show_alarm_module(!0,"请选择一个设备",null):(modal_middle($("#DevDelAlarm")),$("#DevDelAlarm").modal("show"))}),$("#DevModifyButton").on("click",function(){touchcookie(),null===device_selected?show_alarm_module(!0,"请选择一个设备",null):show_mod_dev_module(device_selected)}),$("#delDevCommit").on("click",function(){del_dev(device_selected.DevCode),touchcookie()}),$("#newDevCommit").on("click",function(){device_module_status?(submit_new_dev_module(),touchcookie()):(submit_mod_dev_module(),touchcookie())}),$("#DevProjCode_choice").change(function(){get_proj_point_option($("#DevProjCode_choice").val(),$("#DevStatCode_choice"),"")}),$("#QueryProjCode_choice").change(function(){get_proj_point_option($("#QueryProjCode_choice").val(),$("#QueryStatCode_choice"),"")}),$("#AlarmQueryCommit").on("click",function(){if(touchcookie(),null===alarm_selected)return void $("#WCStatCode_Input").attr("placeholder","请先在地图上选择一个点");if(""===$("#Alarm_query_Input").val()||null===$("#Alarm_query_Input").val())return void $("#Alarm_query_Input").attr("placeholder","请输入日期");if(null!==alarm_type_list){unhide_all_chart();for(var e=0;e<alarm_type_list.length;e++)query_alarm($("#Alarm_query_Input").val(),alarm_type_list[e].id,alarm_type_list[e].name)}}),$("#Alarm_query_choice").change(function(){var e=$(this).val();"0"===e?($("#Alarm_query_Input2").val(""),$("#Alarm_date_button").css("display","none"),$("#Alarm_chart_view2").css("display","none"),$("#Alarm_chart_realtime_view2").css("display","block")):($("#Alarm_date_button").css("display","block"),$("#Alarm_chart_view2").css("display","block"),$("#Alarm_chart_realtime_view2").css("display","none"))}),$("#AlarmQueryCommit2").on("click",function(){if(touchcookie(),null===alarm_selected)return void $("#WCStatCode_Input2").attr("placeholder","请先在地图上选择一个点");var e=$("#Alarm_query_choice").val();if("1"===e&&(""===$("#Alarm_query_Input2").val()||null===$("#Alarm_query_Input2").val()))return void $("#Alarm_query_Input2").attr("placeholder","请输入日期");var t;if(null!==alarm_type_list&"1"===e)for(unhide_all_chart(),alarm_interval_tab=null,null!==alarm_interval&&(clearInterval(alarm_interval),alarm_interval=null),t=0;t<alarm_type_list.length;t++)query_alarm2($("#Alarm_query_Input2").val(),alarm_type_list[t].id,alarm_type_list[t].name);else{for(unhide_all_chart(),alarm_interval_tab=null,null!==alarm_interval&&clearInterval(alarm_interval),t=0;t<alarm_type_list.length;t++)query_alarm3(alarm_type_list[t].id,alarm_type_list[t].name);alarm_interval=setInterval(function(){for(t=0;t<alarm_type_list.length;t++)query_alarm3(alarm_type_list[t].id,alarm_type_list[t].name)},cycle_time)}}),$("#Video_query_Input").change(function(){$("#Video_query_Input").val(date_compare_today($("#Video_query_Input").val())),video_selection_change()}),$("#VideoHour_choice").change(function(){video_selection_change()}),$("#VideoModuleHour_choice").change(function(){video_Module_selection_change()}),$("#VideoModule_query_Input").change(function(){video_Module_selection_change()}),$("#Alarm_query_Input").change(function(){$("#Alarm_query_Input").val(date_compare_today($("#Alarm_query_Input").val()))}),$("#Alarm_query_Input2").change(function(){$("#Alarm_query_Input2").val(date_compare_today($("#Alarm_query_Input2").val()))}),$("#AlarmExport").on("click",function(){touchcookie(),Data_export_alarm()}),$("#AlarmExport2").on("click",function(){touchcookie(),Data_export_alarm2()}),$("#AlarmQuery_Commit").on("click",function(){touchcookie(),submit_alarm_query()}),$("#SensorUpdateCommit").on("click",function(){touchcookie(),submit_sensor_module()}),$("#ExpiredConfirm").on("click",function(){logout()}),$("#QueryStartTime_Input").change(function(){$("#QueryStartTime_Input").val(date_compare_today($("#QueryStartTime_Input").val())),""===$("#QueryEndTime_Input").val()?$("#QueryEndTime_Input").val($("#QueryStartTime_Input").val()):$("#QueryEndTime_Input").val(date_compare($("#QueryEndTime_Input").val(),$("#QueryStartTime_Input").val()))}),$("#QueryEndTime_Input").change(function(){""===$("#QueryStartTime_Input").val()?($("#QueryEndTime_Input").val(date_compare_today($("#QueryEndTime_Input").val())),$("#QueryStartTime_Input").val($("#QueryStartTime_Input").val())):$("#QueryEndTime_Input").val(date_compare($("#QueryEndTime_Input").val(),$("#QueryStartTime_Input").val()))}),$("#VCRshow").on("click",function(){var e=$("#VCRStatus_choice").val();""!==e&&video_windows(e)}),$("#VideoWindow").on("click",function(){null!==monitor_selected&&get_camera_and_video_web(monitor_selected.StatCode,!1,!0)}),$("#CameraWindow").on("click",function(){null!==monitor_selected&&get_camera_and_video_web(monitor_selected.StatCode,!0,!1)}),$("#ModuleVCRshow").on("click",function(){var e=$("#ModuleVCRStatus_choice").val();""!==e&&window.open(httphead+"//"+e,"监控照片","height=480, width=640, top=0, left=400,toolbar=no, menubar=no, scrollbars=no, resizable=no, location=no, status=no")}),$("#ModuleVCRreset").on("click",function(){reset_camera($("#VideoModuleStatCode_Input").val())}),$("#MonitorTableFlash").on("click",function(){query_static_warning()}),$("#WarningHandleTableFlash").on("click",function(){query_warning_handle_list()}),$("#AuditStabilityFlash").on("click",function(){query_audit_stability()}),$("#menu_user_profile").on("click",function(){touchcookie(),show_usr_msg_module()}),$("#ScreenSaver").on("click",function(){null!==monitor_selected&&screen_windows()}),$("#UsrMsgCommit").on("click",function(){touchcookie(),user_message_update()}),$("#UsrImgClean").on("click",function(){touchcookie(),clear_user_image()}),$("#UsrImgFlash").on("click",function(){touchcookie(),get_user_image()}),$("#UpdateConfirm_button").on("click",function(){touchcookie(),update_version()}),$("#btn_camera_up").on("click",function(){var e=$("#VideoModuleStatCode_Input").val();void 0!==e&&""!==e&&move_camera(e,"v","1")}),$("#btn_camera_down").on("click",function(){var e=$("#VideoModuleStatCode_Input").val();void 0!==e&&""!==e&&move_camera(e,"v","-1")}),$("#btn_camera_right").on("click",function(){var e=$("#VideoModuleStatCode_Input").val();void 0!==e&&""!==e&&move_camera(e,"h","1")}),$("#btn_camera_left").on("click",function(){var e=$("#VideoModuleStatCode_Input").val();void 0!==e&&""!==e&&move_camera(e,"h","-1")}),$(".lock_monitor_btn").on("click",function(){monitor_lock()}),$("#UnlockConfirmBtn").on("click",function(){var e=$(this).attr("StateCode");void 0!==e&&""!==e&&openlock(e)}),$(".keyrow").on("click",function(){var e=$(this).attr("id");void 0!==e&&""!==e&&get_key_auth_list(e)}),$("#KeyfreshButton").on("click",function(){touchcookie(),clear_key_detail_panel(),key_intialize(0)}),$("#KeyExportButton").on("click",function(){touchcookie();var e=[],t={ConditonName:"UserId",Equal:usr.id,GEQ:"",LEQ:""};e.push(t),Data_export_Normal("钥匙表导出","keytable",e,[])}),$("#KeyNewButton").on("click",function(){touchcookie(),show_new_key_module()}),$("#KeyDelButton").on("click",function(){touchcookie(),null===key_selected?show_alarm_module(!0,"请选择一把钥匙",null):(modal_middle($("#KeyDelAlarm")),$("#KeyDelAlarm").modal("show"))}),$("#KeyModifyButton").on("click",function(){touchcookie(),null===key_selected?show_alarm_module(!0,"请选择一把钥匙",null):show_mod_key_module(key_selected)}),$("#delKeyCommit").on("click",function(){del_key(key_selected.KeyCode),touchcookie()}),$("#newKeyCommit").on("click",function(){key_module_status?(submit_new_key_module(),touchcookie()):(submit_mod_key_module(),touchcookie())}),$("#KeyHistoryTableFlash").on("click",function(){query_open_lock_history(),touchcookie()}),$("#KeyAuthQuery").on("click",function(){get_domain_auth_list($("#KeyAuthPoint_choice").val()),touchcookie()}),$("#KeyAuthNew").on("click",function(){show_auth_new_module($("#KeyAuthProj_choice").val(),$("#KeyAuthPoint_choice").val(),$("#KeyAuthPoint_choice").find("option:selected").text()),touchcookie()}),$("#KeyUserChange").on("click",function(){show_key_grant_module($("#KeyUserKey_choice").val(),$("#KeyUserUser_choice").val(),$("#KeyUserKey_choice").find("option:selected").text(),$("#KeyUserUser_choice").find("option:selected").text()),touchcookie()}),$("#delKeyAuthCommit").on("click",function(){$("#KeyAuthDelAlarm").modal("hide"),key_auth_delete($(this).attr("AuthId")),touchcookie()}),$("#newKeyAuthCommit").on("click",function(){click_new_key_auch_commit(),touchcookie()}),$("#NewKeyAuthEndTime_Input").change(function(){$("#NewKeyAuthEndTime_Input").val(check_key_auth_date($(this).val()))}),$("#KeyGrantCommit").on("click",function(){$("#KeyGrantAlarm").modal("hide"),click_key_grant_commit($(this).attr("KeyId"),$(this).attr("UserId"))}),$("#AlarmHandleUpdateCommit").on("click",function(){AlarmHandleUpdateCommit_button_commit()}),$("#CommonQueryCommit").on("click",function(){if(global_key_word!=$("#CommonQueryInput").val())switch(global_key_word=$("#CommonQueryInput").val(),CURRENT_URL){case"UserManage":user_intialize(0);break;case"KeyManage":key_intialize(0);break;case"PGManage":pg_intialize(0);break;case"ProjManage":proj_intialize(0);break;case"MPManage":point_intialize(0);break;case"DevManage":dev_intialize(0)}}),$("#RTSPHistoryshow").on("click",function(){var e=new Date($("#RTSPHistoryAlarmTime_Input").val());e=date_addminutes(e,parseInt($("#rtsp_zoom").val()));var t=e.Format("yyyyMMddThhmmss");e=date_addminutes(e,1);var a=e.Format("yyyyMMddThhmmss"),o=$(this).attr("data-url")+"?starttime="+t+"Z&endtime="+a+"Z";console.log(o),window.location.href=o}),clear_window(),desktop(),calculate_row(),clear_user_detail_panel(),clear_proj_detail_panel(),$(window).resize()});