function logout(){delCookie("Environmental.inspection.session"),window.location="http://"+window.location.host+basic_address+"Login.html"}function video_windows(e){window.open("http://"+window.location.host+basic_address+"/video/video.html?id="+e,"监控录像","height=284, width=340, top=0, left=400,toolbar=no, menubar=no, scrollbars=no, resizable=no, location=no, status=no")}function screen_windows(){window.open("http://"+window.location.host+screen_saver_address+"?id="+usr.id+"&StatCode="+monitor_selected.StatCode,"屏幕保护","height=auto, width=auto")}function write_title(e,t){$("#page_title").empty(),$("#page_title").append("<h3>"+e+" <small>"+t+"</small></h3>")}function active_menu(e){$SIDEBAR_MENU.find("li.active").addClass("active-sm").removeClass("active"),$SIDEBAR_MENU.find("li").each(function(){$(this).removeClass("current-page")}),$SIDEBAR_MENU.find('a[id="'+e+'"]').parent("li").addClass("current-page")}function nav_check(){"true"==usr.admin?$("#Admin_menu").css("display","block"):$("#Admin_menu").css("display","none"),$("#Hello_label").text("您好："+usr.name);$(NaN);$("#Hello_label").append("<span class=' fa fa-angle-down'></span>")}function show_alarm_module(e,t){e?($("#UserAlertModalLabel").text="警告",$("#UserAlertModalContent").empty(),$("#UserAlertModalContent").append("<strong>警告！</strong>"+t)):($("#UserAlertModalLabel").text="通知",$("#UserAlertModalContent").empty(),$("#UserAlertModalContent").append("<strong>通知：</strong>"+t)),modal_middle($("#UserAlarm")),$("#UserAlarm").modal("show")}function modal_middle(e){$BODY.hasClass("nav-md")||$MENU_TOGGLE.click(),setTimeout(function(){var t=$(e).find(".modal-dialog");t.animate({"margin-top":parseInt(($(window).height()-t.height())/2)},300)},wait_time_short)}function on_collapse(e){touchcookie()}function PageInitialize(){get_user_information(),get_sensor_list(),get_camera_unit(),window.setTimeout(get_monitor_list,wait_time_middle),window.setTimeout(nav_check,wait_time_short)}function get_user_information(){var e=getQueryString("session"),t={action:"UserInfo",session:e};jQuery.get(request_head,t,function(e){log(e);var t=JSON.parse(e),a=t.status;"false"==a?show_alarm_module(!0,"获取用户失败，请联系管理员"):(usr=t.ret,get_user_message(),get_user_image())})}function show_expiredModule(){modal_middle($("#ExpiredAlarm")),$("#ExpiredAlarm").modal("show")}function calculate_row(){var e=($(window).height(),parseInt(($(window).height()-650)/100));e<=0?table_row=5:e>=5?table_row=10:table_row+=e}function show_table_tags(){$("#Warning_"+alarm_type_list[0].id+"_day").css("display","block")}function user_manager(){clear_window(),write_title("用户管理","根据您的权限对用户进行添加/删除/修改等操作"),$("#UserManageView").css("display","block"),user_initial||user_intialize(0)}function pg_manage(){clear_window(),write_title("项目组管理","根据您的权限对项目组进行添加/删除/修改等操作"),$("#PGManageView").css("display","block"),pg_initial||pg_intialize(0)}function proj_manage(){clear_window(),write_title("项目组管理","根据您的权限对项目进行添加/删除/修改等操作"),$("#ProjManageView").css("display","block"),proj_intialize(0)}function para_manage(){clear_window(),write_title("参数管理","您可以在这里升级您的设备版本"),$("#ParaManageView").css("display","block"),parameter_initial||parameter_initialize()}function mp_manage(){clear_window(),write_title("测量点管理","根据您的权限对测量点进行配置"),$("#MPManageView").css("display","block"),point_initial||point_intialize(0)}function dev_manage(){clear_window(),write_title("设备管理","根据您的权限对设备进行配置"),$("#DevManageView").css("display","block"),device_initial||dev_intialize(0)}function mp_monitor(){clear_window(),write_title("地图监控","在地图上对测量点进行监控"),$("#MPMonitorView").css("display","block"),map_initialized||initializeMap()}function mp_monitor_table(){clear_window(),write_title("监测点聚合","实时刷新"),$("#MPMonitorTableView").css("display","block"),Monitor_table_initialized||initialize_warning_table()}function mp_monitor_card(){clear_window(),write_title("监测点列块","点选设备卡片以获得详细信息"),$("#MPMonitorCardView").css("display","block")}function mp_static_monitor_table(){clear_window(),write_title("监测点聚合","请手工刷新"),$("#MPMonitorStaticTableView").css("display","block"),query_static_warning()}function warning_check(){clear_window(),write_title("告警查看","可以导出报表"),$("#WarningCheckView").css("display","block"),alarm_map_initialized||initializeAlarmMap()}function warning_handle(){clear_window(),write_title("施工中",""),$("#Undefined").css("display","block")}function desktop(){clear_window(),write_title("欢迎","请选择您需要的功能"),$("#Desktop").css("display","block")}function Inst_Conf(){clear_window(),write_title("施工中",""),$("#Undefined").css("display","block")}function Inst_Read(){clear_window(),write_title("施工中",""),$("#Undefined").css("display","block")}function Inst_Design(){clear_window(),write_title("施工中",""),$("#Undefined").css("display","block")}function Inst_Control(){clear_window(),write_title("施工中",""),$("#Undefined").css("display","block")}function Inst_Snapshot(){clear_window(),write_title("施工中",""),$("#Undefined").css("display","block")}function Inst_Video(){clear_window(),write_title("施工中",""),$("#Undefined").css("display","block")}function Audit_Target(){clear_window(),write_title("施工中",""),$("#Undefined").css("display","block")}function Audit_Stability(){clear_window(),write_title("施工中",""),$("#Undefined").css("display","block")}function Audit_Availability(){clear_window(),write_title("施工中",""),$("#Undefined").css("display","block")}function Audit_Error(){clear_window(),write_title("施工中",""),$("#Undefined").css("display","block")}function Audit_Quality(){clear_window(),write_title("施工中",""),$("#Undefined").css("display","block")}function Geo_InfoQuery(){clear_window(),CURRENT_URL="Undefined",write_title("施工中",""),$("#Undefined").css("display","block")}function Geo_TrendAnalysis(){clear_window(),CURRENT_URL="Undefined",write_title("施工中",""),$("#Undefined").css("display","block")}function Geo_DisaterForecast(){clear_window(),CURRENT_URL="Undefined",write_title("施工中",""),$("#Undefined").css("display","block")}function Geo_EmergencyDirect(){clear_window(),write_title("施工中",""),$("#Undefined").css("display","block")}function Geo_DiffusionAnalysis(){clear_window(),write_title("施工中",""),$("#Undefined").css("display","block")}function Work_flowDesign(){clear_window(),write_title("施工中",""),$("#Undefined").css("display","block")}function Order_Management(){clear_window(),write_title("施工中",""),$("#Undefined").css("display","block")}function Unloading_Management(){clear_window(),write_title("施工中",""),$("#Undefined").css("display","block")}function Order_Audit(){clear_window(),write_title("施工中",""),$("#Undefined").css("display","block")}function AD_Conf(){clear_window(),write_title("施工中",""),$("#Undefined").css("display","block")}function WEB_Conf(){clear_window(),write_title("施工中",""),$("#Undefined").css("display","block")}function clear_window(){$("#UserManageView").css("display","none"),$("#PGManageView").css("display","none"),$("#ProjManageView").css("display","none"),$("#ParaManageView").css("display","none"),$("#MPManageView").css("display","none"),$("#DevManageView").css("display","none"),$("#MPMonitorView").css("display","none"),$("#MPMonitorTableView").css("display","none"),$("#MPMonitorCardView").css("display","none"),$("#MPMonitorStaticTableView").css("display","none"),$("#WarningCheckView").css("display","none"),$("#WarningHandleView").css("display","none"),$("#Desktop").css("display","none"),$("#Undefined").css("display","none")}function get_project_pg_list(){var e={action:"ProjectPGList",user:usr.id};jQuery.get(request_head,e,function(e){log(e);var t=JSON.parse(e);return"false"==t.status?void show_expiredModule():void(project_pg_list=t.ret)})}function get_user_table(e,t){var a={action:"UserTable",startseq:e,length:t};jQuery.get(request_head,a,function(e){log(e);var t=JSON.parse(e);return"false"==t.status?void show_expiredModule():(user_table=t.ret,user_start=parseInt(t.start),void(user_total=parseInt(t.total)))})}function del_user(e){var t={action:"UserDel",id:e};jQuery.get(request_head,t,function(e){log(e);var t=JSON.parse(e),a=t.status;"true"==a?(show_alarm_module(!1,"删除成功！"),clear_user_detail_panel(),user_intialize(0)):show_alarm_module(!0,"删除失败！"+t.msg)}),$("#UserDelAlarm").modal("hide")}function new_user(e,t){var a={action:"UserNew",name:e.name,nickname:e.nickname,password:e.password,mobile:e.mobile,mail:e.mail,type:e.type,memo:e.memo,auth:t};jQuery.get(request_head,a,function(e){log(e);var t=JSON.parse(e),a=t.status;"true"==a?(show_alarm_module(!1,"创建成功！"),$("#newUserModal").modal("hide"),clear_user_detail_panel(),user_intialize(0)):show_alarm_module(!0,"创建失败！"+t.msg)})}function modify_user(e,t){var a={action:"UserMod",id:e.id,name:e.name,nickname:e.nickname,password:e.password,mobile:e.mobile,mail:e.mail,type:e.type,memo:e.memo,auth:t};jQuery.get(request_head,a,function(e){log(e);var t=JSON.parse(e),a=t.status;"true"==a?(show_alarm_module(!1,"修改成功！"),$("#newUserModal").modal("hide"),clear_user_detail_panel(),user_intialize(0)):show_alarm_module(!0,"修改失败！"+t.msg)})}function get_user_proj(e){var t={action:"UserProj",userid:e};jQuery.get(request_head,t,function(e){log(e);var t=JSON.parse(e);return"false"==t.status?void show_expiredModule():void(user_selected_auth=t.ret)})}function user_intialize(e){user_initial=!0,user_table=null,get_user_table(e,5*table_row),get_project_pg_list(),window.setTimeout(draw_user_table_head,wait_time_middle)}function draw_user_table_head(){if(null!==user_table){var e=Math.ceil(user_table.length/table_row);$("#User_Page_control").empty();var t,a="<li><a href='#' id='user_page_prev'>Prev</a></li>",o=Math.ceil(user_start/table_row);for(t=0;t<e;t++)a=a+"<li><a href='#' id='user_page_"+t+"'>"+(t+o+1)+"</a></li>";for(a+="<li><a href='#' id='user_page_next'>Next</a></li>",$("#User_Page_control").append(a),table_head="<thead><tr><th>序号</th><th>用户名</th><th>昵称</th><th>电话</th><th>属性</th><th>更新日期</th>",table_head+="</tr></thread>",click_draw_user_table=function(){draw_user_table($(this))},t=0;t<e;t++)$("#user_page_"+t).on("click",click_draw_user_table);user_start<=0?$("#user_page_prev").css("display","none"):($("#user_page_prev").css("display","block"),$("#user_page_prev").on("click",function(){var e=user_start-5*table_row;e<0&&(e=0),user_intialize(e)})),user_start+5*table_row>=user_total?$("#user_page_next").css("display","none"):($("#user_page_next").css("display","block"),$("#user_page_next").on("click",function(){user_intialize(user_start+5*table_row)})),draw_user_table($("#user_page_0"))}}function draw_user_table(e){if($("#Table_user").empty(),null!==user_table){var t=(parseInt(e.html())-1)*table_row-user_start,a=table_head;a+="<tbody>";var o;for(o=0;o<table_row;o++)t+o<user_table.length?(a=0!==o%2?a+"<tr class='success li_menu' id='table_cell"+o+"' userid='"+user_table[t+o].id+"'>":a+"<tr class='li_menu' id='table_cell"+o+"' userid='"+user_table[t+o].id+"'>",a=a+"<td>"+user_table[t+o].id+"</td><td>"+user_table[t+o].name+"</td><td>"+user_table[t+o].nickname+"</td><td>"+user_table[t+o].mobile+"</td>",a+="true"==user_table[t+o].type?"<td>管理员</td>":"<td>用户</td>",a=a+"<td>"+user_table[t+o].date+"</td>",a+="</tr>"):(a=0!==o%2?a+"<tr class='success' id='table_cell"+o+"' userid='null'>":a+"<tr  id='table_cell"+o+"' userid='null'>",a+="<td>--</td><td>--</td><td>--</td><td>--</td><td>--</td><td>--</td>",a+="</tr>");for(a+="</tbody>",$("#Table_user").append(a),table_cell_click=function(){if("null"!=$(this).attr("userid")){for(var e=0;e<user_table.length;e++)if($(this).attr("userid")==user_table[e].id){user_selected=user_table[e];break}Initialize_user_detail(),touchcookie()}},o=0;o<table_row;o++)$("#table_cell"+o).on("click",table_cell_click)}}function Initialize_user_detail(){get_user_proj(user_selected.id),window.setTimeout(draw_user_detail_panel,wait_time_short)}function clear_user_detail_panel(){user_selected=null;var e="<p></p><p></p><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt >用户名：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt >用户类型：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt >联系方式：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd></dl></div><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt>用户昵称：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt>修改日期：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt>邮箱：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd></dl></div><div class='col-md-12 col-sm-12 col-xs-12 column'><dl ><dt>备注：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd></dl></div>";$("#Label_user_detail").empty(),$("#Label_user_detail").append(e),$("#Table_user_authed").empty()}function draw_user_detail_panel(){if($("#Label_user_detail").empty(),null!==user_selected_auth){var e="用户";!0===user_selected.type&&(e="管理员");var t="<p></p><p></p><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt >用户名：</dt><dd>"+user_selected.name+"</dd><dt >用户类型：</dt><dd>"+e+"</dd><dt >联系方式：</dt><dd>"+user_selected.mobile+"</dd></dl></div><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt>用户昵称：</dt><dd>"+user_selected.nickname+"</dd><dt>修改日期：</dt><dd>"+user_selected.date+"</dd><dt>邮箱：</dt><dd>"+user_selected.mail+"</dd></dl></div><div class='col-md-12 col-sm-12 col-xs-12 column'><dl ><dt>备注：</dt><dd>"+user_selected.memo+"</dd></dl></div>";$("#Label_user_detail").append(t),$("#Table_user_authed").empty(),t="<thead> <tr> <th>已关联项目 </th> </tr> </thead> <tbody >";for(var a=0;a<user_selected_auth.length;a++)t=t+"<tr> <td>"+user_selected_auth[a].name+"</td> </tr>";t+="</tbody>",$("#Table_user_authed").append(t)}}function show_new_user_module(){$("#newModalLabel").text("创建新用户"),user_module_status=!0,$("#NewUsername_Input").val(""),$("#NewUserNick_Input").val(""),$("#NewPassword_Input").val(""),$("#NewRePassword_Input").val(""),$("#NewUserMobile_Input").val(""),$("#NewUserMail_Input").val(""),$("#NewUserMemo_Input").val(""),$("#NewUserType_choice").val("false"),$("#NewUsername_Input").attr("placeholder","用户名"),$("#NewPassword_Input").attr("placeholder","密码"),$("#NewRePassword_Input").attr("placeholder","重复密码"),$("#NewUserMobile_Input").attr("placeholder","电话号码"),$("#NewUserMail_Input").attr("placeholder","邮箱"),$("#duallistboxUserAuth_new").empty();for(var e="",t=0;t<project_pg_list.length;t++)e="<option value='"+project_pg_list[t].id+"'>"+project_pg_list[t].name+"</option>",$("#duallistboxUserAuth_new").append(e);$(".NewUserAuthDual").bootstrapDualListbox("refresh",!0),modal_middle($("#newUserModal")),$("#newUserModal").modal("show")}function submit_new_user_module(){var e=$("#NewUsername_Input").val(),t=$("#NewUserNick_Input").val(),a=$("#NewPassword_Input").val(),o=$("#NewRePassword_Input").val(),n=$("#NewUserMobile_Input").val(),l=$("#NewUserMail_Input").val(),i=$("#NewUserMemo_Input").val();if(null===e||""===e)return $("#NewUsername_Input").attr("placeholder","用户名不能为空"),void $("#NewUsername_Input").focus();if(null===a||""===a)return $("#NewPassword_Input").attr("placeholder","密码不能为空"),$("#NewRePassword_Input").attr("placeholder","密码不能为空"),void $("#NewPassword_Input").focus();if(a!=o)return $("#NewPassword_Input").val(""),$("#NewRePassword_Input").val(""),$("#NewPassword_Input").attr("placeholder","密码不正确，请重新输入"),$("#NewRePassword_Input").attr("placeholder","密码不正确，请重新输入"),void $("#NewPassword_Input").focus();if(null===n||""===n)return $("#NewUserMobile_Input").attr("placeholder","电话号码不能为空"),void $("#NewUserMobile_Input").focus();if(null===l||""===l)return $("#NewUserMail_Input").attr("placeholder","邮箱不能为空"),void $("#NewUserMail_Input").focus();var r={name:e,nickname:t,password:o,mobile:n,mail:l,type:$("#NewUserType_choice").val(),memo:i},d=[];$("#duallistboxUserAuth_new :selected").each(function(e,t){var a={id:$(t).val(),name:$(t).text()};d.push(a)}),console.log(d),new_user(r,d)}function show_mod_user_module(e,t){$("#newModalLabel").text("用户信息修改：密码栏不输入表示不修改密码"),user_module_status=!1,$("#NewUsername_Input").val(e.name),$("#NewUserNick_Input").val(e.nickname),$("#NewPassword_Input").val(""),$("#NewRePassword_Input").val(""),$("#NewUserMobile_Input").val(e.mobile),$("#NewUserMail_Input").val(e.mail),$("#NewUserMemo_Input").val(e.memo),$("#NewUsername_Input").attr("placeholder","用户名"),$("#NewPassword_Input").attr("placeholder","密码"),$("#NewRePassword_Input").attr("placeholder","重复密码"),$("#NewUserMobile_Input").attr("placeholder","电话号码"),$("#NewUserMail_Input").attr("placeholder","邮箱"),e.type===!1?$("#NewUserType_choice").val("false"):$("#NewUserType_choice").val("true"),$("#duallistboxUserAuth_new").empty();for(var a="",o=0;o<project_pg_list.length;o++){a="<option value='"+project_pg_list[o].id+"'";for(var n=0;n<t.length;n++)if(t[n].id==project_pg_list[o].id){a+="selected='selected'";break}a=a+">"+project_pg_list[o].name+"</option>",$("#duallistboxUserAuth_new").append(a)}$(".NewUserAuthDual").bootstrapDualListbox("refresh",!0),modal_middle($("#newUserModal")),$("#newUserModal").modal("show")}function submit_mod_user_module(){var e=$("#NewUsername_Input").val(),t=$("#NewUserNick_Input").val(),a=$("#NewPassword_Input").val(),o=$("#NewRePassword_Input").val(),n=$("#NewUserMobile_Input").val(),l=$("#NewUserMail_Input").val(),i=$("#NewUserMemo_Input").val();if(""!==a&&""!==o&&a!=o)return $("#NewPassword_Input").val(""),$("#NewRePassword_Input").val(""),$("#NewPassword_Input").attr("placeholder","密码不正确，请重新输入"),$("#NewRePassword_Input").attr("placeholder","密码不正确，请重新输入"),void $("#NewPassword_Input").focus();var r={id:user_selected.id,name:e,nickname:t,password:o,mobile:n,mail:l,type:$("#NewUserType_choice").val(),memo:i},d=[];$("#duallistboxUserAuth_new :selected").each(function(e,t){var a={id:$(t).val(),name:$(t).text()};d.push(a)}),modify_user(r,d)}function get_project_list(){var e={action:"ProjectList",user:usr.id};jQuery.get(request_head,e,function(e){log(e);var t=JSON.parse(e);return"false"==t.status?void show_expiredModule():void(project_list=t.ret)})}function get_pg_table(e,t){var a={action:"PGTable",startseq:e,length:t,user:usr.id};jQuery.get(request_head,a,function(e){log(e);var t=JSON.parse(e);return"false"==t.status?void show_expiredModule():(pg_table=t.ret,pg_start=parseInt(t.start),void(pg_total=parseInt(t.total)))})}function del_pg(e){var t={action:"PGDel",id:e,user:usr.id};jQuery.get(request_head,t,function(e){log(e);var t=JSON.parse(e),a=t.status;"true"==a?(show_alarm_module(!1,"删除成功！"),clear_pg_detail_panel(),pg_intialize(0)):show_alarm_module(!0,"删除失败！"+t.msg)}),$("#PGDelAlarm").modal("hide")}function new_pg(e,t){var a={action:"PGNew",PGCode:e.PGCode,PGName:e.PGName,ChargeMan:e.ChargeMan,Telephone:e.Telephone,Department:e.Department,Address:e.Address,Stage:e.Stage,Projlist:t,user:usr.id};jQuery.get(request_head,a,function(e){log(e);var t=JSON.parse(e),a=t.status;"true"==a?(show_alarm_module(!1,"创建成功！"),$("#newPGModal").modal("hide"),clear_pg_detail_panel(),pg_intialize(0)):show_alarm_module(!0,"创建失败！"+t.msg)})}function modify_pg(e,t){var a={action:"PGMod",PGCode:e.PGCode,PGName:e.PGName,ChargeMan:e.ChargeMan,Telephone:e.Telephone,Department:e.Department,Address:e.Address,Stage:e.Stage,Projlist:t,user:usr.id};jQuery.get(request_head,a,function(e){log(e);var t=JSON.parse(e),a=t.status;"true"==a?(show_alarm_module(!1,"修改成功！"),$("#newPGModal").modal("hide"),clear_pg_detail_panel(),pg_intialize(0)):show_alarm_module(!0,"修改失败！"+t.msg)})}function get_pg_proj(e){var t={action:"PGProj",id:e};jQuery.get(request_head,t,function(e){log(e);var t=JSON.parse(e);return"false"==t.status?void show_expiredModule():void(pg_selected_proj=t.ret)})}function pg_intialize(e){pg_initial=!0,pg_table=null,get_pg_table(e,5*table_row),clear_pg_detail_panel(),get_project_list(),window.setTimeout(draw_pg_table_head,wait_time_middle)}function draw_pg_table_head(){if(null!==pg_table){var e=Math.ceil(pg_table.length/table_row);$("#PG_Page_control").empty();var t,a="<li><a href='#' id='pg_page_prev'>Prev</a></li>",o=Math.ceil(pg_start/table_row);for(t=0;t<e;t++)a=a+"<li><a href='#' id='pg_page_"+t+"'>"+(t+o+1)+"</a></li>";for(a+="<li><a href='#' id='pg_page_next'>Next</a></li>",$("#PG_Page_control").append(a),table_head="<thead><tr><th>编号</th> <th>名称 </th> <th>责任人 </th> <th>电话 </th> <th>单位 </th>",table_head+="</tr></thread>",pg_page_click=function(){draw_pg_table($(this))},t=0;t<e;t++)$("#pg_page_"+t).on("click",pg_page_click);pg_start<=0?$("#pg_page_prev").css("display","none"):($("#pg_page_prev").css("display","block"),$("#pg_page_prev").on("click",function(){var e=pg_start-5*table_row;e<0&&(e=0),pg_intialize(e)})),pg_start+5*table_row>=pg_total?$("#pg_page_next").css("display","none"):($("#pg_page_next").css("display","block"),$("#pg_page_next").on("click",function(){pg_intialize(pg_start+5*table_row)})),draw_pg_table($("#pg_page_0"))}}function draw_pg_table(e){if($("#Table_pg").empty(),null!==pg_table){var t=(parseInt(e.html())-1)*table_row-pg_start,a=table_head;a+="<tbody>";var o;for(o=0;o<table_row;o++)t+o<pg_table.length?(a=0!==o%2?a+"<tr class='success  li_menu' id='pg_table_cell"+o+"' PGCode='"+pg_table[t+o].PGCode+"'>":a+"<tr class=' li_menu' id='pg_table_cell"+o+"' PGCode='"+pg_table[t+o].PGCode+"'>",a=a+"<td>"+pg_table[t+o].PGCode+"</td><td>"+pg_table[t+o].PGName+"</td><td>"+pg_table[t+o].ChargeMan+"</td><td>"+pg_table[t+o].Telephone+"</td>",a=a+"<td>"+pg_table[t+o].Department+"</td>",a+="</tr>"):(a=0!==o%2?a+"<tr class='success' id='pg_table_cell"+o+"' PGCode='null'>":a+"<tr  id='pg_table_cell"+o+"' PGCode='null'>",a+="<td>--</td><td>--</td><td>--</td><td>--</td><td>--</td><td>--</td>",a+="</tr>");for(a+="</tbody>",$("#Table_pg").append(a),pg_table_cell_click=function(){if("null"!=$(this).attr("PGCode")){for(var e=0;e<pg_table.length;e++)if($(this).attr("PGCode")==pg_table[e].PGCode){pg_selected=pg_table[e];break}Initialize_pg_detail(),touchcookie()}},o=0;o<table_row;o++)$("#pg_table_cell"+o).on("click",pg_table_cell_click);touchcookie()}}function Initialize_pg_detail(){get_pg_proj(pg_selected.PGCode),window.setTimeout(draw_pg_detail_panel,wait_time_short)}function clear_pg_detail_panel(){pg_selected=null;var e="<p></p><p></p><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt >项目组编号：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt >负责人：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd></dl></div><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt>项目组名称：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt>电话：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd></dl></div><div class='col-md-12 col-sm-12 col-xs-12 column'><dl ><dt>单位：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt>地址：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt>备注：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd></dl></div>";$("#Label_pg_detail").empty(),$("#Label_pg_detail").append(e),$("#Table_pg_proj").empty()}function draw_pg_detail_panel(){if($("#Label_pg_detail").empty(),null!==pg_selected_proj){var e="<p></p><p></p><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt >项目组编号：</dt><dd>"+pg_selected.PGCode+"</dd><dt >负责人：</dt><dd>"+pg_selected.ChargeMan+"</dd></dl></div><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt>项目组名称：</dt><dd>"+pg_selected.PGName+"</dd><dt>电话：</dt><dd>"+pg_selected.Telephone+"</dd></dl></div><div class='col-md-12 col-sm-12 col-xs-12 column'><dl ><dt>单位：</dt><dd>"+pg_selected.Department+"</dd><dt>地址：</dt><dd>"+pg_selected.Address+"</dd><dt>备注：</dt><dd>"+pg_selected.Stage+"</dd></dl></div>";$("#Label_pg_detail").append(e),$("#Table_pg_proj").empty(),e="<thead> <tr> <th>下辖项目清单 </th> </tr> </thead> <tbody >";for(var t=0;t<pg_selected_proj.length;t++)e=e+"<tr> <td>"+pg_selected_proj[t].name+"</td> </tr>";e+="</tbody>",$("#Table_pg_proj").append(e)}}function show_new_pg_module(){$("#newPGModalLabel").text("创建新项目组"),pg_module_status=!0,$("#PGPGCode_Input").val(""),$("#PGPGCode_Input").attr("disabled",!1),$("#PGPGName_Input").val(""),$("#PGChargeMan_Input").val(""),$("#PGTelephone_Input").val(""),$("#PGDepartment_Input").val(""),$("#PGAddress_Input").val(""),$("#PGStage_Input").val(""),$("#PGPGCode_Input").attr("placeholder","项目组编号"),$("#PGPGName_Input").attr("placeholder","项目组名称"),$("#PGChargeMan_Input").attr("placeholder","负责人姓名"),$("#PGTelephone_Input").attr("placeholder","联系电话"),$("#PGDepartment_Input").attr("placeholder","单位名称"),$("#PGAddress_Input").attr("placeholder","地址"),$("#duallistboxPGProj_new").empty();for(var e="",t=0;t<project_list.length;t++)e="<option value='"+project_list[t].id+"'>"+project_list[t].name+"</option>",$("#duallistboxPGProj_new").append(e);$(".NewPGProjDual").bootstrapDualListbox("refresh",!0),modal_middle($("#newPGModal")),$("#newPGModal").modal("show")}function submit_new_pg_module(){var e=$("#PGPGCode_Input").val(),t=$("#PGPGName_Input").val(),a=$("#PGChargeMan_Input").val(),o=$("#PGTelephone_Input").val(),n=$("#PGDepartment_Input").val(),l=$("#PGAddress_Input").val(),i=$("#PGStage_Input").val();if(null===e||""===e)return $("#PGPGCode_Input").attr("placeholder","项目组号不能为空"),void $("#PGPGCode_Input").focus();if(null===t||""===t)return $("#PGPGName_Input").attr("placeholder","项目组名称不能为空"),void $("#PGPGName_Input").focus();if(null===a||""===a)return $("#PGChargeMan_Input").attr("placeholder","负责人姓名不能为空"),void $("#PGChargeMan_Input").focus();if(null===o||""===o)return $("#PGTelephone_Input").attr("placeholder","联系电话不能为空"),void $("#PGTelephone_Input").focus();if(null===n||""===n)return $("#PGDepartment_Input").attr("placeholder","单位名称不能为空"),void $("#PGDepartment_Input").focus();if(null===l||""===l)return $("#PGAddress_Input").attr("placeholder","地址不能为空"),void $("#PGAddress_Input").focus();var r={PGCode:e,PGName:t,ChargeMan:a,Telephone:o,Department:n,Address:l,Stage:i},d=[];$("#duallistboxPGProj_new :selected").each(function(e,t){var a={id:$(t).val(),name:$(t).text()};d.push(a)}),new_pg(r,d)}function show_mod_pg_module(e,t){$("#newPGModalLabel").text("项目组修改"),pg_module_status=!1,$("#PGPGCode_Input").val(e.PGCode),$("#PGPGCode_Input").attr("disabled",!0),$("#PGPGName_Input").val(e.PGName),$("#PGChargeMan_Input").val(e.ChargeMan),$("#PGTelephone_Input").val(e.Telephone),$("#PGDepartment_Input").val(e.Department),$("#PGAddress_Input").val(e.Address),$("#PGStage_Input").val(e.Stage),$("#PGPGCode_Input").attr("placeholder","项目号"),$("#PGPGName_Input").attr("placeholder","项目名称"),$("#PGChargeMan_Input").attr("placeholder","负责人姓名"),$("#PGTelephone_Input").attr("placeholder","联系电话"),$("#PGDepartment_Input").attr("placeholder","单位名称"),$("#PGAddress_Input").attr("placeholder","地址"),$("#duallistboxPGProj_new").empty();for(var a="",o=0;o<project_list.length;o++){a="<option value='"+project_list[o].id+"'";for(var n=0;n<t.length;n++)if(t[n].id==project_list[o].id){a+="selected='selected'";break}a=a+">"+project_list[o].name+"</option>",$("#duallistboxPGProj_new").append(a)}$(".NewPGProjDual").bootstrapDualListbox("refresh",!0),modal_middle($("#newPGModal")),$("#newPGModal").modal("show")}function submit_mod_pg_module(){var e=$("#PGPGCode_Input").val(),t=$("#PGPGName_Input").val(),a=$("#PGChargeMan_Input").val(),o=$("#PGTelephone_Input").val(),n=$("#PGDepartment_Input").val(),l=$("#PGAddress_Input").val(),i=$("#PGStage_Input").val(),r={PGCode:e,PGName:t,ChargeMan:a,Telephone:o,Department:n,Address:l,Stage:i},d=[];$("#duallistboxPGProj_new :selected").each(function(e,t){var a={id:$(t).val(),name:$(t).text()};d.push(a)}),modify_pg(r,d)}function get_proj_table(e,t){var a={action:"ProjTable",startseq:e,length:t,user:usr.id};jQuery.get(request_head,a,function(e){log(e);var t=JSON.parse(e);return"false"==t.status?void show_expiredModule():(project_table=t.ret,project_start=parseInt(t.start),void(project_total=parseInt(t.total)))})}function del_proj(e){var t={action:"ProjDel",ProjCode:e,user:usr.id};jQuery.get(request_head,t,function(e){log(e);var t=JSON.parse(e),a=t.status;"true"==a?(show_alarm_module(!1,"删除成功！"),clear_proj_detail_panel(),proj_intialize(0)):show_alarm_module(!0,"删除失败！"+t.msg)}),$("#ProjDelAlarm").modal("hide")}function new_proj(e){var t={action:"ProjNew",ProjCode:e.ProjCode,ProjName:e.ProjName,ChargeMan:e.ChargeMan,Telephone:e.Telephone,Department:e.Department,Address:e.Address,ProStartTime:e.ProStartTime,Stage:e.Stage,user:usr.id};jQuery.get(request_head,t,function(e){log(e);var t=JSON.parse(e),a=t.status;"true"==a?(show_alarm_module(!1,"创建成功！"),$("#newProjModal").modal("hide"),clear_proj_detail_panel(),proj_intialize(0)):show_alarm_module(!0,"创建失败！"+t.msg)})}function modify_proj(e){var t={action:"ProjMod",ProjCode:e.ProjCode,ProjName:e.ProjName,ChargeMan:e.ChargeMan,Telephone:e.Telephone,Department:e.Department,Address:e.Address,ProStartTime:e.ProStartTime,Stage:e.Stage,user:usr.id};jQuery.get(request_head,t,function(e){log(e);var t=JSON.parse(e),a=t.status;"true"==a?(show_alarm_module(!1,"修改成功！"),$("#newProjModal").modal("hide"),clear_proj_detail_panel(),proj_intialize(0)):show_alarm_module(!0,"修改失败！"+t.msg)})}function get_proj_point(e){var t={action:"PointProj",ProjCode:e};jQuery.get(request_head,t,function(e){log(e);var t=JSON.parse(e);return"false"==t.status?void show_expiredModule():void(project_selected_point=t.ret)})}function proj_intialize(e){project_initial=!0,project_table=null,get_proj_table(e,5*table_row),window.setTimeout(draw_proj_table_head,wait_time_middle)}function draw_proj_table_head(){if(null!==project_table){var e=Math.ceil(project_table.length/table_row);$("#Proj_Page_control").empty();var t,a="<li><a href='#' id='proj_page_prev'>Prev</a></li>",o=Math.ceil(project_start/table_row);for(t=0;t<e;t++)a=a+"<li><a href='#' id='proj_page_"+t+"'>"+(t+o+1)+"</a></li>";for(a+="<li><a href='#' id='proj_page_next'>Next</a></li>",$("#Proj_Page_control").append(a),table_head="<thead><tr><th>编号</th> <th>名称 </th> <th>责任人 </th> <th>电话 </th> <th>单位 </th>",table_head+="</tr></thread>",proj_page_click=function(){draw_proj_table($(this))},t=0;t<e;t++)$("#proj_page_"+t).on("click",proj_page_click);project_start<=0?$("#proj_page_prev").css("display","none"):($("#proj_page_prev").css("display","block"),$("#proj_page_prev").on("click",function(){var e=project_start-5*table_row;e<0&&(e=0),proj_intialize(e)})),project_start+5*table_row>=project_total?$("#proj_page_next").css("display","none"):($("#proj_page_next").css("display","block"),$("#proj_page_next").on("click",function(){proj_intialize(project_start+5*table_row)})),draw_proj_table($("#proj_page_0"))}}function draw_proj_table(e){if($("#Table_proj").empty(),null!==project_table){var t=(parseInt(e.html())-1)*table_row-project_start,a=table_head;a+="<tbody>";var o;for(o=0;o<table_row;o++)t+o<project_table.length?(a=0!==o%2?a+"<tr class='success li_menu' id='proj_table_cell"+o+"' ProjCode='"+project_table[t+o].ProjCode+"'>":a+"<tr class=' li_menu' id='proj_table_cell"+o+"' ProjCode='"+project_table[t+o].ProjCode+"'>",a=a+"<td>"+project_table[t+o].ProjCode+"</td><td>"+project_table[t+o].ProjName+"</td><td>"+project_table[t+o].ChargeMan+"</td><td>"+project_table[t+o].Telephone+"</td><td>"+project_table[t+o].Department+"</td>",a+="</tr>"):(a=0!==o%2?a+"<tr class='success' id='proj_table_cell"+o+"' ProjCode='null'>":a+"<tr  id='proj_table_cell"+o+"' ProjCode='null'>",a+="<td>--</td><td>--</td><td>--</td><td>--</td><td>--</td>",a+="</tr>");for(a+="</tbody>",$("#Table_proj").append(a),proj_table_cell_click=function(){if("null"!=$(this).attr("ProjCode")){for(var e=0;e<project_table.length;e++)if($(this).attr("ProjCode")==project_table[e].ProjCode){project_selected=project_table[e];break}Initialize_proj_detail(),touchcookie()}},o=0;o<table_row;o++)$("#proj_table_cell"+o).on("click",proj_table_cell_click);touchcookie()}}function Initialize_proj_detail(){get_proj_point(project_selected.ProjCode),window.setTimeout(draw_proj_detail_panel,wait_time_short)}function clear_proj_detail_panel(){project_selected=null;var e="<p></p><p></p><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt >项目编号：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt >负责人：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd></dl></div><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt>项目名称：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt>电话：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd></dl></div><div class='col-md-12 col-sm-12 col-xs-12 column'><dl ><dt>单位：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt>地址：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt>开工日期：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt>备注：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd></dl></div>";$("#Label_proj_detail").empty(),$("#Label_proj_detail").append(e),$("#Table_proj_point").empty()}function draw_proj_detail_panel(){
if($("#Label_proj_detail").empty(),null!==project_selected_point){var e="<p></p><p></p><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt >项目编号：</dt><dd>"+project_selected.ProjCode+"</dd><dt >负责人：</dt><dd>"+project_selected.ChargeMan+"</dd></dl></div><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt>项目名称：</dt><dd>"+project_selected.ProjName+"</dd><dt>电话：</dt><dd>"+project_selected.Telephone+"</dd></dl></div><div class='col-md-12 col-sm-12 col-xs-12 column'><dl ><dt>单位：</dt><dd>"+project_selected.Department+"</dd><dt>地址：</dt><dd>"+project_selected.Address+"</dd><dt>开工日期：</dt><dd>"+project_selected.ProStartTime+"</dd><dt>备注：</dt><dd>"+project_selected.Stage+"</dd></dl></div>";$("#Label_proj_detail").append(e),$("#Table_proj_point").empty(),e="<thead> <tr> <th>监控点清单 </th> </tr> </thead> <tbody >";for(var t=0;t<project_selected_point.length;t++)e=e+"<tr> <td>"+project_selected_point[t].name+"</td> </tr>";e+="</tbody>",$("#Table_proj_point").append(e)}}function show_new_proj_module(){$("#newProjModalLabel").text("创建新项目"),project_module_status=!0,$("#ProjProjCode_Input").val(""),$("#ProjProjCode_Input").attr("disabled",!1),$("#ProjProjName_Input").val(""),$("#ProjChargeMan_Input").val(""),$("#ProjTelephone_Input").val(""),$("#ProjDepartment_Input").val(""),$("#ProjAddress_Input").val(""),$("#ProjProStartTime_Input").val(""),$("#ProjStage_Input").val(""),$("#ProjProjCode_Input").attr("placeholder","项目号"),$("#ProjProjName_Input").attr("placeholder","项目名称"),$("#ProjChargeMan_Input").attr("placeholder","负责人姓名"),$("#ProjTelephone_Input").attr("placeholder","联系电话"),$("#ProjDepartment_Input").attr("placeholder","单位名称"),$("#ProjAddress_Input").attr("placeholder","地址"),$("#ProjProStartTime_Input").attr("placeholder","开工时间"),modal_middle($("#newProjModal")),$("#newProjModal").modal("show")}function submit_new_proj_module(){var e=$("#ProjProjCode_Input").val(),t=$("#ProjProjName_Input").val(),a=$("#ProjChargeMan_Input").val(),o=$("#ProjTelephone_Input").val(),n=$("#ProjDepartment_Input").val(),l=$("#ProjAddress_Input").val(),i=$("#ProjProStartTime_Input").val(),r=$("#ProjStage_Input").val();if(null===e||""===e)return $("#ProjProjCode_Input").attr("placeholder","项目号不能为空"),void $("#ProjProjCode_Input").focus();if(null===t||""===t)return $("#ProjProjName_Input").attr("placeholder","项目名称不能为空"),void $("#ProjProjName_Input").focus();if(null===a||""===a)return $("#ProjChargeMan_Input").attr("placeholder","负责人姓名不能为空"),void $("#ProjChargeMan_Input").focus();if(null===o||""===o)return $("#ProjTelephone_Input").attr("placeholder","联系电话不能为空"),void $("#ProjTelephone_Input").focus();if(null===n||""===n)return $("#ProjDepartment_Input").attr("placeholder","单位名称不能为空"),void $("#ProjDepartment_Input").focus();if(null===l||""===l)return $("#ProjAddress_Input").attr("placeholder","地址不能为空"),void $("#ProjAddress_Input").focus();if(null===i||""===i)return $("#ProjProStartTime_Input").attr("placeholder","开工时间不能为空"),void $("#ProjProStartTime_Input").focus();var d={ProjCode:e,ProjName:t,ChargeMan:a,Telephone:o,Department:n,Address:l,ProStartTime:i,Stage:r};new_proj(d)}function show_mod_proj_module(e){$("#newProjModalLabel").text("项目修改"),project_module_status=!1,$("#ProjProjCode_Input").val(e.ProjCode),$("#ProjProjCode_Input").attr("disabled",!0),$("#ProjProjName_Input").val(e.ProjName),$("#ProjChargeMan_Input").val(e.ChargeMan),$("#ProjTelephone_Input").val(e.Telephone),$("#ProjDepartment_Input").val(e.Department),$("#ProjAddress_Input").val(e.Address),$("#ProjProStartTime_Input").val(e.ProStartTime),$("#ProjStage_Input").val(e.Stage),$("#ProjProjCode_Input").attr("placeholder","项目号"),$("#ProjProjName_Input").attr("placeholder","项目名称"),$("#ProjChargeMan_Input").attr("placeholder","负责人姓名"),$("#ProjTelephone_Input").attr("placeholder","联系电话"),$("#ProjDepartment_Input").attr("placeholder","单位名称"),$("#ProjAddress_Input").attr("placeholder","地址"),$("#ProjProStartTime_Input").attr("placeholder","开工时间"),modal_middle($("#newProjModal")),$("#newProjModal").modal("show")}function submit_mod_proj_module(){var e=$("#ProjProjCode_Input").val(),t=$("#ProjProjName_Input").val(),a=$("#ProjChargeMan_Input").val(),o=$("#ProjTelephone_Input").val(),n=$("#ProjDepartment_Input").val(),l=$("#ProjAddress_Input").val(),i=$("#ProjProStartTime_Input").val(),r=$("#ProjStage_Input").val(),d={ProjCode:e,ProjName:t,ChargeMan:a,Telephone:o,Department:n,Address:l,ProStartTime:i,Stage:r};modify_proj(d)}function get_version_list(){var e={action:"GetVersionList"};jQuery.get(request_head,e,function(e){log(e);var t=JSON.parse(e);return"false"==t.status?void show_expiredModule():void(software_version_list=t.ret)})}function get_projdev_version(e){var t={action:"GetProjDevVersion",ProjCode:e};jQuery.get(request_head,t,function(e){log(e);var t=JSON.parse(e);if("false"==t.status)return void show_expiredModule();var a=t.ret;$("#duallistboxDevUpdate").empty();for(var o="",n=0;n<a.length;n++)o="<option value='"+a[n].DevCode+"'",o=o+">"+a[n].DevCode+a[n].ProjName+a[n].version+"</option>",$("#duallistboxDevUpdate").append(o);$("#duallistboxDevUpdate").bootstrapDualListbox("refresh",!0)})}function update_version(){var e=get_update_dev_list(),t=$("#UpdateVersion_choice").val();if(0===e.length)return void show_alarm_module(!0,"没有选中的设备");var a={action:"UpdateDevVersion",id:usr.id,list:e,version:t};jQuery.get(request_head,a,function(e){log(e);var t=JSON.parse(e);return"false"==t.status?void show_expiredModule():void show_alarm_module(!1,"设置成功，设备会在下个更新点更新")})}function parameter_initialize(){parameter_initial=!0,get_version_list(),null===project_list&&get_project_list(),window.setTimeout(draw_parameter_page,wait_time_middle)}function draw_parameter_page(){$("#UpdateProj_choice").empty(),$("#UpdateVersion_choice").empty();var e,t="";for(e=0;e<project_list.length;e++)t=t+"<option value="+project_list[e].id+">"+project_list[e].name+"</option>";for($("#UpdateProj_choice").append(t),t="",e=0;e<software_version_list.length;e++)t=t+"<option value="+software_version_list[e]+">"+software_version_list[e]+"</option>";$("#UpdateVersion_choice").append(t),$("#UpdateProj_choice").change(function(){get_projdev_version($("#UpdateProj_choice").val())}),get_projdev_version($("#UpdateProj_choice").val())}function get_update_dev_list(){var e=[];return $("#duallistboxDevUpdate :selected").each(function(t,a){e.push($(a).val())}),e}function get_point_table(e,t){var a={action:"PointTable",startseq:e,length:t,user:usr.id};jQuery.get(request_head,a,function(e){log(e);var t=JSON.parse(e);return"false"==t.status?void show_expiredModule():(point_table=t.ret,point_start=parseInt(t.start),void(point_total=parseInt(t.total)))})}function del_point(e){var t={action:"PointDel",StatCode:e,user:usr.id};jQuery.get(request_head,t,function(e){log(e);var t=JSON.parse(e),a=t.status;"true"==a?(show_alarm_module(!1,"删除成功！"),clear_point_detail_panel(),point_intialize(0)):show_alarm_module(!0,"删除失败！"+t.msg)}),$("#PointDelAlarm").modal("hide")}function new_point(e){var t={action:"PointNew",StatCode:e.StatCode,StatName:e.StatName,ProjCode:e.ProjCode,ChargeMan:e.ChargeMan,Telephone:e.Telephone,Longitude:e.Longitude,Latitude:e.Latitude,Department:e.Department,Address:e.Address,Country:e.Country,Street:e.Street,Square:e.Square,ProStartTime:e.ProStartTime,Stage:e.Stage,user:usr.id};jQuery.get(request_head,t,function(e){log(e);var t=JSON.parse(e),a=t.status;"true"==a?(show_alarm_module(!1,"创建成功！"),$("#newPointModal").modal("hide"),clear_point_detail_panel(),point_intialize(0)):show_alarm_module(!0,"创建失败！"+t.msg)})}function modify_point(e){var t={action:"PointMod",StatCode:e.StatCode,StatName:e.StatName,ProjCode:e.ProjCode,ChargeMan:e.ChargeMan,Telephone:e.Telephone,Longitude:e.Longitude,Latitude:e.Latitude,Department:e.Department,Address:e.Address,Country:e.Country,Street:e.Street,Square:e.Square,ProStartTime:e.ProStartTime,Stage:e.Stage,user:usr.id};jQuery.get(request_head,t,function(e){log(e);var t=JSON.parse(e),a=t.status;"true"==a?(show_alarm_module(!1,"修改成功！"),$("#newPointModal").modal("hide"),clear_point_detail_panel(),point_intialize(0)):show_alarm_module(!0,"修改失败！"+t.msg)})}function get_point_device(e){var t={action:"PointDev",StatCode:e};jQuery.get(request_head,t,function(e){log(e);var t=JSON.parse(e);return"false"==t.status?void show_expiredModule():void(point_selected_device=t.ret)})}function point_intialize(e){point_initial=!0,point_table=null,get_project_list(),get_point_table(e,5*table_row),window.setTimeout(draw_point_table_head,wait_time_middle),clear_point_detail_panel()}function draw_point_table_head(){if(null!==point_table){var e=Math.ceil(point_table.length/table_row);$("#Point_Page_control").empty();var t,a="<li><a href='#' id='point_page_prev'>Prev</a></li>",o=Math.ceil(point_start/table_row);for(t=0;t<e;t++)a=a+"<li><a href='#' id='point_page_"+t+"'>"+(t+o+1)+"</a></li>";for(a+="<li><a href='#' id='point_page_next'>Next</a></li>",$("#Point_Page_control").append(a),table_head="<thead><tr><th>编号</th> <th>名称 </th> <th>项目</th> <th>责任人 </th> <th>电话 </th> ",table_head+="</tr></thread>",point_page_click=function(){draw_point_table($(this))},t=0;t<e;t++)$("#point_page_"+t).on("click",point_page_click);point_start<=0?$("#point_page_prev").css("display","none"):($("#point_page_prev").css("display","block"),$("#point_page_prev").on("click",function(){var e=point_start-5*table_row;e<0&&(e=0),point_intialize(e)})),point_start+5*table_row>=point_total?$("#point_page_next").css("display","none"):($("#point_page_next").css("display","block"),$("#point_page_next").on("click",function(){point_intialize(point_start+5*table_row)})),draw_point_table($("#point_page_0"))}}function draw_point_table(e){if($("#Table_point").empty(),null!==point_table){var t=(parseInt(e.html())-1)*table_row-point_start,a=table_head;a+="<tbody>";var o;for(o=0;o<table_row;o++)if(t+o<point_table.length){for(var n="",l=0;l<project_list.length;l++)if(point_table[t+o].ProjCode==project_list[l].id){n=project_list[l].name;break}a=0!==o%2?a+"<tr class='success li_menu' id='point_table_cell"+o+"' StatCode='"+point_table[t+o].StatCode+"'>":a+"<tr class=' li_menu' id='point_table_cell"+o+"' StatCode='"+point_table[t+o].StatCode+"'>",a=a+"<td>"+point_table[t+o].StatCode+"</td><td>"+point_table[t+o].StatName+"</td><td>"+n+"</td><td>"+point_table[t+o].ChargeMan+"</td><td>"+point_table[t+o].Telephone+"</td>",a+="</tr>"}else a=0!==o%2?a+"<tr class='success' id='point_table_cell"+o+"' StatCode='null'>":a+"<tr  id='point_table_cell"+o+"' StatCode='null'>",a+="<td>--</td><td>--</td><td>--</td><td>--</td><td>--</td><td>--</td>",a+="</tr>";for(a+="</tbody>",$("#Table_point").append(a),point_table_cell_click=function(){if("null"!=$(this).attr("StatCode")){for(var e=0;e<point_table.length;e++)if($(this).attr("StatCode")==point_table[e].StatCode){point_selected=point_table[e];break}Initialize_point_detail(),touchcookie()}},o=0;o<table_row;o++)$("#point_table_cell"+o).on("click",point_table_cell_click);touchcookie()}}function Initialize_point_detail(){get_point_device(point_selected.StatCode),window.setTimeout(draw_point_detail_panel,wait_time_short)}function clear_point_detail_panel(){point_selected=null;var e="<p></p><p></p><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt >监测点编号：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt >负责人：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt >开工日期：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd></dl></div><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt>监测点名称：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt>电话：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt >面积：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd></dl></div><div class='col-md-12 col-sm-12 col-xs-12 column'><dl ><dt>关联项目：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt>单位：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd></dl></div><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt >经度：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt >区县：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd></dl></div><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt>纬度：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt>街镇：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd></dl></div><div class='col-md-12 col-sm-12 col-xs-12 column'><dl ><dt>地址：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt>备注：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd></dl></div>";$("#Label_point_detail").empty(),$("#Label_point_detail").append(e),$("#Table_point_device").empty()}function draw_point_detail_panel(){if($("#Label_point_detail").empty(),null!==point_selected_device){for(var e="",t=0;t<project_list.length;t++)if(point_selected.ProjCode==project_list[t].id){e=project_list[t].name;break}var a="<p></p><p></p><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt >监测点编号：</dt><dd>"+point_selected.StatCode+"</dd><dt >负责人：</dt><dd>"+point_selected.ChargeMan+"</dd><dt >开工日期：</dt><dd>"+point_selected.ProStartTime+"</dd></dl></div><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt>监测点名称：</dt><dd>"+point_selected.StatName+"</dd><dt>电话：</dt><dd>"+point_selected.Telephone+"</dd><dt >面积：</dt><dd>"+point_selected.Square+"</dd></dl></div><div class='col-md-12 col-sm-12 col-xs-12 column'><dl ><dt>关联项目：</dt><dd>"+e+"</dd><dt>单位：</dt><dd>"+point_selected.Department+"</dd></dl></div><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt >经度：</dt><dd>"+point_selected.Longitude+"</dd><dt >区县：</dt><dd>"+point_selected.Country+"</dd></dl></div><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt>纬度：</dt><dd>"+point_selected.Latitude+"</dd><dt>街镇：</dt><dd>"+point_selected.Street+"</dd></dl></div><div class='col-md-12 col-sm-12 col-xs-12 column'><dl ><dt>地址：</dt><dd>"+point_selected.Address+"</dd><dt>备注：</dt><dd>"+point_selected.Stage+"</dd></dl></div>";$("#Label_point_detail").append(a),$("#Table_point_device").empty(),a="<thead> <tr> <th>监控设备清单 </th> </tr> </thead> <tbody >";for(var o=0;o<point_selected_device.length;o++)a=a+"<tr> <td>"+point_selected_device[o].name+"</td> </tr>";a+="</tbody>",$("#Table_point_device").append(a)}}function show_new_point_module(){$("#newPointModalLabel").text("创建监测点"),point_module_status=!0,$("#PointStatCode_Input").val(""),$("#PointStatCode_Input").attr("disabled",!1),$("#PointStatName_Input").val(""),$("#PointChargeMan_Input").val(""),$("#PointTelephone_Input").val(""),$("#PointLongitude_Input").val(""),$("#PointLatitude_Input").val(""),$("#PointDepartment_Input").val(""),$("#PointAddress_Input").val(""),$("#PointCountry_Input").val(""),$("#PointStreet_Input").val(""),$("#PointSquare_Input").val(""),$("#PointProStartTime_Input").val(""),$("#PointStage_Input").val(""),$("#PointProjCode_choice").empty(),$("#PointProjCode_choice").append(get_proj_option()),$("#PointStatCode_Input").attr("placeholder","监控点号"),$("#PointStatName_Input").attr("placeholder","监控点名称"),$("#PointChargeMan_Input").attr("placeholder","负责人姓名"),$("#PointTelephone_Input").attr("placeholder","联系电话"),$("#PointLongitude_Input").attr("placeholder","经度"),$("#PointLatitude_Input").attr("placeholder","纬度"),$("#PointDepartment_Input").attr("placeholder","单位名称"),$("#PointAddress_Input").attr("placeholder","地址"),$("#PointCountry_Input").attr("placeholder","区县"),$("#PointStreet_Input").attr("placeholder","街镇"),$("#PointSquare_Input").attr("placeholder","施工面积(平方米)"),$("#PointProStartTime_Input").attr("placeholder","开工时间"),modal_middle($("#newPointModal")),$("#newPointModal").modal("show")}function submit_new_point_module(){var e=$("#PointStatCode_Input").val(),t=$("#PointStatName_Input").val(),a=$("#PointProjCode_choice").val(),o=$("#PointChargeMan_Input").val(),n=$("#PointTelephone_Input").val(),l=$("#PointLongitude_Input").val(),i=$("#PointLatitude_Input").val(),r=$("#PointDepartment_Input").val(),d=$("#PointAddress_Input").val(),_=$("#PointCountry_Input").val(),s=$("#PointStreet_Input").val(),c=$("#PointSquare_Input").val(),u=$("#PointProStartTime_Input").val(),p=$("#PointStage_Input").val();if(null===e||""===e)return $("#PointStatCode_Input").attr("placeholder","监测点号不能为空"),void $("#PointStatCode_Input").focus();if(null===t||""===t)return $("#PointStatName_Input").attr("placeholder","监测点名称不能为空"),void $("#PointStatName_Input").focus();if(null===o||""===o)return $("#PointChargeMan_Input").attr("placeholder","负责人姓名不能为空"),void $("#PointChargeMan_Input").focus();if(null===a||""===a)return $("#PointProjCode_choice").attr("placeholder","项目不能为空"),void $("#PointProjCode_choice").focus();if(null===n||""===n)return $("#PointTelephone_Input").attr("placeholder","联系电话不能为空"),void $("#PointTelephone_Input").focus();if(null===l||""===l)return $("#PointLongitude_Input").attr("placeholder","经度不能为空"),void $("#PointLongitude_Input").focus();if(null===i||""===i)return $("#PointLatitude_Input").attr("placeholder","纬度不能为空"),void $("#PointLatitude_Input").focus();if(null===r||""===r)return $("#PointDepartment_Input").attr("placeholder","单位名称不能为空"),void $("#PointDepartment_Input").focus();if(null===d||""===d)return $("#PointAddress_Input").attr("placeholder","地址不能为空"),void $("#PointAddress_Input").focus();if(null===_||""===_)return $("#PointCountry_Input").attr("placeholder","区县不能为空"),void $("#PointCountry_Input").focus();if(null===s||""===s)return $("#PointStreet_Input").attr("placeholder","街镇不能为空"),void $("#PointStreet_Input").focus();if(null===c||""===c)return $("#PointSquare_Input").attr("placeholder","施工面积不能为空"),void $("#PointSquare_Input").focus();if(null===u||""===u)return $("#PointProStartTime_Input").attr("placeholder","开工时间不能为空"),void $("#PointProStartTime_Input").focus();var m={StatCode:e,StatName:t,ProjCode:a,ChargeMan:o,Telephone:n,Longitude:l,Latitude:i,Department:r,Address:d,Country:_,Street:s,Square:c,ProStartTime:u,Stage:p};new_point(m)}function show_mod_point_module(e){$("#newPointModalLabel").text("监测点修改"),point_module_status=!1,$("#PointStatCode_Input").val(e.StatCode),$("#PointStatCode_Input").attr("disabled",!0),$("#PointStatName_Input").val(e.StatName),$("#PointChargeMan_Input").val(e.ChargeMan),$("#PointTelephone_Input").val(e.Telephone),$("#PointLongitude_Input").val(e.Longitude),$("#PointLatitude_Input").val(e.Latitude),$("#PointDepartment_Input").val(e.Department),$("#PointAddress_Input").val(e.Address),$("#PointCountry_Input").val(e.Country),$("#PointStreet_Input").val(e.Street),$("#PointSquare_Input").val(e.Square),$("#PointProStartTime_Input").val(e.ProStartTime),$("#PointStage_Input").val(e.Stage),$("#PointProjCode_choice").empty(),$("#PointProjCode_choice").append(get_proj_option()),$("#PointProjCode_choice").val(e.ProjCode),$("#PointStatCode_Input").attr("placeholder","监测点号"),$("#PointStatName_Input").attr("placeholder","监测点名称"),$("#PointChargeMan_Input").attr("placeholder","负责人姓名"),$("#PointTelephone_Input").attr("placeholder","联系电话"),$("#PointLongitude_Input").attr("placeholder","经度"),$("#PointLatitude_Input").attr("placeholder","纬度"),$("#PointDepartment_Input").attr("placeholder","单位名称"),$("#PointAddress_Input").attr("placeholder","地址"),$("#PointCountry_Input").attr("placeholder","区县"),$("#PointStreet_Input").attr("placeholder","街镇"),$("#PointSquare_Input").attr("placeholder","施工面积(平方米)"),$("#PointProStartTime_Input").attr("placeholder","开工时间"),modal_middle($("#newPointModal")),$("#newPointModal").modal("show")}function submit_mod_point_module(){var e=$("#PointStatCode_Input").val(),t=$("#PointStatName_Input").val(),a=$("#PointProjCode_choice").val(),o=$("#PointChargeMan_Input").val(),n=$("#PointTelephone_Input").val(),l=$("#PointLongitude_Input").val(),i=$("#PointLatitude_Input").val(),r=$("#PointDepartment_Input").val(),d=$("#PointAddress_Input").val(),_=$("#PointCountry_Input").val(),s=$("#PointStreet_Input").val(),c=$("#PointSquare_Input").val(),u=$("#PointProStartTime_Input").val(),p=$("#PointStage_Input").val(),m={StatCode:e,StatName:t,ProjCode:a,ChargeMan:o,Telephone:n,Longitude:l,Latitude:i,Department:r,Address:d,Country:_,Street:s,Square:c,ProStartTime:u,Stage:p};modify_point(m)}function get_proj_point_list(){var e={action:"ProjPoint"};jQuery.get(request_head,e,function(e){log(e);var t=JSON.parse(e);return"false"==t.status?void show_expiredModule():void(point_list=t.ret)})}function get_dev_table(e,t){var a={action:"DevTable",startseq:e,length:t,user:usr.id};jQuery.get(request_head,a,function(e){log(e);var t=JSON.parse(e);return"false"==t.status?void show_expiredModule():(device_table=t.ret,device_start=parseInt(t.start),void(device_total=parseInt(t.total)))})}function del_dev(e){var t={action:"DevDel",DevCode:e,user:usr.id};jQuery.get(request_head,t,function(e){log(e);var t=JSON.parse(e),a=t.status;"true"==a?(show_alarm_module(!1,"删除成功！"),clear_dev_detail_panel(),dev_intialize(0)):show_alarm_module(!0,"删除失败！"+t.msg)}),$("#DevDelAlarm").modal("hide")}function new_dev(e){var t={action:"DevNew",DevCode:e.DevCode,StatCode:e.StatCode,StartTime:e.StartTime,PreEndTime:e.PreEndTime,EndTime:e.EndTime,DevStatus:e.DevStatus,VideoURL:e.VideoURL,user:usr.id};jQuery.get(request_head,t,function(e){log(e);var t=JSON.parse(e),a=t.status;"true"==a?(show_alarm_module(!1,"创建成功！"),$("#newDevModal").modal("hide"),clear_dev_detail_panel(),dev_intialize(0)):show_alarm_module(!0,"创建失败！"+t.msg)})}function modify_dev(e){var t={action:"DevMod",DevCode:e.DevCode,StatCode:e.StatCode,StartTime:e.StartTime,PreEndTime:e.PreEndTime,EndTime:e.EndTime,DevStatus:e.DevStatus,VideoURL:e.VideoURL,user:usr.id};jQuery.get(request_head,t,function(e){log(e);var t=JSON.parse(e),a=t.status;"true"==a?(show_alarm_module(!1,"修改成功！"),$("#newDevModal").modal("hide"),clear_dev_detail_panel(),dev_intialize(0)):show_alarm_module(!0,"修改失败！"+t.msg)})}function dev_intialize(e){device_initial=!0,device_table=null,get_dev_table(e,5*table_row),get_project_list(),get_proj_point_list(),window.setTimeout(draw_dev_table_head,wait_time_middle),clear_dev_detail_panel()}function draw_dev_table_head(){if(null!==device_table){var e=Math.ceil(device_table.length/table_row);$("#Dev_Page_control").empty();var t,a="<li><a href='#' id='dev_page_prev'>Prev</a></li>",o=Math.ceil(device_start/table_row);for(t=0;t<e;t++)a=a+"<li><a href='#' id='dev_page_"+t+"'>"+(t+o+1)+"</a></li>";for(a+="<li><a href='#' id='dev_page_next'>Next</a></li>",$("#Dev_Page_control").append(a),table_head="<thead><tr><th>编号 </th> <th>项目名称 </th> <th>测量点名称 </th><th>安装时间 </th> <th>是否启动 </th>",table_head+="</tr></thread>",dev_page_click=function(){draw_dev_table($(this))},t=0;t<e;t++)$("#dev_page_"+t).on("click",dev_page_click);device_start<=0?$("#dev_page_prev").css("display","none"):($("#dev_page_prev").css("display","block"),$("#dev_page_prev").on("click",function(){var e=device_start-5*table_row;e<0&&(e=0),dev_intialize(e)})),device_start+5*table_row>=device_total?$("#dev_page_next").css("display","none"):($("#dev_page_next").css("display","block"),$("#dev_page_next").on("click",function(){dev_intialize(device_start+5*table_row)})),draw_dev_table($("#dev_page_0"))}}function draw_dev_table(e){if($("#Table_dev").empty(),null!==device_table){var t=(parseInt(e.html())-1)*table_row-device_start,a=table_head;a+="<tbody>";var o;for(o=0;o<table_row;o++)if(t+o<device_table.length){a=0!==o%2?a+"<tr class='success li_menu' id='dev_table_cell"+o+"' DevCode='"+device_table[t+o].DevCode+"'>":a+"<tr class=' li_menu' id='dev_table_cell"+o+"' DevCode='"+device_table[t+o].DevCode+"'>";var n="开启";"false"===device_table[t+o].DevStatus&&(n="关闭"),a=a+"<td>"+device_table[t+o].DevCode+"</td><td>"+get_proj_name(device_table[t+o].ProjCode)+"</td><td>"+get_point_name(device_table[t+o].StatCode)+"</td><td>"+device_table[t+o].StartTime+"</td><td>"+n+"</td>",a+="</tr>"}else a=0!==o%2?a+"<tr class='success' id='dev_table_cell"+o+"' DevCode='null'>":a+"<tr  id='dev_table_cell"+o+"' DevCode='null'>",a+="<td>--</td><td>--</td><td>--</td><td>--</td><td>--</td>",a+="</tr>";for(a+="</tbody>",$("#Table_dev").append(a),dev_table_cell_click=function(){if("null"!=$(this).attr("DevCode")){for(var e=0;e<device_table.length;e++)if($(this).attr("DevCode")==device_table[e].DevCode){device_selected=device_table[e];break}Initialize_dev_detail(),touchcookie()}},o=0;o<table_row;o++)$("#dev_table_cell"+o).on("click",dev_table_cell_click);touchcookie()}}function Initialize_dev_detail(){get_device_sensor(device_selected.DevCode),window.setTimeout(draw_dev_detail_panel,wait_time_short)}function clear_dev_detail_panel(){project_selected=null;var e="<p></p><p></p><div class='col-md-12 col-sm-12 col-xs-12 column'><dl ><dt>设备编号：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd></dl></div><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt >项目：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt >安装时间：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt >MAC地址：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt >实际结束时间：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd></dl></div><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt>监测点：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt>预计结束时间：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt >IP地址：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt >设备是否启动：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd></dl></div><div class='col-md-12 col-sm-12 col-xs-12 column'><dl ><dt>视频地址：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd></dl></div>";$("#Label_dev_detail").empty(),$("#Label_dev_detail").append(e),$("#Table_device_sensor").empty()}function draw_dev_detail_panel(){if($("#Label_dev_detail").empty(),null!==device_selected_sensor){var e="开启";"false"===device_selected.DevStatus&&(e="关闭");var t="<p></p><p></p><div class='col-md-12 col-sm-12 col-xs-12 column'><dl ><dt>设备编号：</dt><dd>"+device_selected.DevCode+"</dd></dl></div><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt >项目：</dt><dd>"+get_proj_name(device_selected.ProjCode)+"</dd><dt >安装时间：</dt><dd>"+device_selected.StartTime+"</dd><dt >MAC地址：</dt><dd>"+device_selected.MAC+"</dd><dt >实际结束时间：</dt><dd>"+device_selected.EndTime+"</dd></dl></div><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt>监测点：</dt><dd>"+get_point_name(device_selected.StatCode)+"</dd><dt>预计结束时间：</dt><dd>"+device_selected.PreEndTime+"</dd><dt >IP地址：</dt><dd>"+device_selected.IP+"</dd><dt >设备是否启动：</dt><dd>"+e+"</dd></dl></div><div class='col-md-12 col-sm-12 col-xs-12 column'><dl ><dt>视频地址：</dt><dd>"+device_selected.VideoURL+"</dd></dl></div>";$("#Label_dev_detail").append(t),$("#Table_device_sensor").empty(),t="<thead> <tr> <th>传感器 </th><th>状态 </th> </tr> </thead> <tbody >";var a;for(a=0;a<device_selected_sensor.length;a++){var o="开启";"false"==device_selected_sensor[a].status&&(o="关闭"),t=t+"<tr class=' li_menu' id='sensor_table_cell"+a+"' sequence='"+a+"'> <td>"+get_sensor_name(device_selected_sensor[a].id)+"</td><td>"+o+"</td> </tr>"}for($("#Table_device_sensor").append(t),sensor_table_cell_click=function(){"null"!=$(this).attr("sequence")&&(select_sensor=device_selected_sensor[parseInt($(this).attr("sequence"))],show_sensor_module())},a=0;a<device_selected_sensor.length;a++)$("#sensor_table_cell"+a).on("click",sensor_table_cell_click)}}function show_new_dev_module(){$("#newDevModalLabel").text("创建新设备"),device_module_status=!0,$("#DevDevCode_Input").attr("disabled",!1),$("#DevDevCode_Input").val(""),$("#DevStatCode_choice").empty(),$("#DevProjCode_choice").empty(),$("#DevProjCode_choice").append(get_proj_option()),get_proj_point_option($("#DevProjCode_choice").val(),$("#DevStatCode_choice"),""),$("#DevStartTime_Input").val(""),$("#DevPreEndTime_Input").val(""),$("#DevEndTime_Input").val(""),$("#DevDevStatus_choice").val("true"),$("#DevVideoURL_Input").val(""),$("#DevDevCode_Input").attr("placeholder","设备编号"),$("#DevStartTime_Input").attr("placeholder","安装时间"),$("#DevPreEndTime_Input").attr("placeholder","预计结束时间"),$("#DevEndTime_Input").attr("placeholder","实际结束时间"),modal_middle($("#newDevModal")),$("#newDevModal").modal("show")}function submit_new_dev_module(){var e=$("#DevDevCode_Input").val(),t=$("#DevStatCode_choice").val(),a=$("#DevStartTime_Input").val(),o=$("#DevPreEndTime_Input").val(),n=$("#DevEndTime_Input").val(),l=$("#DevDevStatus_choice").val(),i=$("#DevVideoURL_Input").val();if(null===e||""===e)return $("#DevDevCode_Input").attr("placeholder","设备号不能为空"),void $("#DevDevCode_Input").focus();if(null===t||""===t)return $("#DevStatCode_choice").attr("placeholder","项目不能为空"),void $("#DevStatCode_choice").focus();if(null===a||""===a)return $("#DevStartTime_Input").attr("placeholder","负责人姓名不能为空"),void $("#DevStartTime_Input").focus();var r={DevCode:e,StatCode:t,StartTime:a,PreEndTime:o,EndTime:n,DevStatus:l,VideoURL:i};new_dev(r)}function show_mod_dev_module(e){$("#newDevModalLabel").text("项目修改"),device_module_status=!1,$("#DevDevCode_Input").attr("disabled",!0),$("#DevDevCode_Input").val(e.DevCode),$("#DevStatCode_choice").empty(),$("#DevProjCode_choice").empty(),$("#DevProjCode_choice").append(get_proj_option(e.ProjCode)),get_proj_point_option($("#DevProjCode_choice").val(),$("#DevStatCode_choice"),e.StatCode),$("#DevStatCode_choice").val(e.StatCode),$("#DevStartTime_Input").val(e.StartTime),$("#DevPreEndTime_Input").val(e.PreEndTime),$("#DevEndTime_Input").val(e.EndTime),e.DevStatus?$("#DevDevStatus_choice").val("true"):$("#DevDevStatus_choice").val("false"),$("#DevVideoURL_Input").val(e.VideoURL),$("#DevDevCode_Input").attr("placeholder","设备编号"),$("#DevStartTime_Input").attr("placeholder","安装时间"),$("#DevPreEndTime_Input").attr("placeholder","预计结束时间"),$("#DevEndTime_Input").attr("placeholder","实际结束时间"),modal_middle($("#newDevModal")),$("#newDevModal").modal("show")}function submit_mod_dev_module(){var e=$("#DevDevCode_Input").val(),t=$("#DevStatCode_choice").val(),a=$("#DevStartTime_Input").val(),o=$("#DevPreEndTime_Input").val(),n=$("#DevEndTime_Input").val(),l=$("#DevDevStatus_choice").val(),i=$("#DevVideoURL_Input").val(),r={DevCode:e,StatCode:t,StartTime:a,PreEndTime:o,EndTime:n,DevStatus:l,VideoURL:i};modify_dev(r)}function get_proj_name(e){for(var t=null,a=0;a<project_list.length;a++)if(project_list[a].id==e){t=project_list[a].name;break}return t}function get_point_name(e){for(var t=null,a=0;a<point_list.length;a++)if(point_list[a].id==e){t=point_list[a].name;break}return t}function get_proj_option(e){txt="";for(var t=0;t<project_list.length;t++)project_list[t].id==e?txt=txt+"<option value="+project_list[t].id+" selected='selected'>"+project_list[t].name+"</option>":txt=txt+"<option value="+project_list[t].id+">"+project_list[t].name+"</option>";return txt}function get_proj_point_option(e,t,a){if(t.empty(),""!==e&&null!==e){for(var o="",n=0;n<point_list.length;n++)point_list[n].ProjCode==e&&(o=point_list[n].id==a?o+"<option value="+point_list[n].id+" selected='selected' >"+point_list[n].name+"</option>":o+"<option value="+point_list[n].id+">"+point_list[n].name+"</option>");t.empty(),t.append(o)}}function get_monitor_list(){var e={action:"MonitorList",id:usr.id};jQuery.get(request_head,e,function(e){log(e);var t=JSON.parse(e);return"false"==t.status?void show_expiredModule():void(monitor_map_list=t.ret)})}function get_monitor_warning_on_map(){if(null!==monitor_selected&&null!==monitor_map_handle){var e={action:"DevAlarm",StatCode:monitor_selected.StatCode};jQuery.get(request_head,e,function(e){log(e);var t=JSON.parse(e);if("false"==t.status)return void show_expiredModule();var a=t.ret,o="";if("false"==a)o="<Strong>获取告警失败</Strong>";else{o="<div id ='Element_card_floating' align='center' ><p style='font-size:14px;font-weight: bold' >站点名称："+monitor_selected.StatName+"</p><HR style='FILTER: alpha(opacity=100,finishopacity=0,style=3)' width='80%' color=#987cb9 SIZE=3/><div style='font-size:10px; min-height: 350px; min-width:420px' >",o+=" <div class='col-md-6 column'>";for(var n=0;n<a.length;n++){a[n].AlarmEName;o=o+"<img src='./svg/icon/"+a[n].AlarmEName+".svg' style='width:36px;hight:36px'></img><label style='max-width: 150px;min-width: 150px'>&nbsp&nbsp&nbsp&nbsp"+a[n].AlarmName+":";var l=parseInt(a[n].AlarmValue),i=a[n].WarningTarget;o="true"==i?o+"<Strong style='color:red'>"+l+"</Strong>"+a[n].AlarmUnit+"</label>":o+"<Strong>"+l+"</Strong>"+a[n].AlarmUnit+"</label>",o+="<HR style='FILTER: alpha(opacity=100,finishopacity=0,style=3)' width='80%' color=#987cb9 SIZE=3/>",n==a.length/2-1&&(o+="</div><div class='col-md-6 column'>")}o+="</div></div>"}null!==monitor_map_handle&&monitor_map_handle.setContent(o),$("#VideoStatCode_Input").val(monitor_selected.StatName),video_selection_change()})}}function initializeMap(){get_monitor_list();var e=parseInt($("#MPMonitorViewMap").css("min-height").replace(/[^0-9]/gi,""));
window.screen.availHeight-275>e&&(e=window.screen.availHeight-275),$("#MPMonitorViewMap").css("min-height",e+"px"),map_MPMonitor=new BMap.Map("MPMonitorViewMap"),map_MPMonitor.addControl(new BMap.NavigationControl),map_MPMonitor.enableScrollWheelZoom(),map_MPMonitor.centerAndZoom(usr.city,15),window.setTimeout(addMarker,wait_time_middle),map_initialized=!0}function get_select_monitor(e){for(var t=e.split(":"),a=0;a<monitor_map_list.length;a++)if(monitor_map_list[a].StatCode==t[0])return void(monitor_selected=monitor_map_list[a]);monitor_selected=null}function addMarker(e){if(null!==monitor_map_list){var t=new BMap.Icon("./image/map-marker-ball-azure-small.png",new BMap.Size(32,32),{anchor:new BMap.Size(16,30)});monitor_mark_click=function(){get_select_monitor(this.getTitle());var e=this.getTitle(),t=new BMap.InfoWindow(e,{offset:new BMap.Size(0,(-23))});t.setWidth(600),monitor_map_handle=t,get_monitor_warning_on_map(),this.openInfoWindow(t),t.addEventListener("close",function(){monitor_map_handle==this&&(monitor_map_handle=null)})};for(var a=0;a<monitor_map_list.length;a++){var o=new BMap.Point(parseFloat(monitor_map_list[a].Longitude),parseFloat(monitor_map_list[a].Latitude)),n=new BMap.Marker(o,{icon:t});n.setTitle(monitor_map_list[a].StatCode+":"+monitor_map_list[a].StatName),map_MPMonitor.addOverlay(n),n.addEventListener("click",monitor_mark_click)}}}function video_selection_change(){null!==monitor_selected&&""!==$("#Video_query_Input").val()&&get_video(monitor_selected.StatCode,$("#Video_query_Input").val(),$("#VideoHour_choice").val())}function get_video(e,t,a){var o={action:"GetVideoList",id:usr.id,StatCode:e,date:t,hour:a};jQuery.get(request_head,o,function(e){log(e);var t=JSON.parse(e);if("false"==t.status)return void show_expiredModule();var a=t.ret;$("#VCRStatus_choice").empty();for(var o="",n=0;n<a.length;n++)o=o+"<option value='"+a[n].id+"'>"+a[n].attr+"</option>";$("#VCRStatus_choice").append(o)})}function video_Module_selection_change(){""!==$("#VideoModuleStatCode_Input").val()&&""!==$("#VideoModule_query_Input").val()&&get_Module_video($("#VideoModuleStatCode_Input").val(),$("#VideoModule_query_Input").val(),$("#VideoModuleHour_choice").val())}function get_Module_video(e,t,a){var o={action:"GetVideoList",id:usr.id,StatCode:e,date:t,hour:a};jQuery.get(request_head,o,function(e){log(e);var t=JSON.parse(e);if("false"==t.status)return void show_expiredModule();var a=t.ret;$("#ModuleVCRStatus_choice").empty();for(var o="",n=0;n<a.length;n++)o=o+"<option value='"+a[n].id+"'>"+a[n].attr+"</option>";$("#ModuleVCRStatus_choice").append(o)})}function initialize_warning_table(){$("#Monitor_Page_control").empty(),$("#Table_Monitor").empty();var e,t="<li><a href='#' id='monitor_page_prev'>Prev</a></li>",a=Math.ceil(monitor_map_list.length/(2*table_row));for(e=0;e<a;e++)t=t+"<li><a href='#' id='monitor_page_"+e+"' number='"+e+"'>"+(e+1)+"</a></li>";for(t+="<li><a href='#' id='monitor_page_next'>Next</a></li>",$("#Monitor_Page_control").append(t),Monitor_table_start=0,Monitor_table_total=a,0===Monitor_table_start?$("#monitor_page_prev").css("display","none"):$("#monitor_page_prev").css("display","block"),Monitor_table_start+5>=Monitor_table_total?$("#monitor_page_next").css("display","none"):$("#monitor_page_next").css("display","block"),e=0;e<a;e++)e<5?$("#monitor_page_"+e).css("display","block"):$("#monitor_page_"+e).css("display","none");for($("#monitor_page_next").on("click",function(){if(!(Monitor_table_start+5>=Monitor_table_total)){Monitor_table_start+=5;for(var e=0;e<Monitor_table_total;e++)$("#monitor_page_"+e).css("display","none"),e>=Monitor_table_start&&e<Monitor_table_start+5&&$("#monitor_page_"+e).css("display","block");0===Monitor_table_start?$("#monitor_page_prev").css("display","none"):$("#monitor_page_prev").css("display","block"),Monitor_table_start+5>=Monitor_table_total?$("#monitor_page_next").css("display","none"):$("#monitor_page_next").css("display","block"),show_monitor_page(Monitor_table_start)}}),$("#monitor_page_prev").on("click",function(){if(0!==Monitor_table_start){Monitor_table_start-=5,Monitor_table_start<0&&(Monitor_table_start=0);for(var e=0;e<Monitor_table_total;e++)$("#monitor_page_"+e).css("display","none"),e>=Monitor_table_start&&e<Monitor_table_start+5&&$("#monitor_page_"+e).css("display","block");0===Monitor_table_start?$("#monitor_page_prev").css("display","none"):$("#monitor_page_prev").css("display","block"),Monitor_table_start+5>=Monitor_table_total?$("#monitor_page_next").css("display","none"):$("#monitor_page_next").css("display","block"),show_monitor_page(Monitor_table_start)}}),monitor_page_click=function(){show_monitor_page(parseInt($(this).attr("number")))},e=0;e<a;e++)$("#monitor_page_"+e).on("click",monitor_page_click);Monitor_table_initialized=!0,show_monitor_page(0)}function show_monitor_page(e){$("#Table_Monitor").empty(),table_head="<thead><tr><th>站点名称 </th> <th>监控信息 </th></tr></thread>";var t=table_head;t+="<tbody>",sequence=e*table_row*2;for(var a=0;a<2*table_row;a++)sequence+a<monitor_map_list.length?(t+=0!==a%2?"<tr class='success' >":"<tr >",t=t+"<td>"+monitor_map_list[sequence+a].StatName+"</td><td id='Monitor_table_cell"+a+"' StatCode='"+monitor_map_list[sequence+a].StatCode+"'></td>",t+="</tr>"):(t+=0!==a%2?"<tr class='success'>":"<tr  >",t=t+"<td>--</td><td id='Monitor_table_cell"+a+"' DevCode='null'>--</td>",t+="</tr>");t+="</tbody>",$("#Table_Monitor").append(t),query_warning()}function build_monitor_message(e){var t="";if(null===e||void 0===e)return t;for(var a=0;a<e.length;a++)t=t+e[a].AlarmName+":","true"==e[a].WarningTarget&&(t+="<Strong style='color:red'>"),t=t+e[a].AlarmValue+" ","true"==e[a].WarningTarget&&(t+="</Strong>"),t=t+e[a].AlarmUnit+";";return t}function query_warning(){if(Monitor_table_initialized===!0){ajax_process=function(e){var t={action:"DevAlarm",StatCode:$("#Monitor_table_cell"+e).attr("StatCode")};jQuery.get(request_head,t,function(e){log(e);var t=JSON.parse(e),a="",o=t.StatCode;a="false"==t.status?"<Strong style='color:red'>未找到对应监控信息</Strong>":build_monitor_message(t.ret);for(var n=0;n<2*table_row;n++)if($("#Monitor_table_cell"+n).attr("StatCode")==o){$("#Monitor_table_cell"+n).empty(),$("#Monitor_table_cell"+n).append(a);break}})};for(var e=0;e<2*table_row&&null!==$("#Monitor_table_cell"+e).attr("StatCode");e++)ajax_process(e)}}function query_static_warning(){if(Monitor_Static_table_initialized===!0){var e={action:"GetStaticMonitorTable",id:usr.id};jQuery.get(request_head,e,function(e){log(e);var t=JSON.parse(e);if("false"==t.status)return void show_expiredModule();var a=(new Date).Format("yyyy-MM-dd_hhmmss");$("#MonitorFlashTime").empty(),$("#MonitorFlashTime").append("最后刷新时间："+a);var o,n=t.ColumnName,l=t.TableData,i="<thead> <tr><th></th>";for(o=0;o<n.length;o++)i=i+"<th>"+n[o]+"</th>";for(i+="</tr></thead>",i+="<tbody>",o=0;o<l.length;o++){i+="<tr>",i=i+"<td><button type='button' class='btn btn-default video_btn' StateCode='"+l[o][0]+"' ><em class='glyphicon glyphicon-play ' aria-hidden='true' ></em></button></td>";for(var r=0;r<l[o].length;r++)i=i+"<td>"+l[o][r]+"</td>";i+="</tr>"}i+="</tbody>",$("#MonitorQueryTable").empty(),$("#MonitorQueryTable").append(i),if_static_table_initialize&&$("#MonitorQueryTable").DataTable().destroy();$("#MonitorQueryTable").DataTable({scrollY:!1,scrollCollapse:!0,scrollX:!0,searching:!1,autoWidth:!0,lengthChange:!1,dom:"Bfrtip",buttons:[{extend:"excel",text:"导出到excel",filename:"MonitorData"+a}]});if_static_table_initialize=!0,video_btn_click=function(){var e=$(this).attr("StateCode");void 0!==e&&show_cameraModule(e)},$(".video_btn").on("click",video_btn_click)})}}function get_alarm_type_list(){var e={action:"AlarmType"};jQuery.get(request_head,e,function(e){log(e);var t=JSON.parse(e);return"false"==t.status?void show_expiredModule():void(alarm_type_list=t.typelist)})}function query_alarm(e,t,a){var o={action:"AlarmQuery",id:usr.id,StatCode:alarm_selected.StatCode,date:e,type:t};jQuery.get(request_head,o,function(e){log(e);var o=JSON.parse(e);if("false"==o.status)return void show_expiredModule();var n=(o.StatCode,o.date),l=(o.AlarmName,o.AlarmUnit),i=(o.WarningTarget,o.minute_alarm),r=o.hour_alarm,d=o.day_alarm,_=o.minute_head,s=o.hour_head,c=o.day_head;$("#Warning_"+t+"_day").css("display","block");var u=_.length-1;u>120&&(u=120),$("#"+t+"_canvas_day").highcharts({chart:{type:"areaspline",zoomType:"x"},title:{text:a+" 分钟值日志，日期："+n},legend:{layout:"vertical",align:"left",verticalAlign:"top",x:150,y:100,floating:!0,borderWidth:1,backgroundColor:Highcharts.theme&&Highcharts.theme.legendBackgroundColor||"#FFFFFF"},xAxis:{categories:_,max:u},scrollbar:{enabled:!0},yAxis:{title:{text:a}},tooltip:{shared:!0,valueSuffix:l},credits:{enabled:!1},plotOptions:{areaspline:{fillOpacity:.5}},series:[{name:alarm_selected.StatName,data:i,turboThreshold:1500}]}),$("#Warning_"+t+"_day").css("display","none"),$("#Warning_"+t+"_week").css("display","block"),u=s.length-1,u>120&&(u=120),$("#"+t+"_canvas_week").highcharts({chart:{type:"areaspline",zoomType:"x"},title:{text:a+" 小时平均值日志，周期： "+n+" 为截至的7天 "},legend:{layout:"vertical",align:"left",verticalAlign:"top",x:150,y:100,floating:!0,borderWidth:1,backgroundColor:Highcharts.theme&&Highcharts.theme.legendBackgroundColor||"#FFFFFF"},xAxis:{categories:s,max:u},scrollbar:{enabled:!0},yAxis:{title:{text:a}},tooltip:{shared:!0,valueSuffix:l},credits:{enabled:!1},plotOptions:{areaspline:{fillOpacity:.5}},series:[{name:alarm_selected.StatName,data:r,turboThreshold:1500}]}),$("#Warning_"+t+"_week").css("display","none"),$("#Warning_"+t+"_month").css("display","block"),u=c.length-1,u>30&&(u=30),$("#"+t+"_canvas_month").highcharts({chart:{type:"areaspline",zoomType:"x"},title:{text:a+" 日平均值日志，周期： "+n+" 为截至的30天 "},legend:{layout:"vertical",align:"left",verticalAlign:"top",x:150,y:100,floating:!0,borderWidth:1,backgroundColor:Highcharts.theme&&Highcharts.theme.legendBackgroundColor||"#FFFFFF"},xAxis:{categories:c,max:u},scrollbar:{enabled:!0},yAxis:{title:{text:a}},tooltip:{shared:!0,valueSuffix:l},credits:{enabled:!1},plotOptions:{areaspline:{fillOpacity:.5}},series:[{name:alarm_selected.StatName,data:d,turboThreshold:1500}]}),$("#Warning_"+t+"_month").css("display","none")})}function initializeAlarmMap(){get_project_list(),get_proj_point_list(),get_monitor_list(),get_alarm_type_list();var e=parseInt($("#WCMonitorViewMap").css("min-height").replace(/[^0-9]/gi,""));window.screen.availHeight/2>e&&(e=window.screen.availHeight/2),$("#WCMonitorViewMap").css("min-height",e+"px"),map_MPMonitor=new BMap.Map("WCMonitorViewMap"),map_MPMonitor.addControl(new BMap.NavigationControl),map_MPMonitor.enableScrollWheelZoom(),map_MPMonitor.centerAndZoom(usr.city,15),window.setTimeout(alarm_addMarker,wait_time_middle),window.setTimeout(build_alarm_tabs,wait_time_middle),alarm_map_initialized=!0}function build_alarm_tabs(){if(null!==alarm_type_list){$("#Alarm_chart_view_nav").empty(),$("#Alarm_Chart_content").empty();var e,t="",a="";for(e=0;e<alarm_type_list.length;e++){var o="",n="";0===e&&(o="class='active'",n=" in active"),t=t+"<li class='dropdown'><a href='#' id='Warning_"+alarm_type_list[e].id+"_tab' class='dropdown-toggle' data-toggle='dropdown'>"+alarm_type_list[e].name+" <b class='caret'></b></a><ul class='dropdown-menu' role='menu' aria-labelledby='Warning_"+alarm_type_list[e].id+"_tab''><li><a href='#Warning_"+alarm_type_list[e].id+"_day' "+o+" tabindex='-1' data-toggle='tab' id='Warning_"+alarm_type_list[e].id+"_tab_day' alarmid='"+alarm_type_list[e].id+"'>分钟报表（日）</a> </li><li><a href='#Warning_"+alarm_type_list[e].id+"_week' tabindex='-1' data-toggle='tab'  id='Warning_"+alarm_type_list[e].id+"_tab_week' alarmid='"+alarm_type_list[e].id+"'>小时报表（周）</a> </li><li><a href='#Warning_"+alarm_type_list[e].id+"_month' tabindex='-1' data-toggle='tab'  id='Warning_"+alarm_type_list[e].id+"_tab_month' alarmid='"+alarm_type_list[e].id+"'> 日报表（30天）</a> </li> </ul> </li>",a=a+"<div class='Alarm_Canvas' id='Warning_"+alarm_type_list[e].id+"_day' ><div id='"+alarm_type_list[e].id+"_canvas_day' class='Alarm_Canvas'></div></div><div class='Alarm_Canvas' id='Warning_"+alarm_type_list[e].id+"_week' ><div id='"+alarm_type_list[e].id+"_canvas_week' class='Alarm_Canvas' ></div></div><div class='Alarm_Canvas' id='Warning_"+alarm_type_list[e].id+"_month' ><div id='"+alarm_type_list[e].id+"_canvas_month' class='Alarm_Canvas' ></div></div>"}for($("#Alarm_chart_view_nav").append(t),$("#Alarm_Chart_content").append(a),Warning_tab_day_click=function(){hide_all_chart(),$("#Warning_"+$(this).attr("alarmid")+"_day").css("display","block")},Warning_tab_week_click=function(){hide_all_chart(),$("#Warning_"+$(this).attr("alarmid")+"_week").css("display","block")},Warning_tab_month_click=function(){hide_all_chart(),$("#Warning_"+$(this).attr("alarmid")+"_month").css("display","block")},e=0;e<alarm_type_list.length;e++)$("#Warning_"+alarm_type_list[e].id+"_tab_day").on("click",Warning_tab_day_click),$("#Warning_"+alarm_type_list[e].id+"_tab_week").on("click",Warning_tab_week_click),$("#Warning_"+alarm_type_list[e].id+"_tab_month").on("click",Warning_tab_month_click);hide_all_chart(),$(window).resize()}}function hide_all_chart(){for(var e=0;e<alarm_type_list.length;e++)$("#Warning_"+alarm_type_list[e].id+"_day").css("display","none"),$("#Warning_"+alarm_type_list[e].id+"_week").css("display","none"),$("#Warning_"+alarm_type_list[e].id+"_month").css("display","none")}function unhide_all_chart(){for(var e=0;e<alarm_type_list.length;e++)$("#Warning_"+alarm_type_list[e].id+"_day").css("display","block"),$("#Warning_"+alarm_type_list[e].id+"_week").css("display","block"),$("#Warning_"+alarm_type_list[e].id+"_month").css("display","block")}function get_select_alarm(e){for(var t=e.split(":"),a=0;a<monitor_map_list.length;a++)if(monitor_map_list[a].StatCode==t[0])return void(alarm_selected=monitor_map_list[a]);alarm_selected=null}function get_alarmpointinfo_on_map(){null!==alarm_selected&&null!==alarm_map_handle&&(txt="<div id ='Element_card_floating'><p style='font-size:14px;' >站点名称："+alarm_selected.StatName+"</p><HR style='FILTER: alpha(opacity=100,finishopacity=0,style=3)' width='80%' color=#987cb9 SIZE=3/><div style='font-size:10px;' >站点地址："+alarm_selected.Address+"</div></div>",null!==alarm_map_handle&&alarm_map_handle.setContent(txt),$("#WCStatCode_Input").val(alarm_selected.StatName))}function alarm_addMarker(e){if(null!==monitor_map_list){var t=new BMap.Icon("./image/map-marker-ball-azure-small.png",new BMap.Size(32,32),{anchor:new BMap.Size(16,30)});alarm_mark_click=function(){get_select_alarm(this.getTitle());var e=this.getTitle(),t=new BMap.InfoWindow(e,{offset:new BMap.Size(0,(-23))});t.setWidth(400),alarm_map_handle=t,get_alarmpointinfo_on_map(),this.openInfoWindow(t),t.addEventListener("close",function(){alarm_map_handle==this&&(alarm_map_handle=null)})};for(var a=0;a<monitor_map_list.length;a++){var o=new BMap.Point(parseFloat(monitor_map_list[a].Longitude),parseFloat(monitor_map_list[a].Latitude)),n=new BMap.Marker(o,{icon:t});n.setTitle(monitor_map_list[a].StatCode+":"+monitor_map_list[a].StatName),map_MPMonitor.addOverlay(n),n.addEventListener("click",alarm_mark_click)}}}function Data_export_Normal(e,t,a,o){$("#TableQueryCondition").css("display","none"),$("#ExportTable").empty(),$("#TableExportTitle").text(e);var n={action:"TableQuery",TableName:t,Condition:a,Filter:o};jQuery.get(request_head,n,function(t){log(t);var a=JSON.parse(t);if("false"==a.status)return void show_expiredModule();ColumnName=a.ColumnName,TableData=a.TableData;var o,n="<thead> <tr>";for(o=0;o<ColumnName.length;o++)n=n+"<th>"+ColumnName[o]+"</th>";for(n+="</tr></thead>",n+="<tbody>",o=0;o<TableData.length;o++){n+="<tr>";for(var l=0;l<TableData[o].length;l++)n=n+"<td>"+TableData[o][l]+"</td>";n+="</tr>"}n+="</tbody>",$("#ExportTable").append(n),if_table_initialize&&$("#ExportTable").DataTable().destroy();$("#ExportTable").DataTable({scrollY:200,scrollCollapse:!0,scrollX:!0,searching:!1,autoWidth:!0,lengthChange:!1,dom:"Bfrtip",buttons:[{extend:"excel",text:"导出到excel",filename:e+(new Date).Format("yyyy-MM-dd_hhmmss")}]});if_table_initialize=!0,modal_middle($("#TableExportModule")),$("#TableExportModule").modal("show")})}function Data_export_alarm(){if_table_initialize&&($("#ExportTable").DataTable().destroy(),if_table_initialize=!1),$("#ExportTable").empty(),$("#TableQueryCondition").css("display","block"),$("#TableExportTitle").text("告警日志导出"),$("#QueryProjCode_choice").empty(),$("#QueryStatCode_choice").empty(),null!==alarm_selected?($("#QueryProjCode_choice").append(get_proj_option(alarm_selected.ProjCode)),get_proj_point_option($("#QueryProjCode_choice").val(),$("#QueryStatCode_choice"),alarm_selected.StatCode),$("#QueryStatCode_choice").val(alarm_selected.StatCode)):($("#QueryProjCode_choice").append(get_proj_option()),get_proj_point_option($("#QueryProjCode_choice").val(),$("#QueryStatCode_choice"),"")),$("#QueryStartTime_Input").val(get_yesterday()),$("#QueryEndTime_Input").val(get_yesterday()),modal_middle($("#TableExportModule")),$("#TableExportModule").modal("show")}function submit_alarm_query(){var e=$("#QueryStatCode_choice").val(),t=$("#QueryAlarm_choice").val(),a=$("#QueryStartTime_Input").val(),o=$("#QueryEndTime_Input").val();if(""===e)return void $("#QueryStatCode_choice").focus();var n=[],l={ConditonName:"UserId",Equal:usr.id,GEQ:"",LEQ:""};n.push(l),l={ConditonName:"StatCode",Equal:e,GEQ:"",LEQ:""},n.push(l),l={ConditonName:"AlarmType",Equal:t,GEQ:"",LEQ:""},n.push(l),l={ConditonName:"AlarmDate",Equal:"",GEQ:o,LEQ:a},n.push(l);var i={action:"TableQuery",TableName:"Alarmtable",Condition:n,Filter:[]};jQuery.get(request_head,i,function(e){log(e);var t=JSON.parse(e);if("false"==t.status)return void show_expiredModule();ColumnName=t.ColumnName,TableData=t.TableData,$("#ExportTable").empty();var a,o="<thead> <tr>";for(a=0;a<ColumnName.length;a++)o=o+"<th>"+ColumnName[a]+"</th>";for(o+="</tr></thead>",o+="<tbody>",a=0;a<TableData.length;a++){o+="<tr>";for(var n=0;n<TableData[a].length;n++)o=o+"<td>"+TableData[a][n]+"</td>";o+="</tr>"}o+="</tbody>",$("#ExportTable").append(o),if_table_initialize&&$("#ExportTable").DataTable().destroy();$("#ExportTable").DataTable({scrollY:200,scrollCollapse:!0,scrollX:!0,searching:!1,autoWidth:!0,lengthChange:!1,dom:"Bfrtip",buttons:[{extend:"excel",text:"导出到excel",filename:"日志数据导出"+$("#QueryStatCode_choice").text()+(new Date).Format("yyyy-MM-dd_hhmmss")}]});if_table_initialize=!0,modal_middle($("#TableExportModule")),$("#TableExportModule").modal("show")})}function get_sensor_list(){var e={action:"SensorList"};jQuery.get(request_head,e,function(e){log(e);var t=JSON.parse(e);return"false"==t.status?void show_expiredModule():void(sensor_list=t.SensorList)})}function get_device_sensor(e){var t={action:"DevSensor",DevCode:e};jQuery.get(request_head,t,function(e){log(e);var t=JSON.parse(e);return"false"==t.status?void show_expiredModule():void(device_selected_sensor=t.ret)})}function get_sensor_name(e){for(var t="未知传感器",a=0;a<sensor_list.length;a++)e==sensor_list[a].id&&(t=sensor_list[a].nickname);return t}function show_sensor_module(){if(null!==select_sensor){if($("#SensorExtraInfo").empty(),$("#SensorDevCode_Input").val(device_selected.DevCode),$("#SensorName_Input").val(get_sensor_name(select_sensor.id)),$("#SensorStatus_choice").val(select_sensor.status),0!==select_sensor.para.length){var e,t="";for(e=0;e<select_sensor.para.length;e++)t=t+"<div class='input-group '><span class='input-group-addon' style='min-width: 100px'>"+select_sensor.para[e].name+"</span><input type='text' class='form-control' placeholder='"+select_sensor.para[e].memo+"' aria-describedby='basic-addon1' id='SensorPara_"+select_sensor.para[e].name+"'/></div><p></p>";for($("#SensorExtraInfo").append(t),e=0;e<select_sensor.para.length;e++)$("#SensorPara_"+select_sensor.para[e].name).val(select_sensor.para[e].value)}modal_middle($("#SensorModal")),$("#SensorModal").modal("show")}}function submit_sensor_module(){if(null!==select_sensor){for(var e=[],t=0;t<select_sensor.para.length;t++){var a={name:select_sensor.para[t].name,value:$("#SensorPara_"+select_sensor.para[t].name).val()};e.push(a)}var o={action:"SensorUpdate",DevCode:device_selected.DevCode,SensorCode:select_sensor.id,status:$("#SensorStatus_choice").val(),ParaList:e};jQuery.get(request_head,o,function(e){log(e);var t=JSON.parse(e),a=t.status;"true"==a?(show_alarm_module(!1,"传感器修改成功！"),$("#SensorModal").modal("hide"),Initialize_dev_detail()):show_alarm_module(!0,"传感器修改失败！"+t.msg)})}}function get_user_message(){var e={action:"GetUserMsg",id:usr.id};jQuery.get(request_head,e,function(e){log(e);var t=JSON.parse(e),a=t.status;"true"==a?(usr_msg=t.msg,usr_ifdev=t.ifdev):show_alarm_module(!0,"获取用户信息失败，请重新登录！"+t.msg)})}function get_user_image(){var e={action:"GetUserImg",id:usr.id};jQuery.get(request_head,e,function(e){log(e);var t=JSON.parse(e),a=t.status;"true"==a?(usr_img=t.img,reflash_usr_img_table()):show_alarm_module(!0,"获取用户信息失败，请重新登录！"+t.msg)})}function clear_user_image(){var e={action:"ClearUserImg",id:usr.id};jQuery.get(request_head,e,function(e){log(e);var t=JSON.parse(e),a=t.status;"true"==a?(usr_img=[],reflash_usr_img_table()):show_alarm_module(!0,"获取用户信息失败，请重新登录！"+t.msg)})}function set_user_message(e,t){var a={action:"SetUserMsg",id:usr.id,msg:e,ifdev:t};jQuery.get(request_head,a,function(e){log(e);var t=JSON.parse(e),a=t.status;"true"==a?show_alarm_module(!0,"屏保欢迎语设置成功！"+t.msg):show_alarm_module(!0,"获取用户信息失败，请重新登录！"+t.msg)})}function show_usr_msg_module(){$("#UsrMsg_Input").val(usr_msg),$("#UsrDev_choice").val(usr_ifdev),reflash_usr_img_table(),$("#file-zh").fileinput({language:"zh",uploadUrl:upload_url+"?id="+usr.id,allowedFileExtensions:["jpg","png","gif"],showPreview:!0}),modal_middle($("#UsrMsgModal")),$("#UsrMsgModal").modal("show")}function reflash_usr_img_table(){$("#UsrImgTable").empty();for(var e="<thead> <tr> <th> 已上传文件</th> </tr> </thead> <tbody >",t=0;t<usr_img.length;t++)e=e+"<tr> <td>"+usr_img[t].name+"</td></tr>";$("#UsrImgTable").append(e)}function user_message_update(){var e={action:"SetUserMsg",id:usr.id,msg:$("#UsrMsg_Input").val(),ifdev:$("#UsrDev_choice").val()};jQuery.get(request_head,e,function(e){log(e);var t=JSON.parse(e),a=t.status;"true"==a?($("#UsrMsgModal").modal("hide"),show_alarm_module(!0,"屏保欢迎语设置成功！"+t.msg)):show_alarm_module(!0,"获取用户信息失败，请重新登录！"+t.msg)})}function change_camera_status(e,t,a){var o="当前：水平="+e+"/垂直="+t+"；调节单位：水平="+camera_unit_h+"/垂直="+camera_unit_v;$("#VideoModuleCameraState_Input").val(o),$("#video_img").attr("src",a)}function get_camera_unit(){var e={action:"GetCameraUnit"};jQuery.get(request_head,e,function(e){log(e);var t=JSON.parse(e),a=t.status;"true"==a?(camera_unit_h=t.ret.h,camera_unit_v=t.ret.v):show_alarm_module(!0,"获取摄像头基本单位，请重新登录！"+t.msg)})}function get_camera_status(e){var t={action:"GetCameraStatus",StatCode:e,id:usr.id};jQuery.get(request_head,t,function(e){log(e);var t=JSON.parse(e),a=t.status;"true"==a?change_camera_status(t.ret.h,t.ret.v,t.ret.url):show_alarm_module(!0,"获取摄像头基本单位，请重新登录！"+t.msg)})}function move_camera(e,t,a){var o;o="v"==t?{action:"CameraVAdj",StatCode:e,id:usr.id,adj:a}:{action:"CameraHAdj",StatCode:e,id:usr.id,adj:a},jQuery.get(request_head,o,function(e){log(e);var t=JSON.parse(e),a=t.status;"true"==a?change_camera_status(t.ret.h,t.ret.v,t.ret.url):show_alarm_module(!0,"获取摄像头基本单位，请重新登录！"+t.msg)})}function show_cameraModule(e){modal_middle($("#VideoSelectionModule")),$("#VideoModuleStatCode_Input").val(e),$("#VideoModule_query_Input").val(""),$("#ModuleVCRStatus_choice").empty(),get_camera_status(e),$("#VideoSelectionModule").modal("show")}var basic_address=getRelativeURL()+"/";console.log(basic_address);var wait_time_long=1500,wait_time_middle=1e3,wait_time_short=500,cycle_time=6e4,request_head=basic_address+"request.php",jump_url=basic_address+"jump.php",upload_url=basic_address+"upload.php",screen_saver_address=basic_address+"screensaver/screen.html",usr;usr="";var admin="",keystr="",table_row=5,usr_msg="",usr_ifdev="true",usr_img=[],current_table,table_head,map_MPMonitor,map_initialized=!1,user_initial=!1,user_start=0,user_total=0,project_pg_list=null,user_table=null,user_selected,user_selected_auth,NewUserAuthDual2,user_module_status,pg_initial=!1,pg_start=0,pg_total=0,pg_table=null,pg_selected,pg_selected_proj,NewPGProjDual2,pg_module_status,project_list=null,project_initial=!1,project_start=0,project_total=0,project_table=null,project_selected,project_selected_device,project_module_status,parameter_initial=!1,software_version_list=null,point_initial=!1,point_start=0,point_total=0,point_table=null,point_selected,project_selected_point,point_module_status,point_list=null,device_initial=!1,device_start=0,device_total=0,device_table=null,device_selected,device_selected_sensor,device_module_status,monitor_map_list=null,monitor_handle,monitor_selected=null,monitor_list=null,monitor_string="",monitor_map_handle=null,Monitor_table_initialized=!1,Monitor_table_start=0,Monitor_table_total=0,Monitor_Static_table_initialized=!0,if_static_table_initialize=!1,alarm_type_list=null,alarm_map_initialized=!1,alarm_selected=null,alarm_map_handle=null,alarm_array=null,export_table_name=null,if_table_initialize=!1,sensor_list=null,select_sensor_devcode=null,select_sensor=null,camera_unit_h,camera_unit_v,CURRENT_URL="desktop",$BODY=$("body"),$MENU_TOGGLE=$("#menu_toggle"),$SIDEBAR_MENU=$("#sidebar-menu"),$SIDEBAR_FOOTER=$(".sidebar-footer"),$LEFT_COL=$(".left_col"),$RIGHT_COL=$(".right_col"),$NAV_MENU=$(".nav_menu"),$FOOTER=$("footer");$(document).ready(function(){var e=document.querySelectorAll(".cycle-menuItem");console.log("items="+e.length);for(var t=0,a=e.length;t<a;t++)e[t].style.left=(50-35*Math.cos(-.5*Math.PI-2*(1/a)*t*Math.PI)).toFixed(4)+"%",e[t].style.top=(50+35*Math.sin(-.5*Math.PI-2*(1/a)*t*Math.PI)).toFixed(4)-15*(t+1)+"%";document.querySelector(".cycle-circle").classList.toggle("open");var o=function(){$RIGHT_COL.css("min-height",$(window).height());var e=$BODY.outerHeight(),t=$FOOTER.outerHeight(),a=$LEFT_COL.eq(1).height()+$SIDEBAR_FOOTER.height(),o=e<a?a:e;o-=$NAV_MENU.outerHeight()+t,$RIGHT_COL.css("min-height",o)};$SIDEBAR_MENU.find("a").on("click",function(e){var t=$(this).parent();t.is(".active")?(t.removeClass("active active-sm"),$("ul:first",t).slideUp(function(){o()})):(t.parent().is(".child_menu")||($SIDEBAR_MENU.find("li").removeClass("active active-sm"),$SIDEBAR_MENU.find("li ul").slideUp()),t.addClass("active"),$("ul:first",t).slideDown(function(){o()}))}),$MENU_TOGGLE.on("click",function(){$BODY.hasClass("nav-md")?($SIDEBAR_MENU.find("li.active ul").hide(),$SIDEBAR_MENU.find("li.active").addClass("active-sm").removeClass("active")):($SIDEBAR_MENU.find("li.active-sm ul").show(),$SIDEBAR_MENU.find("li.active-sm").addClass("active").removeClass("active-sm")),$BODY.toggleClass("nav-md nav-sm"),o()}),$SIDEBAR_MENU.find('a[href="#"]').on("click",function(){$BODY.hasClass("nav-md")||$(this).parent().parent().slideUp()}),$(window).smartresize(function(){o()}),o(),$.fn.mCustomScrollbar&&$(".menu_fixed").mCustomScrollbar({autoHideScrollbar:!0,theme:"minimal",mouseWheel:{preventDefault:!0}})}),function(e,t){var a=function(e,t,a){var o;return function(){function n(){a||e.apply(l,i),o=null}var l=this,i=arguments;o?clearTimeout(o):a&&e.apply(l,i),o=setTimeout(n,t||100)}};jQuery.fn[t]=function(e){return e?this.bind("resize",a(e)):this.trigger(t)}}(jQuery,"smartresize"),window.onload=function(){},$(document).ready(function(){$("[data-toggle='modal']").click(function(){var e=$(this).attr("data-target");t=setTimeout(function(){var t=$(e).find(".modal-dialog");t.animate({"margin-top":parseInt(($(window).height()-t.height())/2)},300)},wait_time_short)}),$(".form_date").datetimepicker({language:"zh-CN",weekStart:1,todayBtn:1,autoclose:1,todayHighlight:1,startView:2,minView:2,forceParse:0}),NewUserAuthDual2=$(".NewUserAuthDual").bootstrapDualListbox({nonSelectedListLabel:"全部项目（组）",selectedListLabel:"用户权限",preserveSelectionOnMove:"moved",moveOnSelect:!0,nonSelectedFilter:"",showFilterInputs:!1,infoText:""}),$("#showValue").click(function(){alert($('[name="duallistbox_demo1"]').val())}),NewPGProjDual2=$(".NewPGProjDual").bootstrapDualListbox({nonSelectedListLabel:"全部项目",selectedListLabel:"本组包含",preserveSelectionOnMove:"moved",moveOnSelect:!0,nonSelectedFilter:"",showFilterInputs:!1,infoText:""}),DevUpdateDual2=$(".DevUpdateAuthDual").bootstrapDualListbox({nonSelectedListLabel:"当前设备",selectedListLabel:"需要升级",preserveSelectionOnMove:"moved",moveOnSelect:!0,nonSelectedFilter:"",showFilterInputs:!1,infoText:""}),$("#Desktop").css("min-height",window.screen.availHeight-300),$("#Undefined").css("min-height",window.screen.availHeight-300);setInterval(get_monitor_warning_on_map,cycle_time),setInterval(query_warning,cycle_time);PageInitialize(),$("#menu_logout").on("click",function(){logout()}),$("#UserManage").on("click",function(){CURRENT_URL="UserManage",active_menu("UserManage"),touchcookie(),user_manager()}),$("#PGManage").on("click",function(){CURRENT_URL="PGManage",active_menu("PGManage"),touchcookie(),pg_manage()}),$("#ProjManage").on("click",function(){CURRENT_URL="ProjManage",active_menu("ProjManage"),touchcookie(),proj_manage()}),$("#ParaManage").on("click",function(){CURRENT_URL="ParaManage",active_menu("ParaManage"),touchcookie(),para_manage()}),$("#MPManage").on("click",function(){CURRENT_URL="MPManage",active_menu("MPManage"),touchcookie(),mp_manage()}),$("#DevManage").on("click",function(){CURRENT_URL="DevManage",active_menu("DevManage"),touchcookie(),dev_manage()}),$("#MPMonitor").on("click",function(){CURRENT_URL="MPMonitor",active_menu("MPMonitor"),touchcookie(),mp_monitor()}),$("#MPMonitorTable").on("click",function(){CURRENT_URL="MPMonitorTable",active_menu("MPMonitorTable"),touchcookie(),mp_monitor_table()}),$("#MPMonitorCard").on("click",function(){CURRENT_URL="MPMonitorCard",active_menu("MPMonitorCard"),touchcookie(),mp_monitor_card()}),$("#MPStaticMonitorTable").on("click",function(){CURRENT_URL="MPStaticMonitorTable",active_menu("MPStaticMonitorTable"),touchcookie(),mp_static_monitor_table()}),$("#WarningCheck").on("click",function(){CURRENT_URL="WarningCheck",active_menu("WarningCheck"),touchcookie(),warning_check()}),$("#WarningHandle").on("click",function(){CURRENT_URL="WarningHandle",active_menu("WarningHandle"),touchcookie(),warning_handle()}),$("#InstConf").on("click",function(){CURRENT_URL="InstConf",active_menu("InstConf"),touchcookie(),Inst_Conf()}),$("#InstRead").on("click",function(){CURRENT_URL="InstRead",active_menu("InstRead"),touchcookie(),Inst_Read()}),$("#InstDesign").on("click",function(){CURRENT_URL="InstDesign",active_menu("InstDesign"),touchcookie(),Inst_Design()}),$("#InstControl").on("click",function(){CURRENT_URL="InstControl",active_menu("InstControl"),touchcookie(),Inst_Control()}),$("#InstSnapshot").on("click",function(){CURRENT_URL="InstSnapshot",active_menu("InstSnapshot"),touchcookie(),Inst_Snapshot()}),$("#InstVideo").on("click",function(){CURRENT_URL="InstVideo",active_menu("InstVideo"),touchcookie(),Inst_Video()}),$("#AuditTarget").on("click",function(){CURRENT_URL="AuditTarget",active_menu("AuditTarget"),touchcookie(),Audit_Target()}),$("#AuditStability").on("click",function(){CURRENT_URL="AuditStability",active_menu("AuditStability"),touchcookie(),Audit_Stability()}),$("#AuditAvailability").on("click",function(){CURRENT_URL="AuditAvailability",active_menu("AuditAvailability"),touchcookie(),Audit_Availability()}),$("#AuditError").on("click",function(){CURRENT_URL="AuditError",active_menu("AuditError"),touchcookie(),Audit_Error()}),$("#AuditQuality").on("click",function(){CURRENT_URL="AuditQuality",active_menu("AuditQuality"),touchcookie(),Audit_Quality()}),$("#GeoInfoQuery").on("click",function(){CURRENT_URL="GeoInfoQuery",active_menu("GeoInfoQuery"),touchcookie(),Geo_InfoQuery()}),$("#GeoTrendAnalysis").on("click",function(){CURRENT_URL="GeoTrendAnalysis",active_menu("GeoTrendAnalysis"),touchcookie(),
Geo_TrendAnalysis()}),$("#GeoDisaterForecast").on("click",function(){CURRENT_URL="GeoDisaterForecast",active_menu("GeoDisaterForecast"),touchcookie(),Geo_DisaterForecast()}),$("#GeoEmergencyDirect").on("click",function(){CURRENT_URL="GeoEmergencyDirect",active_menu("GeoEmergencyDirect"),touchcookie(),Geo_EmergencyDirect()}),$("#GeoDiffusionAnalysis").on("click",function(){CURRENT_URL="GeoDiffusionAnalysis",active_menu("GeoDiffusionAnalysis"),touchcookie(),Geo_DiffusionAnalysis()}),$("#WorkflowDesign").on("click",function(){CURRENT_URL="WorkflowDesign",active_menu("WorkflowDesign"),touchcookie(),Work_flowDesign()}),$("#OrderManagement").on("click",function(){CURRENT_URL="OrderManagement",active_menu("OrderManagement"),touchcookie(),Order_Management()}),$("#UnloadingManagement").on("click",function(){CURRENT_URL="UnloadingManagement",active_menu("UnloadingManagement"),touchcookie(),Unloading_Management()}),$("#OrderAudit").on("click",function(){CURRENT_URL="OrderAudit",active_menu("OrderAudit"),touchcookie(),Order_Audit()}),$("#ADConf").on("click",function(){CURRENT_URL="ADConf",active_menu("ADConf"),touchcookie(),AD_Conf()}),$("#WEBConf").on("click",function(){CURRENT_URL="WEBConf",active_menu("WEBConf"),touchcookie(),WEB_Conf()}),$("#UserfreshButton").on("click",function(){touchcookie(),clear_user_detail_panel(),user_intialize(0)}),$("#UserExportButton").on("click",function(){touchcookie();var e=[],t={ConditonName:"UserId",Equal:usr.id,GEQ:"",LEQ:""};e.push(t),Data_export_Normal("用户表导出","usertable",e,[])}),$("#UserNewButton").on("click",function(){touchcookie(),show_new_user_module()}),$("#UserDelButton").on("click",function(){touchcookie(),null===user_selected?show_alarm_module(!0,"请选择一个用户"):(modal_middle($("#UserDelAlarm")),$("#UserDelAlarm").modal("show"))}),$("#UserModifyButton").on("click",function(){touchcookie(),null===user_selected?show_alarm_module(!0,"请选择一个用户"):show_mod_user_module(user_selected,user_selected_auth)}),$("#delUserCommit").on("click",function(){del_user(user_selected.id),touchcookie()}),$("#newUserCommit").on("click",function(){user_module_status?(submit_new_user_module(),touchcookie()):(submit_mod_user_module(),touchcookie())}),$("#PGfreshButton").on("click",function(){touchcookie(),clear_pg_detail_panel(),pg_intialize(0)}),$("#PGExportButton").on("click",function(){touchcookie();var e=[],t={ConditonName:"UserId",Equal:usr.id,GEQ:"",LEQ:""};e.push(t),Data_export_Normal("项目群表导出","PGtable",e,[])}),$("#PGNewButton").on("click",function(){touchcookie(),show_new_pg_module()}),$("#PGDelButton").on("click",function(){touchcookie(),null===pg_selected?show_alarm_module(!0,"请选择一个项目组"):(modal_middle($("#PGDelAlarm")),$("#PGDelAlarm").modal("show"))}),$("#PGModifyButton").on("click",function(){touchcookie(),null===pg_selected?show_alarm_module(!0,"请选择一个项目组"):show_mod_pg_module(pg_selected,pg_selected_proj)}),$("#delPGCommit").on("click",function(){del_pg(pg_selected.PGCode),touchcookie()}),$("#newPGCommit").on("click",function(){pg_module_status?(submit_new_pg_module(),touchcookie()):(submit_mod_pg_module(),touchcookie())}),$("#ProjfreshButton").on("click",function(){touchcookie(),clear_proj_detail_panel(),proj_intialize(0)}),$("#ProjExportButton").on("click",function(){touchcookie();var e=[],t={ConditonName:"UserId",Equal:usr.id,GEQ:"",LEQ:""};e.push(t),Data_export_Normal("项目表导出","Projtable",e,[])}),$("#ProjNewButton").on("click",function(){touchcookie(),show_new_proj_module()}),$("#ProjDelButton").on("click",function(){touchcookie(),null===project_selected?show_alarm_module(!0,"请选择一个项目"):(modal_middle($("#ProjDelAlarm")),$("#ProjDelAlarm").modal("show"))}),$("#ProjModifyButton").on("click",function(){touchcookie(),null===project_selected?show_alarm_module(!0,"请选择一个项目"):show_mod_proj_module(project_selected)}),$("#delProjCommit").on("click",function(){del_proj(project_selected.ProjCode),touchcookie()}),$("#newProjCommit").on("click",function(){project_module_status?(submit_new_proj_module(),touchcookie()):(submit_mod_proj_module(),touchcookie())}),$("#PointfreshButton").on("click",function(){touchcookie(),clear_point_detail_panel(),point_intialize(0)}),$("#PointExportButton").on("click",function(){touchcookie();var e=[],t={ConditonName:"UserId",Equal:usr.id,GEQ:"",LEQ:""};e.push(t),Data_export_Normal("监测点导出","Pointtable",e,[])}),$("#PointNewButton").on("click",function(){touchcookie(),show_new_point_module()}),$("#PointDelButton").on("click",function(){touchcookie(),null===point_selected?show_alarm_module(!0,"请选择一个监测点"):(modal_middle($("#PointDelAlarm")),$("#PointDelAlarm").modal("show"))}),$("#PointModifyButton").on("click",function(){touchcookie(),null===point_selected?show_alarm_module(!0,"请选择一个监测点"):show_mod_point_module(point_selected)}),$("#delPointCommit").on("click",function(){del_point(point_selected.StatCode),touchcookie()}),$("#newPointCommit").on("click",function(){point_module_status?(submit_new_point_module(),touchcookie()):(submit_mod_point_module(),touchcookie())}),$("#DevfreshButton").on("click",function(){touchcookie(),clear_dev_detail_panel(),dev_intialize(0)}),$("#DevExportButton").on("click",function(){touchcookie();var e=[],t={ConditonName:"UserId",Equal:usr.id,GEQ:"",LEQ:""};e.push(t),Data_export_Normal("设备表导出","Devtable",e,[])}),$("#DevNewButton").on("click",function(){touchcookie(),show_new_dev_module()}),$("#DevDelButton").on("click",function(){touchcookie(),null===device_selected?show_alarm_module(!0,"请选择一个设备"):(modal_middle($("#DevDelAlarm")),$("#DevDelAlarm").modal("show"))}),$("#DevModifyButton").on("click",function(){touchcookie(),null===device_selected?show_alarm_module(!0,"请选择一个设备"):show_mod_dev_module(device_selected)}),$("#delDevCommit").on("click",function(){del_dev(device_selected.DevCode),touchcookie()}),$("#newDevCommit").on("click",function(){device_module_status?(submit_new_dev_module(),touchcookie()):(submit_mod_dev_module(),touchcookie())}),$("#DevProjCode_choice").change(function(){get_proj_point_option($("#DevProjCode_choice").val(),$("#DevStatCode_choice"),"")}),$("#QueryProjCode_choice").change(function(){get_proj_point_option($("#QueryProjCode_choice").val(),$("#QueryStatCode_choice"),"")}),$("#AlarmQueryCommit").on("click",function(){if(touchcookie(),null===alarm_selected)return void $("#WCStatCode_Input").attr("placeholder","请先在地图上选择一个点");if(""===$("#Alarm_query_Input").val()||null===$("#Alarm_query_Input").val())return void $("#Alarm_query_Input").attr("placeholder","请输入日期");if(null!==alarm_type_list){unhide_all_chart();for(var e=0;e<alarm_type_list.length;e++)query_alarm($("#Alarm_query_Input").val(),alarm_type_list[e].id,alarm_type_list[e].name)}window.setTimeout(show_table_tags,wait_time_long)}),$("#Video_query_Input").change(function(){$("#Video_query_Input").val(date_compare_today($("#Video_query_Input").val())),video_selection_change()}),$("#VideoHour_choice").change(function(){video_selection_change()}),$("#VideoModuleHour_choice").change(function(){video_Module_selection_change()}),$("#VideoModule_query_Input").change(function(){video_Module_selection_change()}),$("#Alarm_query_Input").change(function(){$("#Alarm_query_Input").val(date_compare_today($("#Alarm_query_Input").val()))}),$("#AlarmExport").on("click",function(){touchcookie(),Data_export_alarm()}),$("#AlarmQuery_Commit").on("click",function(){touchcookie(),submit_alarm_query()}),$("#SensorUpdateCommit").on("click",function(){touchcookie(),submit_sensor_module()}),$("#ExpiredConfirm").on("click",function(){logout()}),$("#QueryStartTime_Input").change(function(){$("#QueryStartTime_Input").val(date_compare_today($("#QueryStartTime_Input").val())),""===$("#QueryEndTime_Input").val()?$("#QueryEndTime_Input").val($("#QueryStartTime_Input").val()):$("#QueryEndTime_Input").val(date_compare($("#QueryEndTime_Input").val(),$("#QueryStartTime_Input").val()))}),$("#QueryEndTime_Input").change(function(){""===$("#QueryStartTime_Input").val()?($("#QueryEndTime_Input").val(date_compare_today($("#QueryEndTime_Input").val())),$("#QueryStartTime_Input").val($("#QueryStartTime_Input").val())):$("#QueryEndTime_Input").val(date_compare($("#QueryEndTime_Input").val(),$("#QueryStartTime_Input").val()))}),$("#VCRshow").on("click",function(){var e=$("#VCRStatus_choice").val();""!==e&&video_windows(e)}),$("#ModuleVCRshow").on("click",function(){var e=$("#ModuleVCRStatus_choice").val();""!==e&&video_windows(e)}),$("#MonitorTableFlash").on("click",function(){query_static_warning()}),$("#menu_user_profile").on("click",function(){touchcookie(),show_usr_msg_module()}),$("#ScreenSaver").on("click",function(){null!==monitor_selected&&screen_windows()}),$("#UsrMsgCommit").on("click",function(){touchcookie(),user_message_update()}),$("#UsrImgClean").on("click",function(){touchcookie(),clear_user_image()}),$("#UsrImgFlash").on("click",function(){touchcookie(),get_user_image()}),$("#UpdateConfirm_button").on("click",function(){touchcookie(),update_version()}),$("#btn_camera_up").on("click",function(){var e=$("#VideoModuleStatCode_Input").val();void 0!==e&&""!==e&&move_camera(e,"v","1")}),$("#btn_camera_down").on("click",function(){var e=$("#VideoModuleStatCode_Input").val();void 0!==e&&""!==e&&move_camera(e,"v","-1")}),$("#btn_camera_right").on("click",function(){var e=$("#VideoModuleStatCode_Input").val();void 0!==e&&""!==e&&move_camera(e,"v","1")}),$("#btn_camera_left").on("click",function(){var e=$("#VideoModuleStatCode_Input").val();void 0!==e&&""!==e&&move_camera(e,"v","-1")}),clear_window(),desktop(),calculate_row(),clear_user_detail_panel(),clear_proj_detail_panel(),$(window).resize()});