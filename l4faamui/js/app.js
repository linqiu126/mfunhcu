function logout(){delCookie("Environmental.inspection.session"),window.location="http://"+window.location.host+basic_address+"login.html"}function video_windows(e){window.open("http://"+window.location.host+basic_address+"/video/video.html?id="+e,"监控录像","height=284, width=340, top=0, left=400,toolbar=no, menubar=no, scrollbars=no, resizable=no, location=no, status=no")}function screen_windows(){window.open("http://"+window.location.host+screen_saver_address+"?id="+usr.id+"&StatCode="+monitor_selected.StatCode,"屏幕保护","height=auto, width=auto")}function write_title(e,t){$("#page_title").empty(),$("#page_title").append("<h3>"+e+" <small>"+t+"</small></h3>")}function active_menu(e){$SIDEBAR_MENU.find("li.active").addClass("active-sm").removeClass("active"),$SIDEBAR_MENU.find("li").each(function(){$(this).removeClass("current-page")}),$SIDEBAR_MENU.find('a[id="'+e+'"]').parent("li").addClass("current-page")}function nav_check(){"true"==usr.admin?$("#Admin_menu").css("display","block"):$("#Admin_menu").css("display","none"),$("#Hello_label").text("您好："+usr.name);$(NaN);$("#Hello_label").append("<span class=' fa fa-angle-down'></span>")}function modal_middle(e){$BODY.hasClass("nav-md")||$MENU_TOGGLE.click(),setTimeout(function(){var t=$(e).find(".modal-dialog");parseInt(($(window).height()-t.height())/2)>0&&t.animate({"margin-top":parseInt(($(window).height()-t.height())/2)},300)},wait_time_short)}function on_collapse(e){touchcookie()}function PageInitialize(){get_user_information()}function hide_menu(){for(var e in usr.userauth.webauth)"false"==usr.userauth.webauth[e]&&$("#"+e).css("display","none");for(var t=$("#menu_monther li ul"),a=0;a<t.length;a++){for(var o=!0,i=0;i<t[a].children.length;i++)if("none"!=$(t[a].children[i].children[0]).css("display")){o=!1;break}o&&$($("#menu_monther").children("li")[a]).css("display","none")}}function get_user_information(){var e=getQueryString("session"),t={session:e},a={action:"UserInfo",type:"query",body:t,user:"null"},o=function(e){var t=e.status;"false"==t?show_alarm_module(!0,"获取用户失败，请联系管理员",null):(usr=e.ret,if_online=usr.online,if_online||(user_point=usr.point,console.log("user_point:"+user_point)),get_user_message(),get_user_image(),getgeographyinfo(),nav_check(),get_factory_list(),get_sensor_list(),get_camera_unit(),get_project_list(),get_proj_point_list(),get_monitor_list(),hide_menu(),getfavoritelist(),get_staff_name_list())};JQ_get(request_head,a,o)}function show_expiredModule(){modal_middle($("#ExpiredAlarm")),$("#ExpiredAlarm").modal("show")}function show_searchbar(e){global_key_word="",$("#CommonQueryInput").val(""),""!==e?$("#CommonQueryInput").attr("placeholder",e):$("#CommonQueryInput").attr("placeholder","查询..."),$("#QueryBar").css("display","block")}function hide_searchbar(){$("#QueryBar").css("display","none")}function calculate_row(){var e=($(window).height(),parseInt(($(window).height()-650)/100));e<=0?table_row=5:e>=5?table_row=10:table_row+=e}function show_table_tags(){$("#Warning_"+alarm_type_list[0].id+"_day").css("display","block")}function user_manager(){clear_window(),write_title("用户管理","根据您的权限对用户进行添加/删除/修改等操作"),$("#UserManageView").css("display","block"),show_searchbar(""),user_intialize(0)}function staff_manager(){clear_window(),write_title("员工管理","根据您的权限对用户进行添加/删除/修改等操作"),$("#StaffManageView").css("display","block"),show_searchbar("查询员工名或手机关键字..."),staff_intialize(0)}function factory_manager(){clear_window(),write_title("工厂管理","根据您的权限对用户进行添加/删除/修改等操作"),$("#FactoryManageView").css("display","block"),show_searchbar("查询工厂代码"),factory_intialize(0)}function specification_manager(){clear_window(),write_title("规格管理","根据您的权限对用户进行添加/删除/修改等操作"),$("#SpecificationManageView").css("display","block"),show_searchbar("查询员工名或手机关键字..."),specification_intialize(0)}function pg_manage(){clear_window(),write_title("项目组管理","根据您的权限对项目组进行添加/删除/修改等操作"),$("#PGManageView").css("display","block"),show_searchbar(""),pg_intialize(0)}function key_manage(){clear_window(),write_title("钥匙管理","根据您的权限对项目组进行添加/删除/修改等操作"),$("#KeyManageView").css("display","block"),show_searchbar(""),key_intialize(0)}function proj_manage(){clear_window(),write_title("项目管理","根据您的权限对项目进行添加/删除/修改等操作"),$("#ProjManageView").css("display","block"),show_searchbar(""),proj_intialize(0)}function para_manage(){clear_window(),write_title("参数管理","您可以在这里升级您的设备版本"),$("#ParaManageView").css("display","block"),hide_searchbar(),parameter_initial||parameter_initialize()}function mp_manage(){clear_window(),write_title("站点管理","根据您的权限对站点进行配置"),show_searchbar(""),$("#MPManageView").css("display","block"),point_intialize(0)}function dev_manage(){clear_window(),write_title("设备管理","根据您的权限对设备进行配置"),show_searchbar(""),$("#DevManageView").css("display","block"),dev_intialize(0)}function mp_monitor(){clear_window(),write_title("地图监控","在地图上对站点进行监控"),hide_searchbar(),$("#MPMonitorView").css("display","block"),initializeMap()}function mp_monitor_table(){clear_window(),write_title("站点聚合","实时刷新"),hide_searchbar(),$("#MPMonitorTableView").css("display","block"),Monitor_table_initialized||initialize_warning_table()}function mp_monitor_card(){clear_window(),write_title("站点列块","点选设备卡片以获得详细信息"),hide_searchbar(),$("#MPMonitorCardView").css("display","block")}function mp_static_monitor_table(){clear_window(),write_title("站点聚合","请手工刷新"),hide_searchbar(),$("#MPMonitorStaticTableView").css("display","block"),query_static_warning()}function warning_check(){clear_window(),write_title("告警查看","可以导出报表"),hide_searchbar(),$("#WarningCheckView").css("display","block"),alarm_map_initialized||initializeAlarmMap()}function warning_handle(){clear_window(),hide_searchbar(),$("#WarningHandleView").css("display","block"),write_title("告警处理","请查看报表"),query_warning_handle_list()}function desktop(){clear_window(),hide_searchbar(),write_title("欢迎","请选择您需要的功能"),$("#Desktop").css("display","block")}function Inst_Conf(){clear_window(),hide_searchbar(),write_title("施工中",""),$("#Undefined").css("display","block")}function Inst_Read(){clear_window(),hide_searchbar(),write_title("施工中",""),$("#Undefined").css("display","block")}function Inst_Design(){clear_window(),hide_searchbar(),write_title("施工中",""),$("#Undefined").css("display","block")}function Inst_Control(){clear_window(),hide_searchbar(),write_title("施工中",""),$("#Undefined").css("display","block")}function Inst_Snapshot(){clear_window(),hide_searchbar(),write_title("施工中",""),$("#Undefined").css("display","block")}function Inst_Video(){clear_window(),hide_searchbar(),write_title("施工中",""),$("#Undefined").css("display","block")}function Audit_Target(){clear_window(),hide_searchbar(),write_title("施工中",""),$("#Undefined").css("display","block")}function Audit_Stability(){clear_window(),hide_searchbar(),write_title("施工中",""),$("#Undefined").css("display","block")}function Audit_Availability(){clear_window(),hide_searchbar(),write_title("施工中",""),$("#Undefined").css("display","block")}function Audit_Error(){clear_window(),hide_searchbar(),write_title("施工中",""),$("#Undefined").css("display","block")}function Audit_Quality(){clear_window(),hide_searchbar(),write_title("施工中",""),$("#Undefined").css("display","block")}function Geo_InfoQuery(){clear_window(),hide_searchbar(),CURRENT_URL="Undefined",write_title("施工中",""),$("#Undefined").css("display","block")}function Geo_TrendAnalysis(){clear_window(),hide_searchbar(),CURRENT_URL="Undefined",write_title("施工中",""),$("#Undefined").css("display","block")}function Geo_DisaterForecast(){clear_window(),hide_searchbar(),CURRENT_URL="Undefined",write_title("施工中",""),$("#Undefined").css("display","block")}function Geo_EmergencyDirect(){clear_window(),hide_searchbar(),CURRENT_URL="Undefined",write_title("施工中",""),$("#Undefined").css("display","block")}function Geo_DiffusionAnalysis(){clear_window(),hide_searchbar(),CURRENT_URL="Undefined",write_title("施工中",""),$("#Undefined").css("display","block")}function Work_flowDesign(){clear_window(),hide_searchbar(),CURRENT_URL="Undefined",write_title("施工中",""),$("#Undefined").css("display","block")}function Order_Management(){clear_window(),hide_searchbar(),CURRENT_URL="Undefined",write_title("施工中",""),$("#Undefined").css("display","block")}function Unloading_Management(){clear_window(),hide_searchbar(),CURRENT_URL="Undefined",write_title("施工中",""),$("#Undefined").css("display","block")}function Order_Audit(){clear_window(),hide_searchbar(),CURRENT_URL="Undefined",write_title("施工中",""),$("#Undefined").css("display","block")}function AD_Conf(){clear_window(),hide_searchbar(),CURRENT_URL="Undefined",write_title("施工中",""),$("#Undefined").css("display","block")}function WEB_Conf(){clear_window(),hide_searchbar(),CURRENT_URL="Undefined",write_title("施工中",""),$("#Undefined").css("display","block")}function CABLE_Check(){clear_window(),hide_searchbar(),write_title("纤芯管理",""),$("#CableCheckView").css("display","block")}function RTU_Manage(){clear_window(),hide_searchbar(),write_title("RTU管理",""),$("#RTUManageView").css("display","block"),query_RTU_list()}function OTDR_Manage(){clear_window(),hide_searchbar(),write_title("OTDR管理",""),$("#OTDRManageView").css("display","block"),query_OTDR_list()}function key_auth(){clear_window(),hide_searchbar(),write_title("钥匙授权",""),$("#KeyAuthView").css("display","block"),key_auth_initialize()}function attendance_history(){clear_window(),hide_searchbar(),write_title("考勤历史查询","请输入查询条件"),$("#AttendanceHistoryView").css("display","block"),attendance_history_initialize()}function assemble_history(){clear_window(),hide_searchbar(),write_title("生产历史查询","请输入查询条件"),$("#AssembleHistoryView").css("display","block"),assemble_history_initialize()}function assemble_audit(){clear_window(),hide_searchbar(),write_title("生产统计查询","请输入查询条件"),$("#AssembleAuditView").css("display","block"),assemble_audit_initialize()}function attendance_audit(){clear_window(),hide_searchbar(),write_title("考勤统计查询","请输入查询条件"),$("#AttendanceAuditView").css("display","block"),attendance_audit_initialize()}function kpi_audit(){clear_window(),hide_searchbar(),write_title("绩效统计查询","请输入查询条件"),$("#KPIAuditView").css("display","block"),kpi_audit_initialize()}function key_history(){clear_window(),hide_searchbar(),write_title("开锁历史查询","请输入查询条件"),$("#KeyHistoryView").css("display","block"),key_history_initialize()}function export_table(){clear_window(),hide_searchbar(),write_title("报表导出","请输入查询条件"),$("#ExportTableView").css("display","block"),export_table_initialize()}function clear_window(){$("#UserManageView").css("display","none"),$("#StaffManageView").css("display","none"),$("#FactoryManageView").css("display","none"),$("#SpecificationManageView").css("display","none"),$("#PGManageView").css("display","none"),$("#ProjManageView").css("display","none"),$("#ParaManageView").css("display","none"),$("#MPManageView").css("display","none"),$("#DevManageView").css("display","none"),$("#MPMonitorView").css("display","none"),$("#MPMonitorTableView").css("display","none"),$("#MPMonitorCardView").css("display","none"),$("#MPMonitorStaticTableView").css("display","none"),$("#WarningCheckView").css("display","none"),$("#WarningHandleView").css("display","none"),$("#Desktop").css("display","none"),$("#Undefined").css("display","none"),$("#KeyManageView").css("display","none"),$("#KeyHistoryView").css("display","none"),$("#KeyAuthView").css("display","none"),$("#CableCheckView").css("display","none"),$("#RTUManageView").css("display","none"),$("#OTDRManageView").css("display","none"),$("#ExportTableView").css("display","none"),$("#AttendanceHistoryView").css("display","none"),$("#AssembleHistoryView").css("display","none"),$("#AssembleAuditView").css("display","none"),$("#AttendanceAuditView").css("display","none"),$("#KPIAuditView").css("display","none")}function get_staff_name_list(){var e={action:"StaffnameList",type:"query",user:usr.id},t=function(e){if("false"==e.status)return void show_expiredModule();staff_name_list=[];for(var t=0;t<e.ret.length;t++){var a={id:e.ret[t].id,name:e.ret[t].name,pinyin:"",pinyinnospace:""};$("#AssembleHideWord_Input").val(a.name),a.pinyin=$("#AssembleHideWord_Input").toPinyin(),a.pinyinnospace=a.pinyin.replace(/\s+/g,""),staff_name_list.push(a)}var o=function(e){return function(t,a){var o;o=[],substrRegex=new RegExp(t,"i"),$.each(e,function(e,t){(substrRegex.test(t.name)||substrRegex.test(t.pinyin)||substrRegex.test(t.pinyinnospace))&&o.push(t.name)}),a(o)}};$("#AssembleHistoryWord_Input").typeahead({hint:!0,highlight:!0,minLength:1,classNames:{input:"Typeahead-input",hint:"Typeahead-hint",selectable:"Typeahead-selectable"}},{name:"states",source:o(staff_name_list)}),$("#AssembleAuditWord_Input").typeahead({hint:!0,highlight:!0,minLength:1,classNames:{input:"Typeahead-input",hint:"Typeahead-hint",selectable:"Typeahead-selectable"}},{name:"states",source:o(staff_name_list)}),$("#AttendanceAuditWord_Input").typeahead({hint:!0,highlight:!0,minLength:1,classNames:{input:"Typeahead-input",hint:"Typeahead-hint",selectable:"Typeahead-selectable"}},{name:"states",source:o(staff_name_list)}),$("#KPIAuditWord_Input").typeahead({hint:!0,highlight:!0,minLength:1,classNames:{input:"Typeahead-input",hint:"Typeahead-hint",selectable:"Typeahead-selectable"}},{name:"states",source:o(staff_name_list)}),$("#AttendanceHistoryWord_Input").typeahead({hint:!0,highlight:!0,minLength:1,classNames:{input:"Typeahead-input",hint:"Typeahead-hint",selectable:"Typeahead-selectable"}},{name:"states",source:o(staff_name_list)}),$("#NewAttendanceName_Input").typeahead({hint:!0,highlight:!0,minLength:1,classNames:{input:"Typeahead-input",hint:"Typeahead-hint",selectable:"Typeahead-selectable"}},{name:"states",source:o(staff_name_list)})};JQ_get(request_head,e,t)}function get_project_pg_list(){var e={action:"ProjectPGList",type:"query",user:usr.id},t=function(e){return"false"==e.status?void show_expiredModule():void(project_pg_list=e.ret)};JQ_get(request_head,e,t)}function get_user_table(e,t){var a={startseq:e,length:t,keyword:global_key_word},o={action:"UserTable",type:"query",body:a,user:usr.id},i=function(e){return"false"==e.status?void show_expiredModule():(user_table=e.ret.usertable,user_start=parseInt(e.ret.start),user_total=parseInt(e.ret.total),void draw_user_table_head())};JQ_get(request_head,o,i)}function del_user(e){var t={userid:e},a={action:"UserDel",type:"mod",body:t,user:usr.id},o=function(e){var t=e.status;"true"==t?(del_user_flash=function(){clear_user_detail_panel(),user_intialize(0)},setTimeout(function(){show_alarm_module(!1,"删除成功！",del_user_flash)},500)):setTimeout(function(){show_alarm_module(!0,"删除失败！"+e.msg,null)},500)};JQ_get(request_head,a,o),$("#UserDelAlarm").modal("hide")}function new_user(e,t){var a={name:e.name,nickname:e.nickname,password:e.password,mobile:e.mobile,mail:e.mail,type:e.type,memo:e.memo,auth:t},o={action:"UserNew",type:"mod",body:a,user:usr.id},i=function(e){var t=e.status;"true"==t?($("#newUserModal").modal("hide"),create_user_flash=function(){clear_user_detail_panel(),user_intialize(0)},setTimeout(function(){show_alarm_module(!1,"创建成功！",create_user_flash)},500)):setTimeout(function(){show_alarm_module(!0,"创建失败！"+e.msg,null)},500)};JQ_get(request_head,o,i)}function modify_user(e,t){var a={userid:e.id,name:e.name,nickname:e.nickname,password:e.password,mobile:e.mobile,mail:e.mail,type:e.type,memo:e.memo,auth:t},o={action:"UserMod",type:"mod",body:a,user:usr.id},i=function(e){var t=e.status;"true"==t?($("#newUserModal").modal("hide"),mod_user_flash=function(){clear_user_detail_panel(),user_intialize(0)},setTimeout(function(){show_alarm_module(!1,"修改成功！",mod_user_flash)},500)):setTimeout(function(){show_alarm_module(!0,"修改失败！"+e.msg,null)},500)};JQ_get(request_head,o,i)}function get_user_proj(e){var t={userid:e},a={action:"UserProj",body:t,type:"query",user:usr.id},o=function(e){return"false"==e.status?void show_expiredModule():void(user_selected_auth=e.ret)};JQ_get(request_head,a,o)}function get_user_key(e){var t={userid:e},a={action:"UserKey",body:t,type:"query",user:usr.id},o=function(e){return"false"==e.status?void show_expiredModule():void(user_selected_key=e.ret)};JQ_get(request_head,a,o)}function user_intialize(e){user_initial=!0,user_table=null,get_user_table(e,5*table_row),get_project_pg_list()}function draw_user_table_head(){if(null!==user_table){var e=Math.ceil(user_table.length/table_row);$("#User_Page_control").empty();var t,a="<li><a href='#' id='user_page_prev'>Prev</a></li>",o=Math.ceil(user_start/table_row);for(t=0;t<e;t++)a=a+"<li><a href='#' id='user_page_"+t+"'>"+(t+o+1)+"</a></li>";for(a+="<li><a href='#' id='user_page_next'>Next</a></li>",$("#User_Page_control").append(a),table_head="<thead><tr><th>序号</th><th>用户名</th><th>昵称</th><th>电话</th><th>属性</th><th>更新日期</th>",table_head+="</tr></thread>",click_draw_user_table=function(){draw_user_table($(this))},t=0;t<e;t++)$("#user_page_"+t).on("click",click_draw_user_table);user_start<=0?$("#user_page_prev").css("display","none"):($("#user_page_prev").css("display","block"),$("#user_page_prev").on("click",function(){var e=user_start-5*table_row;e<0&&(e=0),user_intialize(e)})),user_start+5*table_row>=user_total?$("#user_page_next").css("display","none"):($("#user_page_next").css("display","block"),$("#user_page_next").on("click",function(){user_intialize(user_start+5*table_row)})),draw_user_table($("#user_page_0"))}}function get_user_level(e){return"0"==e?"管理员":"1"==e?"市级网管":"2"==e?"区级网管":"3"==e?"市级代维":"4"==e?"区级代维":"未知级别"}function draw_user_table(e){if($("#Table_user").empty(),null!==user_table){var t=(parseInt(e.html())-1)*table_row-user_start,a=table_head;a+="<tbody>";var o;for(o=0;o<table_row;o++)t+o<user_table.length?(a=0!==o%2?a+"<tr class='success li_menu' id='table_cell"+o+"' userid='"+user_table[t+o].id+"'>":a+"<tr class='li_menu' id='table_cell"+o+"' userid='"+user_table[t+o].id+"'>",a=a+"<td>"+user_table[t+o].id+"</td><td>"+user_table[t+o].name+"</td><td>"+user_table[t+o].nickname+"</td><td>"+user_table[t+o].mobile+"</td>",a=a+"<td>"+get_user_level(user_table[t+o].type)+"</td>",a=a+"<td>"+user_table[t+o].date+"</td>",a+="</tr>"):(a=0!==o%2?a+"<tr class='success' id='table_cell"+o+"' userid='null'>":a+"<tr  id='table_cell"+o+"' userid='null'>",a+="<td>--</td><td>--</td><td>--</td><td>--</td><td>--</td><td>--</td>",a+="</tr>");for(a+="</tbody>",$("#Table_user").append(a),table_cell_click=function(){if("null"!=$(this).attr("userid")){for(var e=0;e<user_table.length;e++)if($(this).attr("userid")==user_table[e].id){user_selected=user_table[e];break}Initialize_user_detail(),touchcookie()}},o=0;o<table_row;o++)$("#table_cell"+o).on("click",table_cell_click)}}function Initialize_user_detail(){draw_user_detail_panel(),get_user_key(user_selected.id),get_user_proj(user_selected.id)}function clear_user_detail_panel(){user_selected=null;var e="<p></p><p></p><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt >用户名：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt >用户类型：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt >联系方式：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd></dl></div><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt>用户昵称：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt>修改日期：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt>邮箱：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd></dl></div><div class='col-md-12 col-sm-12 col-xs-12 column'><dl ><dt>备注：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd></dl></div>";$("#Label_user_detail").empty(),$("#Label_user_detail").append(e),$("#Table_user_authed").empty(),$("#Table_user_key").empty()}function draw_user_detail_panel(){if($("#Label_user_detail").empty(),null!==user_selected_auth){var e=get_user_level(user_selected.type),t="<p></p><p></p><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt >用户名：</dt><dd>"+user_selected.name+"</dd><dt >用户类型：</dt><dd>"+e+"</dd><dt >联系方式：</dt><dd>"+user_selected.mobile+"</dd></dl></div><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt>用户昵称：</dt><dd>"+user_selected.nickname+"</dd><dt>修改日期：</dt><dd>"+user_selected.date+"</dd><dt>邮箱：</dt><dd>"+user_selected.mail+"</dd></dl></div><div class='col-md-12 col-sm-12 col-xs-12 column'><dl ><dt>备注：</dt><dd>"+user_selected.memo+"</dd></dl></div>";$("#Label_user_detail").append(t)}}function draw_user_detail_proj_table(){$("#Table_user_authed").empty(),txt="<thead> <tr> <th>已关联项目 </th> </tr> </thead> <tbody >";for(var e=0;e<user_selected_auth.length;e++)txt=txt+"<tr> <td>"+user_selected_auth[e].name+"</td> </tr>";txt+="</tbody>",$("#Table_user_authed").append(txt)}function draw_user_detail_key_table(){$("#Table_user_key").empty(),txt="<thead> <tr> <th>钥匙名称 </th> <th>归属项目 </th></tr> </thead> <tbody >",null===user_selected_key&&(user_selected_key=[]);for(var e=0;e<user_selected_key.length;e++)txt=txt+"<tr id='"+user_selected_key[e].id+"' class='keyrow'> <td>"+user_selected_key[e].name+"</td> <td>"+user_selected_key[e].domain+"</td></tr>";txt+="</tbody>",$("#Table_user_key").append(txt),$(".keyrow").on("click",function(){var e=$(this).attr("id");void 0!==e&&""!==e&&get_key_auth_list(e)})}function show_new_user_module(){$("#newModalLabel").text("创建新用户"),user_module_status=!0,$("#NewUsername_Input").val(""),$("#NewUserNick_Input").val(""),$("#NewPassword_Input").val(""),$("#NewRePassword_Input").val(""),$("#NewUserMobile_Input").val(""),$("#NewUserMail_Input").val(""),$("#NewUserMemo_Input").val(""),$("#NewUserType_choice").val("false"),$("#NewUsername_Input").attr("placeholder","用户名"),$("#NewPassword_Input").attr("placeholder","密码"),$("#NewRePassword_Input").attr("placeholder","重复密码"),$("#NewUserMobile_Input").attr("placeholder","电话号码"),$("#NewUserMail_Input").attr("placeholder","邮箱"),modal_middle($("#newUserModal")),$("#newUserModal").modal("show")}function submit_new_user_module(){var e=$("#NewUsername_Input").val(),t=$("#NewUserNick_Input").val(),a=$("#NewPassword_Input").val(),o=$("#NewRePassword_Input").val(),i=$("#NewUserMobile_Input").val(),n=$("#NewUserMail_Input").val(),l=$("#NewUserMemo_Input").val();if(null===e||""===e)return $("#NewUsername_Input").attr("placeholder","用户名不能为空"),void $("#NewUsername_Input").focus();if(null===a||""===a)return $("#NewPassword_Input").attr("placeholder","密码不能为空"),$("#NewRePassword_Input").attr("placeholder","密码不能为空"),void $("#NewPassword_Input").focus();if(a!=o)return $("#NewPassword_Input").val(""),$("#NewRePassword_Input").val(""),$("#NewPassword_Input").attr("placeholder","密码不正确，请重新输入"),$("#NewRePassword_Input").attr("placeholder","密码不正确，请重新输入"),void $("#NewPassword_Input").focus();if(null===i||""===i)return $("#NewUserMobile_Input").attr("placeholder","电话号码不能为空"),void $("#NewUserMobile_Input").focus();if(null===n||""===n)return $("#NewUserMail_Input").attr("placeholder","邮箱不能为空"),void $("#NewUserMail_Input").focus();var d={name:e,nickname:t,password:b64_sha1(o),mobile:i,mail:n,type:$("#NewUserType_choice").val(),memo:l},r=[];new_user(d,r)}function show_mod_user_module(e,t){$("#newModalLabel").text("用户信息修改：密码栏不输入表示不修改密码"),user_module_status=!1,$("#NewUsername_Input").val(e.name),$("#NewUserNick_Input").val(e.nickname),$("#NewPassword_Input").val(""),$("#NewRePassword_Input").val(""),$("#NewUserMobile_Input").val(e.mobile),$("#NewUserMail_Input").val(e.mail),$("#NewUserMemo_Input").val(e.memo),$("#NewUsername_Input").attr("placeholder","用户名"),$("#NewPassword_Input").attr("placeholder","密码"),$("#NewRePassword_Input").attr("placeholder","重复密码"),$("#NewUserMobile_Input").attr("placeholder","电话号码"),$("#NewUserMail_Input").attr("placeholder","邮箱"),$("#NewUserType_choice").val(e.type),modal_middle($("#newUserModal")),$("#newUserModal").modal("show")}function submit_mod_user_module(){var e=$("#NewUsername_Input").val(),t=$("#NewUserNick_Input").val(),a=$("#NewPassword_Input").val(),o=$("#NewRePassword_Input").val(),i=$("#NewUserMobile_Input").val(),n=$("#NewUserMail_Input").val(),l=$("#NewUserMemo_Input").val();if(""!==a&&""!==o&&a!=o)return $("#NewPassword_Input").val(""),$("#NewRePassword_Input").val(""),$("#NewPassword_Input").attr("placeholder","密码不正确，请重新输入"),$("#NewRePassword_Input").attr("placeholder","密码不正确，请重新输入"),void $("#NewPassword_Input").focus();""!==o&&(o=b64_sha1(o));var d={id:user_selected.id,name:e,nickname:t,password:o,mobile:i,mail:n,type:$("#NewUserType_choice").val(),memo:l},r=[];modify_user(d,r)}function get_staff_table(e,t){var a={startseq:e,length:t,keyword:global_key_word,containleave:default_staff_left_choice},o={action:"StaffTable",type:"query",body:a,user:usr.id};page_number=e;var i=function(e){return"false"==e.status?void show_expiredModule():(staff_table=e.ret.stafftable,staff_start=parseInt(e.ret.start),staff_total=parseInt(e.ret.total),void draw_staff_table_head())};JQ_get(request_head,o,i)}function del_staff(e){var t={staffid:e},a={action:"StaffDel",type:"mod",body:t,user:usr.id},o=function(e){var t=e.status;"true"==t?(del_staff_flash=function(){clear_staff_detail_panel(),staff_intialize(0)},setTimeout(function(){show_alarm_module(!1,"删除成功！",del_staff_flash)},500)):setTimeout(function(){show_alarm_module(!0,"删除失败！"+e.msg,null)},500)};JQ_get(request_head,a,o),$("#StaffDelAlarm").modal("hide")}function new_staff(e){var t={staffid:"",name:e.name,position:e.position,PJcode:e.PJcode,mobile:e.mobile,address:e.address,gender:e.gender,memo:e.memo,nickname:e.nickname,salary:e.salary,status:e.status,KPI:e.KPI,identify:e.identify,geoinfo:e.geoinfo,bank:e.bank,account:e.account,photo:e.photo},a={action:"StaffNew",type:"mod",body:t,user:usr.id},o=function(e){var t=e.status;"true"==t?($("#newStaffModal").modal("hide"),create_staff_flash=function(){clear_staff_detail_panel(),staff_intialize(0)},setTimeout(function(){show_alarm_module(!1,"创建成功！",create_staff_flash)},500)):setTimeout(function(){show_alarm_module(!0,"创建失败！"+e.msg,null)},500)};JQ_get(request_head,a,o)}function modify_staff(e){var t={staffid:e.staffid,name:e.name,position:e.position,PJcode:e.PJcode,mobile:e.mobile,address:e.address,gender:e.gender,memo:e.memo,status:e.status,nickname:e.nickname,salary:e.salary,KPI:e.KPI,identify:e.identify,geoinfo:e.geoinfo,bank:e.bank,account:e.account,photo:e.photo},a={action:"StaffMod",type:"mod",body:t,user:usr.id},o=function(e){var t=e.status;"true"==t?($("#newStaffModal").modal("hide"),mod_staff_flash=function(){clear_staff_detail_panel(),staff_intialize(page_number),null!==page_sequence&&setTimeout(function(){draw_staff_table(page_sequence)},1e3)},setTimeout(function(){show_alarm_module(!1,"修改成功！",mod_staff_flash)},500)):setTimeout(function(){show_alarm_module(!0,"修改失败！"+e.msg,null)},500)};JQ_get(request_head,a,o)}function staff_intialize(e){staff_initial=!0,staff_table=null,get_staff_table(e,5*table_row),clear_staff_detail_panel()}function draw_staff_table_head(){if(null!==staff_table){var e=Math.ceil(staff_table.length/table_row);$("#Staff_Page_control").empty();var t,a="<li><a href='#' id='staff_page_prev'>Prev</a></li>",o=Math.ceil(staff_start/table_row);for(t=0;t<e;t++)a=a+"<li><a href='#' id='staff_page_"+t+"'>"+(t+o+1)+"</a></li>";for(a+="<li><a href='#' id='staff_page_next'>Next</a></li>",$("#Staff_Page_control").append(a),table_head="<thead><tr><th>序号</th><th>员工名</th><th>性别</th><th>微信昵称</th><th>岗位</th><th>时薪</th>",table_head+="</tr></thread>",click_draw_staff_table=function(){page_sequence=$(this),draw_staff_table($(this))},t=0;t<e;t++)$("#staff_page_"+t).on("click",click_draw_staff_table);staff_start<=0?$("#staff_page_prev").css("display","none"):($("#staff_page_prev").css("display","block"),$("#staff_page_prev").on("click",function(){var e=staff_start-5*table_row;e<0&&(e=0),staff_intialize(e)})),staff_start+5*table_row>=staff_total?$("#staff_page_next").css("display","none"):($("#staff_page_next").css("display","block"),$("#staff_page_next").on("click",function(){staff_intialize(staff_start+5*table_row)})),draw_staff_table($("#staff_page_0"))}}function get_staff_gender(e){return"1"==e?"男":"2"==e?"女":"泰国人妖"}function get_staff_status(e){return"0"==e?"离职":"1"==e?"在职":"未知状态"}function draw_staff_table(e){if($("#Table_staff").empty(),null!==staff_table){var t=(parseInt(e.html())-1)*table_row-staff_start,a=table_head;a+="<tbody>";var o;for(o=0;o<table_row;o++)t+o<staff_table.length?(a=0!==o%2?a+"<tr class='success li_menu' id='staff_table_cell"+o+"' staffid='"+staff_table[t+o].id+"'>":a+"<tr class='li_menu' id='staff_table_cell"+o+"' staffid='"+staff_table[t+o].id+"'>",a=a+"<td>"+staff_table[t+o].id+"</td><td>"+staff_table[t+o].name+"</td>",a=a+"<td>"+get_staff_gender(staff_table[t+o].gender)+"</td><td>"+staff_table[t+o].nickname+"</td><td>"+staff_table[t+o].position+"</td><td>"+staff_table[t+o].salary+"</td>",a+="</tr>"):(a=0!==o%2?a+"<tr class='success' id='staff_table_cell"+o+"' staffid='null'>":a+"<tr  id='staff_table_cell"+o+"' staffid='null'>",a+="<td>--</td><td>--</td><td>--</td><td>--</td><td>--</td><td>--</td>",a+="</tr>");for(a+="</tbody>",$("#Table_staff").append(a),staff_table_cell_click=function(){if("null"!=$(this).attr("staffid")){for(var e=0;e<staff_table.length;e++)if($(this).attr("staffid")==staff_table[e].id){staff_selected=staff_table[e];break}Initialize_staff_detail(),touchcookie()}},o=0;o<table_row;o++)$("#staff_table_cell"+o).on("click",staff_table_cell_click)}}function Initialize_staff_detail(){draw_staff_detail_panel()}function clear_staff_detail_panel(){staff_selected=null;var e="<p></p><p></p><div class='col-md-8 col-sm-8 col-xs-12 column'><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt >员工名：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt >员工性别：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt >员工岗位：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt>时薪：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt>区域：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt>开户行：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd></dl></div><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt>微信昵称：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt>工厂代码：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt>联系电话：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt>绩效标准：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt>状态：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt>账号：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd></dl></div><div class='col-md-12 col-sm-12 col-xs-12 column'><dl ><dt>身份证：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt>地址：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt>备注：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd></dl></div></div>";$("#Label_staff_detail").empty(),$("#Label_staff_detail").append(e)}function draw_staff_detail_panel(){$("#Label_staff_detail").empty();var e=get_staff_gender(staff_selected.gender),t=get_staff_status(staff_selected.status),a="<p></p><p></p><div class='col-md-8 col-sm-8 col-xs-12 column'><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt >员工名：</dt><dd>"+staff_selected.name+"</dd><dt >员工性别：</dt><dd>"+e+"</dd><dt >员工岗位：</dt><dd>"+staff_selected.position+"</dd><dt>时薪：</dt><dd>"+staff_selected.salary+"</dd><dt>区域：</dt><dd>"+staff_selected.geoinfo+"</dd><dt>开户行：</dt><dd>"+staff_selected.bank+"</dd></dl></div><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt>微信昵称：</dt><dd>"+staff_selected.nickname+"</dd><dt>工厂代码：</dt><dd>"+staff_selected.PJcode+"</dd><dt>联系电话：</dt><dd>"+staff_selected.mobile+"</dd><dt>绩效标准：</dt><dd>"+staff_selected.KPI+"</dd><dt>状态：</dt><dd>"+t+"</dd><dt>账号：</dt><dd>"+staff_selected.account+"</dd></dl></div><div class='col-md-12 col-sm-12 col-xs-12 column'><dl ><dt>身份证：</dt><dd>"+staff_selected.identify+"</dd><dt>地址：</dt><dd>"+staff_selected.address+"</dd><dt>备注：</dt><dd>"+staff_selected.memo+"</dd></dl></div></div><div class='col-md-4 col-sm-4 col-xs-12 column'><img src ='"+staff_selected.photo+"' style='width:240px;hight:320px' /></div>";$("#Label_staff_detail").append(a)}function handlestaffFiles(e){staff_photo_name=e.length>0?e[0].name:""}function show_new_staff_module(){$("#staffupdatefrom").empty(),$("#staffupdatefrom").append("<input id='file-zh2' name='file-zh[]' type='file' onchange='handlestaffFiles(this.files)'/>"),$("#file-zh2").fileinput({language:"zh",uploadUrl:upload_url+"?id="+usr.id,allowedFileExtensions:["jpg","png","gif"],showPreview:!1}),$(".fileinput-remove").on("click",function(){staff_photo_name="",console.log("remove click")}),staff_photo_name="",$("#newStaffLabel").text("创建新员工"),staff_module_status=!0,$("#NewStaffname_Input").val(""),$("#NewStaffGender_Choice").val("1"),$("#NewStaffPJcode_Choice").val(""),
$("#NewStaffMobile_Input").val(""),$("#NewStaffPosition_Input").val(""),$("#NewStaffAddress_Input").val(""),$("#NewStaffMemo_Input").val(""),$("#NewStaffSalary_Input").val(""),$("#NewStaffNickname_Input").val(""),$("#NewStaffIdentify_Input").val(""),$("#NewStaffGeoInfo_Input").val(""),$("#NewStaffKPI_Input").val(0),$("#NewStaffStatus_Choice").val("1"),$("#NewStaffBank_Input").val(""),$("#NewStaffAccount_Input").val(""),$("#NewStaffNickname_Input").attr("disabled",!0),$("#NewStaffname_Input").attr("placeholder","员工名"),$("#NewStaffPJcode_Choice").attr("placeholder","工厂代码"),$("#NewStaffMobile_Input").attr("placeholder","联系电话"),$("#NewStaffPosition_Input").attr("placeholder","职位"),$("#NewStaffAddress_Input").attr("placeholder","地址"),$("#NewStaffKPI_Input").attr("placeholder","月绩效标准"),$("#NewStaffSalary_Input").attr("placeholder","时薪"),modal_middle($("#newStaffModal")),$("#newStaffModal").modal("show")}function submit_new_staff_module(){var e=$("#NewStaffname_Input").val(),t=$("#NewStaffGender_Choice").val(),a=$("#NewStaffPJcode_Choice").val(),o=$("#NewStaffMobile_Input").val(),i=$("#NewStaffPosition_Input").val(),n=$("#NewStaffAddress_Input").val(),l=$("#NewStaffMemo_Input").val(),d=$("#NewStaffNickname_Input").val(),r=parseInt($("#NewStaffSalary_Input").val()),_=parseInt($("#NewStaffKPI_Input").val()),s=$("#NewStaffStatus_Choice").val(),c=$("#NewStaffGeoInfo_Input").val(),u=$("#NewStaffIdentify_Input").val(),p=$("#NewStaffBank_Input").val(),m=$("#NewStaffAccount_Input").val();if(null===e||""===e)return $("#NewStaffname_Input").attr("placeholder","员工名不能为空"),void $("#NewStaffname_Input").focus();if(null===o||""===o)return $("#NewStaffMobile_Input").attr("placeholder","手机号不能为空"),void $("#NewStaffMobile_Input").focus();if(null===i||""===i)return $("#NewStaffPosition_Input").attr("placeholder","员工岗位不能为空"),void $("#NewStaffPosition_Input").focus();if(isNaN(r)||r<=0)return $("#NewStaffSalary_Input").val(""),$("#NewStaffSalary_Input").attr("placeholder","请输入正确的时薪"),void $("#NewStaffSalary_Input").focus();if(isNaN(_)||_<=0)return $("#NewStaffKPI_Input").val(""),$("#NewStaffKPI_Input").attr("placeholder","请输入正确的月绩效"),void $("#NewStaffKPI_Input").focus();var f={staffid:"",name:e,position:i,PJcode:a,mobile:o,address:n,gender:t,memo:l,nickname:d,salary:""+r,KPI:""+_,status:s,geoinfo:c,identify:u,bank:p,account:m,photo:staff_photo_name};new_staff(f)}function show_mod_staff_module(e){$("#staffupdatefrom").empty(),$("#staffupdatefrom").append("<input id='file-zh2' name='file-zh[]' type='file' onchange='handlestaffFiles(this.files)'/>"),$("#file-zh2").fileinput({language:"zh",uploadUrl:upload_url+"?id="+usr.id,allowedFileExtensions:["jpg","png","gif"],showPreview:!1}),$(".fileinput-remove").on("click",function(){staff_photo_name=""}),staff_photo_name="",$("#newStaffLabel").text("员工信息修改"),staff_module_status=!1,$("#NewStaffname_Input").val(e.name),$("#NewStaffGender_Choice").val(e.gender),$("#NewStaffPJcode_Choice").val(e.PJcode),$("#NewStaffMobile_Input").val(e.mobile),$("#NewStaffPosition_Input").val(e.position),$("#NewStaffAddress_Input").val(e.address),$("#NewStaffMemo_Input").val(e.memo),$("#NewStaffNickname_Input").val(e.nickname),$("#NewStaffSalary_Input").val(e.salary),$("#NewStaffKPI_Input").val(e.KPI),$("#NewStaffStatus_Choice").val(e.status),$("#NewStaffIdentify_Input").val(e.identify),$("#NewStaffGeoInfo_Input").val(e.geoinfo),$("#NewStaffBank_Input").val(e.bank),$("#NewStaffAccount_Input").val(e.account),$("#NewStaffname_Input").attr("placeholder","员工名"),$("#NewStaffPJcode_Input").attr("placeholder","工厂代码"),$("#NewStaffMobile_Input").attr("placeholder","联系电话"),$("#NewStaffPosition_Input").attr("placeholder","职位"),$("#NewStaffAddress_Input").attr("placeholder","地址"),$("#NewStaffSalary_Input").attr("placeholder","时薪"),$("#NewStaffKPI_Input").attr("placeholder","月绩效标准"),$("#NewStaffNickname_Input").attr("disabled",!1),modal_middle($("#newStaffModal")),$("#newStaffModal").modal("show")}function submit_mod_staff_module(){var e=$("#NewStaffname_Input").val(),t=$("#NewStaffGender_Choice").val(),a=$("#NewStaffPJcode_Choice").val(),o=$("#NewStaffMobile_Input").val(),i=$("#NewStaffPosition_Input").val(),n=$("#NewStaffAddress_Input").val(),l=$("#NewStaffMemo_Input").val(),d=$("#NewStaffNickname_Input").val(),r=parseInt($("#NewStaffSalary_Input").val()),_=parseInt($("#NewStaffKPI_Input").val()),s=$("#NewStaffStatus_Choice").val(),c=$("#NewStaffGeoInfo_Input").val(),u=$("#NewStaffIdentify_Input").val(),p=$("#NewStaffBank_Input").val(),m=$("#NewStaffAccount_Input").val();if(null===e||""===e)return $("#NewStaffname_Input").attr("placeholder","员工名不能为空"),void $("#NewStaffname_Input").focus();if(null===o||""===o)return $("#NewStaffMobile_Input").attr("placeholder","手机号不能为空"),void $("#NewStaffMobile_Input").focus();if(null===i||""===i)return $("#NewStaffPosition_Input").attr("placeholder","员工岗位不能为空"),void $("#NewStaffPosition_Input").focus();if(isNaN(r)||r<=0)return $("#NewStaffSalary_Input").attr("placeholder","请输入正确的时薪"),void $("#NewStaffSalary_Input").focus();if(null===d||""===d)return $("#NewStaffNickname_Input").attr("placeholder","微信昵称不能为空"),void $("#NewStaffNickname_Input").focus();if(isNaN(_)||_<=0)return $("#NewStaffKPI_Input").val(""),$("#NewStaffKPI_Input").attr("placeholder","请输入正确的月绩效"),void $("#NewStaffKPI_Input").focus();var f={staffid:staff_selected.id,name:e,position:i,PJcode:a,mobile:o,address:n,gender:t,memo:l,nickname:d,salary:""+r,KPI:""+_,status:s,geoinfo:c,identify:u,bank:p,account:m,photo:staff_photo_name};modify_staff(f)}function get_factory_list(){var e={action:"FactoryCodeList",type:"query",user:usr.id},t=function(e){if("false"==e.status)return void show_expiredModule();if("false"==e.auth)return void show_expiredModule();factory_list=e.ret;for(var t="",a=0;a<factory_list.length;a++)t=t+"<option value='"+factory_list[a].id+"'>"+factory_list[a].id+"</option>";$("#NewStaffPJcode_Choice").empty(),$("#NewStaffPJcode_Choice").append(t)};JQ_get(request_head,e,t)}function get_factory_table(e,t){var a={startseq:e,length:t,keyword:global_key_word},o={action:"FactoryTable",type:"query",body:a,user:usr.id},i=function(e){return"false"==e.status?void show_expiredModule():(factory_table=e.ret.factorytable,factory_start=parseInt(e.ret.start),factory_total=parseInt(e.ret.total),void draw_factory_table_head())};JQ_get(request_head,o,i)}function del_factory(e){var t={factoryid:e},a={action:"FactoryDel",type:"mod",body:t,user:usr.id},o=function(e){var t=e.status;"true"==t?(del_factory_flash=function(){clear_factory_detail_panel(),factory_intialize(0),get_factory_list()},setTimeout(function(){show_alarm_module(!1,"删除成功！",del_factory_flash)},500)):setTimeout(function(){show_alarm_module(!0,"删除失败！"+e.msg,null)},500)};JQ_get(request_head,a,o),$("#FactoryDelAlarm").modal("hide")}function new_factory(e){var t={factoryid:"",factorycode:e.factorycode,factorydutyday:e.factorydutyday,factorylongitude:e.factorylongitude,factorylatitude:e.factorylatitude,factoryworkstarttime:e.factoryworkstarttime,factoryworkendtime:e.factoryworkendtime,factorylaunchstarttime:e.factorylaunchstarttime,factorylaunchendtime:e.factorylaunchendtime,factoryaddress:e.factoryaddress,factorymemo:e.factorymemo},a={action:"FactoryNew",type:"mod",body:t,user:usr.id},o=function(e){var t=e.status;"true"==t?($("#newFactoryModal").modal("hide"),create_factory_flash=function(){clear_factory_detail_panel(),factory_intialize(0),get_factory_list()},setTimeout(function(){show_alarm_module(!1,"创建成功！",create_factory_flash)},500)):setTimeout(function(){show_alarm_module(!0,"创建失败！"+e.msg,null)},500)};JQ_get(request_head,a,o)}function modify_factory(e){var t={factoryid:e.factoryid,factorycode:e.factorycode,factorydutyday:e.factorydutyday,factorylongitude:e.factorylongitude,factorylatitude:e.factorylatitude,factoryworkstarttime:e.factoryworkstarttime,factoryworkendtime:e.factoryworkendtime,factorylaunchstarttime:e.factorylaunchstarttime,factorylaunchendtime:e.factorylaunchendtime,factoryaddress:e.factoryaddress,factorymemo:e.factorymemo},a={action:"FactoryMod",type:"mod",body:t,user:usr.id},o=function(e){var t=e.status;"true"==t?($("#newFactoryModal").modal("hide"),mod_factory_flash=function(){clear_factory_detail_panel(),factory_intialize(0),get_factory_list()},setTimeout(function(){show_alarm_module(!1,"修改成功！",mod_factory_flash)},500)):setTimeout(function(){show_alarm_module(!0,"修改失败！"+e.msg,null)},500)};JQ_get(request_head,a,o)}function factory_intialize(e){factory_initial=!0,factory_table=null,get_factory_table(e,5*table_row),clear_factory_detail_panel()}function draw_factory_table_head(){if(null!==factory_table){var e=Math.ceil(factory_table.length/table_row);$("#Factory_Page_control").empty();var t,a="<li><a href='#' id='factory_page_prev'>Prev</a></li>",o=Math.ceil(factory_start/table_row);for(t=0;t<e;t++)a=a+"<li><a href='#' id='factory_page_"+t+"'>"+(t+o+1)+"</a></li>";for(a+="<li><a href='#' id='factory_page_next'>Next</a></li>",$("#Factory_Page_control").append(a),table_head="<thead><tr><th>序号</th><th>工厂代码</th><th>全勤天数</th><th>上班时间</th><th>下班时间</th>",table_head+="</tr></thread>",click_draw_factory_table=function(){draw_factory_table($(this))},t=0;t<e;t++)$("#factory_page_"+t).on("click",click_draw_factory_table);factory_start<=0?$("#factory_page_prev").css("display","none"):($("#factory_page_prev").css("display","block"),$("#factory_page_prev").on("click",function(){var e=factory_start-5*table_row;e<0&&(e=0),factory_intialize(e)})),factory_start+5*table_row>=factory_total?$("#factory_page_next").css("display","none"):($("#factory_page_next").css("display","block"),$("#factory_page_next").on("click",function(){factory_intialize(factory_start+5*table_row)})),draw_factory_table($("#factory_page_0"))}}function draw_factory_table(e){if($("#Table_Factory").empty(),null!==factory_table){var t=(parseInt(e.html())-1)*table_row-factory_start,a=table_head;a+="<tbody>";var o;for(o=0;o<table_row;o++)t+o<factory_table.length?(a=0!==o%2?a+"<tr class='success li_menu' id='factory_table_cell"+o+"' factoryid='"+factory_table[t+o].factoryid+"'>":a+"<tr class='li_menu' id='factory_table_cell"+o+"' factoryid='"+factory_table[t+o].factoryid+"'>",a=a+"<td>"+factory_table[t+o].factoryid+"</td><td>"+factory_table[t+o].factorycode+"</td>",a=a+"<td>"+factory_table[t+o].factorydutyday+"</td><td>"+factory_table[t+o].factoryworkstarttime+"</td><td>"+factory_table[t+o].factoryworkendtime+"</td>",a+="</tr>"):(a=0!==o%2?a+"<tr class='success' id='factory_table_cell"+o+"' factoryid='null'>":a+"<tr  id='factory_table_cell"+o+"' factoryid='null'>",a+="<td>--</td><td>--</td><td>--</td><td>--</td><td>--</td><td>--</td>",a+="</tr>");for(a+="</tbody>",$("#Table_Factory").append(a),factory_table_cell_click=function(){if("null"!=$(this).attr("factoryid")){for(var e=0;e<factory_table.length;e++)if($(this).attr("factoryid")==factory_table[e].factoryid){factory_selected=factory_table[e];break}Initialize_factory_detail(),touchcookie()}},o=0;o<table_row;o++)$("#factory_table_cell"+o).on("click",factory_table_cell_click)}}function Initialize_factory_detail(){draw_factory_detail_panel()}function clear_factory_detail_panel(){factory_selected=null;var e="<p></p><p></p><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt >工厂代码：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt >全勤天数：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt >经度：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt>纬度：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd></dl></div><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt>上班时间：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt>下班时间：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt>午休开始时间：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt>午休结束时间：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd></dl></div><div class='col-md-12 col-sm-12 col-xs-12 column'><dl ><dt>地址：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt>备注：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd></dl></div>";$("#Label_factory_detail").empty(),$("#Label_factory_detail").append(e)}function draw_factory_detail_panel(){$("#Label_factory_detail").empty();var e="<p></p><p></p><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt >工厂代码：</dt><dd>"+factory_selected.factorycode+"</dd><dt >全勤天数：</dt><dd>"+factory_selected.factorydutyday+"</dd><dt >经度：</dt><dd>"+factory_selected.factorylongitude+"</dd><dt>纬度：</dt><dd>"+factory_selected.factorylatitude+"</dd></dl></div><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt>上班时间：</dt><dd>"+factory_selected.factoryworkstarttime+"</dd><dt>下班时间：</dt><dd>"+factory_selected.factoryworkendtime+"</dd><dt>午休开始时间：</dt><dd>"+factory_selected.factorylaunchstarttime+"</dd><dt>午休结束时间：</dt><dd>"+factory_selected.factorylaunchendtime+"</dd></dl></div><div class='col-md-12 col-sm-12 col-xs-12 column'><dl ><dt>地址：</dt><dd>"+factory_selected.factoryaddress+"</dd><dt>备注：</dt><dd>"+factory_selected.factorymemo+"</dd></dl></div>";$("#Label_factory_detail").append(e)}function show_new_factory_module(){$("#newFactoryLabel").text("创建新工厂"),factory_module_status=!0,$("#NewFactoryCode_Input").val(""),$("#NewFactoryDutyDay_Input").val("22"),$("#NewFactoryLongitude_Input").val(""),$("#NewFactoryLatitude_Input").val(""),$("#NewFactoryWorkStartTime_Input").val(""),$("#NewFactoryWorkEndTime_Input").val(""),$("#NewFactoryLaunchStartTime_Input").val(""),$("#NewFactoryLaunchEndTime_Input").val(""),$("#NewFactoryAddress_Input").val(""),$("#NewFactoryMemo_Input").val(""),$("#NewFactoryLongitude_Input").attr("disabled",!0),$("#NewFactoryLatitude_Input").attr("disabled",!0),$("#NewFactoryCode_Input").attr("placeholder","工厂代码"),$("#NewFactoryDutyDay_Input").attr("placeholder","全勤天数"),$("#NewFactoryWorkStartTime_Input").attr("placeholder","上班时间"),$("#NewFactoryWorkEndTime_Input").attr("placeholder","下班时间"),$("#NewFactoryLaunchStartTime_Input").attr("placeholder","午休开始时间"),$("#NewFactoryLaunchEndTime_Input").attr("placeholder","午休结束时间"),$("#NewFactoryAddress_Input").attr("placeholder","地址"),modal_middle($("#newFactoryModal")),$("#newFactoryModal").modal("show")}function submit_new_factory_module(){var e=$("#NewFactoryCode_Input").val(),t=parseInt($("#NewFactoryDutyDay_Input").val()),a=$("#NewFactoryLongitude_Input").val(),o=$("#NewFactoryLatitude_Input").val(),i=$("#NewFactoryWorkStartTime_Input").val(),n=$("#NewFactoryWorkEndTime_Input").val(),l=$("#NewFactoryLaunchStartTime_Input").val(),d=$("#NewFactoryLaunchEndTime_Input").val(),r=$("#NewFactoryAddress_Input").val(),_=$("#NewFactoryMemo_Input").val();if(null===e||""===e)return $("#NewFactoryCode_Input").attr("placeholder","工厂代码不能为空"),void $("#NewFactoryCode_Input").focus();if(isNaN(t)||t<=0)return $("#NewFactoryDutyDay_Input").val(""),$("#NewFactoryDutyDay_Input").attr("placeholder","请输入正确的全勤天数"),void $("#NewFactoryDutyDay_Input").focus();if(""!==i&&!isDatetime(i))return $("#NewFactoryWorkStartTime_Input").val(""),void $("#NewFactoryWorkStartTime_Input").focus();if(""!==n&&!isDatetime(n))return $("#NewFactoryWorkEndTime_Input").val(""),void $("#NewFactoryWorkEndTime_Input").focus();if(""!==l&&!isDatetime(l))return $("#NewFactoryLaunchStartTime_Input").val(""),void $("#NewFactoryLaunchStartTime_Input").focus();if(""!==d&&!isDatetime(d))return $("#NewFactoryLaunchEndTime_Input").val(""),void $("#NewFactoryLaunchEndTime_Input").focus();if(null===r||""===r)return $("#NewFactoryCode_Input").attr("placeholder","工厂地址不能为空"),void $("#NewFactoryCode_Input").focus();var s={factoryid:"",factorycode:e,factorydutyday:""+t,factorylongitude:a,factorylatitude:o,factoryworkstarttime:i,factoryworkendtime:n,factorylaunchstarttime:l,factorylaunchendtime:d,factoryaddress:r,factorymemo:_};new_factory(s)}function show_mod_factory_module(e){$("#newFactoryLabel").text("工厂信息修改"),factory_module_status=!1,$("#NewFactoryCode_Input").val(e.factorycode),$("#NewFactoryDutyDay_Input").val(e.factorydutyday),$("#NewFactoryLongitude_Input").val(e.factorylongitude),$("#NewFactoryLatitude_Input").val(e.factorylatitude),$("#NewFactoryWorkStartTime_Input").val(e.factoryworkstarttime),$("#NewFactoryWorkEndTime_Input").val(e.factoryworkendtime),$("#NewFactoryLaunchStartTime_Input").val(e.factorylaunchstarttime),$("#NewFactoryLaunchEndTime_Input").val(e.factorylaunchendtime),$("#NewFactoryAddress_Input").val(e.factoryaddress),$("#NewFactoryMemo_Input").val(e.factorymemo),$("#NewFactoryLongitude_Input").attr("disabled",!0),$("#NewFactoryLatitude_Input").attr("disabled",!0),$("#NewFactoryCode_Input").attr("placeholder","工厂代码"),$("#NewFactoryDutyDay_Input").attr("placeholder","全勤天数"),$("#NewFactoryWorkStartTime_Input").attr("placeholder","上班时间"),$("#NewFactoryWorkEndTime_Input").attr("placeholder","下班时间"),$("#NewFactoryLaunchStartTime_Input").attr("placeholder","午休开始时间"),$("#NewFactoryLaunchEndTime_Input").attr("placeholder","午休结束时间"),$("#NewFactoryAddress_Input").attr("placeholder","地址"),modal_middle($("#newFactoryModal")),$("#newFactoryModal").modal("show")}function submit_mod_factory_module(){var e=$("#NewFactoryCode_Input").val(),t=parseInt($("#NewFactoryDutyDay_Input").val()),a=$("#NewFactoryLongitude_Input").val(),o=$("#NewFactoryLatitude_Input").val(),i=$("#NewFactoryWorkStartTime_Input").val(),n=$("#NewFactoryWorkEndTime_Input").val(),l=$("#NewFactoryLaunchStartTime_Input").val(),d=$("#NewFactoryLaunchEndTime_Input").val(),r=$("#NewFactoryAddress_Input").val(),_=$("#NewFactoryMemo_Input").val();if(null===e||""===e)return $("#NewFactoryCode_Input").attr("placeholder","工厂代码不能为空"),void $("#NewFactoryCode_Input").focus();if(isNaN(t)||t<=0)return $("#NewFactoryDutyDay_Input").val(""),$("#NewFactoryDutyDay_Input").attr("placeholder","请输入正确的全勤天数"),void $("#NewFactoryDutyDay_Input").focus();if(""!==i&&!isDatetime(i))return $("#NewFactoryWorkStartTime_Input").val(""),void $("#NewFactoryWorkStartTime_Input").focus();if(""!==n&&!isDatetime(n))return $("#NewFactoryWorkEndTime_Input").val(""),void $("#NewFactoryWorkEndTime_Input").focus();if(""!==l&&!isDatetime(l))return $("#NewFactoryLaunchStartTime_Input").val(""),void $("#NewFactoryLaunchStartTime_Input").focus();if(""!==d&&!isDatetime(d))return $("#NewFactoryLaunchEndTime_Input").val(""),void $("#NewFactoryLaunchEndTime_Input").focus();if(null===r||""===r)return $("#NewFactoryCode_Input").attr("placeholder","工厂地址不能为空"),void $("#NewFactoryCode_Input").focus();var s={factoryid:factory_selected.factoryid,factorycode:e,factorydutyday:""+t,factorylongitude:a,factorylatitude:o,factoryworkstarttime:i,factoryworkendtime:n,factorylaunchstarttime:l,factorylaunchendtime:d,factoryaddress:r,factorymemo:_};modify_factory(s)}function get_specification_table(e,t){var a={startseq:e,length:t,keyword:global_key_word},o={action:"SpecificationTable",type:"query",body:a,user:usr.id},i=function(e){return"false"==e.status?void show_expiredModule():(specification_table=e.ret.specificationtable,specification_start=parseInt(e.ret.start),specification_total=parseInt(e.ret.total),void draw_specification_table_head())};JQ_get(request_head,o,i)}function del_specification(e){var t={specificationid:e},a={action:"SpecificationDel",type:"mod",body:t,user:usr.id},o=function(e){var t=e.status;"true"==t?(del_specification_flash=function(){clear_specification_detail_panel(),specification_intialize(0)},setTimeout(function(){show_alarm_module(!1,"删除成功！",del_specification_flash)},500)):setTimeout(function(){show_alarm_module(!0,"删除失败！"+e.msg,null)},500)};JQ_get(request_head,a,o),$("#SpecificationDelAlarm").modal("hide")}function new_specification(e){var t={specificationid:"",specificationcode:e.specificationcode,specificationlevel:e.specificationlevel,specificationnumber:e.specificationnumber,specificationweight:e.specificationweight,specificationmemo:e.specificationmemo},a={action:"SpecificationNew",type:"mod",body:t,user:usr.id},o=function(e){var t=e.status;"true"==t?($("#newSpecificationModal").modal("hide"),create_specification_flash=function(){clear_specification_detail_panel(),specification_intialize(0)},setTimeout(function(){show_alarm_module(!1,"创建成功！",create_specification_flash)},500)):setTimeout(function(){show_alarm_module(!0,"创建失败！"+e.msg,null)},500)};JQ_get(request_head,a,o)}function modify_specification(e){var t={specificationid:e.specificationid,specificationcode:e.specificationcode,specificationlevel:e.specificationlevel,specificationnumber:e.specificationnumber,specificationweight:e.specificationweight,specificationmemo:e.specificationmemo},a={action:"SpecificationMod",type:"mod",body:t,user:usr.id},o=function(e){var t=e.status;"true"==t?($("#newSpecificationModal").modal("hide"),mod_specification_flash=function(){clear_specification_detail_panel(),specification_intialize(0)},setTimeout(function(){show_alarm_module(!1,"修改成功！",mod_specification_flash)},500)):setTimeout(function(){show_alarm_module(!0,"修改失败！"+e.msg,null)},500)};JQ_get(request_head,a,o)}function specification_intialize(e){specification_initial=!0,specification_table=null,get_specification_table(e,5*table_row),clear_specification_detail_panel()}function draw_specification_table_head(){if(null!==specification_table){var e=Math.ceil(specification_table.length/table_row);$("#Specification_Page_control").empty();var t,a="<li><a href='#' id='specification_page_prev'>Prev</a></li>",o=Math.ceil(specification_start/table_row);for(t=0;t<e;t++)a=a+"<li><a href='#' id='specification_page_"+t+"'>"+(t+o+1)+"</a></li>";for(a+="<li><a href='#' id='specification_page_next'>Next</a></li>",$("#Specification_Page_control").append(a),table_head="<thead><tr><th>序号</th><th>产品规格代码</th><th>产品等级</th><th>粒数</th><th>重量</th>",table_head+="</tr></thread>",click_draw_specification_table=function(){draw_specification_table($(this))},t=0;t<e;t++)$("#specification_page_"+t).on("click",click_draw_specification_table);specification_start<=0?$("#specification_page_prev").css("display","none"):($("#specification_page_prev").css("display","block"),$("#specification_page_prev").on("click",function(){var e=specification_start-5*table_row;e<0&&(e=0),specification_intialize(e)})),specification_start+5*table_row>=specification_total?$("#specification_page_next").css("display","none"):($("#specification_page_next").css("display","block"),$("#specification_page_next").on("click",function(){specification_intialize(specification_start+5*table_row)})),draw_specification_table($("#specification_page_0"))}}function draw_specification_table(e){if($("#Table_specification").empty(),null!==specification_table){var t=(parseInt(e.html())-1)*table_row-specification_start,a=table_head;a+="<tbody>";var o;for(o=0;o<table_row;o++)t+o<specification_table.length?(a=0!==o%2?a+"<tr class='success li_menu' id='specification_table_cell"+o+"' specificationid='"+specification_table[t+o].specificationid+"'>":a+"<tr class='li_menu' id='specification_table_cell"+o+"' specificationid='"+specification_table[t+o].specificationid+"'>",a=a+"<td>"+specification_table[t+o].specificationid+"</td><td>"+specification_table[t+o].specificationcode+"</td>",a=a+"<td>"+specification_table[t+o].specificationlevel+"</td><td>"+specification_table[t+o].specificationnumber+"</td><td>"+specification_table[t+o].specificationweight+"</td>",a+="</tr>"):(a=0!==o%2?a+"<tr class='success' id='specification_table_cell"+o+"' specificationid='null'>":a+"<tr  id='specification_table_cell"+o+"' specificationid='null'>",a+="<td>--</td><td>--</td><td>--</td><td>--</td><td>--</td><td>--</td>",a+="</tr>");for(a+="</tbody>",$("#Table_specification").append(a),specification_table_cell_click=function(){if("null"!=$(this).attr("specificationid")){for(var e=0;e<specification_table.length;e++)if($(this).attr("specificationid")==specification_table[e].specificationid){specification_selected=specification_table[e];break}Initialize_specification_detail(),touchcookie()}},o=0;o<table_row;o++)$("#specification_table_cell"+o).on("click",specification_table_cell_click)}}function Initialize_specification_detail(){draw_specification_detail_panel()}function clear_specification_detail_panel(){specification_selected=null;var e="<p></p><p></p><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt >规格代码：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt >产品等级：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd></dl></div><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt>粒数：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt>重量：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd></dl></div><div class='col-md-12 col-sm-12 col-xs-12 column'><dl ><dt>备注：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd></dl></div>";$("#Label_specification_detail").empty(),$("#Label_specification_detail").append(e)}function draw_specification_detail_panel(){$("#Label_specification_detail").empty();var e="<p></p><p></p><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt >规格代码：</dt><dd>"+specification_selected.specificationcode+"</dd><dt >产品等级：</dt><dd>"+specification_selected.specificationlevel+"</dd></dl></div><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt>粒数：</dt><dd>"+specification_selected.specificationnumber+"</dd><dt>重量：</dt><dd>"+specification_selected.specificationweight+"</dd></dl></div><div class='col-md-12 col-sm-12 col-xs-12 column'><dl ><dt>备注：</dt><dd>"+specification_selected.specificationmemo+"</dd></dl></div>";$("#Label_specification_detail").append(e)}function show_new_specification_module(){$("#newSpecificationLabel").text("创建新规格"),specification_module_status=!0,$("#NewSpecificationCode_Input").val(""),$("#NewSpecificationLevel_Input").val(""),$("#NewSpecificationNumber_Input").val(""),$("#NewSpecificationWeight_Input").val(""),$("#NewSpecificationMemo_Input").val(""),$("#NewSpecificationCode_Input").attr("placeholder","规格代码"),$("#NewSpecificationLevel_Input").attr("placeholder","产品等级"),$("#NewSpecificationNumber_Input").attr("placeholder","粒数"),$("#NewSpecificationWeight_Input").attr("placeholder","重量"),modal_middle($("#newSpecificationModal")),$("#newSpecificationModal").modal("show")}function submit_new_specification_module(){var e=$("#NewSpecificationCode_Input").val(),t=$("#NewSpecificationLevel_Input").val(),a=parseInt($("#NewSpecificationNumber_Input").val()),o=parseFloat($("#NewSpecificationWeight_Input").val()),i=$("#NewSpecificationMemo_Input").val();if(null===e||""===e)return $("#NewSpecificationCode_Input").attr("placeholder","规格代码不能为空"),void $("#NewSpecificationCode_Input").focus();if(null===t||""===t)return $("#NewSpecificationLevel_Input").attr("placeholder","产品等级不能为空"),void $("#NewSpecificationLevel_Input").focus();if(isNaN(a)||a<=0)return $("#NewSpecificationNumber_Input").val(""),$("#NewSpecificationNumber_Input").attr("placeholder","请输入正确的粒数"),void $("#NewSpecificationNumber_Input").focus();if(isNaN(o)||o<=0)return $("#NewSpecificationWeight_Input").val(""),$("#NewSpecificationWeight_Input").attr("placeholder","请输入正确的重量"),void $("#NewSpecificationWeight_Input").focus();var n={specificationid:"",specificationcode:e,specificationlevel:t,specificationnumber:""+a,specificationweight:""+o,specificationmemo:i};new_specification(n)}function show_mod_specification_module(e){$("#newSpecificationLabel").text("产品规格修改"),specification_module_status=!1,$("#NewSpecificationCode_Input").val(e.specificationcode),$("#NewSpecificationLevel_Input").val(e.specificationlevel),$("#NewSpecificationNumber_Input").val(e.specificationnumber),$("#NewSpecificationWeight_Input").val(e.specificationweight),$("#NewSpecificationMemo_Input").val(e.specificationmemo),$("#NewSpecificationCode_Input").attr("placeholder","规格代码"),$("#NewSpecificationLevel_Input").attr("placeholder","产品等级"),$("#NewSpecificationNumber_Input").attr("placeholder","粒数"),$("#NewSpecificationWeight_Input").attr("placeholder","重量"),modal_middle($("#newSpecificationModal")),$("#newSpecificationModal").modal("show")}function submit_mod_specification_module(){var e=$("#NewSpecificationCode_Input").val(),t=$("#NewSpecificationLevel_Input").val(),a=parseInt($("#NewSpecificationNumber_Input").val()),o=parseFloat($("#NewSpecificationWeight_Input").val()),i=$("#NewSpecificationMemo_Input").val();if(null===e||""===e)return $("#NewSpecificationCode_Input").attr("placeholder","规格代码不能为空"),void $("#NewSpecificationCode_Input").focus();if(null===t||""===t)return $("#NewSpecificationLevel_Input").attr("placeholder","产品等级不能为空"),void $("#NewSpecificationLevel_Input").focus();if(isNaN(a)||a<=0)return $("#NewSpecificationNumber_Input").val(""),$("#NewSpecificationNumber_Input").attr("placeholder","请输入正确的粒数"),void $("#NewSpecificationNumber_Input").focus();if(isNaN(o)||o<=0)return $("#NewSpecificationWeight_Input").val(""),$("#NewSpecificationWeight_Input").attr("placeholder","请输入正确的重量"),void $("#NewSpecificationWeight_Input").focus();var n={specificationid:specification_selected.specificationid,specificationcode:e,specificationlevel:t,specificationnumber:a,specificationweight:o,specificationmemo:i};modify_specification(n)}function get_project_list(){var e={action:"ProjectList",type:"query",user:usr.id},t=function(e){return"false"==e.status?void show_expiredModule():void(project_list=e.ret)};JQ_get(request_head,e,t)}function get_pg_table(e,t){var a={startseq:e,length:t,keyword:global_key_word},o={action:"PGTable",body:a,type:"query",user:usr.id},i=function(e){return"false"==e.status?void show_expiredModule():(pg_table=e.ret.pgtable,pg_start=parseInt(e.ret.start),pg_total=parseInt(e.ret.total),void draw_pg_table_head())};JQ_get(request_head,o,i)}function del_pg(e){var t={PGCode:e},a={action:"PGDel",type:"mod",body:t,user:usr.id},o=function(e){var t=e.status;"true"==t?(del_pg_flash=function(){clear_pg_detail_panel(),pg_intialize(0)},setTimeout(function(){show_alarm_module(!1,"删除成功！",del_pg_flash)},500)):setTimeout(function(){show_alarm_module(!0,"删除失败！"+e.msg,null)},500)};JQ_get(request_head,a,o),$("#PGDelAlarm").modal("hide")}function new_pg(e,t){var a={PGCode:e.PGCode,PGName:e.PGName,ChargeMan:e.ChargeMan,Telephone:e.Telephone,Department:e.Department,Address:e.Address,Stage:e.Stage,Projlist:t},o={action:"PGNew",type:"mod",body:a,user:usr.id},i=function(e){var t=e.status;"true"==t?($("#newPGModal").modal("hide"),new_pg_flash=function(){clear_pg_detail_panel(),pg_intialize(0)},setTimeout(function(){show_alarm_module(!1,"创建成功！",new_pg_flash)},500)):setTimeout(function(){show_alarm_module(!0,"创建失败！"+e.msg,null)},500)};JQ_get(request_head,o,i)}function modify_pg(e,t){var a={PGCode:e.PGCode,PGName:e.PGName,ChargeMan:e.ChargeMan,Telephone:e.Telephone,Department:e.Department,Address:e.Address,Stage:e.Stage,Projlist:t},o={action:"PGMod",type:"mod",body:a,user:usr.id},i=function(e){var t=e.status;"true"==t?($("#newPGModal").modal("hide"),mod_pg_flash=function(){clear_pg_detail_panel(),pg_intialize(0)},setTimeout(function(){show_alarm_module(!1,"修改成功！",mod_pg_flash)},500)):setTimeout(function(){show_alarm_module(!0,"修改失败！"+e.msg,null)},500)};JQ_get(request_head,o,i)}function get_pg_proj(e){var t={PGCode:e},a={action:"PGProj",type:"query",body:t,user:usr.id},o=function(e){return"false"==e.status?void show_expiredModule():(pg_selected_proj=e.ret,void draw_pg_detail_panel())};JQ_get(request_head,a,o)}function pg_intialize(e){null===project_list&&get_project_list(),pg_initial=!0,pg_table=null,get_pg_table(e,5*table_row),clear_pg_detail_panel()}function draw_pg_table_head(){if(null!==pg_table){var e=Math.ceil(pg_table.length/table_row);$("#PG_Page_control").empty();var t,a="<li><a href='#' id='pg_page_prev'>Prev</a></li>",o=Math.ceil(pg_start/table_row);for(t=0;t<e;t++)a=a+"<li><a href='#' id='pg_page_"+t+"'>"+(t+o+1)+"</a></li>";for(a+="<li><a href='#' id='pg_page_next'>Next</a></li>",$("#PG_Page_control").append(a),table_head="<thead><tr><th>编号</th> <th>名称 </th> <th>责任人 </th> <th>电话 </th> <th>单位 </th>",table_head+="</tr></thread>",pg_page_click=function(){draw_pg_table($(this))},t=0;t<e;t++)$("#pg_page_"+t).on("click",pg_page_click);pg_start<=0?$("#pg_page_prev").css("display","none"):($("#pg_page_prev").css("display","block"),$("#pg_page_prev").on("click",function(){var e=pg_start-5*table_row;e<0&&(e=0),pg_intialize(e)})),pg_start+5*table_row>=pg_total?$("#pg_page_next").css("display","none"):($("#pg_page_next").css("display","block"),$("#pg_page_next").on("click",function(){pg_intialize(pg_start+5*table_row)})),draw_pg_table($("#pg_page_0"))}}function draw_pg_table(e){if($("#Table_pg").empty(),
null!==pg_table){var t=(parseInt(e.html())-1)*table_row-pg_start,a=table_head;a+="<tbody>";var o;for(o=0;o<table_row;o++)t+o<pg_table.length?(a=0!==o%2?a+"<tr class='success  li_menu' id='pg_table_cell"+o+"' PGCode='"+pg_table[t+o].PGCode+"'>":a+"<tr class=' li_menu' id='pg_table_cell"+o+"' PGCode='"+pg_table[t+o].PGCode+"'>",a=a+"<td>"+pg_table[t+o].PGCode+"</td><td>"+pg_table[t+o].PGName+"</td><td>"+pg_table[t+o].ChargeMan+"</td><td>"+pg_table[t+o].Telephone+"</td>",a=a+"<td>"+pg_table[t+o].Department+"</td>",a+="</tr>"):(a=0!==o%2?a+"<tr class='success' id='pg_table_cell"+o+"' PGCode='null'>":a+"<tr  id='pg_table_cell"+o+"' PGCode='null'>",a+="<td>--</td><td>--</td><td>--</td><td>--</td><td>--</td><td>--</td>",a+="</tr>");for(a+="</tbody>",$("#Table_pg").append(a),pg_table_cell_click=function(){if("null"!=$(this).attr("PGCode")){for(var e=0;e<pg_table.length;e++)if($(this).attr("PGCode")==pg_table[e].PGCode){pg_selected=pg_table[e];break}Initialize_pg_detail(),touchcookie()}},o=0;o<table_row;o++)$("#pg_table_cell"+o).on("click",pg_table_cell_click);touchcookie()}}function Initialize_pg_detail(){get_pg_proj(pg_selected.PGCode)}function clear_pg_detail_panel(){pg_selected=null;var e="<p></p><p></p><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt >项目组编号：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt >负责人：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd></dl></div><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt>项目组名称：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt>电话：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd></dl></div><div class='col-md-12 col-sm-12 col-xs-12 column'><dl ><dt>单位：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt>地址：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt>备注：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd></dl></div>";$("#Label_pg_detail").empty(),$("#Label_pg_detail").append(e),$("#Table_pg_proj").empty()}function draw_pg_detail_panel(){if($("#Label_pg_detail").empty(),null!==pg_selected_proj){var e="<p></p><p></p><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt >项目组编号：</dt><dd>"+pg_selected.PGCode+"</dd><dt >负责人：</dt><dd>"+pg_selected.ChargeMan+"</dd></dl></div><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt>项目组名称：</dt><dd>"+pg_selected.PGName+"</dd><dt>电话：</dt><dd>"+pg_selected.Telephone+"</dd></dl></div><div class='col-md-12 col-sm-12 col-xs-12 column'><dl ><dt>单位：</dt><dd>"+pg_selected.Department+"</dd><dt>地址：</dt><dd>"+pg_selected.Address+"</dd><dt>备注：</dt><dd>"+pg_selected.Stage+"</dd></dl></div>";$("#Label_pg_detail").append(e),$("#Table_pg_proj").empty(),e="<thead> <tr> <th>下辖项目清单 </th> </tr> </thead> <tbody >",null===pg_selected_proj&&(pg_selected_proj=[]);for(var t=0;t<pg_selected_proj.length;t++)e=e+"<tr> <td>"+pg_selected_proj[t].name+"</td> </tr>";e+="</tbody>",$("#Table_pg_proj").append(e)}}function show_new_pg_module(){$("#newPGModalLabel").text("创建新项目组"),pg_module_status=!0,$("#PGPGCode_Input").val(""),$("#PGPGCode_Input").attr("disabled",!0),$("#PGPGName_Input").val(""),$("#PGChargeMan_Input").val(""),$("#PGTelephone_Input").val(""),$("#PGDepartment_Input").val(""),$("#PGAddress_Input").val(""),$("#PGStage_Input").val(""),$("#PGPGCode_Input").attr("placeholder","项目组编号"),$("#PGPGName_Input").attr("placeholder","项目组名称"),$("#PGChargeMan_Input").attr("placeholder","负责人姓名"),$("#PGTelephone_Input").attr("placeholder","联系电话"),$("#PGDepartment_Input").attr("placeholder","单位名称"),$("#PGAddress_Input").attr("placeholder","地址"),$("#duallistboxPGProj_new").empty();var e="";null===project_list&&(project_list=[]);for(var t=0;t<project_list.length;t++)e="<option value='"+project_list[t].id+"'>"+project_list[t].name+"</option>",$("#duallistboxPGProj_new").append(e);$(".NewPGProjDual").bootstrapDualListbox("refresh",!0),modal_middle($("#newPGModal")),$("#newPGModal").modal("show")}function submit_new_pg_module(){var e=$("#PGPGCode_Input").val(),t=$("#PGPGName_Input").val(),a=$("#PGChargeMan_Input").val(),o=$("#PGTelephone_Input").val(),i=$("#PGDepartment_Input").val(),n=$("#PGAddress_Input").val(),l=$("#PGStage_Input").val();if(null===t||""===t)return $("#PGPGName_Input").attr("placeholder","项目组名称不能为空"),void $("#PGPGName_Input").focus();if(null===a||""===a)return $("#PGChargeMan_Input").attr("placeholder","负责人姓名不能为空"),void $("#PGChargeMan_Input").focus();if(null===o||""===o)return $("#PGTelephone_Input").attr("placeholder","联系电话不能为空"),void $("#PGTelephone_Input").focus();if(null===i||""===i)return $("#PGDepartment_Input").attr("placeholder","单位名称不能为空"),void $("#PGDepartment_Input").focus();if(null===n||""===n)return $("#PGAddress_Input").attr("placeholder","地址不能为空"),void $("#PGAddress_Input").focus();var d={PGCode:e,PGName:t,ChargeMan:a,Telephone:o,Department:i,Address:n,Stage:l},r=[];$("#duallistboxPGProj_new :selected").each(function(e,t){var a={id:$(t).val(),name:$(t).text()};r.push(a)}),new_pg(d,r)}function show_mod_pg_module(e,t){$("#newPGModalLabel").text("项目组修改"),pg_module_status=!1,$("#PGPGCode_Input").val(e.PGCode),$("#PGPGCode_Input").attr("disabled",!0),$("#PGPGName_Input").val(e.PGName),$("#PGChargeMan_Input").val(e.ChargeMan),$("#PGTelephone_Input").val(e.Telephone),$("#PGDepartment_Input").val(e.Department),$("#PGAddress_Input").val(e.Address),$("#PGStage_Input").val(e.Stage),$("#PGPGCode_Input").attr("placeholder","项目号"),$("#PGPGName_Input").attr("placeholder","项目名称"),$("#PGChargeMan_Input").attr("placeholder","负责人姓名"),$("#PGTelephone_Input").attr("placeholder","联系电话"),$("#PGDepartment_Input").attr("placeholder","单位名称"),$("#PGAddress_Input").attr("placeholder","地址"),$("#duallistboxPGProj_new").empty();var a="";null===project_list&&(project_list=[]);for(var o=0;o<project_list.length;o++){a="<option value='"+project_list[o].id+"'";for(var i=0;i<t.length;i++)if(t[i].id==project_list[o].id){a+="selected='selected'";break}a=a+">"+project_list[o].name+"</option>",$("#duallistboxPGProj_new").append(a)}$(".NewPGProjDual").bootstrapDualListbox("refresh",!0),modal_middle($("#newPGModal")),$("#newPGModal").modal("show")}function submit_mod_pg_module(){var e=$("#PGPGCode_Input").val(),t=$("#PGPGName_Input").val(),a=$("#PGChargeMan_Input").val(),o=$("#PGTelephone_Input").val(),i=$("#PGDepartment_Input").val(),n=$("#PGAddress_Input").val(),l=$("#PGStage_Input").val(),d={PGCode:e,PGName:t,ChargeMan:a,Telephone:o,Department:i,Address:n,Stage:l},r=[];$("#duallistboxPGProj_new :selected").each(function(e,t){var a={id:$(t).val(),name:$(t).text()};r.push(a)}),modify_pg(d,r)}function get_key_table(e,t){var a={startseq:e,length:t,keyword:global_key_word},o={action:"KeyTable",type:"query",body:a,user:usr.id},i=function(e){return"false"==e.status?void show_expiredModule():(key_table=e.ret.keytable,key_start=parseInt(e.ret.start),key_total=parseInt(e.ret.total),void draw_key_table_head())};JQ_get(request_head,o,i)}function del_key(e){var t={KeyCode:e},a={action:"KeyDel",type:"mod",body:t,user:usr.id},o=function(e){var t=e.status;"true"==t?(del_key_flash=function(){clear_key_detail_panel(),key_intialize(0)},setTimeout(function(){show_alarm_module(!1,"删除成功！",del_key_flash)},500)):setTimeout(function(){show_alarm_module(!0,"删除失败！"+e.msg,null)},500)};JQ_get(request_head,a,o),$("#KeyDelAlarm").modal("hide")}function new_key(e){var t={KeyCode:e.KeyCode,KeyName:e.KeyName,KeyProj:e.KeyProj,KeyType:e.KeyType,HardwareCode:e.HardwareCode,Memo:e.Memo},a={action:"KeyNew",type:"mod",body:t,user:usr.id},o=function(e){var t=e.status;"true"==t?($("#newKeyModal").modal("hide"),new_key_flash=function(){clear_key_detail_panel(),key_intialize(0)},setTimeout(function(){show_alarm_module(!1,"创建成功！",new_key_flash)},500)):setTimeout(function(){show_alarm_module(!0,"创建失败！"+e.msg,null)},500)};JQ_get(request_head,a,o)}function modify_key(e){var t={KeyCode:e.KeyCode,KeyName:e.KeyName,KeyProj:e.KeyProj,KeyType:e.KeyType,HardwareCode:e.HardwareCode,Memo:e.Memo},a={action:"KeyMod",type:"mod",body:t,user:usr.id},o=function(e){var t=e.status;"true"==t?($("#newKeyModal").modal("hide"),mod_key_flash=function(){clear_key_detail_panel(),key_intialize(0)},setTimeout(function(){show_alarm_module(!1,"修改成功！",mod_key_flash)},500)):setTimeout(function(){show_alarm_module(!0,"修改失败！"+e.msg,null)},500)};JQ_get(request_head,a,o)}function get_key_auth(e){var t={KeyCode:e},a={action:"KeyAuthlist",type:"query",body:t,user:usr.id},o=function(e){return"false"==e.status?void show_expiredModule():(key_selected_auth=e.ret,void draw_key_detail_auth_table())};JQ_get(request_head,a,o)}function key_intialize(e){null===project_list&&get_project_list(),key_initial=!0,key_table=null,get_key_table(e,5*table_row),clear_key_detail_panel()}function draw_key_table_head(){if(null!==key_table){var e=Math.ceil(key_table.length/table_row);$("#Key_Page_control").empty();var t,a="<li><a href='#' id='key_page_prev'>Prev</a></li>",o=Math.ceil(key_start/table_row);for(t=0;t<e;t++)a=a+"<li><a href='#' id='key_page_"+t+"'>"+(t+o+1)+"</a></li>";for(a+="<li><a href='#' id='key_page_next'>Next</a></li>",$("#Key_Page_control").append(a),table_head="<thead><tr><th>编号</th> <th>名称 </th> <th>归口部门 </th> <th>使用人 </th> <th>种类 </th>",table_head+="</tr></thread>",key_page_click=function(){draw_key_table($(this))},t=0;t<e;t++)$("#key_page_"+t).on("click",key_page_click);key_start<=0?$("#key_page_prev").css("display","none"):($("#key_page_prev").css("display","block"),$("#key_page_prev").on("click",function(){var e=key_start-5*table_row;e<0&&(e=0),key_intialize(e)})),key_start+5*table_row>=key_total?$("#key_page_next").css("display","none"):($("#key_page_next").css("display","block"),$("#key_page_next").on("click",function(){key_intialize(key_start+5*table_row)})),draw_key_table($("#key_page_0"))}}function key_type_transfer(e){return"R"==e?"射频卡":"B"==e?"蓝牙":"U"==e?"用户名":"I"==e?"身份证":"W"==e?"微信号":"P"==e?"电话号码":"未知类型"}function draw_key_table(e){if($("#Table_key").empty(),null!==key_table){var t=(parseInt(e.html())-1)*table_row-key_start,a=table_head;a+="<tbody>";var o;for(o=0;o<table_row;o++)if(t+o<key_table.length){var i=key_table[t+o].KeyUserName;"none"==i&&(i="部门收管"),a=0!==o%2?a+"<tr class='success  li_menu' id='key_table_cell"+o+"' KeyCode='"+key_table[t+o].KeyCode+"'>":a+"<tr class=' li_menu' id='key_table_cell"+o+"' KeyCode='"+key_table[t+o].KeyCode+"'>",a=a+"<td>"+key_table[t+o].KeyCode+"</td><td>"+key_table[t+o].KeyName+"</td><td>"+key_table[t+o].KeyProjName+"</td><td>"+i+"</td><td>"+key_type_transfer(key_table[t+o].KeyType)+"</td>",a+="</tr>"}else a=0!==o%2?a+"<tr class='success' id='key_table_cell"+o+"' KeyCode='null'>":a+"<tr  id='key_table_cell"+o+"' KeyCode='null'>",a+="<td>--</td><td>--</td><td>--</td><td>--</td><td>--</td>",a+="</tr>";for(a+="</tbody>",$("#Table_key").append(a),key_table_cell_click=function(){if("null"!=$(this).attr("KeyCode")){for(var e=0;e<key_table.length;e++)if($(this).attr("KeyCode")==key_table[e].KeyCode){key_selected=key_table[e];break}Initialize_key_detail(),touchcookie()}},o=0;o<table_row;o++)$("#key_table_cell"+o).on("click",key_table_cell_click);touchcookie()}}function Initialize_key_detail(){draw_key_detail_panel(),get_key_auth(key_selected.KeyCode)}function clear_key_detail_panel(){key_selected=null;var e="<p></p><p></p><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt >钥匙编号：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt >钥匙名称：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd></dl></div><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt>归口部门：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt>使用人：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd></dl></div><div class='col-md-12 col-sm-12 col-xs-12 column'><dl ><dt>钥匙种类：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt>硬件码：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt>备注：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd></dl></div>";$("#Label_key_detail").empty(),$("#Label_key_detail").append(e),$("#Table_key_auth").empty()}function draw_key_detail_panel(){$("#Label_key_detail").empty();var e=key_selected.KeyUserName;"none"==e&&(e="部门收管");var t="<p></p><p></p><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt >钥匙编号：</dt><dd>"+key_selected.KeyCode+"</dd><dt >钥匙名称：</dt><dd>"+key_selected.KeyName+"</dd></dl></div><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt>归口部门：</dt><dd>"+key_selected.KeyProjName+"</dd><dt>使用人：</dt><dd>"+e+"</dd></dl></div><div class='col-md-12 col-sm-12 col-xs-12 column'><dl ><dt>钥匙种类：</dt><dd>"+key_type_transfer(key_selected.KeyType)+"</dd><dt>硬件码：</dt><dd>"+key_selected.HardwareCode+"</dd><dt>备注：</dt><dd>"+key_selected.Memo+"</dd></dl></div>";$("#Label_key_detail").append(t)}function draw_key_detail_auth_table(){$("#Table_key_auth").empty(),txt="<thead> <tr> <th>授权设备 </th> <th>授权方式 </th></tr> </thead> <tbody >",null===key_selected_auth&&(key_selected_auth=[]);for(var e=0;e<key_selected_auth.length;e++)txt=txt+"<tr> <td>"+key_selected_auth[e].DomainName+"</td> <td>"+key_selected_auth[e].AuthWay+"</td></tr>";txt+="</tbody>",$("#Table_key_auth").append(txt)}function build_key_module_proj_choice(){if(null!==project_list){var e="";for(i=0;i<project_list.length;i++)e=e+"<option value="+project_list[i].id+">"+project_list[i].name+"</option>";$("#NewKeyProj_choice").append(e)}}function show_new_key_module(){$("#newKeyModalLabel").text("创建新钥匙"),build_key_module_proj_choice(),key_module_status=!0,$("#NewKeyName_Input").val(""),$("#NewKeyHardwareID_Input").val(""),$("#NewKeyMemo_Input").val(""),$("#NewKeyName_Input").attr("placeholder","钥匙名称"),$("#NewKeyHardwareID_Input").attr("placeholder","硬件码"),$("#NewKeyMemo_Input").attr("placeholder","备注"),modal_middle($("#newKeyModal")),$("#newKeyModal").modal("show")}function submit_new_key_module(){var e="",t=$("#NewKeyName_Input").val(),a=$("#NewKeyType_choice").val(),o=$("#NewKeyProj_choice").val(),i=$("#NewKeyHardwareID_Input").val(),n=$("#NewKeyMemo_Input").val();if(null===t||""===t)return $("#NewKeyName_Input").attr("placeholder","钥匙名称不能为空"),void $("#NewKeyName_Input").focus();if(null===i||""===i)return $("#NewKeyHardwareID_Input").attr("placeholder","硬件码不能为空"),void $("#NewKeyHardwareID_Input").focus();var l={KeyCode:e,KeyName:t,KeyType:a,KeyProj:o,HardwareCode:i,Memo:n};new_key(l)}function show_mod_key_module(e){$("#newKeyModalLabel").text("钥匙修改"),build_key_module_proj_choice(),key_module_status=!1,$("#NewKeyName_Input").val(e.KeyName),$("#NewKeyHardwareID_Input").val(e.HardwareCode),$("#NewKeyMemo_Input").val(e.Memo),$("#NewKeyName_Input").attr("placeholder","钥匙名称"),$("#NewKeyHardwareID_Input").attr("placeholder","硬件码"),$("#NewKeyMemo_Input").attr("placeholder","备注"),$("#NewKeyType_choice").val(e.KeyType),$("#NewKeyProj_choice").val(e.KeyProj),modal_middle($("#newKeyModal")),$("#newKeyModal").modal("show")}function submit_mod_key_module(){var e=key_selected.KeyCode,t=$("#NewKeyName_Input").val(),a=$("#NewKeyType_choice").val(),o=$("#NewKeyProj_choice").val(),i=$("#NewKeyHardwareID_Input").val(),n=$("#NewKeyMemo_Input").val();if(null===t||""===t)return $("#NewKeyName_Input").attr("placeholder","钥匙名称不能为空"),void $("#NewKeyName_Input").focus();if(null===i||""===i)return $("#NewKeyHardwareID_Input").attr("placeholder","硬件码不能为空"),void $("#NewKeyHardwareID_Input").focus();var l={KeyCode:e,KeyName:t,KeyType:a,KeyProj:o,HardwareCode:i,Memo:n};modify_key(l)}function get_proj_table(e,t){var a={startseq:e,length:t,keyword:global_key_word},o={action:"ProjTable",type:"query",body:a,user:usr.id},i=function(e){return"false"==e.status?void show_expiredModule():(project_table=e.ret.projtable,project_start=parseInt(e.ret.start),project_total=parseInt(e.ret.total),void draw_proj_table_head())};JQ_get(request_head,o,i)}function del_proj(e){var t={ProjCode:e},a={action:"ProjDel",type:"mod",body:t,user:usr.id},o=function(e){var t=e.status;"true"==t?(del_proj_flash=function(){clear_proj_detail_panel(),proj_intialize(0)},setTimeout(function(){show_alarm_module(!1,"删除成功！",del_proj_flash)},500)):setTimeout(function(){show_alarm_module(!0,"删除失败！"+e.msg,null)},500)};JQ_get(request_head,a,o),$("#ProjDelAlarm").modal("hide")}function new_proj(e){var t={ProjCode:e.ProjCode,ProjName:e.ProjName,ChargeMan:e.ChargeMan,Telephone:e.Telephone,Department:e.Department,Address:e.Address,ProStartTime:e.ProStartTime,Stage:e.Stage},a={action:"ProjNew",type:"mod",body:t,user:usr.id},o=function(e){var t=e.status;"true"==t?($("#newProjModal").modal("hide"),new_proj_flash=function(){clear_proj_detail_panel(),proj_intialize(0)},setTimeout(function(){show_alarm_module(!1,"创建成功！",new_proj_flash)},500)):setTimeout(function(){show_alarm_module(!0,"创建失败！"+e.msg,null)},500)};JQ_get(request_head,a,o)}function modify_proj(e){var t={ProjCode:e.ProjCode,ProjName:e.ProjName,ChargeMan:e.ChargeMan,Telephone:e.Telephone,Department:e.Department,Address:e.Address,ProStartTime:e.ProStartTime,Stage:e.Stage},a={action:"ProjMod",type:"mod",body:t,user:usr.id},o=function(e){var t=e.status;"true"==t?($("#newProjModal").modal("hide"),mod_proj_flash=function(){clear_proj_detail_panel(),proj_intialize(0)},setTimeout(function(){show_alarm_module(!1,"修改成功！",mod_proj_flash)},500)):setTimeout(function(){show_alarm_module(!0,"修改失败！"+e.msg,null)},500)};JQ_get(request_head,a,o)}function get_proj_point(e){var t={ProjCode:e},a={action:"PointProj",type:"query",body:t,user:usr.id},o=function(e){return"false"==e.status?void show_expiredModule():(project_selected_point=e.ret,void draw_proj_detail_point_table())};JQ_get(request_head,a,o)}function get_proj_key(e){var t={ProjCode:e},a={action:"ProjKey",type:"query",body:t,user:usr.id},o=function(e){return"false"==e.status?void show_expiredModule():(project_selected_key=e.ret,void draw_proj_detail_key_table())};JQ_get(request_head,a,o)}function proj_intialize(e){project_initial=!0,project_table=null,get_proj_table(e,5*table_row)}function draw_proj_table_head(){if(null!==project_table){var e=Math.ceil(project_table.length/table_row);$("#Proj_Page_control").empty();var t,a="<li><a href='#' id='proj_page_prev'>Prev</a></li>",o=Math.ceil(project_start/table_row);for(t=0;t<e;t++)a=a+"<li><a href='#' id='proj_page_"+t+"'>"+(t+o+1)+"</a></li>";for(a+="<li><a href='#' id='proj_page_next'>Next</a></li>",$("#Proj_Page_control").append(a),table_head="<thead><tr><th>编号</th> <th>名称 </th> <th>责任人 </th> <th>电话 </th> <th>单位 </th>",table_head+="</tr></thread>",proj_page_click=function(){draw_proj_table($(this))},t=0;t<e;t++)$("#proj_page_"+t).on("click",proj_page_click);project_start<=0?$("#proj_page_prev").css("display","none"):($("#proj_page_prev").css("display","block"),$("#proj_page_prev").on("click",function(){var e=project_start-5*table_row;e<0&&(e=0),proj_intialize(e)})),project_start+5*table_row>=project_total?$("#proj_page_next").css("display","none"):($("#proj_page_next").css("display","block"),$("#proj_page_next").on("click",function(){proj_intialize(project_start+5*table_row)})),draw_proj_table($("#proj_page_0"))}}function draw_proj_table(e){if($("#Table_proj").empty(),null!==project_table){var t=(parseInt(e.html())-1)*table_row-project_start,a=table_head;a+="<tbody>";var o;for(o=0;o<table_row;o++)t+o<project_table.length?(a=0!==o%2?a+"<tr class='success li_menu' id='proj_table_cell"+o+"' ProjCode='"+project_table[t+o].ProjCode+"'>":a+"<tr class=' li_menu' id='proj_table_cell"+o+"' ProjCode='"+project_table[t+o].ProjCode+"'>",a=a+"<td>"+project_table[t+o].ProjCode+"</td><td>"+project_table[t+o].ProjName+"</td><td>"+project_table[t+o].ChargeMan+"</td><td>"+project_table[t+o].Telephone+"</td><td>"+project_table[t+o].Department+"</td>",a+="</tr>"):(a=0!==o%2?a+"<tr class='success' id='proj_table_cell"+o+"' ProjCode='null'>":a+"<tr  id='proj_table_cell"+o+"' ProjCode='null'>",a+="<td>--</td><td>--</td><td>--</td><td>--</td><td>--</td>",a+="</tr>");for(a+="</tbody>",$("#Table_proj").append(a),proj_table_cell_click=function(){if("null"!=$(this).attr("ProjCode")){for(var e=0;e<project_table.length;e++)if($(this).attr("ProjCode")==project_table[e].ProjCode){project_selected=project_table[e];break}Initialize_proj_detail(),touchcookie()}},o=0;o<table_row;o++)$("#proj_table_cell"+o).on("click",proj_table_cell_click);touchcookie()}}function Initialize_proj_detail(){draw_proj_detail_panel(),get_proj_point(project_selected.ProjCode),get_proj_key(project_selected.ProjCode)}function clear_proj_detail_panel(){project_selected=null;var e="<p></p><p></p><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt >项目编号：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt >负责人：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd></dl></div><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt>项目名称：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt>电话：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd></dl></div><div class='col-md-12 col-sm-12 col-xs-12 column'><dl ><dt>单位：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt>地址：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt>创建日期：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt>备注：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd></dl></div>";$("#Label_proj_detail").empty(),$("#Label_proj_detail").append(e),$("#Table_proj_point").empty(),$("#Table_proj_key").empty()}function draw_proj_detail_panel(){if($("#Label_proj_detail").empty(),null!==project_selected_point){var e="<p></p><p></p><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt >项目编号：</dt><dd>"+project_selected.ProjCode+"</dd><dt >负责人：</dt><dd>"+project_selected.ChargeMan+"</dd></dl></div><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt>项目名称：</dt><dd>"+project_selected.ProjName+"</dd><dt>电话：</dt><dd>"+project_selected.Telephone+"</dd></dl></div><div class='col-md-12 col-sm-12 col-xs-12 column'><dl ><dt>单位：</dt><dd>"+project_selected.Department+"</dd><dt>地址：</dt><dd>"+project_selected.Address+"</dd><dt>创建日期：</dt><dd>"+project_selected.ProStartTime+"</dd><dt>备注：</dt><dd>"+project_selected.Stage+"</dd></dl></div>";$("#Label_proj_detail").append(e)}}function draw_proj_detail_point_table(){$("#Table_proj_point").empty(),txt="<thead> <tr> <th>站点清单 </th> </tr> </thead> <tbody >",null===project_selected_point&&(project_selected_point=[]);for(var e=0;e<project_selected_point.length;e++)txt=txt+"<tr> <td>"+project_selected_point[e].name+"</td> </tr>";txt+="</tbody>",$("#Table_proj_point").append(txt)}function draw_proj_detail_key_table(){$("#Table_proj_key").empty(),txt="<thead> <tr> <th>钥匙名称 </th> <th>所有人 </th></tr> </thead> <tbody >",null===project_selected_key&&(project_selected_key=[]);for(var e=0;e<project_selected_key.length;e++){var t=project_selected_key[e].username;"none"==t&&(t="部门收管"),txt=txt+"<tr id='"+project_selected_key[e].id+"' class='keyrow'> <td>"+project_selected_key[e].name+"</td> <td>"+t+"</td></tr>"}txt+="</tbody>",$("#Table_proj_key").append(txt),$(".keyrow").on("click",function(){var e=$(this).attr("id");void 0!==e&&""!==e&&get_key_auth_list(e)})}function show_new_proj_module(){$("#newProjModalLabel").text("创建新项目"),project_module_status=!0,$("#ProjProjCode_Input").val(""),$("#ProjProjCode_Input").attr("disabled",!0),$("#ProjProjName_Input").val(""),$("#ProjChargeMan_Input").val(""),$("#ProjTelephone_Input").val(""),$("#ProjDepartment_Input").val(""),$("#ProjAddress_Input").val(""),$("#ProjProStartTime_Input").val(""),$("#ProjStage_Input").val(""),$("#ProjProjCode_Input").attr("placeholder","项目号"),$("#ProjProjName_Input").attr("placeholder","项目名称"),$("#ProjChargeMan_Input").attr("placeholder","负责人姓名"),$("#ProjTelephone_Input").attr("placeholder","联系电话"),$("#ProjDepartment_Input").attr("placeholder","单位名称"),$("#ProjAddress_Input").attr("placeholder","地址"),$("#ProjProStartTime_Input").attr("placeholder","创建时间"),modal_middle($("#newProjModal")),$("#newProjModal").modal("show")}function submit_new_proj_module(){var e=$("#ProjProjCode_Input").val(),t=$("#ProjProjName_Input").val(),a=$("#ProjChargeMan_Input").val(),o=$("#ProjTelephone_Input").val(),i=$("#ProjDepartment_Input").val(),n=$("#ProjAddress_Input").val(),l=$("#ProjProStartTime_Input").val(),d=$("#ProjStage_Input").val();if(null===t||""===t)return $("#ProjProjName_Input").attr("placeholder","项目名称不能为空"),void $("#ProjProjName_Input").focus();if(null===a||""===a)return $("#ProjChargeMan_Input").attr("placeholder","负责人姓名不能为空"),void $("#ProjChargeMan_Input").focus();if(null===o||""===o)return $("#ProjTelephone_Input").attr("placeholder","联系电话不能为空"),void $("#ProjTelephone_Input").focus();if(null===i||""===i)return $("#ProjDepartment_Input").attr("placeholder","单位名称不能为空"),void $("#ProjDepartment_Input").focus();if(null===n||""===n)return $("#ProjAddress_Input").attr("placeholder","地址不能为空"),void $("#ProjAddress_Input").focus();if(null===l||""===l)return $("#ProjProStartTime_Input").attr("placeholder","创建时间不能为空"),void $("#ProjProStartTime_Input").focus();var r={ProjCode:e,ProjName:t,ChargeMan:a,Telephone:o,Department:i,Address:n,ProStartTime:l,Stage:d};new_proj(r)}function show_mod_proj_module(e){$("#newProjModalLabel").text("项目修改"),project_module_status=!1,$("#ProjProjCode_Input").val(e.ProjCode),$("#ProjProjCode_Input").attr("disabled",!0),$("#ProjProjName_Input").val(e.ProjName),$("#ProjChargeMan_Input").val(e.ChargeMan),$("#ProjTelephone_Input").val(e.Telephone),$("#ProjDepartment_Input").val(e.Department),$("#ProjAddress_Input").val(e.Address),$("#ProjProStartTime_Input").val(e.ProStartTime),$("#ProjStage_Input").val(e.Stage),$("#ProjProjCode_Input").attr("placeholder","项目号"),$("#ProjProjName_Input").attr("placeholder","项目名称"),$("#ProjChargeMan_Input").attr("placeholder","负责人姓名"),$("#ProjTelephone_Input").attr("placeholder","联系电话"),$("#ProjDepartment_Input").attr("placeholder","单位名称"),$("#ProjAddress_Input").attr("placeholder","地址"),$("#ProjProStartTime_Input").attr("placeholder","创建时间"),modal_middle($("#newProjModal")),$("#newProjModal").modal("show")}function submit_mod_proj_module(){var e=$("#ProjProjCode_Input").val(),t=$("#ProjProjName_Input").val(),a=$("#ProjChargeMan_Input").val(),o=$("#ProjTelephone_Input").val(),i=$("#ProjDepartment_Input").val(),n=$("#ProjAddress_Input").val(),l=$("#ProjProStartTime_Input").val(),d=$("#ProjStage_Input").val(),r={ProjCode:e,ProjName:t,ChargeMan:a,Telephone:o,Department:i,Address:n,ProStartTime:l,Stage:d};modify_proj(r)}function get_point_table(e,t){var a={startseq:e,length:t,keyword:global_key_word},o={action:"PointTable",type:"query",body:a,user:usr.id},i=function(e){return"false"==e.status?void show_expiredModule():(point_table=e.ret.pointtable,point_start=parseInt(e.ret.start),point_total=parseInt(e.ret.total),void draw_point_table_head())};JQ_get(request_head,o,i)}function del_point(e){var t={StatCode:e},a={action:"PointDel",type:"mod",body:t,user:usr.id},o=function(e){var t=e.status;"true"==t?(del_point_flash=function(){clear_point_detail_panel(),point_intialize(0)},setTimeout(function(){show_alarm_module(!1,"删除成功！",del_point_flash)},500)):setTimeout(function(){show_alarm_module(!0,"删除失败！"+e.msg,null)},500)};JQ_get(request_head,a,o),$("#PointDelAlarm").modal("hide")}function new_point(e){var t={StatCode:e.StatCode,StatName:e.StatName,ProjCode:e.ProjCode,ChargeMan:e.ChargeMan,Telephone:e.Telephone,Longitude:e.Longitude,Latitude:e.Latitude,Department:e.Department,Address:e.Address,Country:e.Country,Street:e.Street,Square:e.Square,ProStartTime:e.ProStartTime,Stage:e.Stage},a={action:"PointNew",type:"mod",body:t,user:usr.id},o=function(e){var t=e.status;"true"==t?($("#newPointModal").modal("hide"),new_point_flash=function(){clear_point_detail_panel(),point_intialize(0)},setTimeout(function(){show_alarm_module(!1,"创建成功！",new_point_flash)},500)):setTimeout(function(){show_alarm_module(!0,"创建失败！"+e.msg,null)},500)};JQ_get(request_head,a,o)}function modify_point(e){var t={StatCode:e.StatCode,StatName:e.StatName,ProjCode:e.ProjCode,ChargeMan:e.ChargeMan,Telephone:e.Telephone,Longitude:e.Longitude,Latitude:e.Latitude,Department:e.Department,Address:e.Address,Country:e.Country,Street:e.Street,Square:e.Square,ProStartTime:e.ProStartTime,Stage:e.Stage},a={action:"PointMod",type:"mod",body:t,user:usr.id},o=function(e){var t=e.status;"true"==t?($("#newPointModal").modal("hide"),mod_point_flash=function(){clear_point_detail_panel(),point_intialize(0)},setTimeout(function(){show_alarm_module(!1,"修改成功！",mod_point_flash)},500)):setTimeout(function(){show_alarm_module(!0,"修改失败！"+e.msg,null)},500)};JQ_get(request_head,a,o)}function get_point_device(e){var t={StatCode:e},a={action:"PointDev",type:"query",body:t,user:usr.id},o=function(e){return"false"==e.status?void show_expiredModule():(point_selected_device=e.ret,void draw_point_detail_panel())};JQ_get(request_head,a,o)}function get_point_picture(e){var t={StatCode:e},a={action:"PointPicture",type:"query",body:t,user:usr.id},o=function(e){return"false"==e.status?void show_expiredModule():(point_selected_picture=e.ret,void draw_point_picture_panel())};JQ_get(request_head,a,o)}function point_intialize(e){point_initial=!0,point_table=null,get_project_list(),get_point_table(e,5*table_row),clear_point_detail_panel()}function draw_point_table_head(){if(null!==point_table){var e=Math.ceil(point_table.length/table_row);$("#Point_Page_control").empty();var t,a="<li><a href='#' id='point_page_prev'>Prev</a></li>",o=Math.ceil(point_start/table_row);for(t=0;t<e;t++)a=a+"<li><a href='#' id='point_page_"+t+"'>"+(t+o+1)+"</a></li>";for(a+="<li><a href='#' id='point_page_next'>Next</a></li>",$("#Point_Page_control").append(a),table_head="<thead><tr><th>编号</th> <th>名称 </th> <th>项目</th> <th>责任人 </th> <th>电话 </th> ",table_head+="</tr></thread>",point_page_click=function(){draw_point_table($(this))},t=0;t<e;t++)$("#point_page_"+t).on("click",point_page_click);point_start<=0?$("#point_page_prev").css("display","none"):($("#point_page_prev").css("display","block"),$("#point_page_prev").on("click",function(){var e=point_start-5*table_row;e<0&&(e=0),point_intialize(e)})),point_start+5*table_row>=point_total?$("#point_page_next").css("display","none"):($("#point_page_next").css("display","block"),$("#point_page_next").on("click",function(){point_intialize(point_start+5*table_row)})),draw_point_table($("#point_page_0"))}}function draw_point_table(e){if($("#Table_point").empty(),null!==point_table){var t=(parseInt(e.html())-1)*table_row-point_start,a=table_head;a+="<tbody>";var o;for(o=0;o<table_row;o++)if(t+o<point_table.length){for(var i="",n=0;n<project_list.length;n++)if(point_table[t+o].ProjCode==project_list[n].id){i=project_list[n].name;break}a=0!==o%2?a+"<tr class='success li_menu' id='point_table_cell"+o+"' StatCode='"+point_table[t+o].StatCode+"'>":a+"<tr class=' li_menu' id='point_table_cell"+o+"' StatCode='"+point_table[t+o].StatCode+"'>",a=a+"<td>"+point_table[t+o].StatCode+"</td><td>"+point_table[t+o].StatName+"</td><td>"+i+"</td><td>"+point_table[t+o].ChargeMan+"</td><td>"+point_table[t+o].Telephone+"</td>",a+="</tr>"}else a=0!==o%2?a+"<tr class='success' id='point_table_cell"+o+"' StatCode='null'>":a+"<tr  id='point_table_cell"+o+"' StatCode='null'>",a+="<td>--</td><td>--</td><td>--</td><td>--</td><td>--</td><td>--</td>",a+="</tr>";for(a+="</tbody>",$("#Table_point").append(a),point_table_cell_click=function(){if("null"!=$(this).attr("StatCode")){for(var e=0;e<point_table.length;e++)if($(this).attr("StatCode")==point_table[e].StatCode){point_selected=point_table[e];break}Initialize_point_detail(),touchcookie()}},o=0;o<table_row;o++)$("#point_table_cell"+o).on("click",point_table_cell_click);touchcookie()}}function Initialize_point_detail(){get_point_device(point_selected.StatCode),get_point_picture(point_selected.StatCode)}function clear_point_detail_panel(){point_selected=null;var e="<button class='btn btn-default' type='button' disabled = 'true'>已激活</button><p></p><p></p><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt >站点编号：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt >负责人：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd></dl></div><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt>站点名称：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt>电话：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd></dl></div><div class='col-md-12 col-sm-12 col-xs-12 column'><dl ><dt>关联项目：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt>单位：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd></dl></div><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt >经度：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt >区县：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd></dl></div><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt>纬度：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt>街镇：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd></dl></div><div class='col-md-12 col-sm-12 col-xs-12 column'><dl ><dt>地址：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt>备注：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd></dl></div>";
$("#Label_point_detail").empty(),$("#Label_point_detail").append(e),$("#Table_point_device").empty(),$("#Table_point_picture").empty()}function draw_point_detail_panel(){if($("#Label_point_detail").empty(),null!==point_selected_device){var e="";null===project_list&&(project_list=[]);for(var t=0;t<project_list.length;t++)if(point_selected.ProjCode==project_list[t].id){e=project_list[t].name;break}var a="<button class='btn btn-default' type='button' id='selectpointactivebutton' disabled = 'true'>查询中</button><p></p><p></p><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt >站点编号：</dt><dd>"+point_selected.StatCode+"</dd><dt >负责人：</dt><dd>"+point_selected.ChargeMan+"</dd></dl></div><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt>站点名称：</dt><dd>"+point_selected.StatName+"</dd><dt>电话：</dt><dd>"+point_selected.Telephone+"</dd></dl></div><div class='col-md-12 col-sm-12 col-xs-12 column'><dl ><dt>关联项目：</dt><dd>"+e+"</dd><dt>单位：</dt><dd>"+point_selected.Department+"</dd></dl></div><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt >经度：</dt><dd>"+point_selected.Longitude+"</dd><dt >区县：</dt><dd>"+point_selected.Country+"</dd></dl></div><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt>纬度：</dt><dd>"+point_selected.Latitude+"</dd><dt>街镇：</dt><dd>"+point_selected.Street+"</dd></dl></div><div class='col-md-12 col-sm-12 col-xs-12 column'><dl ><dt>地址：</dt><dd>"+point_selected.Address+"</dd><dt>备注：</dt><dd>"+point_selected.Stage+"</dd></dl></div>";$("#Label_point_detail").append(a),$("#Table_point_device").empty(),a="<thead> <tr> <th>监控设备清单 </th> </tr> </thead> <tbody >",null===point_selected_device&&(point_selected_device=[]);for(var o=0;o<point_selected_device.length;o++)a=a+"<tr> <td>"+point_selected_device[o].name+"</td> </tr>";a+="</tbody>",$("#Table_point_device").append(a),getselectedstationactived(),$("#selectpointactivebutton").on("click",function(){$("#StationActiveConfirmModalContent").text("确定要激活站点："+point_selected.StatName+"?"),modal_middle($("#StationActiveConfirm")),$("#StationActiveConfirm").modal("show")})}}function draw_point_picture_panel(){$("#Table_point_picture").empty(),txt="<thead> <tr> <th>站点照片 </th> </tr> </thead> <tbody >",null===point_selected_picture&&(point_selected_picture=[]);for(var e=0;e<point_selected_picture.length;e++)txt=txt+"<tr> <td class='pictd' picurl='"+point_selected_picture[e].url+"' >"+point_selected_picture[e].name+"</td> </tr>";txt+="</tbody>",$("#Table_point_picture").append(txt),$(".pictd").on("click",function(){console.log("http://"+window.location.host+"/"+$(this).attr("picurl")),window.open("http://"+window.location.host+"/"+show_image_url+"?image="+$(this).attr("picurl")+"#","监控照片","height=620, width=640, top=0, left=400,toolbar=no, menubar=no, scrollbars=no, resizable=no, location=no, status=no")})}function show_new_point_module(){$("#newPointModalLabel").text("创建新站点"),point_module_status=!0,$("#PointLatitude_Input").attr("disabled",!0),$("#PointLongitude_Input").attr("disabled",!0),$("#PointStatCode_Input").val(""),$("#PointStatCode_Input").attr("disabled",!0),$("#PointStatName_Input").val(""),$("#PointChargeMan_Input").val(""),$("#PointTelephone_Input").val(""),$("#PointLongitude_Input").val(""),$("#PointLatitude_Input").val(""),$("#PointDepartment_Input").val(""),$("#PointAddress_Input").val(""),$("#PointCountry_Input").val(""),$("#PointStreet_Input").val(""),$("#PointStage_Input").val(""),$("#PointProjCode_choice").empty(),$("#PointProjCode_choice").append(get_proj_option()),$("#PointStatCode_Input").attr("placeholder","站点号"),$("#PointStatName_Input").attr("placeholder","站点名称"),$("#PointChargeMan_Input").attr("placeholder","负责人姓名"),$("#PointTelephone_Input").attr("placeholder","联系电话"),$("#PointLongitude_Input").attr("placeholder","经度"),$("#PointLatitude_Input").attr("placeholder","纬度"),$("#PointDepartment_Input").attr("placeholder","单位名称"),$("#PointAddress_Input").attr("placeholder","地址"),$("#PointCountry_Input").attr("placeholder","区县"),$("#PointStreet_Input").attr("placeholder","街镇"),modal_middle($("#newPointModal")),$("#newPointModal").modal("show")}function submit_new_point_module(){var e=$("#PointStatCode_Input").val(),t=$("#PointStatName_Input").val(),a=$("#PointProjCode_choice").val(),o=$("#PointChargeMan_Input").val(),i=$("#PointTelephone_Input").val(),n=$("#PointLongitude_Input").val(),l=$("#PointLatitude_Input").val(),d=$("#PointDepartment_Input").val(),r=$("#PointAddress_Input").val(),_=$("#PointCountry_Input").val(),s=$("#PointStreet_Input").val(),c="0",u="1999-01-01",p=$("#PointStage_Input").val();if(null===t||""===t)return $("#PointStatName_Input").attr("placeholder","站点名称不能为空"),void $("#PointStatName_Input").focus();if(null===o||""===o)return $("#PointChargeMan_Input").attr("placeholder","负责人姓名不能为空"),void $("#PointChargeMan_Input").focus();if(null===a||""===a)return $("#PointProjCode_choice").attr("placeholder","项目不能为空"),void $("#PointProjCode_choice").focus();if(null===i||""===i)return $("#PointTelephone_Input").attr("placeholder","联系电话不能为空"),void $("#PointTelephone_Input").focus();if(null===d||""===d)return $("#PointDepartment_Input").attr("placeholder","单位名称不能为空"),void $("#PointDepartment_Input").focus();if(null===r||""===r)return $("#PointAddress_Input").attr("placeholder","地址不能为空"),void $("#PointAddress_Input").focus();if(null===_||""===_)return $("#PointCountry_Input").attr("placeholder","区县不能为空"),void $("#PointCountry_Input").focus();if(null===s||""===s)return $("#PointStreet_Input").attr("placeholder","街镇不能为空"),void $("#PointStreet_Input").focus();var m={StatCode:e,StatName:t,ProjCode:a,ChargeMan:o,Telephone:i,Longitude:n,Latitude:l,Department:d,Address:r,Country:_,Street:s,Square:c,ProStartTime:u,Stage:p};new_point(m)}function show_mod_point_module(e){$("#newPointModalLabel").text("站点修改"),point_module_status=!1,$("#PointLatitude_Input").attr("disabled",!1),$("#PointLongitude_Input").attr("disabled",!1),$("#PointStatCode_Input").val(e.StatCode),$("#PointStatCode_Input").attr("disabled",!0),$("#PointStatName_Input").val(e.StatName),$("#PointChargeMan_Input").val(e.ChargeMan),$("#PointTelephone_Input").val(e.Telephone),$("#PointLongitude_Input").val(e.Longitude),$("#PointLatitude_Input").val(e.Latitude),$("#PointDepartment_Input").val(e.Department),$("#PointAddress_Input").val(e.Address),$("#PointCountry_Input").val(e.Country),$("#PointStreet_Input").val(e.Street),$("#PointSquare_Input").val(e.Square),$("#PointProjCode_choice").empty(),$("#PointProjCode_choice").append(get_proj_option()),$("#PointProjCode_choice").val(e.ProjCode),$("#PointStatCode_Input").attr("placeholder","站点号"),$("#PointStatName_Input").attr("placeholder","站点名称"),$("#PointChargeMan_Input").attr("placeholder","负责人姓名"),$("#PointTelephone_Input").attr("placeholder","联系电话"),$("#PointLongitude_Input").attr("placeholder","经度"),$("#PointLatitude_Input").attr("placeholder","纬度"),$("#PointDepartment_Input").attr("placeholder","单位名称"),$("#PointAddress_Input").attr("placeholder","地址"),$("#PointCountry_Input").attr("placeholder","区县"),$("#PointStreet_Input").attr("placeholder","街镇"),modal_middle($("#newPointModal")),$("#newPointModal").modal("show")}function submit_mod_point_module(){var e=$("#PointStatCode_Input").val(),t=$("#PointStatName_Input").val(),a=$("#PointProjCode_choice").val(),o=$("#PointChargeMan_Input").val(),i=$("#PointTelephone_Input").val(),n=$("#PointLongitude_Input").val(),l=$("#PointLatitude_Input").val(),d=$("#PointDepartment_Input").val(),r=$("#PointAddress_Input").val(),_=$("#PointCountry_Input").val(),s=$("#PointStreet_Input").val(),c="0",u="1999-01-01",p=$("#PointStage_Input").val(),m={StatCode:e,StatName:t,ProjCode:a,ChargeMan:o,Telephone:i,Longitude:n,Latitude:l,Department:d,Address:r,Country:_,Street:s,Square:c,ProStartTime:u,Stage:p};modify_point(m)}function get_proj_point_list(){var e={action:"ProjPoint",type:"query",user:usr.id},t=function(e){return"false"==e.status?void show_expiredModule():void(point_list=e.ret)};JQ_get(request_head,e,t)}function get_dev_table(e,t){var a={startseq:e,length:t,keyword:global_key_word},o={action:"DevTable",body:a,type:"query",user:usr.id},i=function(e){return"false"==e.status?void show_expiredModule():(device_table=e.ret.devtable,device_start=parseInt(e.ret.start),device_total=parseInt(e.ret.total),void window.setTimeout(draw_dev_table_head,wait_time_middle))};JQ_get(request_head,o,i)}function del_dev(e){var t={DevCode:e},a={action:"DevDel",type:"mod",body:t,user:usr.id},o=function(e){var t=e.status;"true"==t?(del_dev_flash=function(){clear_dev_detail_panel(),dev_intialize(0)},setTimeout(function(){show_alarm_module(!1,"删除成功！",del_dev_flash)},500)):setTimeout(function(){show_alarm_module(!0,"删除失败！"+e.msg,null)},500)};JQ_get(request_head,a,o),$("#DevDelAlarm").modal("hide")}function new_dev(e){var t={DevCode:e.DevCode,StatCode:e.StatCode,StartTime:e.StartTime,PreEndTime:e.PreEndTime,EndTime:e.EndTime,DevStatus:e.DevStatus,VideoURL:e.VideoURL},a={action:"DevNew",type:"mod",body:t,user:usr.id},o=function(e){var t=e.status;"true"==t?($("#newDevModal").modal("hide"),new_dev_flash=function(){clear_dev_detail_panel(),dev_intialize(0)},setTimeout(function(){show_alarm_module(!1,"创建成功！",new_dev_flash)},500)):setTimeout(function(){show_alarm_module(!0,"创建失败！"+e.msg,null)},500)};JQ_get(request_head,a,o)}function modify_dev(e){var t={DevCode:e.DevCode,StatCode:e.StatCode,StartTime:e.StartTime,PreEndTime:e.PreEndTime,EndTime:e.EndTime,DevStatus:e.DevStatus,VideoURL:e.VideoURL},a={action:"DevMod",type:"mod",body:t,user:usr.id},o=function(e){var t=e.status;"true"==t?($("#newDevModal").modal("hide"),mod_dev_flash=function(){clear_dev_detail_panel(),dev_intialize(0)},setTimeout(function(){show_alarm_module(!1,"修改成功！",mod_dev_flash)},500)):setTimeout(function(){show_alarm_module(!0,"修改失败！"+e.msg,null)},500)};JQ_get(request_head,a,o)}function dev_intialize(e){device_initial=!0,device_table=null,get_dev_table(e,5*table_row),get_project_list(),get_proj_point_list(),clear_dev_detail_panel()}function draw_dev_table_head(){if(null!==device_table){var e=Math.ceil(device_table.length/table_row);$("#Dev_Page_control").empty();var t,a="<li><a href='#' id='dev_page_prev'>Prev</a></li>",o=Math.ceil(device_start/table_row);for(t=0;t<e;t++)a=a+"<li><a href='#' id='dev_page_"+t+"'>"+(t+o+1)+"</a></li>";for(a+="<li><a href='#' id='dev_page_next'>Next</a></li>",$("#Dev_Page_control").append(a),table_head="<thead><tr><th>编号 </th> <th>项目名称 </th> <th>站点名称 </th><th>安装时间 </th> <th>是否启动 </th>",table_head+="</tr></thread>",dev_page_click=function(){draw_dev_table($(this))},t=0;t<e;t++)$("#dev_page_"+t).on("click",dev_page_click);device_start<=0?$("#dev_page_prev").css("display","none"):($("#dev_page_prev").css("display","block"),$("#dev_page_prev").on("click",function(){var e=device_start-5*table_row;e<0&&(e=0),dev_intialize(e)})),device_start+5*table_row>=device_total?$("#dev_page_next").css("display","none"):($("#dev_page_next").css("display","block"),$("#dev_page_next").on("click",function(){dev_intialize(device_start+5*table_row)})),draw_dev_table($("#dev_page_0"))}}function draw_dev_table(e){if($("#Table_dev").empty(),null!==device_table){var t=(parseInt(e.html())-1)*table_row-device_start,a=table_head;a+="<tbody>";var o;for(o=0;o<table_row;o++)if(t+o<device_table.length){a=0!==o%2?a+"<tr class='success li_menu' id='dev_table_cell"+o+"' DevCode='"+device_table[t+o].DevCode+"'>":a+"<tr class=' li_menu' id='dev_table_cell"+o+"' DevCode='"+device_table[t+o].DevCode+"'>";var i="开启";"false"===device_table[t+o].DevStatus&&(i="关闭"),a=a+"<td>"+device_table[t+o].DevCode+"</td><td>"+get_proj_name(device_table[t+o].ProjCode)+"</td><td>"+get_point_name(device_table[t+o].StatCode)+"</td><td>"+device_table[t+o].StartTime+"</td><td>"+i+"</td>",a+="</tr>"}else a=0!==o%2?a+"<tr class='success' id='dev_table_cell"+o+"' DevCode='null'>":a+"<tr  id='dev_table_cell"+o+"' DevCode='null'>",a+="<td>--</td><td>--</td><td>--</td><td>--</td><td>--</td>",a+="</tr>";for(a+="</tbody>",$("#Table_dev").append(a),dev_table_cell_click=function(){if("null"!=$(this).attr("DevCode")){for(var e=0;e<device_table.length;e++)if($(this).attr("DevCode")==device_table[e].DevCode){device_selected=device_table[e];break}Initialize_dev_detail(),touchcookie()}},o=0;o<table_row;o++)$("#dev_table_cell"+o).on("click",dev_table_cell_click);touchcookie()}}function Initialize_dev_detail(){get_device_sensor(device_selected.DevCode)}function clear_dev_detail_panel(){project_selected=null;var e="<p></p><p></p><div class='col-md-12 col-sm-12 col-xs-12 column'><dl ><dt>设备编号：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd></dl></div><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt >项目：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt >安装时间：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt >MAC地址：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd></dl></div><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt>站点：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt >IP地址：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt >设备是否启动：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd></dl></div><div class='col-md-12 col-sm-12 col-xs-12 column'><dl ><dt>视频地址：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd></dl></div>";$("#Label_dev_detail").empty(),$("#Label_dev_detail").append(e),$("#Table_device_sensor").empty()}function draw_dev_detail_panel(){if($("#Label_dev_detail").empty(),null!==device_selected_sensor){var e="开启";"false"===device_selected.DevStatus&&(e="关闭");var t="<p></p><p></p><div class='col-md-12 col-sm-12 col-xs-12 column'><dl ><dt>设备编号：</dt><dd>"+device_selected.DevCode+"</dd></dl></div><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt >项目：</dt><dd>"+get_proj_name(device_selected.ProjCode)+"</dd><dt >安装时间：</dt><dd>"+device_selected.StartTime+"</dd><dt >MAC地址：</dt><dd>"+device_selected.MAC+"</dd></dl></div><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt>站点：</dt><dd>"+get_point_name(device_selected.StatCode)+"</dd><dt >IP地址：</dt><dd>"+device_selected.IP+"</dd><dt >设备是否启动：</dt><dd>"+e+"</dd></dl></div><div class='col-md-12 col-sm-12 col-xs-12 column'><dl ><dt>视频地址：</dt><dd>"+device_selected.VideoURL+"</dd></dl></div>";$("#Label_dev_detail").append(t),$("#Table_device_sensor").empty(),t="<thead> <tr> <th>传感器 </th><th>状态 </th> </tr> </thead> <tbody >";var a;for(null===device_selected_sensor&&(device_selected_sensor=[]),a=0;a<device_selected_sensor.length;a++){var o="开启";"false"==device_selected_sensor[a].status&&(o="关闭"),t=t+"<tr class=' li_menu' id='sensor_table_cell"+a+"' sequence='"+a+"'> <td>"+get_sensor_name(device_selected_sensor[a].id)+"</td><td>"+o+"</td> </tr>"}for($("#Table_device_sensor").append(t),sensor_table_cell_click=function(){"null"!=$(this).attr("sequence")&&(select_sensor=device_selected_sensor[parseInt($(this).attr("sequence"))],show_sensor_module())},a=0;a<device_selected_sensor.length;a++)$("#sensor_table_cell"+a).on("click",sensor_table_cell_click)}}function show_new_dev_module(){$("#newDevModalLabel").text("创建新设备"),device_module_status=!0,$("#DevDevCode_Input").attr("disabled",!1),$("#DevDevCode_Input").val(""),$("#DevStatCode_choice").empty(),$("#DevProjCode_choice").empty(),$("#DevProjCode_choice").append(get_proj_option()),get_proj_point_option($("#DevProjCode_choice").val(),$("#DevStatCode_choice"),""),$("#DevStartTime_Input").val(""),$("#DevDevStatus_choice").val("true"),$("#DevVideoURL_Input").val(""),$("#DevDevCode_Input").attr("placeholder","设备编号"),$("#DevStartTime_Input").attr("placeholder","安装时间"),modal_middle($("#newDevModal")),$("#newDevModal").modal("show")}function submit_new_dev_module(){var e=$("#DevDevCode_Input").val(),t=$("#DevStatCode_choice").val(),a=$("#DevStartTime_Input").val(),o="1999-01-01",i="1999-01-01",n=$("#DevDevStatus_choice").val(),l=$("#DevVideoURL_Input").val();if(null===e||""===e)return $("#DevDevCode_Input").attr("placeholder","设备号不能为空"),void $("#DevDevCode_Input").focus();if(null===t||""===t)return $("#DevStatCode_choice").attr("placeholder","项目不能为空"),void $("#DevStatCode_choice").focus();if(null===a||""===a)return $("#DevStartTime_Input").attr("placeholder","负责人姓名不能为空"),void $("#DevStartTime_Input").focus();var d={DevCode:e,StatCode:t,StartTime:a,PreEndTime:o,EndTime:i,DevStatus:n,VideoURL:l};new_dev(d)}function show_mod_dev_module(e){$("#newDevModalLabel").text("设备修改"),device_module_status=!1,$("#DevDevCode_Input").attr("disabled",!0),$("#DevDevCode_Input").val(e.DevCode),$("#DevStatCode_choice").empty(),$("#DevProjCode_choice").empty(),$("#DevProjCode_choice").append(get_proj_option(e.ProjCode)),get_proj_point_option($("#DevProjCode_choice").val(),$("#DevStatCode_choice"),e.StatCode),$("#DevStatCode_choice").val(e.StatCode),$("#DevStartTime_Input").val(e.StartTime),e.DevStatus?$("#DevDevStatus_choice").val("true"):$("#DevDevStatus_choice").val("false"),$("#DevVideoURL_Input").val(e.VideoURL),$("#DevDevCode_Input").attr("placeholder","设备编号"),$("#DevStartTime_Input").attr("placeholder","安装时间"),modal_middle($("#newDevModal")),$("#newDevModal").modal("show")}function submit_mod_dev_module(){var e=$("#DevDevCode_Input").val(),t=$("#DevStatCode_choice").val(),a=$("#DevStartTime_Input").val(),o="1999-01-01",i="1999-01-01",n=$("#DevDevStatus_choice").val(),l=$("#DevVideoURL_Input").val(),d={DevCode:e,StatCode:t,StartTime:a,PreEndTime:o,EndTime:i,DevStatus:n,VideoURL:l};modify_dev(d)}function get_proj_name(e){var t=null;null===project_list&&(project_list=[]);for(var a=0;a<project_list.length;a++)if(project_list[a].id==e){t=project_list[a].name;break}return t}function get_point_name(e){var t=null;null===point_list&&(point_list=[]);for(var a=0;a<point_list.length;a++)if(point_list[a].id==e){t=point_list[a].name;break}return t}function get_proj_option(e){txt="",null===project_list&&(project_list=[]);for(var t=0;t<project_list.length;t++)project_list[t].id==e?txt=txt+"<option value="+project_list[t].id+" selected='selected'>"+project_list[t].name+"</option>":txt=txt+"<option value="+project_list[t].id+">"+project_list[t].name+"</option>";return txt}function get_proj_point_option(e,t,a){if(t.empty(),""!==e&&null!==e){var o="";null===point_list&&(point_list=[]);for(var i=0;i<point_list.length;i++)point_list[i].ProjCode==e&&(o=point_list[i].id==a?o+"<option value="+point_list[i].id+" selected='selected' >"+point_list[i].name+"</option>":o+"<option value="+point_list[i].id+">"+point_list[i].name+"</option>");t.empty(),t.append(o)}}function get_monitor_list(){var e={action:"MonitorList",type:"query",user:usr.id},t=function(e){return"false"==e.status?void show_expiredModule():void(monitor_map_list=e.ret)};JQ_get(request_head,e,t)}function get_monitor_alarm_list(){var e={action:"MonitorAlarmList",type:"query",user:usr.id},t=function(e){return"false"==e.status?void show_expiredModule():void(alarm_map_list=e.ret)};JQ_get(request_head,e,t)}function get_monitor_warning_on_map(){if(null!==monitor_selected&&null!==monitor_map_handle){var e={StatCode:monitor_selected.StatCode},t={action:"DevAlarm",body:e,type:"query",user:usr.id},a=function(e){if("false"==e.status)return void show_expiredModule();var t=e.ret.alarmlist,a="";if("false"==t)a="<Strong>获取告警失败</Strong>";else{a="<div id ='Element_card_floating' align='center' ><p style='font-size:16px;font-weight: 800' >站点名称："+monitor_selected.StatName+"</p><HR style='FILTER: alpha(opacity=100,finishopacity=0,style=3)' width='80%' color=#987cb9 SIZE=3/><div style='font-size:10px; min-height: 500px; min-width:480px' >",a+=" <div class='col-md-6 column'>";for(var o=0;o<t.length;o++){t[o].AlarmEName;a=a+"<img src='./svg/icon/"+t[o].AlarmEName+".svg' style='width:36px;hight:36px'></img><label style='max-width: 150px;min-width: 150px;font-size: 14px'>&nbsp&nbsp&nbsp&nbsp"+t[o].AlarmName+":";var i=t[o].AlarmValue,n=t[o].WarningTarget;a="true"==n?a+"<Strong style='color:red'>"+i+"</Strong>"+t[o].AlarmUnit+"</label>":a+"<Strong>"+i+"</Strong>"+t[o].AlarmUnit+"</label>",a+="<HR style='FILTER: alpha(opacity=100,finishopacity=0,style=3)' width='80%' color=#987cb9 SIZE=3/>",o==t.length/2-1&&(a+="</div><div class='col-md-6 column'>")}a+="</div></div>"}null!==monitor_map_handle&&($("#infowindow").empty(),$("#infowindow").append(a)),$("#VideoStatCode_Input").val(monitor_selected.StatName),video_selection_change()};JQ_get(request_head,t,a)}}function monitor_lock(){var e=monitor_selected.StatCode;void 0!==e&&show_openlockmodule(e)}function initializeMap(){get_monitor_list();var e=parseInt($("#MPMonitorViewMap").css("min-height").replace(/[^0-9]/gi,""));window.screen.availHeight-275>e&&(e=window.screen.availHeight-275),$("#MPMonitorViewMap").css("min-height",e+"px"),map_MPMonitor=new BMap.Map("MPMonitorViewMap"),map_MPMonitor.addControl(new BMap.NavigationControl),map_MPMonitor.enableScrollWheelZoom();var t=new BMap.Marker(new BMap.Point(111.404,40.915));map_MPMonitor.addOverlay(t);var a=new BMap.Label("1234",{offset:new BMap.Size((-50),(-50)),position:new BMap.Point(111.404,40.915)});a.setStyle({fontSize:"14px",border:"0",height:"100px",width:"100px",textAlign:"center",lineHeight:"12px",background:"#000000",opacity:.75}),t.addEventListener("click",function(){map_MPMonitor.addOverlay(a)}),map_MPMonitor.removeOverlay(t),null===usr_faverate_list||0===usr_faverate_list.length?(console.log("usr_faverate_list:"+usr_faverate_list),map_MPMonitor.centerAndZoom(new BMap.Point(parseFloat(user_point.Longitude),parseFloat(user_point.Latitude)),15)):map_MPMonitor.centerAndZoom(new BMap.Point(parseFloat(usr_faverate_list[0].Longitude),parseFloat(usr_faverate_list[0].Latitude)),15),window.setTimeout(addMarker,wait_time_long),map_initialized=!0}function get_select_monitor(e){var t=e.split(":");null===monitor_map_list&&(monitor_map_list=[]);for(var a=0;a<monitor_map_list.length;a++)if(monitor_map_list[a].StatCode==t[0])return monitor_selected=monitor_map_list[a],void favorateCount(monitor_selected.StatCode);monitor_selected=null}function addMarker(e){if(null!==monitor_map_list){var t=new BMap.Icon("./image/map-marker-ball-azure-small.png",new BMap.Size(32,32),{anchor:new BMap.Size(16,30)});monitor_mark_click=function(){get_select_monitor(this.getTitle());this.getTitle();null!==monitor_map_handle&&(map_MPMonitor.removeOverlay(monitor_map_handle),monitor_map_handle=null),temp="<div style='padding: 10px;min-width:150px'><div class='pull-left' style='margin-top:5px'><a class='maintext' style='font-size: 18px;font-weight:900'>状态监控</a></div><div class='pull-right' style='margin-top: -5px;margin-right: -7px'><a class='label_close_button' >[x]</a></div><div id='infowindow' style='margin-top: 40px;'>",temp+="</div></div>";var e=new BMap.Label(temp,{offset:new BMap.Size(24,(-32)),position:new BMap.Point(parseFloat(monitor_selected.Longitude),parseFloat(monitor_selected.Latitude))});e.setStyle({fontSize:"24px",border:"0",textAlign:"left",lineHeight:"10px",background:"#ffffff",opacity:.9}),monitor_map_handle=e,get_monitor_warning_on_map(),map_MPMonitor.addOverlay(e),$(".label_close_button").on("click",function(){console.log("close button click"),null!==monitor_map_handle&&(map_MPMonitor.removeOverlay(monitor_map_handle),monitor_map_handle=null)})},null===monitor_map_list&&(monitor_map_list=[]),console.log(monitor_map_list);for(var a=0;a<monitor_map_list.length;a++){var o=new BMap.Point(parseFloat(monitor_map_list[a].Longitude),parseFloat(monitor_map_list[a].Latitude)),i=new BMap.Marker(o,{icon:t});i.setTitle(monitor_map_list[a].StatCode+":"+monitor_map_list[a].StatName),map_MPMonitor.addOverlay(i),i.addEventListener("click",monitor_mark_click),mark_MPMonitor_List.push(i)}}}function video_selection_change(){null!==monitor_selected&&""!==$("#Video_query_Input").val()&&get_video(monitor_selected.StatCode,$("#Video_query_Input").val(),$("#VideoHour_choice").val())}function get_video(e,t,a){var o={StatCode:e,date:t,hour:a},i={action:"GetVideoList",body:o,type:"query",user:usr.id},n=function(e){if("false"==e.status)return void show_expiredModule();var t=e.ret;$("#VCRStatus_choice").empty();for(var a="",o=0;o<t.length;o++)a=a+"<option value='"+t[o].id+"'>"+t[o].attr+"</option>";$("#VCRStatus_choice").append(a)};JQ_get(request_head,i,n)}function video_Module_selection_change(){""!==$("#VideoModuleStatCode_Input").val()&&""!==$("#VideoModule_query_Input").val()&&get_Module_video($("#VideoModuleStatCode_Input").val(),$("#VideoModule_query_Input").val(),$("#VideoModuleHour_choice").val())}function get_Module_video(e,t,a){var o={StatCode:e,date:t,hour:a},i={action:"GetVideoList",body:o,type:"query",user:usr.id},n=function(e){if("false"==e.status)return void show_expiredModule();var t=e.ret;$("#ModuleVCRStatus_choice").empty();for(var a="",o=0;o<t.length;o++)a=a+"<option value='"+t[o].id+"'>"+t[o].attr+"</option>";$("#ModuleVCRStatus_choice").append(a)};JQ_get(request_head,i,n)}function initialize_warning_table(){$("#Monitor_Page_control").empty(),$("#Table_Monitor").empty();var e,t="<li><a href='#' id='monitor_page_prev'>Prev</a></li>",a=Math.ceil(monitor_map_list.length/(2*table_row));for(e=0;e<a;e++)t=t+"<li><a href='#' id='monitor_page_"+e+"' number='"+e+"'>"+(e+1)+"</a></li>";for(t+="<li><a href='#' id='monitor_page_next'>Next</a></li>",$("#Monitor_Page_control").append(t),Monitor_table_start=0,Monitor_table_total=a,0===Monitor_table_start?$("#monitor_page_prev").css("display","none"):$("#monitor_page_prev").css("display","block"),Monitor_table_start+5>=Monitor_table_total?$("#monitor_page_next").css("display","none"):$("#monitor_page_next").css("display","block"),e=0;e<a;e++)e<5?$("#monitor_page_"+e).css("display","block"):$("#monitor_page_"+e).css("display","none");for($("#monitor_page_next").on("click",function(){if(!(Monitor_table_start+5>=Monitor_table_total)){Monitor_table_start+=5;for(var e=0;e<Monitor_table_total;e++)$("#monitor_page_"+e).css("display","none"),e>=Monitor_table_start&&e<Monitor_table_start+5&&$("#monitor_page_"+e).css("display","block");0===Monitor_table_start?$("#monitor_page_prev").css("display","none"):$("#monitor_page_prev").css("display","block"),Monitor_table_start+5>=Monitor_table_total?$("#monitor_page_next").css("display","none"):$("#monitor_page_next").css("display","block"),show_monitor_page(Monitor_table_start)}}),$("#monitor_page_prev").on("click",function(){if(0!==Monitor_table_start){Monitor_table_start-=5,Monitor_table_start<0&&(Monitor_table_start=0);for(var e=0;e<Monitor_table_total;e++)$("#monitor_page_"+e).css("display","none"),e>=Monitor_table_start&&e<Monitor_table_start+5&&$("#monitor_page_"+e).css("display","block");0===Monitor_table_start?$("#monitor_page_prev").css("display","none"):$("#monitor_page_prev").css("display","block"),Monitor_table_start+5>=Monitor_table_total?$("#monitor_page_next").css("display","none"):$("#monitor_page_next").css("display","block"),show_monitor_page(Monitor_table_start)}}),monitor_page_click=function(){show_monitor_page(parseInt($(this).attr("number")))},e=0;e<a;e++)$("#monitor_page_"+e).on("click",monitor_page_click);Monitor_table_initialized=!0,show_monitor_page(0)}function show_monitor_page(e){$("#Table_Monitor").empty(),table_head="<thead><tr><th>站点名称 </th> <th>监控信息 </th></tr></thread>";var t=table_head;t+="<tbody>",sequence=e*table_row*2,null===monitor_map_list&&(monitor_map_list=[]);for(var a=0;a<2*table_row;a++)sequence+a<monitor_map_list.length?(t+=0!==a%2?"<tr class='success' >":"<tr >",t=t+"<td>"+monitor_map_list[sequence+a].StatName+"</td><td id='Monitor_table_cell"+a+"' StatCode='"+monitor_map_list[sequence+a].StatCode+"'></td>",t+="</tr>"):(t+=0!==a%2?"<tr class='success'>":"<tr  >",t=t+"<td>--</td><td id='Monitor_table_cell"+a+"' DevCode='null'>--</td>",t+="</tr>");t+="</tbody>",$("#Table_Monitor").append(t),query_warning()}function build_monitor_message(e){var t="";if(null===e||void 0===e)return t;for(var a=0;a<e.length;a++)t=t+e[a].AlarmName+":","true"==e[a].WarningTarget&&(t+="<Strong style='color:red'>"),t=t+e[a].AlarmValue+" ","true"==e[a].WarningTarget&&(t+="</Strong>"),t=t+e[a].AlarmUnit+";";return t}function query_warning(){if(Monitor_table_initialized===!0){ajax_process=function(e){var t={StatCode:$("#Monitor_table_cell"+e).attr("StatCode")},a={action:"DevAlarm",body:t,type:"query",user:usr.id},o=function(e){var t="",a=e.ret.StatCode;t="false"==e.status?"<Strong style='color:red'>未找到对应监控信息</Strong>":build_monitor_message(e.ret.alarmlist);for(var o=0;o<2*table_row;o++)if($("#Monitor_table_cell"+o).attr("StatCode")==a){$("#Monitor_table_cell"+o).empty(),$("#Monitor_table_cell"+o).append(t);break}};JQ_get(request_head,a,o)};for(var e=0;e<2*table_row&&null!==$("#Monitor_table_cell"+e).attr("StatCode");e++)ajax_process(e)}}function query_static_warning(){if(Monitor_Static_table_initialized===!0){var e={action:"GetStaticMonitorTable",type:"query",user:usr.id},t=function(e){if("false"==e.status)return void show_expiredModule();var t=(new Date).Format("yyyy-MM-dd_hhmmss");$("#MonitorFlashTime").empty(),$("#MonitorFlashTime").append("最后刷新时间："+t);var a,o=e.ret.ColumnName,i=e.ret.TableData,n="<thead> <tr><th></th><th></th>";for(a=0;a<o.length;a++)n=n+"<th>"+o[a]+"</th>";for(n+="</tr></thead>",n+="<tbody>",a=0;a<i.length;a++){n+="<tr>",n=n+"<td><button type='button' class='btn btn-default lock_btn' StateCode='"+i[a][0]+"' ><em class='glyphicon glyphicon-lock ' aria-hidden='true' ></em></button></td></td><td><button type='button' class='btn btn-default map_btn' StateCode='"+i[a][0]+"' StateName='"+i[a][1]+"' ><em class='glyphicon glyphicon-globe ' aria-hidden='true' ></em></button></td>";for(var l=0;l<i[a].length;l++)n=n+"<td>"+i[a][l]+"</td>";n+="</tr>"}n+="</tbody>",$("#MonitorQueryTable").empty(),$("#MonitorQueryTable").append(n),if_static_table_initialize&&$("#MonitorQueryTable").DataTable().destroy();$("#MonitorQueryTable").DataTable({scrollY:!1,scrollCollapse:!0,scrollX:!0,searching:!1,autoWidth:!0,lengthChange:!1,dom:"Bfrtip",buttons:[{extend:"excel",text:"导出到excel",filename:"MonitorData"+t}]});if_static_table_initialize=!0,video_btn_click=function(){var e=$(this).attr("StateCode");void 0!==e&&show_cameraModule(e)},lock_btn_click=function(){var e=$(this).attr("StateCode");void 0!==e&&show_openlockmodule(e)},map_btn_click=function(){mp_monitor();var e=$(this).attr("StateCode"),t=$(this).attr("StateName"),a=function(e,t){if(void 0!==e&&void 0!==t){var a=e+":"+t,o=find_marker(a);if(null!==o){get_select_monitor(a),console.log("Selected:"+monitor_selected.StatName),console.log("Selected:"+monitor_selected.Longitude),console.log("Selected:"+monitor_selected.Latitude);var i=monitor_selected.Longitude,n=monitor_selected.Latitude;map_MPMonitor.centerAndZoom(new BMap.Point(i,n),15);var l=e+":"+t,d=new BMap.InfoWindow(l,{offset:new BMap.Size(0,(-23)),width:600,height:300});monitor_map_handle=d,get_monitor_warning_on_map(),o.openInfoWindow(d),d.addEventListener("close",function(){monitor_map_handle==this&&(monitor_map_handle=null)})}}};setTimeout(function(){a(e,t)},500)},$(".lock_btn").on("click",lock_btn_click),$(".map_btn").on("click",map_btn_click),$("#MonitorQueryTable").on("draw.dt",function(){$(".lock_btn").unbind(),$(".map_btn").unbind(),$(".lock_btn").on("click",lock_btn_click),$(".map_btn").on("click",map_btn_click)})};JQ_get(request_head,e,t)}}function staff_query_static_warning(){if(Staff_Static_table_initialized===!0){var e={action:"GetStaticStaffTable",type:"query",user:usr.id},t=function(e){if("false"==e.status)return void show_expiredModule();var t=(new Date).Format("yyyy-MM-dd_hhmmss");$("#StaffFlashTime").empty(),$("#StaffFlashTime").append("最后刷新时间："+t);var a,o=e.ret.ColumnName,i=e.ret.TableData,n="<thead> <tr><th></th><th></th>";for(a=0;a<o.length;a++)n=n+"<th>"+o[a]+"</th>";for(n+="</tr></thead>",n+="<tbody>",a=0;a<i.length;a++){n+="<tr>",n=n+"<td><button type='button' class='btn btn-default lock_btn' StateCode='"+i[a][0]+"' ><em class='glyphicon glyphicon-lock ' aria-hidden='true' ></em></button></td></td><td><button type='button' class='btn btn-default map_btn' StateCode='"+i[a][0]+"' StateName='"+i[a][1]+"' ><em class='glyphicon glyphicon-globe ' aria-hidden='true' ></em></button></td>";for(var l=0;l<i[a].length;l++)n=n+"<td>"+i[a][l]+"</td>";n+="</tr>"}n+="</tbody>",$("#StaffQueryTable").empty(),$("#StaffQueryTable").append(n),
if_static_table_initialize&&$("#StaffQueryTable").DataTable().destroy();$("#StaffQueryTable").DataTable({scrollY:!1,scrollCollapse:!0,scrollX:!0,searching:!1,autoWidth:!0,lengthChange:!1,dom:"Bfrtip",buttons:[{extend:"excel",text:"导出到excel",filename:"MonitorData"+t}]});if_static_table_initialize=!0,video_btn_click=function(){},lock_btn_click=function(){},map_btn_click=function(){},$(".lock_btn").on("click",lock_btn_click),$(".map_btn").on("click",map_btn_click),$("#StaffQueryTable").on("draw.dt",function(){$(".lock_btn").unbind(),$(".map_btn").unbind(),$(".lock_btn").on("click",lock_btn_click),$(".map_btn").on("click",map_btn_click)})};JQ_get(request_head,e,t)}}function export_table_initialize(){}function query_export_table(){var e=$("#ExportTableSelect_choice").val(),t=$("#ExportTableTime_choice").val(),a=$("#ExportTableWord_Input").val(),o={TableName:e,Time:t,KeyWord:a},i={action:"ExportTable",body:o,user:usr.id},n=function(e){if("false"==e.status)return void show_expiredModule();var t=(new Date).Format("yyyy-MM-dd_hhmmss");$("#ExportTableLastFlash").empty(),$("#ExportTableLastFlash").append("最后刷新时间："+t);var a,o=e.ret.ColumnName,i=e.ret.TableData,n="<thead> <tr>";for(a=0;a<o.length;a++)n=n+"<th>"+o[a]+"</th>";for(n+="</tr></thead>",n+="<tbody>",a=0;a<i.length;a++){n+="<tr>";for(var l=0;l<i[a].length;l++)n=n+"<td>"+i[a][l]+"</td>";n+="</tr>"}n+="</tbody>",$("#ExportTableQueryTable").empty(),$("#ExportTableQueryTable").append(n),if_Export_table_initialize&&$("#ExportTableQueryTable").DataTable().destroy();$("#ExportTableQueryTable").DataTable({scrollY:!1,scrollCollapse:!0,scrollX:!0,searching:!1,autoWidth:!0,lengthChange:!1,dom:"Bfrtip",buttons:[{extend:"excel",text:"导出到excel",filename:"HistoryData"+t}]});if_Export_table_initialize=!0};JQ_get(request_head,i,n)}function build_key_history_proj_choice(){if(null!==project_list){var e="";for(null===project_list&&(project_list=[]),i=0;i<project_list.length;i++)e=e+"<option value="+project_list[i].id+">"+project_list[i].name+"</option>";$("#KeyHistoryProj_choice").append(e)}}function key_history_initialize(){Key_History_table_initialized===!1&&(null===project_list?(get_project_list(),window.setTimeout(build_key_history_proj_choice,wait_time_long)):build_key_history_proj_choice(),Key_History_table_initialized=!0)}function attendance_history_initialize(){Attendance_History_table_initialized=!0}function assemble_history_initialize(){Assemble_History_table_initialized=!0}function assemble_audit_initialize(){Assemble_Audit_table_initialized=!0}function attendance_audit_initialize(){Attendance_Audit_table_initialized=!0}function kpi_audit_initialize(){KPI_Audit_table_initialized=!0}function query_open_lock_history(){if(Key_History_table_initialized===!0){var e=$("#KeyHistoryProj_choice").val(),t=$("#KeyHistoryTime_choice").val(),a=$("#KeyHistoryWord_Input").val(),o={ProjCode:e,Time:t,KeyWord:a},i={action:"KeyHistory",body:o,user:usr.id},n=function(e){if("false"==e.status)return void show_expiredModule();var t=(new Date).Format("yyyy-MM-dd_hhmmss");$("#KeyHistoryLastFlash").empty(),$("#KeyHistoryLastFlash").append("最后刷新时间："+t);var a,o=e.ret.ColumnName,i=e.ret.TableData,n="<thead> <tr><th></th>";for(a=0;a<o.length;a++)n=n+"<th>"+o[a]+"</th>";for(n+="</tr></thead>",n+="<tbody>",a=0;a<i.length;a++){n+="<tr>",n=n+"<td><button type='button' class='btn btn-default open_btn' OpenCode='"+i[a][0]+"' ><em class='glyphicon glyphicon-picture ' aria-hidden='true' ></em></button></td>";for(var l=0;l<i[a].length;l++)n=n+"<td>"+i[a][l]+"</td>";n+="</tr>"}n+="</tbody>",$("#KeyHistoryQueryTable").empty(),$("#KeyHistoryQueryTable").append(n),if_key_history_table_initialize&&$("#KeyHistoryQueryTable").DataTable().destroy();$("#KeyHistoryQueryTable").DataTable({scrollY:!1,scrollCollapse:!0,scrollX:!0,searching:!1,autoWidth:!0,lengthChange:!1,dom:"Bfrtip",buttons:[{extend:"excel",text:"导出到excel",filename:"HistoryData"+t}]});Openpicture_btn_click=function(){var e=$(this).attr("OpenCode");getopenpicture(e)},$(".open_btn").on("click",Openpicture_btn_click),$("#KeyHistoryQueryTable").on("draw.dt",function(){$(".open_btn").unbind(),$(".open_btn").on("click",Openpicture_btn_click)}),if_key_history_table_initialize=!0};JQ_get(request_head,i,n)}}function query_attendance_history(){if(Attendance_History_table_initialized===!0){var e=$("#AttendanceHistoryStartTime_input").val(),t=$("#AttendanceHistoryEndTime_input").val();if(""!==e&&""!==t){var a=$("#AttendanceHistoryWord_Input").val(),o={Timestart:e,Timeend:t,KeyWord:a},i={action:"AttendanceHistory",body:o,user:usr.id},n=function(e){if("false"==e.status)return void show_expiredModule();var t=(new Date).Format("yyyy-MM-dd_hhmmss");$("#AttendanceHistoryLastFlash").empty(),$("#AttendanceHistoryLastFlash").append("最后刷新时间："+t);var a,o=e.ret.ColumnName,i=e.ret.TableData,n="<thead> <tr><th></th><th></th>";for(a=0;a<o.length;a++)n=n+"<th>"+o[a]+"</th>";for(n+="</tr></thead>",n+="<tbody>",a=0;a<i.length;a++){n+="<tr>",n=n+"<td><button type='button' class='btn btn-default open_btn' AttendanceCode='"+i[a][0]+"' ><em class='glyphicon glyphicon-trash ' aria-hidden='true' ></em></button></td>",n=n+"<td><button type='button' class='btn btn-default mod_btn' AttendanceCode='"+i[a][0]+"' ><em class='glyphicon glyphicon-pencil ' aria-hidden='true' ></em></button></td>";for(var l=0;l<i[a].length;l++)n=n+"<td>"+i[a][l]+"</td>";n+="</tr>"}n+="</tbody>",$("#AttendanceHistoryQueryTable").empty(),$("#AttendanceHistoryQueryTable").append(n),if_attendance_history_table_initialize&&$("#AttendanceHistoryQueryTable").DataTable().destroy();$("#AttendanceHistoryQueryTable").DataTable({scrollY:!1,scrollCollapse:!0,scrollX:!0,searching:!1,autoWidth:!0,lengthChange:!1,dom:"Bfrtip",buttons:[{extend:"excel",text:"导出到excel",filename:"HistoryData"+t}]});Openpicture_btn_click=function(){$("#delAttendanceCommit").attr("AttendanceID",$(this).attr("AttendanceCode")),modal_middle($("#AttendanceDelAlarm")),$("#AttendanceDelAlarm").modal("show")},Modstaff_btn_click=function(){select_attendance_ID=$(this).attr("AttendanceCode"),get_attendance(select_attendance_ID)},$(".open_btn").on("click",Openpicture_btn_click),$(".mod_btn").on("click",Modstaff_btn_click),$("#AttendanceHistoryQueryTable").on("draw.dt",function(){$(".open_btn").unbind(),$(".open_btn").on("click",Openpicture_btn_click),$(".mod_btn").unbind(),$(".mod_btn").on("click",Modstaff_btn_click)}),if_attendance_history_table_initialize=!0};JQ_get(request_head,i,n)}}}function show_new_attendance_module(){$("#newAttendanceLabel").text("创建考勤记录"),attendance_module_status=!0,$("#NewAttendancePJcode_Input").val(""),$("#NewAttendanceName_Input").val(""),$("#NewAttendanceStartTime_Input").val(""),$("#NewAttendanceEndTime_Input").val(""),$("#NewAttendanceLeaveHour_Input").val("0"),$("#AttendanceDate_Input").val(""),$("#NewAttendancePJcode_Input").attr("disabled",!0),$("#NewAttendanceName_Input").attr("disabled",!1),$("#AttendanceDate_Input").attr("disabled",!1),modal_middle($("#newAttendanceModal")),$("#newAttendanceModal").modal("show")}function show_mod_attendance_module(e){$("#newAttendanceLabel").text("修改考勤记录"),attendance_module_status=!1,$("#NewAttendancePJcode_Input").val(e.PJcode),$("#NewAttendanceName_Input").val(e.name),$("#NewAttendanceStartTime_Input").val(e.arrivetime),$("#NewAttendanceEndTime_Input").val(e.leavetime),$("#NewAttendanceLeaveHour_Input").val(e.leavehour),$("#AttendanceDate_Input").val(e.date),$("#NewAttendancePJcode_Input").attr("disabled",!0),$("#NewAttendanceName_Input").attr("disabled",!0),$("#AttendanceDate_Input").attr("disabled",!0),modal_middle($("#newAttendanceModal")),$("#newAttendanceModal").modal("show")}function new_attendance_submit(){var e=$("#NewAttendancePJcode_Input").val(),t=$("#NewAttendanceName_Input").val(),a=$("#NewAttendanceStartTime_Input").val(),o=$("#NewAttendanceEndTime_Input").val(),i=$("#AttendanceDate_Input").val(),n=parseFloat($("#NewAttendanceLeaveHour_Input").val());if(""===t)return void $("#NewAttendanceName_Input").val("");if(""===i)return void $("#AttendanceDate_Input").val("");if(""!==a&&!isDatetime(a))return $("#NewAttendanceStartTime_Input").val(""),void $("#NewAttendanceStartTime_Input").focus();if(""!==o&&!isDatetime(o))return $("#NewAttendanceEndTime_Input").val(""),void $("#NewAttendanceEndTime_Input").focus();if(isNaN(n)||n<0||n>12)return $("#NewAttendanceLeaveHour_Input").val(""),void $("#NewAttendanceLeaveHour_Input").focus();var l={PJcode:e,name:t,arrivetime:a,leavetime:o,date:i,leavehour:""+n};new_attendance(l)}function new_attendance_batch(){var e={action:"AttendanceBatchNew",type:"mod",user:usr.id},t=function(e){var t=e.status;"true"==t?($("#AttendanceBatchAlarm").modal("hide"),create_attendance_flash=function(){query_attendance_history()},setTimeout(function(){show_alarm_module(!1,"批量创建成功！",create_attendance_flash)},500)):($("#AttendanceBatchAlarm").modal("hide"),setTimeout(function(){show_alarm_module(!0,"批量创建失败！"+e.msg,null)},500))};JQ_get(request_head,e,t)}function new_attendance(e){var t={PJcode:e.PJcode,name:e.name,arrivetime:e.arrivetime,leavetime:e.leavetime,date:e.date,leavehour:e.leavehour},a={action:"AttendanceNew",type:"mod",body:t,user:usr.id},o=function(e){var t=e.status;"true"==t?($("#newAttendanceModal").modal("hide"),create_user_flash=function(){query_attendance_history()},setTimeout(function(){show_alarm_module(!1,"创建成功！",create_user_flash)},500)):setTimeout(function(){show_alarm_module(!0,"创建失败！"+e.msg,null)},500)};JQ_get(request_head,a,o)}function mod_attendance_submit(){var e=$("#NewAttendancePJcode_Input").val(),t=$("#NewAttendanceName_Input").val(),a=$("#NewAttendanceStartTime_Input").val(),o=$("#NewAttendanceEndTime_Input").val(),i=$("#AttendanceDate_Input").val(),n=parseFloat($("#NewAttendanceLeaveHour_Input").val());if(""!==a&&!isDatetime(a))return $("#NewAttendanceStartTime_Input").val(""),void $("#NewAttendanceStartTime_Input").focus();if(""!==o&&!isDatetime(o))return $("#NewAttendanceEndTime_Input").val(""),void $("#NewAttendanceEndTime_Input").focus();if(isNaN(n)||n<0||n>12)return $("#NewAttendanceLeaveHour_Input").val(""),void $("#NewAttendanceLeaveHour_Input").focus();var l={PJcode:e,name:t,arrivetime:a,leavetime:o,date:i,leavehour:""+n};mod_attendance(l)}function mod_attendance(e){var t={attendanceID:select_attendance_ID,PJcode:e.PJcode,name:e.name,arrivetime:e.arrivetime,leavetime:e.leavetime,date:e.date,leavehour:e.leavehour},a={action:"AttendanceMod",type:"mod",body:t,user:usr.id},o=function(e){var t=e.status;"true"==t?($("#newAttendanceModal").modal("hide"),create_user_flash=function(){query_attendance_history()},setTimeout(function(){show_alarm_module(!1,"修改成功！",create_user_flash)},500)):setTimeout(function(){show_alarm_module(!0,"修改失败！"+e.msg,null)},500)};JQ_get(request_head,a,o)}function get_attendance(e){var t={attendanceID:e},a={action:"GetAttendance",type:"query",body:t,user:usr.id},o=function(e){var t=e.status;"true"==t?show_mod_attendance_module(e.ret):setTimeout(function(){show_alarm_module(!0,"查询失败！"+e.msg,null)},500)};JQ_get(request_head,a,o)}function del_attendance(e){var t={attendanceid:e},a={action:"AttendanceDel",type:"mod",body:t,user:usr.id},o=function(e){var t=e.status;"true"==t?(del_attendance_flash=function(){query_attendance_history()},setTimeout(function(){show_alarm_module(!1,"删除成功！",del_attendance_flash)},500)):setTimeout(function(){show_alarm_module(!0,"删除失败！"+e.msg,null)},500)};JQ_get(request_head,a,o),$("#UserDelAlarm").modal("hide")}function query_assemble_history(){if(Assemble_History_table_initialized===!0){var e=$("#AssembleHistoryStartTime_input").val(),t=$("#AssembleHistoryEndTime_input").val(),a=$("#AssembleHistoryWord_Input").val();if(""!==e&&""!==t){var o={TimeStart:e,TimeEnd:t,KeyWord:a},i={action:"AssembleHistory",body:o,user:usr.id},n=function(e){if("false"==e.status)return void show_expiredModule();var t=(new Date).Format("yyyy-MM-dd_hhmmss");$("#AssembleHistoryLastFlash").empty(),$("#AssembleHistoryLastFlash").append("最后刷新时间："+t);var a,o=e.ret.ColumnName,i=e.ret.TableData,n="<thead> <tr>";for(a=0;a<o.length;a++)n=n+"<th>"+o[a]+"</th>";for(n+="</tr></thead>",n+="<tbody>",a=0;a<i.length;a++){n+="<tr>";for(var l=0;l<i[a].length;l++)n=n+"<td>"+i[a][l]+"</td>";n+="</tr>"}n+="</tbody>",$("#AssembleHistoryQueryTable").empty(),$("#AssembleHistoryQueryTable").append(n),if_assemble_history_table_initialize&&$("#AssembleHistoryQueryTable").DataTable().destroy();$("#AssembleHistoryQueryTable").DataTable({scrollY:!1,scrollCollapse:!0,scrollX:!0,searching:!1,autoWidth:!0,lengthChange:!1,dom:"Bfrtip",buttons:[{extend:"excel",text:"导出到excel",filename:"HistoryData"+t}]});if_assemble_history_table_initialize=!0};JQ_get(request_head,i,n)}}}function query_assemble_audit(){if(Assemble_Audit_table_initialized===!0){var e=$("#AssembleAuditStartTime_input").val(),t=$("#AssembleAuditEndTime_input").val(),a=$("#AssembleAuditWord_Input").val();if(""!==e&&""!==t){var o={TimeStart:e,TimeEnd:t,KeyWord:a},i={action:"AssembleAudit",body:o,user:usr.id},n=function(e){if("false"==e.status)return void show_expiredModule();var t=(new Date).Format("yyyy-MM-dd_hhmmss");$("#AssembleAuditLastFlash").empty(),$("#AssembleAuditLastFlash").append("最后刷新时间："+t);var a,o=e.ret.ColumnName,i=e.ret.TableData,n="<thead> <tr>";for(a=0;a<o.length;a++)n=n+"<th>"+o[a]+"</th>";for(n+="</tr></thead>",n+="<tbody>",a=0;a<i.length;a++){n+="<tr>";for(var l=0;l<i[a].length;l++)n=n+"<td>"+i[a][l]+"</td>";n+="</tr>"}n+="</tbody>",$("#AssembleAuditQueryTable").empty(),$("#AssembleAuditQueryTable").append(n),if_assemble_audit_table_initialize&&$("#AssembleAuditQueryTable").DataTable().destroy();$("#AssembleAuditQueryTable").DataTable({scrollY:!1,scrollCollapse:!0,scrollX:!0,searching:!1,autoWidth:!0,lengthChange:!1,dom:"Bfrtip",buttons:[{extend:"excel",text:"导出到excel",filename:"HistoryData"+t}]});if_assemble_audit_table_initialize=!0};JQ_get(request_head,i,n)}}}function query_attendance_audit(){if(Attendance_Audit_table_initialized===!0){var e=$("#AttendanceAuditStartTime_input").val(),t=$("#AttendanceAuditEndTime_input").val(),a=$("#AttendanceAuditWord_Input").val();if(""!==e&&""!==t){var o={TimeStart:e,TimeEnd:t,KeyWord:a},i={action:"AttendanceAudit",body:o,user:usr.id},n=function(e){if("false"==e.status)return void show_expiredModule();var t=(new Date).Format("yyyy-MM-dd_hhmmss");$("#AttendanceAuditLastFlash").empty(),$("#AttendanceAuditLastFlash").append("最后刷新时间："+t);var a,o=e.ret.ColumnName,i=e.ret.TableData,n="<thead> <tr>";for(a=0;a<o.length;a++)n=n+"<th>"+o[a]+"</th>";for(n+="</tr></thead>",n+="<tbody>",a=0;a<i.length;a++){n+="<tr>";for(var l=0;l<i[a].length;l++)n=n+"<td>"+i[a][l]+"</td>";n+="</tr>"}n+="</tbody>",$("#AttendanceAuditQueryTable").empty(),$("#AttendanceAuditQueryTable").append(n),if_attendance_audit_table_initialize&&$("#AttendanceAuditQueryTable").DataTable().destroy();$("#AttendanceAuditQueryTable").DataTable({scrollY:!1,scrollCollapse:!0,scrollX:!0,searching:!1,autoWidth:!0,lengthChange:!1,dom:"Bfrtip",buttons:[{extend:"excel",text:"导出到excel",filename:"HistoryData"+t}]});if_attendance_audit_table_initialize=!0};JQ_get(request_head,i,n)}}}function query_kpi_audit(){if(KPI_Audit_table_initialized===!0){var e=$("#KPIAuditStartTime_input").val(),t=$("#KPIAuditEndTime_input").val(),a=$("#KPIAuditWord_Input").val();if(""!==e&&""!==t){var o={TimeStart:e,TimeEnd:t,KeyWord:a},i={action:"KPIAudit",body:o,user:usr.id},n=function(e){if("false"==e.status)return void show_expiredModule();var t=(new Date).Format("yyyy-MM-dd_hhmmss");$("#KPILastFlash").empty(),$("#KPILastFlash").append("最后刷新时间："+t);var a,o=e.ret.ColumnName,i=e.ret.TableData,n="<thead> <tr>";for(a=0;a<o.length;a++)n=n+"<th>"+o[a]+"</th>";for(n+="</tr></thead>",n+="<tbody>",a=0;a<i.length;a++){n+="<tr>";for(var l=0;l<i[a].length;l++)n=n+"<td>"+i[a][l]+"</td>";n+="</tr>"}n+="</tbody>",$("#KPIAuditQueryTable").empty(),$("#KPIAuditQueryTable").append(n),if_kpi_audit_table_initialize&&$("#KPIAuditQueryTable").DataTable().destroy();$("#KPIAuditQueryTable").DataTable({scrollY:!1,scrollCollapse:!0,scrollX:!0,searching:!1,autoWidth:!0,lengthChange:!1,dom:"Bfrtip",buttons:[{extend:"excel",text:"导出到excel",filename:"HistoryData"+t}]});if_kpi_audit_table_initialize=!0};JQ_get(request_head,i,n)}}}function get_alarm_type_list(){var e={action:"AlarmType",type:"query",user:usr.id},t=function(e){return"false"==e.status?void show_expiredModule():void(alarm_type_list=e.ret)};JQ_get(request_head,e,t)}function query_alarm(e,t,a){var o={StatCode:alarm_selected.StatCode,date:e,type:t},i={action:"AlarmQuery",body:o,type:"query",user:usr.id},n=function(e){if("false"==e.status)return void show_expiredModule();var o=(e.ret.StatCode,e.ret.date),i=(e.ret.AlarmName,e.ret.AlarmUnit),n=(e.ret.WarningTarget,e.ret.minute_alarm),l=e.ret.hour_alarm,d=e.ret.day_alarm,r=e.ret.minute_head,_=e.ret.hour_head,s=e.ret.day_head;$("#Warning_"+t+"_day").css("display","block");var c=r.length-1;c>120&&(c=120),$("#"+t+"_canvas_day").highcharts({chart:{type:"areaspline",zoomType:"x"},title:{text:a+" 分钟值日志，日期："+o},legend:{layout:"vertical",align:"left",verticalAlign:"top",x:150,y:100,floating:!0,borderWidth:1,backgroundColor:Highcharts.theme&&Highcharts.theme.legendBackgroundColor||"#FFFFFF"},xAxis:{categories:r,max:c},scrollbar:{enabled:!0},yAxis:{title:{text:a}},tooltip:{shared:!0,valueSuffix:i},credits:{enabled:!1},plotOptions:{areaspline:{fillOpacity:.5}},series:[{name:alarm_selected.StatName,data:n,turboThreshold:1500}]}),$("#Warning_"+t+"_day").css("display","none"),$("#Warning_"+t+"_week").css("display","block"),c=_.length-1,c>120&&(c=120),$("#"+t+"_canvas_week").highcharts({chart:{type:"areaspline",zoomType:"x"},title:{text:a+" 小时平均值日志，周期： "+o+" 为截至的7天 "},legend:{layout:"vertical",align:"left",verticalAlign:"top",x:150,y:100,floating:!0,borderWidth:1,backgroundColor:Highcharts.theme&&Highcharts.theme.legendBackgroundColor||"#FFFFFF"},xAxis:{categories:_,max:c},scrollbar:{enabled:!0},yAxis:{title:{text:a}},tooltip:{shared:!0,valueSuffix:i},credits:{enabled:!1},plotOptions:{areaspline:{fillOpacity:.5}},series:[{name:alarm_selected.StatName,data:l,turboThreshold:1500}]}),$("#Warning_"+t+"_week").css("display","none"),$("#Warning_"+t+"_month").css("display","block"),c=s.length-1,c>30&&(c=30),$("#"+t+"_canvas_month").highcharts({chart:{type:"areaspline",zoomType:"x"},title:{text:a+" 日平均值日志，周期： "+o+" 为截至的30天 "},legend:{layout:"vertical",align:"left",verticalAlign:"top",x:150,y:100,floating:!0,borderWidth:1,backgroundColor:Highcharts.theme&&Highcharts.theme.legendBackgroundColor||"#FFFFFF"},xAxis:{categories:s,max:c},scrollbar:{enabled:!0},yAxis:{title:{text:a}},tooltip:{shared:!0,valueSuffix:i},credits:{enabled:!1},plotOptions:{areaspline:{fillOpacity:.5}},series:[{name:alarm_selected.StatName,data:d,turboThreshold:1500}]}),$("#Warning_"+t+"_month").css("display","none"),show_table_tags()};JQ_get(request_head,i,n)}function initializeAlarmMap(){get_project_list(),get_proj_point_list(),get_monitor_alarm_list(),get_alarm_type_list();var e=parseInt($("#WCMonitorViewMap").css("min-height").replace(/[^0-9]/gi,""));window.screen.availHeight/2>e&&(e=window.screen.availHeight/2),$("#WCMonitorViewMap").css("min-height",e+"px"),map_MPMonitor=new BMap.Map("WCMonitorViewMap"),map_MPMonitor.addControl(new BMap.NavigationControl),map_MPMonitor.enableScrollWheelZoom(),null===usr_faverate_list||0===usr_faverate_list.length?map_MPMonitor.centerAndZoom(new BMap.Point(user_point.Longitude,user_point.Latitude),15):map_MPMonitor.centerAndZoom(new BMap.Point(usr_faverate_list[0].Longitude,usr_faverate_list[0].Latitude),17),window.setTimeout(alarm_addMarker,wait_time_long),window.setTimeout(build_alarm_tabs,wait_time_long),alarm_map_initialized=!0}function alarm_cycle(){"WarningCheck"==CURRENT_URL&&alarm_map_initialized!==!1&&(get_monitor_alarm_list(),window.setTimeout(alarm_addMarker,wait_time_long))}function build_alarm_tabs(){if(null!==alarm_type_list){$("#Alarm_chart_view_nav").empty(),$("#Alarm_Chart_content").empty();var e,t="",a="";for(e=0;e<alarm_type_list.length;e++){var o="",i="";0===e&&(o="class='active'",i=" in active"),t=t+"<li class='dropdown'><a href='#' id='Warning_"+alarm_type_list[e].id+"_tab' class='dropdown-toggle' data-toggle='dropdown'>"+alarm_type_list[e].name+" <b class='caret'></b></a><ul class='dropdown-menu' role='menu' aria-labelledby='Warning_"+alarm_type_list[e].id+"_tab''><li><a href='#Warning_"+alarm_type_list[e].id+"_day' "+o+" tabindex='-1' data-toggle='tab' id='Warning_"+alarm_type_list[e].id+"_tab_day' alarmid='"+alarm_type_list[e].id+"'>分钟报表（日）</a> </li><li><a href='#Warning_"+alarm_type_list[e].id+"_week' tabindex='-1' data-toggle='tab'  id='Warning_"+alarm_type_list[e].id+"_tab_week' alarmid='"+alarm_type_list[e].id+"'>小时报表（周）</a> </li><li><a href='#Warning_"+alarm_type_list[e].id+"_month' tabindex='-1' data-toggle='tab'  id='Warning_"+alarm_type_list[e].id+"_tab_month' alarmid='"+alarm_type_list[e].id+"'> 日报表（30天）</a> </li> </ul> </li>",a=a+"<div class='Alarm_Canvas' id='Warning_"+alarm_type_list[e].id+"_day' ><div id='"+alarm_type_list[e].id+"_canvas_day' class='Alarm_Canvas'></div></div><div class='Alarm_Canvas' id='Warning_"+alarm_type_list[e].id+"_week' ><div id='"+alarm_type_list[e].id+"_canvas_week' class='Alarm_Canvas' ></div></div><div class='Alarm_Canvas' id='Warning_"+alarm_type_list[e].id+"_month' ><div id='"+alarm_type_list[e].id+"_canvas_month' class='Alarm_Canvas' ></div></div>"}for($("#Alarm_chart_view_nav").append(t),$("#Alarm_Chart_content").append(a),Warning_tab_day_click=function(){hide_all_chart(),$("#Warning_"+$(this).attr("alarmid")+"_day").css("display","block")},Warning_tab_week_click=function(){hide_all_chart(),$("#Warning_"+$(this).attr("alarmid")+"_week").css("display","block")},Warning_tab_month_click=function(){hide_all_chart(),$("#Warning_"+$(this).attr("alarmid")+"_month").css("display","block")},e=0;e<alarm_type_list.length;e++)$("#Warning_"+alarm_type_list[e].id+"_tab_day").on("click",Warning_tab_day_click),$("#Warning_"+alarm_type_list[e].id+"_tab_week").on("click",Warning_tab_week_click),$("#Warning_"+alarm_type_list[e].id+"_tab_month").on("click",Warning_tab_month_click);hide_all_chart(),$(window).resize()}}function hide_all_chart(){for(var e=0;e<alarm_type_list.length;e++)$("#Warning_"+alarm_type_list[e].id+"_day").css("display","none"),$("#Warning_"+alarm_type_list[e].id+"_week").css("display","none"),$("#Warning_"+alarm_type_list[e].id+"_month").css("display","none")}function unhide_all_chart(){for(var e=0;e<alarm_type_list.length;e++)$("#Warning_"+alarm_type_list[e].id+"_day").css("display","block"),$("#Warning_"+alarm_type_list[e].id+"_week").css("display","block"),$("#Warning_"+alarm_type_list[e].id+"_month").css("display","block")}function get_select_alarm(e){var t=e.split(":");null===monitor_map_list&&(monitor_map_list=[]);for(var a=0;a<monitor_map_list.length;a++)if(monitor_map_list[a].StatCode==t[0])return void(alarm_selected=monitor_map_list[a]);alarm_selected=null}function get_alarmpointinfo_on_map(){null!==alarm_selected&&null!==alarm_map_handle&&(txt="<div id ='Element_card_floating'><p style='font-size:14px;' >站点名称："+alarm_selected.StatName+"</p><HR style='FILTER: alpha(opacity=100,finishopacity=0,style=3)' width='80%' color=#987cb9 SIZE=3/><div style='font-size:10px;' >站点地址："+alarm_selected.Address+"</div></div>",null!==alarm_map_handle&&alarm_map_handle.setContent(txt),$("#WCStatCode_Input").val(alarm_selected.StatName))}function alarm_addMarker(e){if("WarningCheck"==CURRENT_URL&&null!==alarm_map_list){var t=new BMap.Icon("./image/map-marker-ball-pink-small.png",new BMap.Size(32,32),{anchor:new BMap.Size(16,30)});map_MPMonitor.clearOverlays(),alarm_mark_click=function(){get_select_alarm(this.getTitle());var e=this.getTitle(),t=new BMap.InfoWindow(e,{offset:new BMap.Size(0,(-23))});t.setWidth(400),alarm_map_handle=t,get_alarmpointinfo_on_map(),this.openInfoWindow(t),t.addEventListener("close",function(){alarm_map_handle==this&&(alarm_map_handle=null)})},null===alarm_map_list&&(alarm_map_list=[]);for(var a=0;a<alarm_map_list.length;a++){var o=new BMap.Point(parseFloat(alarm_map_list[a].Longitude),parseFloat(alarm_map_list[a].Latitude)),i=new BMap.Marker(o,{icon:t});i.setTitle(alarm_map_list[a].StatCode+":"+alarm_map_list[a].StatName),map_MPMonitor.addOverlay(i),i.addEventListener("click",alarm_mark_click)}}}function Data_export_Normal(e,t,a,o){$("#TableQueryCondition").css("display","none"),$("#ExportTable").empty(),$("#TableExportTitle").text(e);var i={TableName:t,Condition:a,Filter:o},n={action:"TableQuery",body:i,type:"query",user:usr.id},l=function(t){if("false"==t.status)return void show_expiredModule();ColumnName=t.ret.ColumnName,TableData=t.ret.TableData;var a,o="<thead> <tr>";for(a=0;a<ColumnName.length;a++)o=o+"<th>"+ColumnName[a]+"</th>";for(o+="</tr></thead>",o+="<tbody>",a=0;a<TableData.length;a++){o+="<tr>";for(var i=0;i<TableData[a].length;i++)o=o+"<td>"+TableData[a][i]+"</td>";o+="</tr>"}o+="</tbody>",if_table_initialize&&$("#ExportTable").DataTable().destroy(),$("#ExportTable").empty(),$("#ExportTable").append(o);$("#ExportTable").DataTable({scrollY:200,scrollCollapse:!0,scrollX:!0,searching:!1,autoWidth:!0,lengthChange:!1,dom:"Bfrtip",buttons:[{extend:"excel",text:"导出到excel",filename:e+(new Date).Format("yyyy-MM-dd_hhmmss")}]});if_table_initialize=!0,modal_middle($("#TableExportModule")),$("#TableExportModule").modal("show")};JQ_get(request_head,n,l)}function Data_export_alarm(){if_table_initialize&&($("#ExportTable").DataTable().destroy(),if_table_initialize=!1),$("#ExportTable").empty(),$("#TableQueryCondition").css("display","block"),$("#TableExportTitle").text("告警日志导出"),$("#QueryProjCode_choice").empty(),$("#QueryStatCode_choice").empty(),null!==alarm_selected?($("#QueryProjCode_choice").append(get_proj_option(alarm_selected.ProjCode)),get_proj_point_option($("#QueryProjCode_choice").val(),$("#QueryStatCode_choice"),alarm_selected.StatCode),$("#QueryStatCode_choice").val(alarm_selected.StatCode)):($("#QueryProjCode_choice").append(get_proj_option()),get_proj_point_option($("#QueryProjCode_choice").val(),$("#QueryStatCode_choice"),"")),$("#QueryStartTime_Input").val(get_yesterday()),$("#QueryEndTime_Input").val(get_yesterday()),modal_middle($("#TableExportModule")),$("#TableExportModule").modal("show")}function submit_alarm_query(){var e=$("#QueryStatCode_choice").val(),t=$("#QueryAlarm_choice").val(),a=$("#QueryStartTime_Input").val(),o=$("#QueryEndTime_Input").val();if(""===e)return void $("#QueryStatCode_choice").focus();var i=[],n={ConditonName:"UserId",Equal:usr.id,GEQ:"",LEQ:""};i.push(n),n={ConditonName:"StatCode",Equal:e,GEQ:"",LEQ:""},i.push(n),n={ConditonName:"AlarmType",Equal:t,GEQ:"",LEQ:""},i.push(n),n={ConditonName:"AlarmDate",Equal:"",GEQ:o,LEQ:a},i.push(n);var l={TableName:"Alarmtable",Condition:i,Filter:[]},d={action:"TableQuery",body:l,type:"query",user:usr.id},r=function(e){if("false"==e.status)return void show_expiredModule();ColumnName=e.ret.ColumnName,TableData=e.ret.TableData,$("#ExportTable").empty();var t,a="<thead> <tr>";for(t=0;t<ColumnName.length;t++)a=a+"<th>"+ColumnName[t]+"</th>";for(a+="</tr></thead>",a+="<tbody>",t=0;t<TableData.length;t++){a+="<tr>";for(var o=0;o<TableData[t].length;o++)a=a+"<td>"+TableData[t][o]+"</td>";a+="</tr>"}a+="</tbody>",$("#ExportTable").append(a),if_table_initialize&&$("#ExportTable").DataTable().destroy();$("#ExportTable").DataTable({scrollY:200,scrollCollapse:!0,scrollX:!0,searching:!1,autoWidth:!0,lengthChange:!1,dom:"Bfrtip",buttons:[{extend:"excel",text:"导出到excel",filename:"日志数据导出"+$("#QueryStatCode_choice").text()+(new Date).Format("yyyy-MM-dd_hhmmss")}]});if_table_initialize=!0,modal_middle($("#TableExportModule")),$("#TableExportModule").modal("show")};JQ_get(request_head,d,r)}function get_sensor_list(){var e={action:"SensorList",type:"query",user:usr.id},t=function(e){return"false"==e.status?void show_expiredModule():void(sensor_list=e.ret)};JQ_get(request_head,e,t)}function get_device_sensor(e){var t={DevCode:e},a={action:"DevSensor",body:t,type:"query",user:usr.id},o=function(e){return"false"==e.status?void show_expiredModule():(device_selected_sensor=e.ret,void draw_dev_detail_panel())};JQ_get(request_head,a,o)}function get_sensor_name(e){var t="未知传感器";null===sensor_list&&(sensor_list=[]);for(var a=0;a<sensor_list.length;a++)e==sensor_list[a].id&&(t=sensor_list[a].nickname);return t}function show_sensor_module(){if(null!==select_sensor){if($("#SensorExtraInfo").empty(),$("#SensorDevCode_Input").val(device_selected.DevCode),$("#SensorName_Input").val(get_sensor_name(select_sensor.id)),$("#SensorStatus_choice").val(select_sensor.status),null===select_sensor.para&&(select_sensor.para=[]),0!==select_sensor.para.length){var e,t="";for(e=0;e<select_sensor.para.length;e++)t=t+"<div class='input-group '><span class='input-group-addon' style='min-width: 100px'>"+select_sensor.para[e].name+"</span><input type='text' class='form-control' placeholder='"+select_sensor.para[e].memo+"' aria-describedby='basic-addon1' id='SensorPara_"+select_sensor.para[e].name+"'/></div><p></p>";for($("#SensorExtraInfo").append(t),e=0;e<select_sensor.para.length;e++)$("#SensorPara_"+select_sensor.para[e].name).val(select_sensor.para[e].value)}modal_middle($("#SensorModal")),$("#SensorModal").modal("show")}}function submit_sensor_module(){if(null!==select_sensor){var e=[];null===select_sensor.para&&(select_sensor.para=[]);for(var t=0;t<select_sensor.para.length;t++){var a={name:select_sensor.para[t].name,value:$("#SensorPara_"+select_sensor.para[t].name).val()};e.push(a)}var o={DevCode:device_selected.DevCode,SensorCode:select_sensor.id,status:$("#SensorStatus_choice").val(),ParaList:e},i={action:"SensorUpdate",body:o,type:"mod",user:usr.id},n=function(e){var t=e.status;"true"==t?($("#SensorModal").modal("hide"),Initialize_dev_detail(),setTimeout(function(){show_alarm_module(!1,"传感器修改成功！",null)},500)):setTimeout(function(){show_alarm_module(!0,"传感器修改失败！"+e.msg,null)},500)};JQ_get(request_head,i,n)}}function get_key_auth_list(e){var t={KeyCode:e},a={action:"KeyAuthlist",body:t,type:"query",user:usr.id},o=function(e){return"false"==e.status?void show_expiredModule():(select_key_auth=e.ret,void show_key_auth_module())};JQ_get(request_head,a,o)}function show_key_auth_module(){if(null!==select_key_auth){if($("#KeyAuthList").empty(),$("#KeyAuthNumber_Input").val(""+select_key_auth.length),0!==select_key_auth.length){var e,t="";for(t="<table data-toggle='table' class='table table-hover table-bordered' ' data-click-to-select='false' ><thead> <tr> <th>授权设备 </th> <th>授权方式 </th></tr> </thead> <tbody >",e=0;e<select_key_auth.length;e++)t=t+"<tr> <td>"+select_key_auth[e].DomainName+"</td> <td>"+select_key_auth[e].AuthWay+"</td></tr>";t+="</tbody></table>",$("#KeyAuthList").append(t)}modal_middle($("#KeyModal")),$("#KeyModal").modal("show")}}function get_user_message(){var e={id:usr.id},t={action:"GetUserMsg",body:e,type:"query",user:usr.id},a=function(e){var t=e.status;"true"==t?(usr_msg=e.ret.msg,usr_ifdev=e.ret.ifdev):show_alarm_module(!0,"获取用户信息失败，请重新登录！"+e.msg,null)};JQ_get(request_head,t,a)}function get_user_image(){var e={id:usr.id},t={action:"GetUserImg",body:e,type:"query",user:usr.id},a=function(e){var t=e.status;"true"==t?(usr_img=e.ret,reflash_usr_img_table()):show_alarm_module(!0,"获取用户信息失败，请重新登录！"+e.msg,null)};JQ_get(request_head,t,a)}function clear_user_image(){var e={id:usr.id},t={action:"ClearUserImg",body:e,type:"query",user:usr.id},a=function(e){var t=e.status;"true"==t?(usr_img=[],reflash_usr_img_table()):show_alarm_module(!0,"获取用户信息失败，请重新登录！"+e.msg,null)};JQ_get(request_head,t,a)}function set_user_message(e,t){var a={id:usr.id,msg:e,ifdev:t},o={action:"SetUserMsg",body:a,type:"query",user:usr.id},i=function(e){var t=e.status;"true"==t?show_alarm_module(!0,"屏保欢迎语设置成功！"+e.msg,null):show_alarm_module(!0,"获取用户信息失败，请重新登录！"+e.msg,null)};JQ_get(request_head,o,i)}function show_usr_msg_module(){$("#UsrMsg_Input").val(usr_msg),$("#UsrDev_choice").val(usr_ifdev),reflash_usr_img_table(),$("#file-zh").fileinput({
language:"zh",uploadUrl:upload_url+"?id="+usr.id,allowedFileExtensions:["jpg","png","gif"],showPreview:!0}),modal_middle($("#UsrMsgModal")),$("#UsrMsgModal").modal("show")}function reflash_usr_img_table(){$("#UsrImgTable").empty();var e="<thead> <tr> <th> 已上传文件</th> </tr> </thead> <tbody >";null===usr_img&&(usr_img=[]);for(var t=0;t<usr_img.length;t++)e=e+"<tr> <td>"+usr_img[t].name+"</td></tr>";$("#UsrImgTable").append(e)}function user_message_update(){var e={id:usr.id,msg:$("#UsrMsg_Input").val(),ifdev:$("#UsrDev_choice").val()},t={action:"SetUserMsg",body:e,type:"query",user:usr.id},a=function(e){var t=e.status;"true"==t?($("#UsrMsgModal").modal("hide"),show_alarm_module(!0,"屏保欢迎语设置成功！"+e.msg,null)):show_alarm_module(!0,"获取用户信息失败，请重新登录！"+e.msg,null)};JQ_get(request_head,t,a)}function change_camera_status(e,t,a){var o="当前：水平="+e+"/垂直="+t+"；调节单位：水平="+camera_unit_h+"/垂直="+camera_unit_v;$("#VideoModuleCameraState_Input").val(o),$("#video_img").attr("src",a)}function get_camera_unit(){var e={action:"GetCameraUnit",type:"query",user:usr.id},t=function(e){var t=e.status;"true"==t?(camera_unit_h=e.ret.h,camera_unit_v=e.ret.v):show_alarm_module(!0,"获取摄像头基本单位失败，请重新登录！"+e.msg,null)};JQ_get(request_head,e,t)}function get_camera_status(e){var t={StatCode:e},a={action:"GetCameraStatus",body:t,type:"query",user:usr.id},o=function(e){var t=e.status;"true"==t?change_camera_status(e.ret.h,e.ret.v,e.ret.url):show_alarm_module(!0,"获取摄像头基本单位失败，请重新登录！"+e.msg,null)};JQ_get(request_head,a,o)}function move_camera(e,t,a){var o,i={StatCode:e,adj:a};o="v"==t?{action:"CameraVAdj",body:i,type:"mod",user:usr.id}:{action:"CameraHAdj",body:i,type:"mod",user:usr.id};var n=function(e){var t=e.status;"true"==t?change_camera_status(e.ret.h,e.ret.v,e.ret.url):show_alarm_module(!0,"改变摄像头参数失败，请重新登录！"+e.msg,null)};JQ_get(request_head,o,n)}function show_cameraModule(e){modal_middle($("#VideoSelectionModule")),$("#VideoModuleStatCode_Input").val(e),$("#VideoModule_query_Input").val(""),$("#ModuleVCRStatus_choice").empty(),get_camera_status(e),$("#VideoSelectionModule").modal("show")}function show_openlockmodule(e){$("#UnlockConfirmBtn").attr("StateCode",e),$("#UnlockConfirmModalContent").empty(),$("#UnlockConfirmModalContent").append("<strong>请确认：</strong>是否要打开站点["+e+"]的智能锁！按确认继续。"),modal_middle($("#UnlockConfirm")),$("#UnlockConfirm").modal("show")}function openlock(e){var t={StatCode:e},a={action:"OpenLock",body:t,type:"mod",user:usr.id},o=function(e){var t=e.status;if("true"==t){var a=e.auth;"true"==a?show_alarm_module(!1,"已向下位机发送开锁请求，请稍后刷新！",null):show_alarm_module(!0,"无效授权！"+e.msg,null)}else show_alarm_module(!0,"开锁请求失败，请重新登录！"+e.msg,null)};JQ_get(request_head,a,o)}function get_proj_key_list(){var e={action:"ProjKeyList",type:"query",user:usr.id},t=function(e){return"false"==e.status?void show_expiredModule():void(key_list=e.ret)};JQ_get(request_head,e,t)}function get_proj_user_list(){var e={action:"ProjUserList",type:"query",user:usr.id},t=function(e){return"false"==e.status?void show_expiredModule():void(proj_user_list=e.ret)};JQ_get(request_head,e,t)}function build_key_auth_proj_choice(){if(null!==project_list){var e="";for($("#KeyAuthProj_choice").empty(),$("#KeyUserProj_choice").empty(),null===project_list&&(project_list=[]),i=0;i<project_list.length;i++)e=e+"<option value="+project_list[i].id+">"+project_list[i].name+"</option>";$("#KeyAuthProj_choice").append(e),$("#KeyUserProj_choice").append(e),update_key_auth_proj_stat_choice($("#KeyAuthProj_choice").val(),$("#KeyAuthProj_choice").find("option:selected").text()),update_key_auth_proj_key_choice($("#KeyUserProj_choice").val()),update_key_auth_proj_user_choice($("#KeyUserProj_choice").val()),$("#KeyAuthProj_choice").change(function(){update_key_auth_proj_stat_choice($(this).val(),$(this).find("option:selected").text())}),$("#KeyUserProj_choice").change(function(){update_key_auth_proj_key_choice($(this).val()),update_key_auth_proj_user_choice($("#KeyUserProj_choice").val())})}}function update_key_auth_proj_stat_choice(e,t){$("#KeyAuthPoint_choice").empty();var a="";for(null===point_list&&(point_list=[]),i=0;i<point_list.length;i++)point_list[i].ProjCode==e&&(a=a+"<option value="+point_list[i].id+">"+point_list[i].name+"</option>");a="<option value="+e+">"+t+":全项目</option>"+a,$("#KeyAuthPoint_choice").append(a)}function update_key_auth_proj_key_choice(e){$("#KeyUserKey_choice").empty();var t="";for(null===key_list&&(key_list=[]),i=0;i<key_list.length;i++)if(key_list[i].ProjCode==e){var a=key_list[i].username;"none"==a&&(a="部门收管"),t=t+"<option value="+key_list[i].id+">"+key_list[i].name+":"+a+"</option>"}$("#KeyUserKey_choice").append(t)}function update_new_key_auth_key_choice(e){$("#NewKeyAuthKey_choice").empty();var t="";for(null===key_list&&(key_list=[]),i=0;i<key_list.length;i++)if(key_list[i].ProjCode==e){var a=key_list[i].username;"none"==a&&(a="部门收管"),t=t+"<option value="+key_list[i].id+">"+key_list[i].name+":"+a+"</option>"}$("#NewKeyAuthKey_choice").append(t)}function update_key_auth_proj_user_choice(e){$("#KeyUserUser_choice").empty();var t="";for(null===proj_user_list&&(proj_user_list=[]),i=0;i<proj_user_list.length;i++)proj_user_list[i].ProjCode==e&&(t=t+"<option value="+proj_user_list[i].id+">"+proj_user_list[i].name+"</option>");t="<option value='none'>部门收管</option>"+t,$("#KeyUserUser_choice").append(t)}function key_auth_initialize(){get_project_list(),get_proj_point_list(),get_proj_key_list(),get_proj_user_list(),window.setTimeout(build_key_auth_proj_choice,wait_time_middle)}function get_domain_auth_list(e){if(""!==e){var t={DomainCode:e},a={action:"DomainAuthlist",body:t,type:"query",user:usr.id},o=function(e){if("false"==e.status)return void show_expiredModule();var t=e.ret;null===t&&(t=[]);var a="<thead><tr><th></th><th>编号</th><th>钥匙编号</th><th>钥匙</th><th>用户</th><th>授权条件</th></tr></thead><tbody>";$("#Table_point_key_auth").empty();for(var o=0;o<t.length;o++){var i=t[o].UserName;"none"==i&&(i="部门收管"),a=a+"<tr> <td><button type='button' class='btn btn-default Auth_del_btn' AuthId='"+t[o].AuthId+"' ><em class='glyphicon glyphicon-trash ' aria-hidden='true' ></em></button></td>",a=a+"<td>"+t[o].AuthId+"</td><td>"+t[o].KeyId+"</td><td>"+t[o].KeyName+"</td><td>"+i+"</td><td>"+t[o].AuthWay+"</td></tr>"}a+="</tbody>",$("#Table_point_key_auth").append(a),$(".Auth_del_btn").on("click",function(){touchcookie(),show_auth_delete_module($(this).attr("AuthId"))})};JQ_get(request_head,a,o)}}function show_auth_delete_module(e){$("#delKeyAuthCommit").attr("AuthId",e),$("#KeyAuthDelAlertModalLabel").text("确认删除 授权"+e),modal_middle($("#KeyAuthDelAlarm")),$("#KeyAuthDelAlarm").modal("show")}function key_auth_delete(e){if(""!==e){var t={AuthId:e},a={action:"KeyAuthDel",body:t,type:"mod",user:usr.id},o=function(e){var t=e.status;"true"==t?(setTimeout(function(){show_alarm_module(!1,"删除成功！",null)},500),get_domain_auth_list($("#KeyAuthPoint_choice").val())):setTimeout(function(){show_alarm_module(!0,"修改失败！"+e.msg,null)},500)};JQ_get(request_head,a,o)}}function show_auth_new_module(e,t,a){$("#newKeyAuthCommit").attr("DomainId",t),$("#NewKeyAuthDomain_Input").val(a),update_new_key_auth_key_choice(e),$("NewKeyAuthEndTime_Input").val(""),modal_middle($("#newKeyAuthModal")),$("#newKeyAuthModal").modal("show")}function new_key_auth(e){var t={action:"KeyAuthNew",body:e,type:"mod",user:usr.id},a=function(e){var t=e.status;"true"==t?setTimeout(function(){show_alarm_module(!1,"新建成功！",null),get_domain_auth_list($("#KeyAuthPoint_choice").val())},500):setTimeout(function(){show_alarm_module(!0,"新建失败！"+e.msg,null)},500)};JQ_get(request_head,t,a)}function click_new_key_auch_commit(){var e=$("#newKeyAuthCommit").attr("DomainId"),t=$("#NewKeyAuthKey_choice").val(),a=$("#NewKeyAuthEndTime_Input").val();""===a&&(a="always");var o={DomainId:e,KeyId:t,Authway:a};$("#newKeyAuthModal").modal("hide"),new_key_auth(o)}function check_key_auth_date(e){if(""===e)return e;var t=new Date(e.replace(/-/g,"/"));if("Invalid Date"==t.getdate)return"";var a=new Date;return t.getTime()<a.getTime()?"":t.Format("yyyy-MM-dd")}function show_key_grant_module(e,t,a,o){$("#KeyGrantCommit").attr("KeyId",e),$("#KeyGrantCommit").attr("UserId",t),$("#KeyGrantAlertModalLabel").empty(),$("#KeyGrantAlertModalLabel").append("确定转移 "+a+"->"+o),modal_middle($("#KeyGrantAlarm")),$("#KeyGrantAlarm").modal("show")}function click_key_grant_commit(e,t){var a={KeyCode:e,UserId:t},o={action:"KeyGrant",body:a,type:"mod",user:usr.id},i=function(e){var t=e.status;"true"==t?setTimeout(function(){show_alarm_module(!1,"变更成功！",null),get_domain_auth_list($("#KeyAuthPoint_choice").val()),get_proj_key_list(),window.setTimeout(build_key_auth_proj_choice,wait_time_middle)},500):setTimeout(function(){show_alarm_module(!0,"变更失败！"+e.msg,null)},500)};JQ_get(request_head,o,i)}function JQ_get(e,t,a){return"null"!=t.user&&"false"==usr.userauth[t.type]?void show_alarm_module(!0,"您没有进行此操作的权限",null):void jQuery.get(e,t,function(e){log(e);var t=JSON.parse(e);return"false"==t.status?void show_expiredModule():"false"==t.auth?void show_alarm_module(!0,"您没有进行此操作的权限："+t.msg,null):void a(t)})}function JQ_get_with_para(e,t,a,o){return"null"!=t.user&&"false"==usr.userauth[t.type]?void show_alarm_module(!0,"您没有进行此操作的权限",null):void jQuery.get(e,t,function(e){log(e);var t=JSON.parse(e);return"false"==t.status?void show_expiredModule():"false"==t.auth?void show_alarm_module(!0,"您没有进行此操作的权限："+t.msg,null):void a(t,o)})}function thread_sync(e,t,a){var o=0,i=function(t,a){e==threadnumber&&(e=0,clearInterval(t),a())};o=setInterval(function(){i(o,a)},500)}function show_alarm_module(e,t,a){if(e?($("#UserAlertModalLabel").text("警告"),$("#UserAlertModalContent").empty(),$("#UserAlertModalContent").append("<strong>警告！</strong>"+t)):($("#UserAlertModalLabel").text("通知"),$("#UserAlertModalContent").empty(),$("#UserAlertModalContent").append("<strong>通知：</strong>"+t)),modal_middle($("#UserAlarm")),$("#UserAlarm").modal("show"),null===a)emptyfunction=function(){},$("#UserAlarm").on("hide.bs.modal",emptyfunction);else{var o=0;$("#UserAlarm").on("hide.bs.modal",function(){1==++o&&setTimeout(a,500)})}}function getLocation(){console.log("正在获取位置！"),navigator.geolocation?navigator.geolocation.getCurrentPosition(showPosition):console.log("无法获得当前位置！")}function showPosition(e){console.log("Latitude: "+e.coords.latitude+"Longitude: "+e.coords.longitude),Latitude=e.coords.latitude,Longitude=e.coords.longitude}function parameter_initialize(){parameter_initial=!0,null===project_list&&get_project_list(),get_VersionInformation(),draw_parameter_page()}function draw_parameter_page(){$("#UpdateProj_choice").empty();var e,t="";for(null===project_list&&(project_list=[]),e=0;e<project_list.length;e++)t=t+"<option value="+project_list[e].id+">"+project_list[e].name+"</option>";$("#UpdateProj_choice").append(t),get_ProjUpdateStrategy($("#UpdateProj_choice").val()),$("#UpdateProj_choice").change(function(){get_ProjUpdateStrategy($(this).val())}),$("#UpdateLineChange_button").on("click",function(){click_ProjVersionStrategyChange_commit($("#UpdateProj_choice").val(),$("#UpdateLine_choice").val())}),$("#FlashProjUpdatedetail_button").on("click",function(){query_ProjUpdateStrategyList($("#UpdateProj_choice").val())}),$("#ProjAutoUpdate_button").on("click",function(){click_ProjUpdateStrategyChange_commit($("#UpdateProj_choice").val(),"true")}),$("#ProjNotUpdate_button").on("click",function(){click_ProjUpdateStrategyChange_commit($("#UpdateProj_choice").val(),"false")}),$("#UpdateProj_choice").change(function(){query_ProjUpdateStrategyList($("#UpdateProj_choice").val())}),query_ProjUpdateStrategyList($("#UpdateProj_choice").val())}function get_VersionInformation(){var e={action:"VersionInformation",type:"query",user:usr.id},t=function(e){var t=e.status;if("true"==t){for(var a=e.ret,o="<dl ><dt>版本升级详细信息：</dt><p></p>",i=0;i<a.length;i++)o=o+"<dd>"+a[i]+"</dd><p></p>";o+="</dl>",$("#Version_detail").empty(),$("#Version_detail").append(o)}else setTimeout(function(){show_alarm_module(!0,"无法获取版本详细说明！"+e.msg,null)},500)};JQ_get(request_head,e,t)}function get_ProjUpdateStrategy(e){var t={ProjCode:e},a={action:"GetProjUpdateStrategy",body:t,type:"query",user:usr.id},o=function(e){var t=e.status;if("true"==t){var a=e.ret.VersionLine;$("#UpdateLine_choice").val(a)}else setTimeout(function(){show_alarm_module(!0,"无法获取项目处于版本线"+e.msg,null)},500)};JQ_get(request_head,a,o)}function click_ProjVersionStrategyChange_commit(e,t){var a={ProjCode:e,UpdateLine:t},o={action:"ProjVersionStrategyChange",body:a,type:"query",user:usr.id},i=function(e){var t=e.status;"true"==t?setTimeout(function(){show_alarm_module(!1,"版本线更新成功！",null)},500):setTimeout(function(){show_alarm_module(!0,"版本线更新失败"+e.msg,null)},500)};JQ_get(request_head,o,i)}function click_PointUpdateStrategyChange_commit(e,t,a){var o={StatCode:e,AutoUpdate:t},i={action:"PointUpdateStrategyChange",body:o,type:"query",user:usr.id},n=function(e,a){var o=e.status;"true"==o?(a.empty(),"true"===t?(a.append("<em class='glyphicon glyphicon-ok' aria-hidden='true' ></em>"),a.attr("AutoUpdate","Y")):(a.append("<em class='glyphicon glyphicon-remove' aria-hidden='true' ></em>"),a.attr("AutoUpdate","N"))):setTimeout(function(){show_alarm_module(!0,"监测点自动更新设置失败"+e.msg,null)},500)};JQ_get_with_para(request_head,i,n,a)}function click_ProjUpdateStrategyChange_commit(e,t){var a={ProjCode:e,AutoUpdate:t},o={action:"ProjUpdateStrategyChange",body:a,type:"query",user:usr.id},i=function(e){var t=e.status;"true"==t?setTimeout(function(){show_alarm_module(!1,"批量自动更新设置成功！请手动刷新",null)},500):setTimeout(function(){show_alarm_module(!0,"批量自动更新设置失败"+e.msg,null)},500)};JQ_get(request_head,o,i)}function query_ProjUpdateStrategyList(e){var t={ProjCode:e},a={action:"ProjUpdateStrategyList",body:t,type:"query",user:usr.id},o=function(e){if("false"==e.status)return void show_expiredModule();var t=(new Date).Format("yyyy-MM-dd_hhmmss");$("#UpdateFlashTime").empty(),$("#UpdateFlashTime").append("最后刷新时间："+t);var a,o=e.ret.ColumnName,i=e.ret.TableData,n="<thead> <tr>";for(a=0;a<o.length;a++)n=n+"<th>"+o[a]+"</th>";for(n+="</tr></thead>",n+="<tbody>",a=0;a<i.length;a++){n+="<tr>";for(var l=0;l<i[a].length;l++)if(1!=l)n=n+"<td>"+i[a][l]+"</td>";else{var d="glyphicon glyphicon-remove";"Y"===i[a][1]&&(d="glyphicon glyphicon-ok"),n=n+"<td><button type='button' class='btn btn-default update_change_btn' StateCode='"+i[a][0]+"' AutoUpdate= '"+i[a][1]+"'><em class='"+d+"' aria-hidden='true' ></em></button></td>"}n+="</tr>"}n+="</tbody>",$("#ProjUpdateDetailTable").empty(),$("#ProjUpdateDetailTable").append(n),if_update_table_initialize&&$("#ProjUpdateDetailTable").DataTable().destroy();$("#ProjUpdateDetailTable").DataTable({scrollY:!1,scrollCollapse:!0,scrollX:!0,searching:!1,autoWidth:!0,lengthChange:!1,dom:"Bfrtip",buttons:[{text:"自动升级",action:function(e,t,a,o){click_ProjUpdateStrategyChange_commit($("#UpdateProj_choice").val(),"true")}},{text:"手动升级",action:function(e,t,a,o){click_ProjUpdateStrategyChange_commit($("#UpdateProj_choice").val(),"false")}},{extend:"excel",text:"导出到excel",filename:"MonitorData"+t}]});if_update_table_initialize=!0,update_change_btn_click=function(){var e=$(this).attr("StateCode");if(void 0!==e&&null!==e){var t=$(this).attr("AutoUpdate"),a="true";"Y"===t&&(a="false"),click_PointUpdateStrategyChange_commit(e,a,$(this))}},$(".update_change_btn").on("click",update_change_btn_click),$("#ProjUpdateDetailTable").on("draw.dt",function(){$(".update_change_btn").unbind(),$(".update_change_btn").on("click",update_change_btn_click)})};JQ_get(request_head,a,o)}function query_warning_handle_list(){if(Warning_Handle_table_initialized===!0){var e={action:"GetWarningHandleListTable",type:"query",user:usr.id},t=function(e){if("false"==e.status)return void show_expiredModule();var t=(new Date).Format("yyyy-MM-dd_hhmmss");$("#WarningHandleFlashTime").empty(),$("#WarningHandleFlashTime").append("最后刷新时间："+t);var a,o=e.ret.ColumnName,i=e.ret.TableData,n="<thead> <tr><th></th>";for(a=0;a<o.length;a++)n=n+"<th>"+o[a]+"</th>";for(n+="</tr></thead>",n+="<tbody>",a=0;a<i.length;a++){n+="<tr>",n="N"==i[a][1]?n+"<td><ul class='pagination'> <li><a href='#' class = 'alarm_action_btn' StatCode='"+i[a][0]+"'>处理</a> </li></ul></td>":n+"<td><ul class='pagination'> <li><a href='#' class = 'alarm_close_btn' StatCode='"+i[a][0]+"'>关闭</a> </li></ul></td>";for(var l=0;l<i[a].length;l++)n=n+"<td>"+i[a][l]+"</td>";n+="</tr>"}n+="</tbody>",$("#WarningHandleQueryTable").empty(),$("#WarningHandleQueryTable").append(n),if_Warning_Handle_table_initialize&&$("#WarningHandleQueryTable").DataTable().destroy();$("#WarningHandleQueryTable").DataTable({scrollY:!0,scrollCollapse:!0,scrollX:!0,searching:!1,autoWidth:!0,lengthChange:!1,dom:"Bfrtip",select:!0,buttons:{buttons:[{extend:"excel",text:"导出到excel",filename:"AlarmData"+t}]}});if_Warning_Handle_table_initialize=!0,alarm_action_btn_click=function(){var e=$(this).attr("StatCode");$("#AlarmHandleUpdateCommit").attr("StatCode",e);var t=get_point_name(e);$("#AlarmStatName_Input").val(t),modal_middle($("#AlarmHandleProcess")),$("#AlarmHandleProcess").modal("show")},$(".alarm_action_btn").on("click",alarm_action_btn_click),alarm_close_btn_click=function(){var e=$(this).attr("StatCode");handle_Alarm_close(e)},$(".alarm_close_btn").on("click",alarm_close_btn_click),$("#WarningHandleQueryTable").on("draw.dt",function(){$(".alarm_action_btn").unbind(),$(".alarm_close_btn").unbind(),$(".alarm_action_btn").on("click",alarm_action_btn_click),$(".alarm_close_btn").on("click",alarm_close_btn_click)})};JQ_get(request_head,e,t)}}function handle_Alarm_process(e,t,a){var o={StatCode:e,Mobile:t,Action:a},i={action:"AlarmHandle",body:o,type:"mod",user:usr.id},n=function(e){var t=e.status;"true"==t?setTimeout(function(){show_alarm_module(!1,"工单下发成功",null),query_warning_handle_list()},500):setTimeout(function(){show_alarm_module(!0,"工单下发失败"+e.msg,null)},500)};JQ_get(request_head,i,n)}function handle_Alarm_close(e){var t={StatCode:e},a={action:"AlarmClose",body:t,type:"mod",user:usr.id},o=function(e){var t=e.status;"true"==t?setTimeout(function(){show_alarm_module(!1,"告警关闭成功",null),query_warning_handle_list()},500):setTimeout(function(){show_alarm_module(!0,"告警关闭失败"+e.msg,null)},500)};JQ_get(request_head,a,o)}function AlarmHandleUpdateCommit_button_commit(){var e=$("#AlarmHandleUpdateCommit").attr("StatCode"),t=$("#AlarmHandleMobile_Input").val(),a=$("#AlarmHandleAction_Input").val();""!==t&&""!==a&&(handle_Alarm_process(e,t,a),$("#AlarmHandleProcess").modal("hide"))}function query_RTU_list(){if(RTU_Manage_table_initialized===!0){var e={action:"GetRTUTable",type:"query",user:usr.id},t=function(e){if("false"==e.status)return void show_expiredModule();var t=(new Date).Format("yyyy-MM-dd_hhmmss");$("#RTUFlashTime").empty(),$("#RTUFlashTime").append("最后刷新时间："+t);var a,o=e.ret.ColumnName,i=e.ret.TableData,n="<thead> <tr>";for(a=0;a<o.length;a++)n=n+"<th>"+o[a]+"</th>";for(n+="</tr></thead>",n+="<tbody>",a=0;a<i.length;a++){n+="<tr>";for(var l=0;l<i[a].length;l++)n=n+"<td>"+i[a][l]+"</td>";n+="</tr>"}n+="</tbody>",$("#RTUQueryTable").empty(),$("#RTUQueryTable").append(n),if_RTU_Manage_table_initialize&&$("#RTUQueryTable").DataTable().destroy();$("#RTUQueryTable").DataTable({scrollY:!0,scrollCollapse:!0,scrollX:!0,searching:!1,autoWidth:!0,lengthChange:!1,dom:"Bfrtip",select:!0,buttons:{buttons:[{extend:"excel",text:"导出到excel",filename:"AlarmData"+t}]}});if_RTU_Manage_table_initialize=!0};JQ_get(request_head,e,t)}}function query_OTDR_list(){if(OTDR_Manage_table_initialized===!0){var e={action:"GetOTDRTable",type:"query",user:usr.id},t=function(e){if("false"==e.status)return void show_expiredModule();var t=(new Date).Format("yyyy-MM-dd_hhmmss");$("#OTDRFlashTime").empty(),$("#OTDRFlashTime").append("最后刷新时间："+t);var a,o=e.ret.ColumnName,i=e.ret.TableData,n="<thead> <tr>";for(a=0;a<o.length;a++)n=n+"<th>"+o[a]+"</th>";for(n+="</tr></thead>",n+="<tbody>",a=0;a<i.length;a++){n+="<tr>";for(var l=0;l<i[a].length;l++)n=n+"<td>"+i[a][l]+"</td>";n+="</tr>"}n+="</tbody>",$("#OTDRQueryTable").empty(),$("#OTDRQueryTable").append(n),OTDR_Manage_table_initialized&&$("#OTDRQueryTable").DataTable().destroy();$("#OTDRQueryTable").DataTable({scrollY:!0,scrollCollapse:!0,scrollX:!0,searching:!1,autoWidth:!0,lengthChange:!1,dom:"Bfrtip",select:!0,buttons:{buttons:[{extend:"excel",text:"导出到excel",filename:"AlarmData"+t}]}});OTDR_Manage_table_initialized=!0};JQ_get(request_head,e,t)}}function get_pm(e){var t=e,a="http://api.map.baidu.com/telematics/v3/weather?location="+t+"&output=json&ak=2Pcn24FAWGTcyW4jsC8O38IyPd0pDZYX";$.ajax({url:a,scriptCharset:"gbk",dataType:"jsonp",crossDomain:!0,success:function(e){weather_info=t+"今日天气："+e.results[0].weather_data[0].weather+" 气温："+e.results[0].weather_data[0].temperature+" 颗粒物："+e.results[0].pm25,$("#weather_label").text(weather_info+"    ")}})}function getfavoritelist(){var e={action:"Favourite_list",type:"query",user:usr.id},t=function(e){var t=e.status;"true"==t?(usr_faverate_list=e.ret,usr_faverate_list.length>0&&if_online&&get_city(usr_faverate_list[0].Latitude,usr_faverate_list[0].Longitude),build_fast_guild()):show_alarm_module(!0,"请重新登录！"+e.msg,null)};JQ_get(request_head,e,t)}function favorateCount(e){var t={StatCode:e},a={action:"Favourite_count",body:t,type:"query",user:usr.id},o=function(e){var t=e.status;"true"==t||show_alarm_module(!0,"请重新登录！"+e.msg,null)};JQ_get(request_head,a,o)}function build_fast_guild(){$("#fast_guild").empty(),console.log("usr_faverate_list:"+usr_faverate_list),txt="<thead> <tr> <th>常用站点 </th> </tr> </thead> <tbody >";for(var e=0;e<usr_faverate_list.length;e++)txt=txt+"<tr> <td class='favouratelist' Latitude="+usr_faverate_list[e].Latitude+" Longitude="+usr_faverate_list[e].Longitude+" StatCode="+usr_faverate_list[e].StatCode+" StatName="+usr_faverate_list[e].StatName+">"+usr_faverate_list[e].StatName+"</td> </tr>";txt+="</tbody>",$("#fast_guild").append(txt),$(".favouratelist").on("click",function(){var e=$(this).attr("Longitude"),t=$(this).attr("Latitude");map_MPMonitor.centerAndZoom(new BMap.Point(e,t),15);var a=$(this).attr("StatCode")+":"+$(this).attr("StatName"),o=find_marker(a);if(null!==o){get_select_monitor(a);var i=$(this).attr("StatCode")+":"+$(this).attr("StatName"),n=new BMap.InfoWindow(i,{offset:new BMap.Size(0,(-23))});n.setWidth(600),monitor_map_handle=n,get_monitor_warning_on_map(),o.openInfoWindow(n),n.addEventListener("close",function(){monitor_map_handle==this&&(monitor_map_handle=null)})}})}function find_marker(e){for(var t=0;t<mark_MPMonitor_List.length;t++)if(mark_MPMonitor_List[t].getTitle()===e)return mark_MPMonitor_List[t];return null}function get_city(e,t){var a=(new BMap.Map("allmap"),new BMap.Point(t,e)),o=new BMap.Geocoder;o.getLocation(a,function(e){var t=e.addressComponents;usr_favorate_city=t.city,get_pm(usr_favorate_city)})}function getopenpicture(e){var t={openid:e},a={action:"GetOpenImg",body:t,type:"query",user:usr.id},o=function(e){var t=e.status;if("true"==t)if("true"==e.ret.ifpicture){var a=e.ret.picture;window.open("http://"+window.location.host+"/"+show_image_url+"?image="+a+"#","监控照片","height=620, width=640, top=0, left=400,toolbar=no, menubar=no, scrollbars=no, resizable=no, location=no, status=no")}else show_alarm_module(!1,"本次开锁未能捕捉到照片",null);else show_alarm_module(!0,"请重新登录！"+e.msg,null)};JQ_get(request_head,a,o)}function getselectedstationactived(){var e={action:"GetStationActiveInfo",body:{StatCode:point_selected.StatCode},type:"query",user:usr.id},t=function(e){var t=e.status;"true"==t?"true"==e.ret.actived?($("#selectpointactivebutton").attr("disabled",!0),$("#selectpointactivebutton").text("已激活")):($("#selectpointactivebutton").attr("disabled",!1),$("#selectpointactivebutton").text("激活")):show_alarm_module(!0,"请重新登录！"+e.msg,null)};JQ_get(request_head,e,t)}function selectedstationactive(){var e={action:"StationActive",body:{StatCode:point_selected.StatCode},type:"mod",user:usr.id},t=function(e){var t=e.status;"true"==t?setTimeout(function(){show_alarm_module(!1,"激活成功",null),point_intialize(0)},500):setTimeout(function(){show_alarm_module(!0,"激活失败"+e.msg,null)},500)};JQ_get(request_head,e,t)}function getgeographyinfo(){var e={action:"GetGeoList",type:"mod",user:usr.id},t=function(e){var t=e.status;if("true"==t){var a=function(e){return function(t,a){var o;o=[],substrRegex=new RegExp(t,"i"),$.each(e,function(e,t){(substrRegex.test(t.name)||substrRegex.test(t.pinyin)||substrRegex.test(t.pinyinnospace))&&o.push(t.name)}),a(o)}};geography_list=[];for(var o=0;o<e.ret.length;o++){var i={name:e.ret[o],pinyin:"",pinyinnospace:""};$("#AssembleHideWord_Input").val(i.name),i.pinyin=$("#AssembleHideWord_Input").toPinyin(),i.pinyinnospace=i.pinyin.replace(/\s+/g,""),geography_list.push(i)}$("#NewStaffGeoInfo_Input").typeahead({hint:!0,highlight:!0,minLength:1,classNames:{input:"Typeahead-input",hint:"Typeahead-hint",selectable:"Typeahead-selectable"}},{name:"states",source:a(geography_list)})}else show_alarm_module(!0,"请重新登录！"+e.msg,null)};JQ_get(request_head,e,t)}var basic_address=getRelativeURL()+"/";console.log(basic_address);var wait_time_long=3e3,wait_time_middle=1e3,wait_time_short=500,cycle_time=6e4,request_head=basic_address+"request.php",jump_url=basic_address+"jump.php",upload_url=basic_address+"upload.php",admintools_url="/dist/admintools/admintools.html",screen_saver_address=basic_address+"screensaver/screen.html",show_image_url=basic_address+"imageshow/ImageShow.html",global_key_word="",default_point={Flag_la:"N",Latitude:"31.240246",Flag_lo:"E",Longitude:"121.514168"},if_online=!0,user_point=default_point,staff_name_list=[],geography_list=[],page_number=0,page_sequence=null,usr;usr="";var admin="",keystr="",table_row=5,usr_msg="",usr_ifdev="true",usr_img=[],current_table,table_head,map_MPMonitor,map_initialized=!1,user_initial=!1,user_start=0,user_total=0,project_pg_list=null,user_table=null,user_selected,user_selected_auth,user_selected_key,NewUserAuthDual2,user_module_status,staff_initial=!1,staff_start=0,staff_total=0,staff_table=null,staff_selected,staff_module_status,default_staff_left_choice=!1,staff_photo_name="",factory_initial=!1,factory_start=0,factory_total=0,factory_table=null,factory_selected,factory_module_status,factory_list=null,specification_initial=!1,specification_start=0,specification_total=0,specification_table=null,specification_selected,specification_module_status,attendance_module_status,select_attendance_ID=null,pg_initial=!1,pg_start=0,pg_total=0,pg_table=null,pg_selected,pg_selected_proj,NewPGProjDual2,pg_module_status,project_list=null,project_initial=!1,project_start=0,project_total=0,project_table=null,project_selected,project_selected_device,project_module_status,parameter_initial=!1,software_version_list=null,if_update_table_initialize=!1,point_initial=!1,point_start=0,point_total=0,point_table=null,point_selected,project_selected_point,project_selected_key,point_module_status,point_list=null,device_initial=!1,device_start=0,device_total=0,device_table=null,device_selected,device_selected_sensor,device_module_status,key_list=null,proj_user_list=null,key_initial=!1,key_start=0,key_total=0,key_table=null,key_selected,key_selected_auth,key_module_status,monitor_map_list=null,monitor_handle,monitor_selected=null,monitor_list=null,monitor_string="",monitor_map_handle=null,mark_MPMonitor_List=[],usr_faverate_list=null,Monitor_table_initialized=!1,Monitor_table_start=0,Monitor_table_total=0,Monitor_Static_table_initialized=!0,Staff_Static_table_initialized=!0,if_static_table_initialize=!1,Key_History_table_initialized=!1,if_key_history_table_initialize=!1,Attendance_History_table_initialized=!0,if_attendance_history_table_initialize=!1,Assemble_History_table_initialized=!0,if_assemble_history_table_initialize=!1,Assemble_Audit_table_initialized=!0,if_assemble_audit_table_initialize=!1,Attendance_Audit_table_initialized=!0,if_attendance_audit_table_initialize=!1,KPI_Audit_table_initialized=!0,if_kpi_audit_table_initialize=!1,if_Export_table_initialize=!1,Key_auth_initialized=!1,alarm_map_list=null,alarm_type_list=null,alarm_map_initialized=!1,alarm_selected=null,alarm_map_handle=null,alarm_array=null,Warning_Handle_table_initialized=!0,if_Warning_Handle_table_initialize=!1,export_table_name=null,if_table_initialize=!1,sensor_list=null,select_sensor_devcode=null,select_sensor=null,select_key_auth=null,RTU_Manage_table_initialized=!0,OTDR_Manage_table_initialized=!0,if_RTU_Manage_table_initialize=!1,if_OTDR_Manage_table_initialize=!1,camera_unit_h,camera_unit_v,Longitude=null,Latitude=null,CURRENT_URL="desktop",$BODY=$("body"),$MENU_TOGGLE=$("#menu_toggle"),$SIDEBAR_MENU=$("#sidebar-menu"),$SIDEBAR_FOOTER=$(".sidebar-footer"),$LEFT_COL=$(".left_col"),$RIGHT_COL=$(".right_col"),$NAV_MENU=$(".nav_menu"),$FOOTER=$("footer");$(document).ready(function(){var e=document.querySelectorAll(".cycle-menuItem");console.log("items="+e.length);for(var t=0,a=e.length;t<a;t++)e[t].style.left=(50-35*Math.cos(-.5*Math.PI-2*(1/a)*t*Math.PI)).toFixed(4)+"%",e[t].style.top=(50+35*Math.sin(-.5*Math.PI-2*(1/a)*t*Math.PI)).toFixed(4)-15*(t+1)+"%";document.querySelector(".cycle-circle").classList.toggle("open");var o=function(){$RIGHT_COL.css("min-height",$(window).height());var e=$BODY.outerHeight(),t=$FOOTER.outerHeight(),a=$LEFT_COL.eq(1).height()+$SIDEBAR_FOOTER.height(),o=e<a?a:e;o-=$NAV_MENU.outerHeight()+t,$RIGHT_COL.css("min-height",o)};if($SIDEBAR_MENU.find("a").on("click",function(e){var t=$(this).parent();t.is(".active")?(t.removeClass("active active-sm"),$("ul:first",t).slideUp(function(){o()})):(t.parent().is(".child_menu")||($SIDEBAR_MENU.find("li").removeClass("active active-sm"),$SIDEBAR_MENU.find("li ul").slideUp()),t.addClass("active"),$("ul:first",t).slideDown(function(){o()}))}),$MENU_TOGGLE.on("click",function(){$BODY.hasClass("nav-md")?($SIDEBAR_MENU.find("li.active ul").hide(),$SIDEBAR_MENU.find("li.active").addClass("active-sm").removeClass("active")):($SIDEBAR_MENU.find("li.active-sm ul").show(),$SIDEBAR_MENU.find("li.active-sm").addClass("active").removeClass("active-sm")),$BODY.toggleClass("nav-md nav-sm"),o()}),$SIDEBAR_MENU.find('a[href="#"]').on("click",function(){$BODY.hasClass("nav-md")||$(this).parent().parent().slideUp()}),$(window).smartresize(function(){o()}),o(),$.fn.mCustomScrollbar&&$(".menu_fixed").mCustomScrollbar({autoHideScrollbar:!0,theme:"minimal",mouseWheel:{preventDefault:!0}}),$(".staff-js-switch")[0]){var i=Array.prototype.slice.call(document.querySelectorAll(".staff-js-switch"));console.log("switchery list lenght:"+i.length),i.forEach(function(e){new Switchery(e,{color:"#26B99A"})})}}),function(e,t){var a=function(e,t,a){var o;return function(){function i(){a||e.apply(n,l),o=null}var n=this,l=arguments;o?clearTimeout(o):a&&e.apply(n,l),o=setTimeout(i,t||100)}};jQuery.fn[t]=function(e){return e?this.bind("resize",a(e)):this.trigger(t)}}(jQuery,"smartresize"),window.onload=function(){},$(document).ready(function(){$("[data-toggle='modal']").click(function(){var e=$(this).attr("data-target");t=setTimeout(function(){var t=$(e).find(".modal-dialog");t.animate({"margin-top":parseInt(($(window).height()-t.height())/2)},300)},wait_time_short)}),$(".form_date").datetimepicker({language:"zh-CN",weekStart:1,todayBtn:1,autoclose:1,todayHighlight:1,startView:2,minView:2,forceParse:0}),NewUserAuthDual2=$(".NewUserAuthDual").bootstrapDualListbox({nonSelectedListLabel:"全部项目（组）",selectedListLabel:"用户权限",preserveSelectionOnMove:"moved",moveOnSelect:!0,nonSelectedFilter:"",showFilterInputs:!1,infoText:""}),$("#showValue").click(function(){alert($('[name="duallistbox_demo1"]').val())}),NewPGProjDual2=$(".NewPGProjDual").bootstrapDualListbox({nonSelectedListLabel:"全部项目",selectedListLabel:"本组包含",preserveSelectionOnMove:"moved",moveOnSelect:!0,nonSelectedFilter:"",showFilterInputs:!1,infoText:""}),DevUpdateDual2=$(".DevUpdateAuthDual").bootstrapDualListbox({nonSelectedListLabel:"当前设备",selectedListLabel:"需要升级",preserveSelectionOnMove:"moved",moveOnSelect:!0,nonSelectedFilter:"",showFilterInputs:!1,
infoText:""}),$("#LeftStaff").change(function(){var e=$(this).is(":checked");default_staff_left_choice!==e&&(default_staff_left_choice=e,staff_intialize(0))}),$("#Desktop").css("min-height",window.screen.availHeight-300),$("#Undefined").css("min-height",window.screen.availHeight-300),$("#CableCheckView").css("min-height",window.screen.availHeight-300);setInterval(get_monitor_warning_on_map,cycle_time),setInterval(query_warning,cycle_time),setInterval(alarm_cycle,cycle_time);PageInitialize(),$("#menu_logout").on("click",function(){logout()}),$("#UserManage").on("click",function(){CURRENT_URL="UserManage",active_menu("UserManage"),touchcookie(),user_manager()}),$("#StaffManage").on("click",function(){CURRENT_URL="StaffManage",active_menu("StaffManage"),touchcookie(),staff_manager()}),$("#FactoryManage").on("click",function(){CURRENT_URL="FactoryManage",active_menu("FactoryManage"),touchcookie(),factory_manager()}),$("#SpecificationManage").on("click",function(){CURRENT_URL="SpecificationManage",active_menu("SpecificationManage"),touchcookie(),specification_manager()}),$("#AttendanceManage").on("click",function(){CURRENT_URL="AttendanceManage",active_menu("AttendanceManage"),touchcookie(),attendance_history()}),$("#AssembleManage").on("click",function(){CURRENT_URL="AssembleManage",active_menu("AssembleManage"),touchcookie(),assemble_history()}),$("#AssembleAudit").on("click",function(){CURRENT_URL="AssembleAudit",active_menu("AssembleAudit"),touchcookie(),assemble_audit()}),$("#AttendanceAudit").on("click",function(){CURRENT_URL="AttendanceAudit",active_menu("AttendanceAudit"),touchcookie(),attendance_audit()}),$("#KPIAudit").on("click",function(){CURRENT_URL="KPIAudit",active_menu("KPIAudit"),touchcookie(),kpi_audit()}),$("#KeyManage").on("click",function(){CURRENT_URL="KeyManage",active_menu("KeyManage"),touchcookie(),key_manage()}),$("#PGManage").on("click",function(){CURRENT_URL="PGManage",active_menu("PGManage"),touchcookie(),pg_manage()}),$("#ProjManage").on("click",function(){CURRENT_URL="ProjManage",active_menu("ProjManage"),touchcookie(),proj_manage()}),$("#ParaManage").on("click",function(){CURRENT_URL="ParaManage",active_menu("ParaManage"),touchcookie(),para_manage()}),$("#MPManage").on("click",function(){CURRENT_URL="MPManage",active_menu("MPManage"),touchcookie(),mp_manage()}),$("#DevManage").on("click",function(){CURRENT_URL="DevManage",active_menu("DevManage"),touchcookie(),dev_manage()}),$("#MPMonitor").on("click",function(){CURRENT_URL="MPMonitor",active_menu("MPMonitor"),touchcookie(),mp_monitor()}),$("#MPMonitorTable").on("click",function(){CURRENT_URL="MPMonitorTable",active_menu("MPMonitorTable"),touchcookie(),mp_monitor_table()}),$("#MPMonitorCard").on("click",function(){CURRENT_URL="MPMonitorCard",active_menu("MPMonitorCard"),touchcookie(),mp_monitor_card()}),$("#MPStaticMonitorTable").on("click",function(){CURRENT_URL="MPStaticMonitorTable",active_menu("MPStaticMonitorTable"),touchcookie(),mp_static_monitor_table()}),$("#WarningCheck").on("click",function(){CURRENT_URL="WarningCheck",active_menu("WarningCheck"),touchcookie(),warning_check()}),$("#WarningHandle").on("click",function(){CURRENT_URL="WarningHandle",active_menu("WarningHandle"),touchcookie(),warning_handle()}),$("#InstConf").on("click",function(){CURRENT_URL="InstConf",active_menu("InstConf"),touchcookie(),Inst_Conf()}),$("#InstRead").on("click",function(){CURRENT_URL="InstRead",active_menu("InstRead"),touchcookie(),Inst_Read()}),$("#InstDesign").on("click",function(){CURRENT_URL="InstDesign",active_menu("InstDesign"),touchcookie(),Inst_Design()}),$("#InstControl").on("click",function(){CURRENT_URL="InstControl",active_menu("InstControl"),touchcookie(),Inst_Control()}),$("#InstSnapshot").on("click",function(){CURRENT_URL="InstSnapshot",active_menu("InstSnapshot"),touchcookie(),Inst_Snapshot()}),$("#InstVideo").on("click",function(){CURRENT_URL="InstVideo",active_menu("InstVideo"),touchcookie(),Inst_Video()}),$("#AuditTarget").on("click",function(){CURRENT_URL="AuditTarget",active_menu("AuditTarget"),touchcookie(),Audit_Target()}),$("#AuditStability").on("click",function(){CURRENT_URL="AuditStability",active_menu("AuditStability"),touchcookie(),Audit_Stability()}),$("#AuditAvailability").on("click",function(){CURRENT_URL="AuditAvailability",active_menu("AuditAvailability"),touchcookie(),Audit_Availability()}),$("#AuditError").on("click",function(){CURRENT_URL="AuditError",active_menu("AuditError"),touchcookie(),Audit_Error()}),$("#AuditQuality").on("click",function(){CURRENT_URL="AuditQuality",active_menu("AuditQuality"),touchcookie(),Audit_Quality()}),$("#GeoInfoQuery").on("click",function(){CURRENT_URL="GeoInfoQuery",active_menu("GeoInfoQuery"),touchcookie(),Geo_InfoQuery()}),$("#GeoTrendAnalysis").on("click",function(){CURRENT_URL="GeoTrendAnalysis",active_menu("GeoTrendAnalysis"),touchcookie(),Geo_TrendAnalysis()}),$("#GeoDisaterForecast").on("click",function(){CURRENT_URL="GeoDisaterForecast",active_menu("GeoDisaterForecast"),touchcookie(),Geo_DisaterForecast()}),$("#GeoEmergencyDirect").on("click",function(){CURRENT_URL="GeoEmergencyDirect",active_menu("GeoEmergencyDirect"),touchcookie(),Geo_EmergencyDirect()}),$("#GeoDiffusionAnalysis").on("click",function(){CURRENT_URL="GeoDiffusionAnalysis",active_menu("GeoDiffusionAnalysis"),touchcookie(),Geo_DiffusionAnalysis()}),$("#WorkflowDesign").on("click",function(){CURRENT_URL="WorkflowDesign",active_menu("WorkflowDesign"),touchcookie(),Work_flowDesign()}),$("#OrderManagement").on("click",function(){CURRENT_URL="OrderManagement",active_menu("OrderManagement"),touchcookie(),Order_Management()}),$("#UnloadingManagement").on("click",function(){CURRENT_URL="UnloadingManagement",active_menu("UnloadingManagement"),touchcookie(),Unloading_Management()}),$("#OrderAudit").on("click",function(){CURRENT_URL="OrderAudit",active_menu("OrderAudit"),touchcookie(),Order_Audit()}),$("#ADConf").on("click",function(){CURRENT_URL="ADConf",active_menu("ADConf"),touchcookie(),AD_Conf()}),$("#WEBConf").on("click",function(){CURRENT_URL="WEBConf",active_menu("WEBConf"),touchcookie(),WEB_Conf()}),$("#KeyManage").on("click",function(){CURRENT_URL="KeyManage",active_menu("KeyManage"),touchcookie(),key_manage()}),$("#KeyAuth").on("click",function(){CURRENT_URL="KeyAuth",active_menu("KeyAuth"),touchcookie(),key_auth()}),$("#KeyHistory").on("click",function(){CURRENT_URL="KeyHistory",active_menu("KeyHistory"),touchcookie(),key_history()}),$("#ExportTableManage").on("click",function(){CURRENT_URL="ExportTableManage",active_menu("ExportTableManage"),touchcookie(),export_table()}),$("#SoftwareLoadManage").on("click",function(){window.location="http://"+window.location.host+admintools_url+"?session="+getQueryString("session")+"#"}),$("#CableCheck").on("click",function(){CURRENT_URL="CableCheck",active_menu("CableCheck"),touchcookie(),CABLE_Check()}),$("#RTUManage").on("click",function(){CURRENT_URL="RTUManage",active_menu("RTUManage"),touchcookie(),RTU_Manage()}),$("#OTDRManage").on("click",function(){CURRENT_URL="OTDRManage",active_menu("OTDRManage"),touchcookie(),OTDR_Manage()}),$("#UserfreshButton").on("click",function(){touchcookie(),clear_user_detail_panel(),user_intialize(0)}),$("#UserExportButton").on("click",function(){touchcookie();var e=[],t={ConditonName:"UserId",Equal:usr.id,GEQ:"",LEQ:""};e.push(t),Data_export_Normal("用户表导出","usertable",e,[])}),$("#UserNewButton").on("click",function(){touchcookie(),show_new_user_module()}),$("#UserDelButton").on("click",function(){touchcookie(),null===user_selected?show_alarm_module(!0,"请选择一个用户",null):(modal_middle($("#UserDelAlarm")),$("#UserDelAlarm").modal("show"))}),$("#UserModifyButton").on("click",function(){touchcookie(),null===user_selected?show_alarm_module(!0,"请选择一个用户",null):show_mod_user_module(user_selected,user_selected_auth)}),$("#delUserCommit").on("click",function(){del_user(user_selected.id),touchcookie()}),$("#newUserCommit").on("click",function(){user_module_status?(submit_new_user_module(),touchcookie()):(submit_mod_user_module(),touchcookie())}),$("#StafffreshButton").on("click",function(){touchcookie(),clear_staff_detail_panel(),staff_intialize(0)}),$("#StaffExportButton").on("click",function(){touchcookie();var e=[],t={ConditonName:"StaffId",Equal:usr.id,GEQ:"",LEQ:""};e.push(t),Data_export_Normal("用户表导出","stafftable",e,[])}),$("#StaffNewButton").on("click",function(){touchcookie(),show_new_staff_module()}),$("#StaffDelButton").on("click",function(){touchcookie(),null===staff_selected?show_alarm_module(!0,"请选择一个员工",null):(modal_middle($("#StaffDelAlarm")),$("#StaffDelAlarm").modal("show"))}),$("#StaffModifyButton").on("click",function(){touchcookie(),null===staff_selected?show_alarm_module(!0,"请选择一个员工",null):show_mod_staff_module(staff_selected)}),$("#delStaffCommit").on("click",function(){del_staff(staff_selected.id),touchcookie()}),$("#newStaffCommit").on("click",function(){staff_module_status?(submit_new_staff_module(),touchcookie()):(submit_mod_staff_module(),touchcookie())}),$("#FactoryNewButton").on("click",function(){touchcookie(),show_new_factory_module()}),$("#FactoryDelButton").on("click",function(){touchcookie(),null===factory_selected?show_alarm_module(!0,"请选择一个工厂",null):(modal_middle($("#FactoryDelAlarm")),$("#FactoryDelAlarm").modal("show"))}),$("#FactoryModifyButton").on("click",function(){touchcookie(),null===factory_selected?show_alarm_module(!0,"请选择一个工厂",null):show_mod_factory_module(factory_selected)}),$("#delFactoryCommit").on("click",function(){del_factory(factory_selected.factoryid),touchcookie()}),$("#newFactoryCommit").on("click",function(){factory_module_status?(submit_new_factory_module(),touchcookie()):(submit_mod_factory_module(),touchcookie())}),$("#SpecificationNewButton").on("click",function(){touchcookie(),show_new_specification_module()}),$("#SpecificationDelButton").on("click",function(){touchcookie(),null===specification_selected?show_alarm_module(!0,"请选择一个规格",null):(modal_middle($("#SpecificationDelAlarm")),$("#SpecificationDelAlarm").modal("show"))}),$("#SpecificationModifyButton").on("click",function(){touchcookie(),null===specification_selected?show_alarm_module(!0,"请选择一个规格",null):show_mod_specification_module(specification_selected)}),$("#delSpecificationCommit").on("click",function(){del_specification(specification_selected.specificationid),touchcookie()}),$("#newSpecificationCommit").on("click",function(){specification_module_status?(submit_new_specification_module(),touchcookie()):(submit_mod_specification_module(),touchcookie())}),$("#PGfreshButton").on("click",function(){touchcookie(),clear_pg_detail_panel(),pg_intialize(0)}),$("#PGExportButton").on("click",function(){touchcookie();var e=[],t={ConditonName:"UserId",Equal:usr.id,GEQ:"",LEQ:""};e.push(t),Data_export_Normal("项目组表导出","PGtable",e,[])}),$("#PGNewButton").on("click",function(){touchcookie(),show_new_pg_module()}),$("#PGDelButton").on("click",function(){touchcookie(),null===pg_selected?show_alarm_module(!0,"请选择一个项目组",null):(modal_middle($("#PGDelAlarm")),$("#PGDelAlarm").modal("show"))}),$("#PGModifyButton").on("click",function(){touchcookie(),null===pg_selected?show_alarm_module(!0,"请选择一个项目组",null):show_mod_pg_module(pg_selected,pg_selected_proj)}),$("#delPGCommit").on("click",function(){del_pg(pg_selected.PGCode),touchcookie()}),$("#newPGCommit").on("click",function(){pg_module_status?(submit_new_pg_module(),touchcookie()):(submit_mod_pg_module(),touchcookie())}),$("#ProjfreshButton").on("click",function(){touchcookie(),clear_proj_detail_panel(),proj_intialize(0)}),$("#ProjExportButton").on("click",function(){touchcookie();var e=[],t={ConditonName:"UserId",Equal:usr.id,GEQ:"",LEQ:""};e.push(t),Data_export_Normal("项目表导出","Projtable",e,[])}),$("#ProjNewButton").on("click",function(){touchcookie(),show_new_proj_module()}),$("#ProjDelButton").on("click",function(){touchcookie(),null===project_selected?show_alarm_module(!0,"请选择一个项目",null):(modal_middle($("#ProjDelAlarm")),$("#ProjDelAlarm").modal("show"))}),$("#ProjModifyButton").on("click",function(){touchcookie(),null===project_selected?show_alarm_module(!0,"请选择一个项目",null):show_mod_proj_module(project_selected)}),$("#delProjCommit").on("click",function(){del_proj(project_selected.ProjCode),touchcookie()}),$("#newProjCommit").on("click",function(){project_module_status?(submit_new_proj_module(),touchcookie()):(submit_mod_proj_module(),touchcookie())}),$("#PointfreshButton").on("click",function(){touchcookie(),clear_point_detail_panel(),point_intialize(0)}),$("#PointExportButton").on("click",function(){touchcookie();var e=[],t={ConditonName:"UserId",Equal:usr.id,GEQ:"",LEQ:""};e.push(t),Data_export_Normal("站点导出","Pointtable",e,[])}),$("#PointNewButton").on("click",function(){touchcookie(),show_new_point_module()}),$("#PointDelButton").on("click",function(){touchcookie(),null===point_selected?show_alarm_module(!0,"请选择一个站点",null):(modal_middle($("#PointDelAlarm")),$("#PointDelAlarm").modal("show"))}),$("#PointModifyButton").on("click",function(){touchcookie(),null===point_selected?show_alarm_module(!0,"请选择一个站点",null):show_mod_point_module(point_selected)}),$("#delPointCommit").on("click",function(){del_point(point_selected.StatCode),touchcookie()}),$("#newPointCommit").on("click",function(){point_module_status?(submit_new_point_module(),touchcookie()):(submit_mod_point_module(),touchcookie())}),$("#DevfreshButton").on("click",function(){touchcookie(),clear_dev_detail_panel(),dev_intialize(0)}),$("#DevExportButton").on("click",function(){touchcookie();var e=[],t={ConditonName:"UserId",Equal:usr.id,GEQ:"",LEQ:""};e.push(t),Data_export_Normal("设备表导出","Devtable",e,[])}),$("#DevNewButton").on("click",function(){touchcookie(),show_new_dev_module()}),$("#DevDelButton").on("click",function(){touchcookie(),null===device_selected?show_alarm_module(!0,"请选择一个设备",null):(modal_middle($("#DevDelAlarm")),$("#DevDelAlarm").modal("show"))}),$("#DevModifyButton").on("click",function(){touchcookie(),null===device_selected?show_alarm_module(!0,"请选择一个设备",null):show_mod_dev_module(device_selected)}),$("#delDevCommit").on("click",function(){del_dev(device_selected.DevCode),touchcookie()}),$("#newDevCommit").on("click",function(){device_module_status?(submit_new_dev_module(),touchcookie()):(submit_mod_dev_module(),touchcookie())}),$("#AttendanceHistoryStartTime_input").change(function(){var e=$("#AttendanceHistoryStartTime_input").val(),t=$("#AttendanceHistoryEndTime_input").val(),a=date_compare_today(e);if(e!==a&&($("#AttendanceHistoryStartTime_input").val(a),e=a),""===t)$("#AttendanceHistoryEndTime_input").val(e);else{var o=date_compare(e,t),i=dateplus30(e),n=date_compare(i,t);o===t?$("#AttendanceHistoryEndTime_input").val(e):n===i&&$("#AttendanceHistoryEndTime_input").val(i)}}),$("#AttendanceHistoryEndTime_input").change(function(){var e=$("#AttendanceHistoryStartTime_input").val(),t=$("#AttendanceHistoryEndTime_input").val(),a=date_compare_today(t);if(t!==a&&($("#AttendanceHistoryEndTime_input").val(a),t=a),""===e)$("#AttendanceHistoryStartTime_input").val(t);else{var o=date_compare(e,t),i=dateminus30(t),n=date_compare(i,e);o===t?$("#AttendanceHistoryStartTime_input").val(t):n===e&&$("#AttendanceHistoryStartTime_input").val(i)}}),$("#AssembleHistoryStartTime_input").change(function(){var e=$("#AssembleHistoryStartTime_input").val(),t=$("#AssembleHistoryEndTime_input").val(),a=date_compare_today(e);if(e!==a&&($("#AssembleHistoryStartTime_input").val(a),e=a),""===t)$("#AssembleHistoryEndTime_input").val(e);else{var o=date_compare(e,t),i=dateplus30(e),n=date_compare(i,t);o===t?$("#AssembleHistoryEndTime_input").val(e):n===i&&$("#AssembleHistoryEndTime_input").val(i)}}),$("#AssembleHistoryEndTime_input").change(function(){var e=$("#AssembleHistoryStartTime_input").val(),t=$("#AssembleHistoryEndTime_input").val(),a=date_compare_today(t);if(t!==a&&($("#AssembleHistoryEndTime_input").val(a),t=a),""===e)$("#AssembleHistoryStartTime_input").val(t);else{var o=date_compare(e,t),i=dateminus30(t),n=date_compare(i,e);o===t?$("#AssembleHistoryStartTime_input").val(t):n===e&&$("#AssembleHistoryStartTime_input").val(i)}}),$("#AssembleAuditStartTime_input").change(function(){var e=$("#AssembleAuditStartTime_input").val(),t=$("#AssembleAuditEndTime_input").val(),a=date_compare_today(e);if(e!==a&&($("#AssembleAuditStartTime_input").val(a),e=a),""===t)$("#AssembleAuditEndTime_input").val(e);else{var o=date_compare(e,t),i=dateplus30(e),n=date_compare(i,t);o===t?$("#AssembleAuditEndTime_input").val(e):n===i&&$("#AssembleAuditEndTime_input").val(i)}}),$("#AssembleAuditEndTime_input").change(function(){var e=$("#AssembleAuditStartTime_input").val(),t=$("#AssembleAuditEndTime_input").val(),a=date_compare_today(t);if(t!==a&&($("#AssembleAuditEndTime_input").val(a),t=a),""===e)$("#AssembleAuditStartTime_input").val(t);else{var o=date_compare(e,t),i=dateminus30(t),n=date_compare(i,e);o===t?$("#AssembleAuditStartTime_input").val(t):n===e&&$("#AssembleAuditStartTime_input").val(i)}}),$("#AttendanceAuditStartTime_input").change(function(){var e=$("#AttendanceAuditStartTime_input").val(),t=$("#AttendanceAuditEndTime_input").val(),a=date_compare_today(e);if(e!==a&&($("#AttendanceAuditStartTime_input").val(a),e=a),""===t)$("#AttendanceAuditEndTime_input").val(e);else{var o=date_compare(e,t),i=dateplus30(e),n=date_compare(i,t);o===t?$("#AttendanceAuditEndTime_input").val(e):n===i&&$("#AttendanceAuditEndTime_input").val(i)}}),$("#AttendanceAuditEndTime_input").change(function(){var e=$("#AttendanceAuditStartTime_input").val(),t=$("#AttendanceAuditEndTime_input").val(),a=date_compare_today(t);if(t!==a&&($("#AttendanceAuditEndTime_input").val(a),t=a),""===e)$("#AttendanceAuditStartTime_input").val(t);else{var o=date_compare(e,t),i=dateminus30(t),n=date_compare(i,e);o===t?$("#AttendanceAuditStartTime_input").val(t):n===e&&$("#AttendanceAuditStartTime_input").val(i)}}),$("#KPIAuditStartTime_input").change(function(){var e=$("#KPIAuditStartTime_input").val(),t=$("#KPIAuditEndTime_input").val(),a=date_compare_today(e);if(e!==a&&($("#KPIAuditStartTime_input").val(a),e=a),""===t)$("#KPIAuditEndTime_input").val(e);else{var o=date_compare(e,t),i=dateplus30(e),n=date_compare(i,t);o===t?$("#KPIAuditEndTime_input").val(e):n===i&&$("#KPIAuditEndTime_input").val(i)}}),$("#KPIAuditEndTime_input").change(function(){var e=$("#KPIAuditStartTime_input").val(),t=$("#KPIAuditEndTime_input").val(),a=date_compare_today(t);if(t!==a&&($("#KPIAuditEndTime_input").val(a),t=a),""===e)$("#KPIAuditStartTime_input").val(t);else{var o=date_compare(e,t),i=dateminus30(t),n=date_compare(i,e);o===t?$("#KPIAuditStartTime_input").val(t):n===e&&$("#KPIAuditStartTime_input").val(i)}}),$("#DevProjCode_choice").change(function(){get_proj_point_option($("#DevProjCode_choice").val(),$("#DevStatCode_choice"),"")}),$("#QueryProjCode_choice").change(function(){get_proj_point_option($("#QueryProjCode_choice").val(),$("#QueryStatCode_choice"),"")}),$("#AlarmQueryCommit").on("click",function(){if(touchcookie(),null===alarm_selected)return void $("#WCStatCode_Input").attr("placeholder","请先在地图上选择一个点");if(""===$("#Alarm_query_Input").val()||null===$("#Alarm_query_Input").val())return void $("#Alarm_query_Input").attr("placeholder","请输入日期");if(null!==alarm_type_list){unhide_all_chart();for(var e=0;e<alarm_type_list.length;e++)query_alarm($("#Alarm_query_Input").val(),alarm_type_list[e].id,alarm_type_list[e].name)}}),$("#Video_query_Input").change(function(){$("#Video_query_Input").val(date_compare_today($("#Video_query_Input").val())),video_selection_change()}),$("#VideoHour_choice").change(function(){video_selection_change()}),$("#VideoModuleHour_choice").change(function(){video_Module_selection_change()}),$("#VideoModule_query_Input").change(function(){video_Module_selection_change()}),$("#Alarm_query_Input").change(function(){$("#Alarm_query_Input").val(date_compare_today($("#Alarm_query_Input").val()))}),$("#AlarmExport").on("click",function(){touchcookie(),Data_export_alarm()}),$("#AlarmQuery_Commit").on("click",function(){touchcookie(),submit_alarm_query()}),$("#SensorUpdateCommit").on("click",function(){touchcookie(),submit_sensor_module()}),$("#ExpiredConfirm").on("click",function(){logout()}),$("#QueryStartTime_Input").change(function(){$("#QueryStartTime_Input").val(date_compare_today($("#QueryStartTime_Input").val())),""===$("#QueryEndTime_Input").val()?$("#QueryEndTime_Input").val($("#QueryStartTime_Input").val()):$("#QueryEndTime_Input").val(date_compare($("#QueryEndTime_Input").val(),$("#QueryStartTime_Input").val()))}),$("#QueryEndTime_Input").change(function(){""===$("#QueryStartTime_Input").val()?($("#QueryEndTime_Input").val(date_compare_today($("#QueryEndTime_Input").val())),$("#QueryStartTime_Input").val($("#QueryStartTime_Input").val())):$("#QueryEndTime_Input").val(date_compare($("#QueryEndTime_Input").val(),$("#QueryStartTime_Input").val()))}),$("#VCRshow").on("click",function(){var e=$("#VCRStatus_choice").val();""!==e&&video_windows(e)}),$("#ModuleVCRshow").on("click",function(){var e=$("#ModuleVCRStatus_choice").val();""!==e&&video_windows(e)}),$("#MonitorTableFlash").on("click",function(){query_static_warning()}),$("#WarningHandleTableFlash").on("click",function(){query_warning_handle_list()}),$("#RTUFlash").on("click",function(){query_RTU_list()}),$("#OTDRFlash").on("click",function(){query_OTDR_list()}),$("#menu_user_profile").on("click",function(){touchcookie(),show_usr_msg_module()}),$("#ScreenSaver").on("click",function(){null!==monitor_selected&&screen_windows()}),$("#UsrMsgCommit").on("click",function(){touchcookie(),user_message_update()}),$("#UsrImgClean").on("click",function(){touchcookie(),clear_user_image()}),$("#UsrImgFlash").on("click",function(){touchcookie(),get_user_image()}),$("#UpdateConfirm_button").on("click",function(){touchcookie(),update_version()}),$("#btn_camera_up").on("click",function(){var e=$("#VideoModuleStatCode_Input").val();void 0!==e&&""!==e&&move_camera(e,"v","1")}),$("#btn_camera_down").on("click",function(){var e=$("#VideoModuleStatCode_Input").val();void 0!==e&&""!==e&&move_camera(e,"v","-1")}),$("#btn_camera_right").on("click",function(){var e=$("#VideoModuleStatCode_Input").val();void 0!==e&&""!==e&&move_camera(e,"v","1")}),$("#btn_camera_left").on("click",function(){var e=$("#VideoModuleStatCode_Input").val();void 0!==e&&""!==e&&move_camera(e,"v","-1")}),$(".lock_monitor_btn").on("click",function(){monitor_lock()}),$("#UnlockConfirmBtn").on("click",function(){var e=$(this).attr("StateCode");void 0!==e&&""!==e&&openlock(e)}),$(".keyrow").on("click",function(){var e=$(this).attr("id");void 0!==e&&""!==e&&get_key_auth_list(e)}),$("#KeyfreshButton").on("click",function(){touchcookie(),clear_key_detail_panel(),key_intialize(0)}),$("#KeyExportButton").on("click",function(){touchcookie();var e=[],t={ConditonName:"UserId",Equal:usr.id,GEQ:"",LEQ:""};e.push(t),Data_export_Normal("钥匙表导出","keytable",e,[])}),$("#KeyNewButton").on("click",function(){touchcookie(),show_new_key_module()}),$("#KeyDelButton").on("click",function(){touchcookie(),null===key_selected?show_alarm_module(!0,"请选择一把钥匙",null):(modal_middle($("#KeyDelAlarm")),$("#KeyDelAlarm").modal("show"))}),$("#KeyModifyButton").on("click",function(){touchcookie(),null===key_selected?show_alarm_module(!0,"请选择一把钥匙",null):show_mod_key_module(key_selected)}),$("#delKeyCommit").on("click",function(){del_key(key_selected.KeyCode),touchcookie()}),$("#newKeyCommit").on("click",function(){key_module_status?(submit_new_key_module(),touchcookie()):(submit_mod_key_module(),touchcookie())}),$("#AttendanceHistoryTableFlash").on("click",function(){query_attendance_history(),touchcookie()}),$("#AssembleHistoryTableFlash").on("click",function(){query_assemble_history(),touchcookie()}),$("#AttendanceAuditTableFlash").on("click",function(){query_attendance_audit(),touchcookie()}),$("#KPIAuditTableFlash").on("click",function(){query_kpi_audit(),touchcookie()}),$("#AssembleAuditTableFlash").on("click",function(){query_assemble_audit(),touchcookie()}),$("#KeyHistoryTableFlash").on("click",function(){query_open_lock_history(),touchcookie()}),$("#ExportTableFlash").on("click",function(){query_export_table(),touchcookie()}),$("#KeyAuthQuery").on("click",function(){get_domain_auth_list($("#KeyAuthPoint_choice").val()),touchcookie()}),$("#KeyAuthNew").on("click",function(){show_auth_new_module($("#KeyAuthProj_choice").val(),$("#KeyAuthPoint_choice").val(),$("#KeyAuthPoint_choice").find("option:selected").text()),touchcookie()}),$("#KeyUserChange").on("click",function(){show_key_grant_module($("#KeyUserKey_choice").val(),$("#KeyUserUser_choice").val(),$("#KeyUserKey_choice").find("option:selected").text(),$("#KeyUserUser_choice").find("option:selected").text()),touchcookie()}),$("#delKeyAuthCommit").on("click",function(){$("#KeyAuthDelAlarm").modal("hide"),key_auth_delete($(this).attr("AuthId")),touchcookie()}),$("#newKeyAuthCommit").on("click",function(){click_new_key_auch_commit(),touchcookie()}),$("#NewKeyAuthEndTime_Input").change(function(){$("#NewKeyAuthEndTime_Input").val(check_key_auth_date($(this).val()))}),$("#KeyGrantCommit").on("click",function(){$("#KeyGrantAlarm").modal("hide"),click_key_grant_commit($(this).attr("KeyId"),$(this).attr("UserId"))}),$("#AlarmHandleUpdateCommit").on("click",function(){AlarmHandleUpdateCommit_button_commit()}),$("#newAttendanceCommit").on("click",function(){attendance_module_status?new_attendance_submit():mod_attendance_submit()}),$("#delAttendanceCommit").on("click",function(){var e=$("#delAttendanceCommit").attr("AttendanceID");del_attendance(e),$("#AttendanceDelAlarm").modal("hide")}),$("#AttendanceHistoryTableNew").on("click",function(){show_new_attendance_module()}),$("#CommonQueryCommit").on("click",function(){if(global_key_word!=$("#CommonQueryInput").val())switch(global_key_word=$("#CommonQueryInput").val(),CURRENT_URL){case"UserManage":user_intialize(0);break;case"StaffManage":staff_intialize(0);break;case"FactoryManage":factory_intialize(0);break;case"SpecificationManage":specification_intialize(0);break;case"KeyManage":key_intialize(0);break;case"PGManage":pg_intialize(0);break;case"ProjManage":proj_intialize(0);break;case"MPManage":point_intialize(0);break;case"DevManage":dev_intialize(0)}}),$("#StationActiveConfirmBtn").on("click",function(){selectedstationactive()}),$("#AttendanceHistoryTableBatchNew").on("click",function(){touchcookie(),modal_middle($("#AttendanceBatchAlarm")),$("#AttendanceBatchAlarm").modal("show")}),$("#AttendanceBatchCommit").on("click",function(){touchcookie(),new_attendance_batch()}),clear_window(),desktop(),calculate_row(),clear_user_detail_panel(),clear_staff_detail_panel(),clear_factory_detail_panel(),clear_specification_detail_panel(),clear_proj_detail_panel(),$(window).resize()});