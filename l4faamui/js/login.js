function getsec(e){var t=Number(e.substring(1,e.length)),n=e.substring(0,1);return"s"==n?1e3*t:"m"==n?60*t*1e3:"h"==n?60*t*60*1e3:"d"==n?24*t*60*60*1e3:void 0}function setCookie(e,t,n){var o=getsec(n),i=new Date;i.getTime()+Number(o),i.setTime(i.getTime()+Number(o)),document.cookie=e+"="+escape(t)+";expires="+i.toGMTString()}function getCookie(e){var t,n=new RegExp("(^| )"+e+"=([^;]*)(;|$)");return t=document.cookie.match(n),t===!0?unescape(t[2]):null}function jump(e){log("try to dump to session "+window.location.host+jump_url+"?session"+e),window.location="http://"+window.location.host+jump_url+"?session="+e}function modal_middle(e){setTimeout(function(){var t=$(e).find(".modal-dialog");t.animate({"margin-top":parseInt(($(window).height()-t.height())/2)},300)},200)}function get_size(){window.innerWidth?winWidth=window.innerWidth:document.body&&document.body.clientWidth&&(winWidth=document.body.clientWidth),window.innerHeight?winHeight=window.innerHeight:document.body&&document.body.clientHeight&&(winHeight=document.body.clientHeight),document.documentElement&&document.documentElement.clientHeight&&document.documentElement.clientWidth&&(winHeight=document.documentElement.clientHeight,winWidth=document.documentElement.clientWidth),console.log("winWidth = "+winWidth),console.log("winHeight= "+winHeight);var e=winHeight;winHeight>winWidth&&(e=winWidth),logoHeight=parseInt(e/5),headHeight=parseInt(e/5),$("#logo").css("height",logoHeight),$("#webhead").css("height",logoHeight),$("body").css("height",winHeight);var t=(parseInt((winHeight-180)/2)-64)/2;$("#kuang").css("margin-top",t),winHeight>winWidth&&$("#webhead").css("margin-top",logoHeight)}function JQ_get(e,t,n){jQuery.get(e,t,function(e){log(e);var t=JSON.parse(e);n(t)})}function jump_to_password_change(){window.location="http://"+window.location.host+lost_url}function jump_to_login(){window.location="http://"+window.location.host+login_url}function send_authcode(e){var t={name:e},n={action:"Get_user_auth_code",body:t,type:"query",user:null},o=function(e){"true"!=e.status?($("#UserAlertModalLabel").text="警告",$("#UserAlertModalContent").empty(),$("#UserAlertModalContent").append("<strong>警告！</strong>"+e.msg),modal_middle($("#UserAlarm")),$("#UserAlarm").modal("show")):sms_buffer()};JQ_get(request_head,n,o)}function sms_buffer(){$("#Send_SMS").attr("disabled","disabled"),$("#Send_SMS").attr("data-cycle","0"),cycle_action=function(){cyclenumber=parseInt($("#Send_SMS").attr("data-cycle")),console.log(cyclenumber),cyclenumber+1==60?($("#Send_SMS").attr("disabled",!1),$("#Send_SMS").attr("data-cycle","0"),$("#Send_SMS").text("发送验证码"),window.clearInterval(tempInterval)):($("#Send_SMS").attr("data-cycle",cyclenumber+1),$("#Send_SMS").text("请等待"+(60-cyclenumber)+"秒"))},tempInterval=setInterval(cycle_action,1e3)}function passwordchange(){var e=$("#Username_Input").val(),t=$("#Authcode_Input").val(),n=$("#NewPassword_Input").val(),o=$("#reNewPassword_Input").val();if(""===e)return void $("#Username_Input").focus();if(""===t)return void $("#Authcode_Input").focus();if(""===n)return void $("#NewPassword_Input").focus();if(""===o)return void $("#reNewPassword_Input").focus();if(n!=o)return $("#NewPassword_Input").val(""),$("#reNewPassword_Input").val(""),$("#NewPassword_Input").attr("placeholder","两个密码不相同"),$("#reNewPassword_Input").attr("placeholder","两个密码不相同"),void $("#NewPassword_Input").focus();var i={name:e,code:t,password:b64_sha1(n)},a={action:"Reset_password",body:i,type:"query",user:null},s=function(e){"true"!=e.status?($("#UserAlertModalLabel").text="警告",$("#UserAlertModalContent").empty(),$("#UserAlertModalContent").append("<strong>警告！</strong>"+e.msg),modal_middle($("#UserAlarm")),$("#UserAlarm").modal("show")):(setCookie("Environmental.inspection.session",e.ret.key,"m10"),jump(e.ret.key))};JQ_get(request_head,a,s)}var basic_address=getRelativeURL()+"/",request_head=basic_address+"request.php",jump_url=basic_address+"jump.php",login_url=basic_address+"Login.html",lost_url=basic_address+"LostPassword.html",winHeight=800,winWidth=800,logoHeight=100,headHeight=100,tempInterval=0;$(document).ready(function(){get_size();var e=parseInt($(".leaderboard").css("padding-top").replace(/[^0-9]/gi,""));(window.screen.availHeight-600)/2>e&&(e=(window.screen.availHeight-600)/2),$(".leaderboard").css("padding-top",e+"px"),console.log($(".leaderboard").css("padding-top")),$("#Login_Comfirm").on("click",function(){if(""===$("#Username_Input").val())return void $("#Username_Input").focus();if(""===$("#Password_Input").val())return void $("#Password_Input").focus();setCookie("Environmental.inspection.usrname",$("#Username_Input").val(),"d30");var e={action:"login",name:$("#Username_Input").val(),password:b64_sha1($("#Password_Input").val())},t=function(e){"true"!=e.status?($("#UserAlertModalLabel").text="警告",$("#UserAlertModalContent").empty(),$("#UserAlertModalContent").append("<strong>警告！</strong>"+e.msg),modal_middle($("#UserAlarm")),$("#UserAlarm").modal("show")):(setCookie("Environmental.inspection.session",e.ret.key,"m10"),jump(e.ret.key))};JQ_get(request_head,e,t)}),$("#Forget_Password").on("click",function(){jump_to_password_change()}),$("#back_to_Login").on("click",function(){jump_to_login()}),$("#Send_SMS").on("click",function(){var e=$("#Username_Input").val();return""===e?void $("#Username_Input").focus():void send_authcode(e)}),$("#NewPassword_Comfirm").on("click",function(){passwordchange()})}),window.onload=function(){$("[data-toggle='modal']").click(function(){var e=$(this).attr("data-target");t=setTimeout(function(){var t=$(e).find(".modal-dialog");t.animate({"margin-top":parseInt(($(window).height()-t.height())/2)},300)},200)});var e=getCookie("Environmental.inspection.usrname");null!==e&&$("#Username_Input").val(e);var n=getCookie("Environmental.inspection.session");log("check cookie: username["+e+"]session["+n+"]"),null!==n&&n.length>0&&jump(n)};